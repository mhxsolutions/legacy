<!--
  Copyright (C) 2003-2010 GrapeCity Inc.	All rights reserved.
-->
<public:component>
<PUBLIC:METHOD NAME="Copy" />
<PUBLIC:METHOD NAME="Paste" />
<PUBLIC:METHOD NAME="Clear" />
<PUBLIC:METHOD NAME="Update" />
<PUBLIC:METHOD NAME="Cancel" />
<PUBLIC:METHOD NAME="Add" />
<PUBLIC:METHOD NAME="Insert" />
<PUBLIC:METHOD NAME="Delete" />
<PUBLIC:METHOD NAME="Prev" />
<PUBLIC:METHOD NAME="Next" />
<PUBLIC:METHOD NAME="StartEdit" /> 
<PUBLIC:METHOD NAME="EndEdit" />
<PUBLIC:METHOD NAME="Print" />
<PUBLIC:METHOD NAME="PrintPDF" />

<PUBLIC:METHOD NAME="GetSelectedRange" />
<PUBLIC:METHOD NAME="SetSelectedRange" />
<PUBLIC:METHOD NAME="ClearSelection" />
<PUBLIC:METHOD NAME="GetSelectedRanges" />
<PUBLIC:METHOD NAME="AddSelection" />

<PUBLIC:METHOD NAME="SuspendLayout" />
<PUBLIC:METHOD NAME="ResumeLayout" />

<PUBLIC:PROPERTY NAME="ActiveRow" GET="getActiveRow" />
<PUBLIC:PROPERTY NAME="ActiveCol" GET="getActiveCol" />

<!--[Owen] makes unpredictable cases, and make wrong attributes accessing behaviors. 
          And in IE9 we always use get/set attribute functions-->
<!--<PUBLIC:PROPERTY NAME="getAttribute" GET="getAttribute" />-->

<!--Client-Side Object Model Enhancement start-->
<PUBLIC:METHOD NAME="Cells"/>
<PUBLIC:METHOD NAME="Rows"/>
<PUBLIC:METHOD NAME="Columns"/>
<PUBLIC:METHOD NAME="GetTitleInfo"/>
<!--Client-Side Object Model Enhancement end-->


<PUBLIC:METHOD NAME="ShowMessage" />
<PUBLIC:METHOD NAME="HideMessage" />
<PUBLIC:METHOD NAME="SetActiveSpreadID"  internalName="setActiveSpreadID" />

<!-- FpChart start -->
<PUBLIC:METHOD NAME="SetActiveChart" />
<PUBLIC:METHOD NAME="GetActiveChart" />
<!-- FpChart end -->

<PUBLIC:METHOD NAME="SetActiveCell" />
<PUBLIC:METHOD NAME="GetCellByRowCol" />
<PUBLIC:METHOD NAME="GetValue" />
<PUBLIC:METHOD NAME="SetValue" />
<PUBLIC:METHOD NAME="GetFormula" />
<PUBLIC:METHOD NAME="SetFormula" />
<PUBLIC:METHOD NAME="GetHiddenValue" />

<PUBLIC:METHOD NAME="GetSheetRowIndex" />
<PUBLIC:METHOD NAME="GetSheetColIndex" />

<PUBLIC:METHOD NAME="GetTopRowIndex" />
<PUBLIC:METHOD NAME="GetLeftColIndex" />

<PUBLIC:METHOD NAME="GetRowByKey" internalName="getRowByKey2" /><!--#99915815 - Jeff 2010/04/23-->
<PUBLIC:METHOD NAME="GetColByKey" internalName="getColByKey2" /><!--#99915815 - Jeff 2010/04/23-->

<PUBLIC:METHOD NAME="GetRowKeyFromRow" internalName="getRowKeyFromRow2" /><!--#99916872 - Jeff 2010/07/08-->
<PUBLIC:METHOD NAME="GetColKeyFromCol" internalName="getColKeyFromCol3" /> <!-- #99916403 - Zesson 2010/05/27 -->

<PUBLIC:METHOD NAME="GetRowCount" />
<PUBLIC:METHOD NAME="GetColCount" />
<PUBLIC:METHOD NAME="GetParentSpread" internalName="getParentSpread" />
<PUBLIC:METHOD NAME="GetChildSpread" internalName="getChildSpread" />
<PUBLIC:METHOD NAME="GetChildSpreads" />
<PUBLIC:METHOD NAME="GetSpread" internalName="getSpreadControl" />
<PUBLIC:METHOD NAME="GetParentRowIndex" />
<PUBLIC:METHOD NAME="GetActiveChildSheetView" />
<PUBLIC:METHOD NAME="UpdatePostbackData" />
<PUBLIC:METHOD NAME="SizeToFit" />
<PUBLIC:METHOD NAME="SetColWidth" internalName="setColWidth" />
<PUBLIC:METHOD NAME="ExpandRow"/>
<PUBLIC:METHOD NAME="SortColumn"/>
<PUBLIC:METHOD NAME="CallBack"/>
<PUBLIC:METHOD NAME="AddKeyMap"/>
<PUBLIC:METHOD NAME="RemoveKeyMap"/>
<PUBLIC:METHOD NAME="MoveToPrevCell" />
<PUBLIC:METHOD NAME="MoveToNextCell" />
<PUBLIC:METHOD NAME="MoveToNextRow" />
<PUBLIC:METHOD NAME="MoveToPrevRow" />
<PUBLIC:METHOD NAME="MoveToFirstColumn" />
<PUBLIC:METHOD NAME="MoveToLastColumn" />
<PUBLIC:METHOD NAME="ScrollTo" />

<PUBLIC:METHOD NAME="GetTotalRowCount" />
<PUBLIC:METHOD NAME="GetPageCount" />

<PUBLIC:METHOD NAME="Edit" />
<PUBLIC:METHOD NAME="IsValid" />
<PUBLIC:METHOD NAME="LoadData" />

<!-- SP-WEb5-132 GetCurrentPageIndex start -->
<PUBLIC:METHOD NAME="GetCurrentPageIndex" />
<!-- SP-WEb5-132 GetCurrentPageIndex end -->

<PUBLIC:EVENT NAME="onScroll" ID="Scroll" />
<PUBLIC:EVENT NAME="onActiveCellChanging" ID="ActiveCellChanging" />
<PUBLIC:EVENT NAME="onActiveCellChanged" ID="ActiveCellChanged" />
<PUBLIC:EVENT NAME="onDataChanged" ID="DataChanged" />
<PUBLIC:EVENT NAME="onSelectionChanged" ID="SelectionChanged" />
<PUBLIC:EVENT NAME="onEditStart" ID="EditStart" />
<PUBLIC:EVENT NAME="onEditStopped" ID="EditStopped" />
<PUBLIC:EVENT NAME="onCallBackStart" ID="CallBackStart" />
<PUBLIC:EVENT NAME="onCallBackStopped" ID="CallBackStopped" />
<PUBLIC:EVENT NAME="onColumnDragMove" ID="ColumnDragMove" />
<PUBLIC:EVENT NAME="onColumnDragMoveCompleted" ID="ColumnDragMoveCompleted" />

<PUBLIC:EVENT NAME="onErrorMessageShown" ID="ErrorMessageShown" />
<PUBLIC:EVENT NAME="onAutoFilteringColumn" ID="AutoFilteringColumn" />
<PUBLIC:EVENT NAME="onAutoFilteredColumn" ID="AutoFilteredColumn" />

<PUBLIC:EVENT NAME="onColWidthChanged" ID="ColWidthChanged" />
<PUBLIC:EVENT NAME="onRowHeightChanged" ID="RowHeightChanged" />
<PUBLIC:EVENT NAME="onCopyData" ID="CopyData" />

<PUBLIC:ATTACH EVENT="ondocumentready" ONEVENT="init()"  />
<PUBLIC:ATTACH EVENT="onmousedown" ONEVENT="mouseDown()"  />
<PUBLIC:ATTACH EVENT="onmouseup" ONEVENT="mouseUp()" />
<PUBLIC:ATTACH EVENT="onmouseout" ONEVENT="mouseOut()"  />
<PUBLIC:ATTACH EVENT="onmousemove" ONEVENT="mouseMove()"  />
<PUBLIC:ATTACH EVENT="onmouseover" ONEVENT="mouseOver()"  />
<PUBLIC:ATTACH EVENT="ondblclick" ONEVENT="dblclick()"  />
<PUBLIC:ATTACH EVENT="onresize" ONEVENT="processResize()"  />
<PUBLIC:ATTACH EVENT="onpropertychange" ONEVENT="propertyChanged()"  />

</public:component><script language="javascript">if(!Function.prototype.CreateDelegate)Function.prototype.CreateDelegate=function(a,b){return function(){return b.apply(a,arguments)}};if(!Function.prototype.CreateCallback)Function.prototype.CreateCallback=function(b,a){return function(){var e=arguments.length;if(e>0){for(var d=[],c=0;c<e;c++)d[c]=arguments[c];d[e]=a;return b.apply(this,d)}return b.call(this,a)}};var SelectionBlockOptions=new function(){this.None=0;this.Cells=1;this.Rows=2;this.Columns=4;this.Sheet=8};fpSpreadJS=null;var rowHeaders=1,colHeaders=1,working=false,editing=false,editor=null,editingValue=null,editingFormula=null,editorMargin=new Margin(-1,-1,-1,-1),editorSelectedIndex=-1,sizeColumn=null,sizeRow=null,activeX=-1,activeY=-1,activeElement=null,anchorCell=null,oldAnchorCell=null,leadingCell=null,leadingCellRow=null,leadingCellCol=null,selectStartRow=null,selectStartCol=null,selectedBackColor="#aabbff",anchorBackColor="#bbccff",xmlData=null,spanCells=[],rowSpanCells=[],colSpanCells=[],tableView=null,viewport=null,rowHeader=null,colHeader=null,commandBar=null,viewport0=null,viewport1=null,viewport2=null,scrollvp=null,vpholder_setSizeCallback=null,corner=null,frozColHeader=null,frozColFooter=null,footerCorner=null,colFooter=null,frozRowHeader=null,editorList=[],validatorList=[],validationMsg=null,dirty=false,initialized=false,operationMode="Normal",textBox=null,sizeBar=null,xhtml=false,frameSet=false,frzRows=0,frzCols=0,rowCount=0,ignoreBlur=false,ignoreChange=false,ignoreVirtualPaging=false,dataBuff=null,selectType="",selectionUnit="Cell",scrollLeft=0,scrollTop=0,retainSelectionBlock=true,editModePermanent=false,enableRowEditTemplate="false",selectedCols=[],vp2List=null,vpList=null,rhList=null,current=-1,currentCount=-1,newTop=0,newPageCount=0,smartPaint=false,bSuspendLayout=false,left=37,right=39,up=38,down=40,tab=9,enter=13,shift=16,space=32,altkey=18,home=36,end=35,pup=33,pdn=34,backspace=8,hierBar=null,pager1=null,pager2=null,dummy=null,vpholder=null,groupBar=null,movingCol=null,slideLeft=null,slideRight=null,dragCol=null,dragViewCol=null,dragSlideBar=null,allowColMove=null,allowGroup=null,activePager=null,error=false,cb_btn=null,msgStyle=null,ignoreSynRowHeight=false,ignorePostbackEditmode=false,ignoreEditorFocus=false,ignorePaintSelection=false,ignoreElementActive=false,ignoreFireSelectionChanged=false,engine=null,selectionBlockOptions=SelectionBlockOptions.Cells|SelectionBlockOptions.Rows|SelectionBlockOptions.Columns|SelectionBlockOptions.Sheet,msgList=null,mouseY=null,copymultiCol,activeChartObj,ignorePropertyChanged=false;function propertyChanged(){try{if(getTopSpread(element).resizing)return;!ignorePropertyChanged&&event.propertyName=="style.display"&&element.style.display!="none"&&initLayout()}catch(a){$$.DEBUG.Log(a,"propertyChange")}}function getAttributeInternal(a){return element.getAttribute(a)}function dispose(){var a=element.document;if(!a.detachEvent)a=window.document;a.detachEvent("onkeyup",keyup);a.detachEvent("onkeydown",translateKey);a.detachEvent("onmousedown",setActiveSpread);element.detachEvent("onmousewheel",doMouseWheel);element.detachEvent("onactivate",spreadActive);element.detachEvent("ondocumentready",init);element.detachEvent("onmousedown",mouseDown);element.detachEvent("onmouseup",mouseUp);element.detachEvent("onmouseout",mouseOut);element.detachEvent("onmousemove",mouseMove);element.detachEvent("ondblclick",dblclick);element.detachEvent("onresize",processResize);element.detachEvent("onpropertychange",propertyChanged);var g=getTopSpread(element),e=a.all(g.id+"_textBox");e!=null&&e.detachEvent("onactivate",textBoxActive);var c=element.all(element.id+"_scrollvp");c!=null&&c.detachEvent("onresize",processResize);var d=getViewportHolder();d!=null&&d.detachEvent("onscroll",noScroll);var b=element.all(element.id+"_view");b!=null&&b.detachEvent("onscroll",scrollView);var f=getParent(getViewport2());f!=null&&f.detachEvent("onscroll",vp2Scroll);chartDispose()}function syncBehavior(e){var d=e.style.behavior,a=GetChildSpreads(e.id);if(a!=null&&a.length>0)for(var c=0,f=a.length;c<f;c++){var b=a[c];if(b.style.behavior!=d){b.style.behavior=d;syncBehavior(b)}}}function init(l){if(element.parentNode==null)return;var q=$$.browser;q.ieversion>=9&&syncBehavior(element);fpSpreadJS=new FpSpreadJS(element,getSpreadContext(),fpSpreadJS);element.fpSpreadJS=fpSpreadJS;var h=getParentSpread();if(h!=null&&!h.initialized){if(h.childViewsInitPending==null)h.childViewsInitPending={};var B=Function.CreateCallback(init,l),A=Function.CreateDelegate(element,B);h.childViewsInitPending[element.id]=A;return}initialized=false;if(element.document.FpActiveSheetView!=null&&element.document.FpActiveSheetView.parentNode==null)element.document.FpActiveSheetView=element.document.getElementById(element.document.FpActiveSheetView.id);isactive=element.document.FpActiveSheetView==element;element.initialized=false;ignoreVirtualPaging=true;current=-1;currentCount=-1;newTop=0;newPageCount=0;smartPaint=element.getAttribute("UIVirtualization")=="True"&&element.getAttribute("virtualPaging")!="true"&&element.getAttribute("ClientAutoSize")!="True";selectionBlockOptions=parseInt(element.getAttribute("selectionBlockOptions"));if(getTopSpread().getAttribute("hierView")=="true")smartPaint=false;tableView=element.all(element.id+"_view");if(tableView!=null){tableView.onscroll=scrollView;viewport=tableView.all(element.id+"_viewport")}viewport0=element.all(element.id+"_viewport0");viewport1=element.all(element.id+"_viewport1");viewport2=element.all(element.id+"_viewport2");rowHeader=element.all(element.id+"_rowHeader");if(smartPaint){vp2List=new TableBuff(element,getViewport2());vpList=new TableBuff(element,getViewport());rhList=new TableBuff(element,getRowHeader())}anchorCell=null;leadingCell=null;groupBar=null;hierBar=null;pager1=null;pager2=null;dummy=null;vpholder=null;frozRowHeader=null;frozColHeader=null;frozColFooter=null;frzRows=0;frzCols=0;validationMsg=null;editorList=[];validatorList=[];spanCells=[];rowSpanCells=[];colSpanCells=[];slideLeft=slideRight=dragCol=dragViewCol=movingCol=dragSlideBar=allowColMove=allowGroup=activePager=null;cb_btn=null;msgStyle=null;editor=sizeColumn=sizeRow=null;working=editing=false;scrollLeft=0;scrollTop=0;ignoreSynRowHeight=false;bSuspendLayout=false;if(element.getAttribute("EditModePermanent"))editModePermanent=true;if(element.getAttribute("RetainSelectionBlock")!=null&&element.getAttribute("RetainSelectionBlock")=="false")retainSelectionBlock=false;var H=window.navigator.userAgent;msgList=null;copymultiCol=false;var q=$$.browser,F=q.ie;xhtml=isXHTML();getIEMode();if(xmlData==null||!xmlData.belongToElement(element)){xmlData=$$.fn.createXMLDOMWrapper(element);element.getXmlDataObject=function(){return xmlData}}var p=element.all[element.id+"_data"];if(p!=null){var x=p.getAttribute("data");if(x!=null){xmlData.loadXML(x);p.value=""}}saveData();if(viewport!=null&&(engine<8||viewport.cellSpacing>0||viewport.rules=="")){viewport.style.removeAttribute("borderWidth");viewport.style.borderWidth="0px"}if(engine<8||viewport.cellSpacing>0){if(viewport!=null){viewport.style.removeAttribute("borderWidth");viewport.style.borderWidth="0px"}if(viewport0!=null){viewport0.style.removeAttribute("borderWidth");viewport0.style.borderWidth="0px"}if(viewport1!=null){viewport1.style.removeAttribute("borderWidth");viewport1.style.borderWidth="0px"}if(viewport2!=null){viewport2.style.removeAttribute("borderWidth");viewport2.style.borderWidth="0px"}}corner=element.all(element.id+"_corner");if(corner!=null&&corner.children.length>0)corner=corner.children(0);if(viewport1!=null)frzRows=viewport1.rows.length;if(viewport0!=null){var m=getColGroup(viewport0);if(m!=null)frzCols=m.children.length}else if(viewport2!=null){var m=getColGroup(viewport2);if(m!=null)frzCols=m.children.length}var c=element.all(element.id+"_frozColHeader");if(c!=null){frozColHeader=c.children(0);frzCols=getColGroup(frozColHeader).children.length}c=element.all(element.id+"_frozColFooter");if(c!=null)frozColFooter=c.children(0);colFooter=element.all(element.id+"_colFooter");if(colFooter!=null)colFooter=colFooter.children(0);footerCorner=element.all(element.id+"_footerCorner");if(footerCorner!=null&&footerCorner.children.length>0)footerCorner=footerCorner.children(0);c=element.all(element.id+"_frozRowHeader");if(c!=null)frozRowHeader=c.children(0);rowHeader!=null&&rowHeader.attachEvent("onscroll",rheaderScroll);if(rowHeader!=null)rowHeader=rowHeader.children(0);colHeader=element.all(element.id+"_colHeader");colHeader!=null&&colHeader.attachEvent("onscroll",cheaderScroll);if(colHeader!=null)colHeader=colHeader.children(0);commandBar=element.all(element.id+"_commandBar");scrollvp=element.all(element.id+"_scrollvp");if(scrollvp!=null)scrollvp.attachEvent("onresize",processResize);else if(smartPaint){var a=element.document;if(!a.createElement)a=window.document;scrollvp=a.createElement("div");scrollvp.id=element.id+"_scrollvp";scrollvp.style.position="relative";scrollvp.style.display="none";scrollvp.style.overflowX=tableView.style.overflowX;scrollvp.style.overflowY=tableView.style.overflowY;tableView.style.overflowX="hidden";tableView.style.overflowY="hidden";tableView.parentNode.insertBefore(scrollvp,tableView);dummy=a.createElement("div");dummy.id=element.id+"_dummy";dummy.style.width="100%";dummy.style.height="100%";scrollvp.insertBefore(dummy,null);vpholder=a.createElement("div");vpholder.id=element.id+"_vpholder";vpholder.style.position="absolute";tableView.parentNode.insertBefore(vpholder,tableView);var d=a.createElement("table");d.cellspacing="0";d.cellpadding="0";d.border="0";d.style.borderWidth="0px";d.style.borderCollapse="collapse";vpholder.insertBefore(d,null);var E=d.insertRow(),n=E.insertCell();n.align="left";n.valign="top";n.style.padding="0px";n.insertBefore(tableView)}rowHeaders=parseInt(element.getAttribute("RowHeaders"));colHeaders=parseInt(element.getAttribute("ColHeaders"));if(colHeader!=null&&engine>=9){var f=getColGroup(colHeader);if(f!=null&&f.children.length>1){var w=parseInt(f.children[f.children.length-2].width);if(!isNaN(w))f.children[f.children.length-2].width=w-1+"px"}}selectedBackColor=element.getAttribute("selectedBackColor");anchorBackColor=element.getAttribute("anchorBackColor");var t=getViewport();if(t!=null){element.RowCount=t.rows.length;element.ColCount=t.getAttribute("cols")}operationMode=element.getAttribute("OperationMode");enableRowEditTemplate=element.getAttribute("EnableRowEditTemplate");if(element.getAttribute("selectionUnit")!=null)selectionUnit=element.getAttribute("selectionUnit");element.getCommandBar=getCommandBar;element.getRowHeader=getRowHeader;element.getColHeader=getColHeader;element.getViewport=getViewport;element.getCorner=getCorner;element.getFrozColHeader=getFrozColHeader;element.getFrozRowHeader=getFrozRowHeader;element.getViewport0=getViewport0;element.getViewport1=getViewport1;element.getViewport2=getViewport2;element.getScrollvp=getScrollvp;element.setColWidth=setColWidth;element.waitForAttachBehavior=waitForAttachBehavior;element.printSpread=printSpread;element.sizeSpread=sizeSpread;element.processKeyMap=processKeyMap;element.syncRowRange=syncRowRange;element.syncRowRangeSafeMode=syncRowRangeSafeMode;element.getPagers=getPagers;element.getColHeader=getColHeader;element.getParentSpread=getParentSpread;element.getRowByKey=getRowByKey;element.getColByKey=getColByKey;element.clearCellData=clearCellData;element.Filter=Filter;element.init=init;element.dispose=dispose;element.loadScrollbarState=loadScrollbarState;element.fireCallBackStartEvent=fireCallBackStartEvent;element.fireCallBackStoppedEvent=fireCallBackStoppedEvent;element.fireActiveCellChangingEvent=fireActiveCellChangingEvent;element.fireActiveCellChangedEvent=fireActiveCellChangedEvent;element.fireDataChangedEvent=fireDataChangedEvent;element.fireSelectionChangedEvent=fireSelectionChangedEvent;element.fireEditStartEvent=fireEditStartEvent;element.fireEditStoppedEvent=fireEditStoppedEvent;element.fireAutoFilterColumnCompleted=fireAutoFilterColumnCompleted;element.setCellValueFromView=setCellValueFromView;element.setActiveField=setActiveField;element.getAttributeInternal=getAttributeInternal;element.getCellFromRowCol=getCellFromRowCol;element.isHeaderCell=isHeaderCell;element.getEditor=getEditor;element.setEditorFocus=setEditorFocus;element.GetActiveRow=getActiveRow;element.GetActiveCol=getActiveCol;element.setColHeaderRowHeight=setColHeaderRowHeight;element.getColFooter=getColFooter;element.getFrozColFooter=getFrozColFooter;element.getFooterCorner=getFooterCorner;element.setRowHeaderColWidth=setRowHeaderColWidth;element.setRowHeight2=setRowHeight2;element.getPreferredRowHeight=getPreferredRowHeight;element.getCellEditorID=getCellEditorID;element.getCellEditor=getCellEditor;element.getRowHeightInternal=getRowHeightInternal;element.getRowHeightInternal2=getRowHeightInternal2;element.paintFocusRect=paintFocusRect;element.paintAnchorCell=paintAnchorCell;element.textBoxActive=textBoxActive;element.AddSpan=AddSpan;element.RemoveSpan=RemoveSpan;element.GetSheetIndex=GetSheetIndex;element.getTopSpread=getTopSpread;element.OpenWaitMsg=openWaitMsg;element.CloseWaitMsg=closeWaitMsg;element.inactiveAllChart=inactiveAllChart;element.RefreshChart=RefreshChart;element.GetActiveChartObj=GetActiveChartObj;element.SetActiveChartObj=SetActiveChartObj;element.getViewportSize=getViewPortSize;element.rowEditTemplateContainer_keyDown=rowEditTemplateContainer_keyDown;element.rowEditTemplateContainer_textBoxFocus=rowEditTemplateContainer_textBoxFocus;element.doGetFocus=doGetFocus;element.isSizeSpread=false;element.getSpreadJS=function(){return fpSpreadJS};element.isEditing=function(){return editing};element.__attachOnActiveEvent=__attachOnActiveEvent;element.__detachOnActiveEvent=__detachOnActiveEvent;element.getAnchorCell=function(){return anchorCell};if(element.getAttribute("virtualPaging")=="true"){var a=element.document;if(!a.getElementById)a=window.document;var u=a.getElementById(element.id+"_VirtualPaging_Top");if(u==null)element.virtualPagingTop=element.virtualTop=0;else element.virtualPagingTop=element.virtualTop=parseInt(u.style.height);if(element.virtualTop>0&&a.compatMode=="BackCompat")for(var j=[viewport0,viewport1,viewport2,viewport],g=0;g<j.length;g++)if(j[g]!=null&&(j[g].style.position==""||j[g].style.position=="static"))j[g].style.position="relative"}else element.virtualPagingTop=element.virtualTop=0;element.stopVirtualPaging=function(){ignoreVirtualPaging=true};element.startVirtualPaging=function(){ignoreVirtualPaging=false};element.preventScrollView=element.preventScrollView||false;initChartObj();if(typeof Sys!="undefined")element.SetCellValue=setCellValue;if(element.inDesign){element.getCellType=getCellType;element.getEditor=getEditor;element.getFunction=getFunction}initSpan(getViewport0(),spanCells);initSpan(getViewport1(),spanCells);initSpan(getViewport2(),spanCells);initSpan(getViewport(),spanCells);initSpan(getColHeader(),colSpanCells);initSpan(getFrozColHeader(),colSpanCells);initSpan(getRowHeader(),rowSpanCells);initSpan(getFrozRowHeader(),rowSpanCells);if(frzRows!=0||frzCols!=0){rowCount=0;if(getViewport1()!=null)rowCount+=getViewport1().rows.length;if(getViewport()!=null)rowCount+=getViewport().rows.length}if(!q.quirksMode){var b=$$.utils;b.attachEvent(element,"Scroll");b.attachEvent(element,"ActiveCellChanging");b.attachEvent(element,"ActiveCellChanged");b.attachEvent(element,"DataChanged");b.attachEvent(element,"SelectionChanged");b.attachEvent(element,"EditStart");b.attachEvent(element,"EditStopped");b.attachEvent(element,"CallBackStart");b.attachEvent(element,"CallBackStopped");b.attachEvent(element,"ColumnDragMove");b.attachEvent(element,"ColumnDragMoveCompleted");b.attachEvent(element,"ErrorMessageShown");b.attachEvent(element,"AutoFilteringColumn");b.attachEvent(element,"AutoFilteredColumn");b.attachEvent(element,"ColWidthChanged");b.attachEvent(element,"RowHeightChanged");b.attachEvent(element,"CopyData")}var a=element.document;if(!a.getElementById)a=window.document;a.detachEvent("onkeyup",keyup);a.attachEvent("onkeyup",keyup);a.detachEvent("onkeydown",translateKey);a.attachEvent("onkeydown",translateKey);a.detachEvent("onmousedown",setActiveSpread);a.attachEvent("onmousedown",setActiveSpread);createFocusBorder();syncBorders();fpSpreadJS.countChildViews();if(xmlData!=null&&getViewport()!=null){getViewport().parentElement.style.display="block";if(activeChartObj==null){initSelection();if(l!="LoadOnDemand"){var i=getCmdBtn("Update");updateCmdBtnState(i,true)}}}initLayout(true);if(smartPaint){backUpStyleSetting();initSmartPaint();restoreStyleSetting();sizeSpread(true)}var k=null;if(xmlData!=null&&getParentSpread()==null){var z=xmlData.selectSingleNode("root activespread");k=xmlData.selectSingleNode("root activechild");var s=xmlData.textContent(z);if(s!=null&&s.length>0){var e=xmlData.textContent(k);if(e==null||e.length==0)e=s;if(e!=null&&e!=""){a.FpActiveSpread=a.all(e);a.FpActiveSheetView=a.FpActiveSpread}}isactive=element.document.FpActiveSpread==element}initialized=true;dirty=true;if(a.FpActiveSpread==element&&(element.getAttribute("AllowInsert")=="false"||element.getAttribute("IsNewRow")=="true")){var i=getCmdBtn("Insert");updateCmdBtnState(i,true);i=getCmdBtn("Add");updateCmdBtnState(i,true)}createTextbox();element.focus=focus;textBox.onactivate=textBoxActive;var v=a.FpActiveSpread==element&&(k==null||xmlData.textContent(k)==element.id);if(typeof window.__smartNav=="undefined"&&v)try{if(l!="LoadOnDemand")if(window.frameElement!=null)setTimeout(focus,100);else{var y=anchorCell;focus();if(l!="Update"&&y!=anchorCell&&anchorCell!=null){var i=getCmdBtn("Update");updateCmdBtnState(i,false)}}}catch(G){$$.DEBUG.Log(G,"startVirtualPaging")}if(v)if(anchorCell!=null){var o=getEditor(anchorCell);if(o!=null){editing=true;editor=o;renderAsEditor=1;editingValue=getEditorValue(o)}}element.onclickCell=onclickCell;element.UpdateRowHeight=UpdateRowHeight;element.onmousewheel=doMouseWheel;element.onactivate=spreadActive;element.blur=blur;allowColMove=element.getAttribute("colMove");allowGroup=element.getAttribute("allowGroup");createSizebar();syncColSelection();element.getAttribute("ajax")=="false"&&fireOperationEndEvent();setTimeout(function(){ignoreVirtualPaging=false},100);element.initialized=true;if(element.childViewsInitPending!=null){for(var D in element.childViewsInitPending){var C=element.childViewsInitPending[D];C()}element.childViewsInitPending=null}if(element.getAttribute("mcctCellType")!=null){var r=FarPoint.System.WebControl.MultiColumnComboBoxCellType.GetMcctObject(element.id);if(r!=null){r.DetachEvents();r.AttachEvents()}}}function getSpreadContext(){return this}function frzRowCount(){return frzRows}function frzColCount(){return frzCols}function hasCellBorder(b,e,d){if(b!=null)for(var c=0;c<b.cells.length;c++){var j=b.cells[c],a=$$(j).border("all"),i=e&&a.top!=0,f=e&&a.bottom!=0,h=d&&a.left!=0,g=d&&a.right!=0;if(i||f||h||g)return true}return false}function syncBorders(){var j="#d0d7e5",e=[getFrozRowHeader(),getRowHeader()];$$.utils.cleanArray(e);for(var f=0;f<e.length;f++){var b=e[f];if(b!=null&&b.rows.length>0){var i=b.getAttribute("__defaultBackColor"),k=i!=null?i:j;if(hasCellBorder(b.rows[0],true,false))b.style.borderTop="1px solid "+k}}for(var l=[getFrozColHeader(),getColHeader()],o=[getViewport0(),getViewport2()],p=[getViewport1(),getViewport()],n=[o,p],d=0;d<l.length;d++){var a=l[d],m=n[d];if(a)for(var g=0;g<m.length;g++){var c=m[g];if(c&&a.style.borderLeftWidth!=c.style.borderLeftWidth){if(!a.style.borderLeftStyle)a.style.borderLeftStyle=c.style.borderLeftStyle;a.style.borderLeftWidth=c.style.borderLeftWidth;var h=a.getAttribute("__defaultBackColor"),k=h!=null?h:j;a.style.borderLeftColor=k;break}}}}function setActiveField(a){isactive=a}function fireOperationEndEvent(){fireAutoFilterColumnCompleted()}function getIEMode(){if(document.documentMode)engine=document.documentMode;else{engine=5;if(document.compatMode)if(document.compatMode=="CSS1Compat")engine=7}}var ignoreScroll=false,ignoreMainScroll=false;function fireAutoFilterColumnCompleted(b){if(element.getAttribute("isFiltering")=="true"&&(b==null||b==element.getAttribute("FilteringString")))if(element.getAttribute("isFilteringCancel")!="true")if($$.browser.quirksMode){var a=createEventObject();a.spread=element;a.col=element.getAttribute("FilteringCol");a.filterString=element.getAttribute("FilteringString");AutoFilteredColumn.fire(a)}else{var c={spread:element,col:element.getAttribute("FilteringCol"),filterString:element.getAttribute("FilteringString")},a=$$.utils.createEvent("AutoFilteredColumn",false,true,c);element.dispatchEvent(a)}}function cheaderScroll(){if(ignoreScroll)return;var a=getParent(getViewport());if(a==null)return;a.scrollLeft=getParent(getColHeader()).scrollLeft;ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}function rheaderScroll(){if(ignoreScroll)return;var a=getParent(getViewport());if(a==null)return;if(a.fromScrollTo==true){a.fromScrollTo=false;return}a.scrollTop=getParent(getRowHeader()).scrollTop;scrollView()}function blur(){setActiveSpreadID(element,"","",false)}function isXHTML(){var a=element.document;if(!a.getElementById)a=window.document;return a.compatMode&&a.compatMode=="CSS1Compat"}function createTextbox(){var c=getTopSpread(element),a=element.document;if(!a.createElement)a=window.document;textBox=a.all(c.id+"_textBox");if(textBox==null){var b=a.createElement("div");b.style.position="absolute";b.style.left="-100px";b.style.overflow="hidden";textBox=a.createElement("input");textBox.type="text";textBox.style.position="absolute";textBox.style.borderWidth=0;textBox.style.top="10px";textBox.style.left="-100px";textBox.style.width="0px";textBox.style.height="1px";if(element.tabIndex!=null){textBox.tabIndex=element.tabIndex;element.tabIndex=-1}textBox.id=element.id+"_textBox";b.insertBefore(textBox);element.insertBefore(b)}else if(element.tabIndex!=null)element.tabIndex=-1}var isactive=true;function textBoxBlur(){if(!ignoreBlur){isactive=false;if(!retainSelectionBlock){paintAnchorCell();paintSelections(false);paintAnchorCellHeader(false);hideFocusBorder()}}}function hideFocusBorder(){var b=element.document;if(!b.getElementById)b=window.document;var a=b.getElementById(element.id+"_focusRectT");if(a==null)return;a.style.left="-1000px";a.style.width="0px";var c=element.id;a=b.getElementById(c+"_focusRectB");a.style.left="-1000px";a.style.width="0px";a=b.getElementById(c+"_focusRectL");a.style.left="-1000px";a.style.width="0px";a=b.getElementById(c+"_focusRectR");a.style.left="-1000px";a.style.width="0px"}function getSizeHeader(){var a=getTopSpread(element);return a.getAttribute("sizeHeader")!=null}function createLineBorder(c){var b=element.document;if(!b.getElementById)b=window.document;var a=b.getElementById(c);if(a==null){a=b.createElement("img");a.style.position="absolute";a.style.left="-1000px";a.style.top="0px";a.style.overflow="hidden";a.style.border="1px solid black";if(element.getAttribute("FocusBorderColor")!=null)a.style.borderColor=element.getAttribute("FocusBorderColor");if(element.getAttribute("FocusBorderStyle")!=null)a.style.borderStyle=element.getAttribute("FocusBorderStyle");a.id=c;var d=getViewport().parentNode;d.insertBefore(a,null)}return a}function createFocusBorder(){if(frzRows>0||frzCols>0)return;if(getTopSpread().getAttribute("hierView")=="true")return;if(element.getAttribute("showFocusRect")=="false")return;if(getViewport()==null)return;var b=element.id,a=createLineBorder(b+"_focusRectT");a.style.height="0px";a=createLineBorder(b+"_focusRectB");a.style.height="0px";a=createLineBorder(b+"_focusRectL");a.style.width="0px";a=createLineBorder(b+"_focusRectR");a.style.width="0px"}function createSizebar(){var a=element.document;if(!a.createElement)a=window.document;sizeBar=a.all(element.id+"_sizeBar");var b=getSizeHeader();if(sizeBar==null&&(b||frzRows>0||frzCols>0)){sizeBar=a.createElement("img");sizeBar.style.position="absolute";sizeBar.style.borderWidth="1px";sizeBar.style.top="0px";sizeBar.style.left="-400px";sizeBar.style.width="2px";sizeBar.style.height="2px";sizeBar.style.background="black";sizeBar.style.zIndex=1e3;sizeBar.id=element.id+"_sizeBar";element.insertBefore(sizeBar)}}var posIndicator=null;function getPosIndicator(){if(posIndicator==null)createPosIndicator();else posIndicator.parentNode!=element&&element.insertBefore(posIndicator);return posIndicator}function createPosIndicator(){var a=element.document;if(!a.createElement)a=window.document;posIndicator=a.all(element.id+"_posIndicator");if(posIndicator==null){posIndicator=a.createElement("img");posIndicator.style.position="absolute";posIndicator.style.borderWidth=1;posIndicator.style.top="0px";posIndicator.style.left="-400px";posIndicator.style.width="10px";posIndicator.style.height="10px";posIndicator.style.zIndex=1e3;posIndicator.id=element.id+"_posIndicator";if(element.getAttribute("clienturl")!=null)posIndicator.src=element.getAttribute("clienturl")+"down.gif";else posIndicator.src=element.getAttribute("clienturlres");element.insertBefore(posIndicator)}}function initSpan(b,h){if(b!=null){if(b==getViewport())rowCount=b.rows.length;for(var f=b.rows,i=GetColCount(),c=0;c<f.length;c++)if(IsChildSpreadRow(b,c)){if(b==getViewport())rowCount--}else for(var e=f(c).cells,d=0;d<e.length;d++){var a=e(d);if(a!=null&&a.getAttribute("FpSpread")!="rowpadding"&&(a.rowSpan!=null&&a.rowSpan>1||a.colSpan!=null&&a.colSpan>1)){var j=getRowFromCell(a),g=parseInt(a.getAttribute("scol"));g<i&&AddSpan(j,g,a.rowSpan,a.colSpan,h)}}}}function getColWithSpan(e,a,d){var f=0,c=0;if(d==0)while(isCovered(e,c,a))c++;for(var b=0;b<a.length;b++)if(a[b].rowCount>1&&(a[b].col<=d||d==0&&a[b].col<c)&&e>=a[b].row&&e<a[b].row+a[b].rowCount)f+=a[b].colCount;return f}function AddSpan(f,e,d,c,a){if(a==null)a=spanCells;var b=new Range;setRange(b,"Cell",f,e,d,c);a.push(b);paintFocusRect()}function RemoveSpan(g,f,a){if(a==null)a=spanCells;for(var b=0;b<a.length;b++){var d=a[b];if(d.row==g&&d.col==f){for(var e=a.length-1,c=b;c<e;c++)a[c]=a[c+1];a.length=a.length-1;break}}paintFocusRect()}function onclickCell(){mouseDown()}function textBoxActive(event,manualActive){if(ignoreChange||ignoreElementActive)return;if(activeChartObj!=null)return;if(event!=null&&event.srcElement!=null){var spreadContainer=$$(event.srcElement).getParent("DIV",0,{FpSpread:"Spread"});if(spreadContainer!=null&&element!=spreadContainer&&editModePermanent&&!manualActive)return}isactive=true;!ignoreBlur&&editModePermanent&&doGetFocus();var ts=getTopSpread(element);if(element.document.FpActiveSpread==null){var xmlData=$$.fn.createXMLDOMWrapper(ts),activeChild=xmlData.selectSingleNode("root activechild"),_activeSheet=element.document.FpActiveSheetView;try{if(activeChild!=null&&xmlData.textContent(activeChild)!=null&&xmlData.textContent(activeChild)!="")element.document.FpActiveSpread=eval(xmlData.textContent(activeChild));else if(_activeSheet!=null&&ts==getTopSpread(_activeSheet))element.document.FpActiveSpread=element.document.FpActiveSheetView;else if(ts.getAnchorCell()!=null&&ts.getAnchorCell().paintSelected)element.document.FpActiveSpread=ts;else{for(var f=null,allSpreads=getAllSpreads(),i=0;i<allSpreads.length;i++){var ss=allSpreads[i];if(ss.getAnchorCell()!=null&&ss.getAnchorCell().paintSelected){element.document.FpActiveSpread=ss;f=true;break}}if(!f)element.document.FpActiveSpread=ts}}catch(ex){if(element.document.FpActiveSheetView!=null)element.document.FpActiveSpread=element.document.FpActiveSheetView;else element.document.FpActiveSpread=ts;$$.DEBUG.Log(ex,"textBoxActive")}}var activeSpread=element.document.FpActiveSpread,_asid=activeSpread==null?"":activeSpread.id;setActiveSpreadID(ts,_asid,_asid);element.document.FpActiveSheetView=element.document.FpActiveSpread;if(element.document.FpActiveSpread!=element){ClearSelection(true,element.document.FpActiveSpread);setTextBoxFocus();element.document.FpActiveSpread!=null&&element.document.FpActiveSpread.getAttribute("hostspread")==null&&element.document.FpActiveSpread.textBoxActive(null,true);setActiveField(false);return}element.document.FpActiveSpread.setActiveField(true);ClearSelection(true,element);var opm=operationMode;if(anchorCell==null&&opm!="MultiSelect"&&opm!="ExtendedSelect"&&GetRowCount()>0&&GetColCount()>0){var cc=GetColCount(),rc=GetRowCountInternal(),_checktab=event&&event.type=="keydown"&&event.keyCode==tab,nextRow=getNextCellRowIndex(0,0,_checktab,true),nextCol=getNextCellColIndex(0,0,_checktab,true);if(nextRow<rc&&nextCol<cc){var f=fireActiveCellChangingEvent(nextRow,nextCol,element,0),ts=getTopSpread(element);if(!f)if(ts!=element)f=ts.fireActiveCellChangingEvent(nextRow,nextCol,element,0);if(!f){!(element.getAttribute("OperationMode")=="Normal"&&(element.getAttribute("SelectionPolicy")=="MultiRange"&&element.getAttribute("multiRange")=="true"||element.getAttribute("SelectionPolicy")=="Range"))&&ClearSelection();leadingCellRow=nextRow;leadingCellCol=nextCol;updateAnchorCell(leadingCellRow,leadingCellCol);var processTab=_checktab&&(ts.getAttribute("ProcessTab")=="true"||ts.getAttribute("ProcessTab")=="True")&&getCellFromRowCol(leadingCellRow,leadingCellCol)!=null&&getCellFromRowCol(leadingCellRow,leadingCellCol).getAttribute("TabStop")!=null&&getCellFromRowCol(leadingCellRow,leadingCellCol).getAttribute("TabStop")=="false";processTab&&!editing&&nextCell(window.event.keyCode);enableButtons();var btn=getCmdBtn("Update");updateCmdBtnState(btn,false);if(window.event.srcElement.tagName=="SELECT")ignorePostbackEditmode=true;fireActiveCellChangedEvent(leadingCellRow,leadingCellCol,element,0);if(window.event.srcElement.tagName=="SELECT")ignorePostbackEditmode=false;ts!=element&&ts.fireActiveCellChangedEvent(leadingCellRow,leadingCellCol,element,0)}}}else window.event.srcElement==element&&setTextBoxFocus();if(retainSelectionBlock||element.document.FpActiveSpread==element){if(!ignorePaintSelection){ignorePaintSelection=true;paintSelections(true);ignorePaintSelection=false}else paintSelections(true);paintAnchorCell(element.document.FpActiveSpread==element)}var ot=getOffsetTop(element,element.document.body),ol=getOffsetLeft(element,element.document.body),needVScroll=ot+element.clientHeight<element.document.body.scrollTop||ot>element.document.body.scrollTop+element.document.body.clientHeight;if(xhtml)needVScroll=ot+element.clientHeight<element.document.body.parentNode.scrollTop||ot>element.document.body.parentNode.scrollTop+element.document.body.parentNode.clientHeight;if(needVScroll)if(xhtml)element.document.body.parentNode.scrollTop=ot;else element.document.body.scrollTop=ot;var needHScroll=ol+element.clienWidth<element.document.body.scrollLeft||ol>element.document.body.scrollLeft+element.document.body.clientWidth;if(xhtml)needHScroll=ol+element.clienWidth<element.document.body.parentNode.scrollLeft||ol>element.document.body.parentNode.scrollLeft+element.document.body.parentNode.clientWidth;if(needHScroll)if(xhtml)element.document.body.parentNode.scrollLeft=ol;else element.document.body.scrollLeft=ol;if(engine>=9){ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}}function selectAllText(){if(anchorCell==null)return;var a=getEditor(anchorCell);if(a!=null&&a.select){var b=a.getValue?a.getValue():a.value;if(a.setValue){a.setValue("");a.setValue(b)}else{a.value="";a.value=b}try{var c=a.tagName=="INPUT"&&(a.type=="button"||a.type=="submit");!c&&a.select()}catch(d){$$.DEBUG.Log(d,"selectAllText")}}}function spreadActive(){$$.utils.cancelBubble(window.event);var a=element.document.FpActiveSpread;if(a!=null&&a.getAttribute("mcctCellType")=="true"){var b=FarPoint.System.WebControl.MultiColumnComboBoxCellType.GetMcctObject(a.id);b!=null&&b.getHostSpread()==element&&!b.getIsDrop()&&__setActiveSpread(element)}detachOnActiveEvents();textBoxActive();attachOnActiveEvents()}function attachOnActiveEvents(){for(var b=getAllSpreads(),a=0;a<b.length;a++){var c=b[a];typeof c.__attachOnActiveEvent!="undefined"&&c.__attachOnActiveEvent()}}function detachOnActiveEvents(){for(var b=getAllSpreads(),a=0;a<b.length;a++){var c=b[a];typeof c.__detachOnActiveEvent!="undefined"&&c.__detachOnActiveEvent()}}function __attachOnActiveEvent(){if(textBox!=null){textBox.onactivate=null;textBox.onactivate=textBoxActive;element.onactivate=null;element.onactivate=spreadActive}}function __detachOnActiveEvent(){if(textBox!=null){textBox.onactivate=null;element.onactivate=null}}function endEditSpread(){var a=getEditingSpread();return a!=null?a.EndEdit():true}function getEditingSpread(){for(var c=getAllSpreads(),b=0;b<c.length;b++){var a=c[b];if(typeof a.isEditing!="undefined"&&a.isEditing())return a}return null}function getAllSpreads(){var b=getTopSpread(element),a=[b];__getAllChildSpreads(b.id,a);return a}function __getAllChildSpreads(e,b){for(var c=GetChildSpreads(e),a=0;a<c.length;a++){var d=c[a];b.push(d);__getAllChildSpreads(d.id,b)}}function isEditModeReplace(b){var a=getCellType(b);return a=="ExtenderCellType"?false:element.getAttribute("EditMode")=="replace"}function setTextBoxFocus(a){if(textBox!=null&&textBox.document!=null){!a&&detachOnActiveEvents();textBox.focus();!a&&attachOnActiveEvents()}}function focus(A,s){var b=getTopSpread(element),k=$$.fn.createXMLDOMWrapper(b),h=k.selectSingleNode("root activechild");if(h!=null&&k.textContent(h)!=""){var g=element.document.getElementById(k.textContent(h));if(g!=null&&g!=element){g.focus();return}}var r=element.document.FpActiveSpread;if(r!=null&&!r.IsValid())return;var i=event!=null&&element==getSpreadControl(event.srcElement)&&isEditModeReplace(anchorCell);if(editing&&i){selectAllText();i=false}if(editing)return;if(event!=null&&(event.type=="mousedown"||event.type=="mouseup")){var v=getSpreadControl(event.srcElement);if(v!=element)return;if(event.srcElement.tagName=="INPUT"||event.srcElement.tagName=="SELECT"||event.srcElement.tagName=="TEXTAREA")return}var a=null;if(window.event!=null)a=window.event.srcElement;if(a!=null&&(hitCommandBar()||a==getParent(getViewport())||a==getParent(getViewport1())||a==getParent(getViewport2())||a.getAttribute&&(a.getAttribute("ControlType")=="chgrayarea"||a.getAttribute("FpSpread")=="rowpadding"))){var f=getParent(getViewport());if(window.event.type=="mousedown"&&a==f){var p=f.getBoundingClientRect(),t=f.clientHeight,u=f.clientWidth,x=event.clientX+element.document.documentElement.scrollLeft,y=event.clientY+element.document.documentElement.scrollTop;(y>p.top+t||x>p.left+u)&&setTextBoxFocus()}return}if(activeChartObj!=null){doClearSelection();ignoreVirtualPaging=true;activeChartObj.container.focus();ignoreVirtualPaging=false;return}var m=false;if(element.document.FpActiveSpread!=element){m=true;__setActiveSpread(element)}var q=operationMode;if(anchorCell==null&&q!="MultiSelect"&&q!="ExtendedSelect"&&GetRowCount()>0&&GetColCount()>0){var w=GetColCount(),z=GetRowCountInternal(),n=event&&event.type=="keydown"&&event.keyCode==tab,e=getNextCellRowIndex(0,0,n,true),d=getNextCellColIndex(0,0,n,true);if(e<z&&d<w){var l=fireActiveCellChangingEvent(e,d,element,0),b=getTopSpread(element);if(!l)if(b!=element)l=b.fireActiveCellChangingEvent(e,d,element,0);if(!l){element.inDesign&&doClearSelection();leadingCellCol=d;leadingCellRow=e;updateAnchorCell(leadingCellRow,leadingCellCol);enableButtons();fireActiveCellChangedEvent(leadingCellRow,leadingCellCol,element,0);b!=element&&b.fireActiveCellChangedEvent(leadingCellRow,leadingCellCol,element,0)}}}if(element.document.FpActiveSpread==element&&m){paintSelections(true,s);paintAnchorCell()}var b=getTopSpread(element),c=element.document;if(!c.all)c=window.document;textBox=c.all(b.id+"_textBox");if(anchorCell!=null&&event!=null&&!isHeaderCell(getCell(event.srcElement))){var j=getEditor(anchorCell),o=getCorner();if(o!=null&&o.contains(window.event.srcElement))j=null;if(j==null)c.activeElement!=textBox&&setTextBoxFocus();else{setTextBoxFocus();setEditorFocus(j)}}else setTextBoxFocus();i&&selectAllText();enableButtons()}function GetTotalRowCount(){return parseInt(element.getAttribute("totalRowCount"))}function GetPageCount(){return parseInt(element.getAttribute("pageCount"))}function GetColCount(){return frzCols+parseInt(element.ColCount)}function GetRowCount(){return rowCount}function GetRowCountInternal(){return frzRows+parseInt(element.RowCount)}function IsChildSpreadRow(a,b){return FpSpreadJS.isChildSpreadRow(a,b)}function GetChildSpread(e,c){var b=getViewport();if(b!=null){var a=GetDisplayIndex(e)+1;if(typeof c=="number")a+=c;if(a>=0&&a<b.rows.length)if(b.rows(a).cells.length>0&&b.rows(a).cells(0)!=null&&b.rows(a).cells(0).children.length>0){var d=b.rows(a).cells(0).children(0);if(d.getAttribute("FpSpread")=="Spread")return d}}return null}function GetChildSpreads(b){var a=element.document;if(!a.getElementById)a=window.document;var c=b==null?element:a.getElementById(b);return c==null?null:FpSpreadJS.getChildViews(c)}function GetDisplayIndex(a){return fpSpreadJS.getDisplayIndex(a)}function GetSheetIndex(b,a){return a!=null&&getViewport()!=a?getSpreadControl(a,true).GetSheetIndex(b):fpSpreadJS.getSheetIndex(b)}function GetParentRowIndex(){var b=getParentSpread();if(b==null)return-1;var c=b.all(b.id+"_viewport");if(c==null)return-1;for(var d=element.parentElement.parentElement,a=d.rowIndex-1;a>0;a--)if(IsChildSpreadRow(c,a))continue;else break;return GetSheetIndex(a,c)}function SizeToFit(a,e){if(a==null||a<0)a=0;var f=getViewport();if(f!=null){for(var h=createTestBox(),c=0,i=GetRowCountInternal(),b=0;b<i;b++){if(frzCols==0&&frzRows==0&&IsChildSpreadRow(f,b))continue;var d=getCellFromRowCol(b,a);if(e)d=getHeaderCellFromRowCol(b,a,false);if(d.colSpan>1)continue;var g=getPreferredCellWidth(d,h);if(g>c)c=g}if(e)setRowHeaderColWidth(a,c,true);else setColWidth(a,c,null,true)}}function getPreferredCellWidth(c,b){if(b==null)b=createTestBox();var a=getRender(c),e=getCellType(c),o=getEditor(c);if(a!=null){b.style.fontFamily=a.currentStyle.fontFamily;b.style.fontSize=a.currentStyle.fontSize;b.style.fontWeight=a.currentStyle.fontWeight;b.style.fontStyle=a.currentStyle.fontStyle}b.style.width="";if(a!=null&&a.tagName=="SELECT"){for(var h="",g=0;g<a.children.length;g++){var f=a.children[g];if(xmlData.textContent(f)!=null&&xmlData.textContent(f).length>h.length)h=xmlData.textContent(f)}b.innerHTML=h}else if(a!=null&&a.tagName=="INPUT")if(a.type=="submit")b.innerHTML=a.outerHTML;else b.innerHTML=a.value;else{var n=c.getElementsByTagName("TABLE");if(n!=null&&n.length>0)b.style.width="20px";if(c.getAttribute("FpCellType")=="ExtenderCellType"&&a!=null&&c.getElementsByTagName("DIV").length>0){var l=getEditor(c),m=getFunction("ExtenderCellType_getEditorValue");if(l!=null&&m!=null)b.innerHTML=m(l)}else if(a!=null&&a.tagName!="TABLE")b.innerHTML=a.innerHTML;else b.innerHTML=c.innerHTML}if(a!=null&&e=="MultiColumnComboBoxCellType"){var j=b.getElementsByTagName("Table")[0];if(j!=null){j.style.tableLayout="";b.style.width=b.offsetWidth+3+"px"}}if(a!=null&&e=="ListBoxCellType"){var k=b.getElementsByTagName("Table")[0];if(k!=null){k.style.width="";b.style.width=""}}if(a!=null&&e=="RadioButtonListCellType"){var i=b.getElementsByTagName("Table")[0];if(i!=null){i.style.width="";b.style.width=""}}var d=b.offsetWidth+4;if(!xhtml)d+=parseInt(c.currentStyle.paddingLeft)+parseInt(c.currentStyle.paddingRight);d+=3;if(a!=null&&a.tagName=="SELECT")d+=24;return d}function getGroupBar(){if(groupBar==null)groupBar=element.all(element.id+"_groupBar");return groupBar}function getHierBar(){if(hierBar==null)hierBar=element.all(element.id+"_hierBar");return hierBar}function getPager1(){if(pager1==null)pager1=element.all(element.id+"_pager1");return pager1}function getPager2(){if(pager2==null)pager2=element.all(element.id+"_pager2");return pager2}function getPagers(a){if(a==null)return[];var b=[a.getPager1?a.getPager1():element.document.getElementById(a.id+"_pager1"),a.getPager2?a.getPager2():element.document.getElementById(a.id+"_pager2")];$$.utils.cleanArray(b);return b}function getDummy(){if(dummy==null)dummy=element.all(element.id+"_dummy");return dummy}function getViewportHolder(){if(vpholder==null)vpholder=element.all(element.id+"_vpholder");return vpholder}function getMaxCellHeight(b){for(var c=0,a=0;a<b.cells.length;a++)if(b.cells[a].rowSpan==1&&b.cells[a].style.display!="none"){var d=b.cells[a].offsetHeight;if(d>c)c=d}return c}function getFirstNonSpanCell(b){var a=null;if(b.cells.length>0){a=b.cells(0);var c=1;while(a.rowSpan>1&&c<b.cells.length){a=b.cells(c);c++}if(a.rowSpan>1)a=null}return a}function skipRowSpan(b){for(var c=false,a=0;a<b.cells.length;a++)if(b.cells[a].rowSpan>1&&b.cells[a].style.display!="none"||c){b.cells[a].savedRowSpan=b.cells[a].rowSpan;b.cells[a].rowSpan=1}}function restoreRowSpan(b){for(var a=0;a<b.cells.length;a++)if(b.cells[a].savedRowSpan!=null){b.cells[a].rowSpan=b.cells[a].savedRowSpan;b.cells[a].savedRowSpan=null}}function sync2Tables(a,b,f,i,c){if((a==null||b==null)&&!c||c&&a==null&&b==null)return;var g=current,d=a!=null?a.rows.length:0;if(b!=null)if(smartPaint&&a==getRowHeader())d=Math.min(currentCount,b.rows.length);else d=Math.min(d,b.rows.length);else g=0;var h=a==getCorner();c&&restoreSynDelt([a,b],-1);if(a!=null&&b!=null)for(var e=0;e<d;e++)if(!h)synRowHeight(a,b,g+e,f,i,c);else synRowHeight(a,b,e,f,false,c)}function sync3Tables(a,b,c,f,d){if(ignoreSynRowHeight)return;if(a==null&&b==null&&c==null)return;var e=a==getRowHeader()||a==getFrozRowHeader();if(a==null){e=b==getRowHeader()||b==getFrozRowHeader();sync2Tables(b,c,f,e,d)}else if(b==null)sync2Tables(a,c,f,e,d);else if(c==null)sync2Tables(a,b,f,e,d);else{var h=[a,b,c],i=current,j=a.rows.length;if(smartPaint&&(a==getRowHeader()||c==getViewport()))j=Math.min(currentCount,c.rows.length);else i=0;if(d)restoreSynDelt(h,-1);else for(var g=0;g<j;g++)syncRowsHeight(h,i+g,f,e,d)}}function syncRowsHeight(d,e,q,s,f){for(var g=Number.MIN_VALUE,j=Number.MAX_VALUE,b=0;b<d.length;b++){var l=d[b],a=l.rows[e];if(a==null)return;j=Math.min(j,l.rows.length);var c=getFirstNonSpanCell(a);if(!f&&a.synDelt!=null){if(c!=null&&c.style.height!="")c.style.height=Math.max(c.style.posHeight-a.synDelt,0)+"px";if(a.style.height!="")a.style.height=Math.max(a.style.posHeight-a.synDelt,0)+"px";a.synDelt=null}!f&&c!=null&&setElementHeight(c,Math.max(0,c.offsetHeight));setElementHeight(a,Math.max(0,a.offsetHeight));g=Math.max(g,a.offsetHeight+a.offsetTop)}for(var h=Number.MIN_VALUE,p=0;p<2;p++){for(var b=0;b<d.length;b++){var l=d[b],a=l.rows[e],c=getFirstNonSpanCell(a),i=Math.max(0,g-a.offsetTop);if(!f&&c!=null)c.style.height=i+"px";a.style.height=i+"px";c!=null&&(!f||c.style.height.length>0)&&setElementHeight(c,i);setElementHeight(a,Math.max(0,g-a.offsetTop));h=Math.max(h,a.offsetHeight+a.offsetTop)}if(h==g)break;g=h}if(e<j-1){for(var k=d[0].rows[e+1].offsetTop,n=false,b=1;b<d.length;b++){var a=d[b].rows[e+1];if(k>a.offsetTop){k=a.offsetTop;n=true}}if(n)for(var b=0;b<d.length;b++){var a=d[b].rows[e],r=d[b].rows[e+1],m=r.offsetTop-k;if(m>0){var c=getFirstNonSpanCell(a);!f&&c!=null&&setElementHeight(c,c.offsetHeight-m);setElementHeight(a,a.offsetHeight-m)}}}for(var a,c,b=0;b<d.length;b++){a=d[b].rows[e];if(f&&a.synDelt!=null)continue;c=getFirstNonSpanCell(a);if(c!=null&&(!f||c.style.height.length>0))c.style.height=c.style.posHeight+1+"px";a.style.height=a.style.posHeight+1+"px";a.synDelt=1}for(var b=0;b<d.length;b++)if(!xhtml&&d[b].rows(e)!=null&&d[b].rows(e).style.posHeight<0)d[b].rows(e).style.posHeight=0;if(q){var o=getParentSpread();o!=null&&o.UpdateRowHeight(element)}}function restoreSynDelt(a,c){if(a.length>0)if(Object.prototype.toString.call(a[0]).slice(8,-1)=="Array")for(var b=0;b<a.length;b++){$$.utils.cleanArray(a[b]);_restoreSynDelt(a[b],c)}else _restoreSynDelt(a,c)}function _restoreSynDelt(d,g){$$.utils.cleanArray(d);for(var l=d.length,o=Number.MAX_VALUE,f=getViewport(),k=false,a=0;a<d.length;a++)if(d[a]==f){k=true;break}k&=f!=null&&fpSpreadJS.childViewIndexes.length>0;var s=$$.browser.quirksMode;if(typeof g!="undefined")if(g==-1){for(var b=0;b<l;b++)for(var c=d[b],a=0;a<c.rows.length;a++)if(c.rows[a].synDelt!=null){var m=k&&FpSpreadJS.isChildSpreadRow(f,a);if(m)continue;c.rows[a].style.height=c.rows[a].style.posHeight-c.rows[a].synDelt+"px";c.rows[a].synDelt=null}}else for(var b=0;b<l;b++){var c=d[b];if(c.rows[g].synDelt!=null){var m=k&&FpSpreadJS.isChildSpreadRow(f,a);if(m)continue;c.rows[g].style.height=c.rows[g].style.posHeight-c.rows[g].synDelt+"px";c.rows[g].synDelt=null}}for(var b=0;b<l;b++){var c=d[b];o=Math.min(c.rows.length,o)}for(var h=[],e=[],b=0;b<l;b++){var c=d[b],i=c.rows;if(i.length==0)continue;for(var a=0;a<o;a++){var j=i[a],p=i[a].synDelt==null?null:i[a].synDelt,n=p==null;if(n)p=0;var m=k&&FpSpreadJS.isChildSpreadRow(f,a),r=Math.max(j.style.posHeight-p,0);if(h.length<=a){h.push(r);if(m)e.push(Math.max(0,f.rows[a].cells[0].children[0].offsetHeight+1));else e.push(Math.max(0,j.offsetHeight+(n?1:0)))}else{h[a]=Math.max(h[a],r);if(m)e[a]=Math.max(e[a],Math.max(0,f.rows[a].cells[0].children[0].offsetHeight+1));else e[a]=Math.max(e[a],Math.max(0,j.offsetHeight+(n?1:0)))}if(n)i[a].synDelt=1}}for(var b=0;b<l;b++)for(var c=d[b],i=c.rows,a=0;a<o;a++){var j=i[a];if(j.synDelt!=null){if(h[a]==e[a])continue;j.style.height=Math.max(h[a],e[a])+"px";var q=getFirstNonSpanCell(j);if(q!=null)q.style.height=""}}}function setTableRowHeight(a,d,e,f){var b=getFirstNonSpanCell(a);if(b!=null){var c=d-a.offsetTop-f;b.style.height=c+"px";if(getOffsetHeight(a)+a.offsetTop>d){c-=getOffsetHeight(a)+a.offsetTop-d;b.style.height=c+"px"}if(e&&b.style.posHeight<getOffsetHeight(a)){var g=b.innerHTML;b.innerHTML="";b.innerHTML=g}}else{var c=d-a.offsetTop;a.style.height=c+"px";if(getOffsetHeight(a)+a.offsetTop>d){c-=getOffsetHeight(a)+a.offsetTop-d;a.style.height=c+"px"}}}function synRowHeight(a,b,f,d,e,c){if(a==null||b==null)return;syncRowsHeight([a,b],f,d,e,c)}function setElementHeight(a,b){if(a.offsetHeight==b)return;a.style.height=b+"px";var c=null;while(a.offsetHeight>b){c=a.offsetHeight;var d=parseInt(a.style.height)-(a.offsetHeight-b);a.style.height=Math.max(1,d)+"px";if(d<1||a.offsetHeight==c)break}while(a.offsetHeight<b){c=a.offsetHeight;var d=parseInt(a.style.height)+1;a.style.height=d+"px";if(d>b||a.offsetHeight==c)break}return a.offsetHeight}function getMaxRowSpanInRow(a){if(a==null)return 0;for(var c=1,b=0;b<a.cells.length;b++)if(a.cells[b].rowSpan>1&&a.cells[b].rowSpan>c)c=a.cells[b].rowSpan;return c}function getOffsetHeight(a){for(var d=a.offsetHeight,f=false,b=0;b<a.cells.length;b++)if(a.cells[b].rowSpan==1){d=a.cells[b].offsetHeight;f=true;break}if(!f)if(a.cells.length>0){var c=element.document;if(!c.createElement)c=window.document;var e=c.createElement("td");a.insertBefore(e,null);d=e.offsetHeight;a.removeChild(e)}return d}function sizeFrozHeader(b,c){for(var a=0;a<b.children.length&&a<c.children.length;a++){var d=b.children[a].offsetWidth,e=c.children[a].offsetWidth;if(engine>=9){d=parseInt(b.children[a].width);e=parseInt(c.children[a].width)}if(d>e){var f=parseInt(c.children[a].width)+(d-e);c.children[a].width=f}else{var f=parseInt(b.children[a].width)+(e-d);b.children[a].width=f}}}function sizeColHeader(f,e){for(var a=0;a<f.children.length&&a<e.children.length;a++){if(typeof element.getAttribute("mcctCellType")!="undefined"&&element.getAttribute("mcctCellType")=="true")e.children[a].width=1;var c=parseInt(f.children[a].width);if(isNaN(c))c=1;var d=parseInt(e.children[a].width);if(isNaN(d))d=1;if(c>d){var b=parseInt(e.children[a].width);if(isNaN(b))b=d;b+=c-d;e.children[a].width=b}else{var b=parseInt(f.children[a].width);if(isNaN(b))b=c;b+=d-c;f.children[a].width=b}}}function sizeFrozFooter(b,c){for(var a=0;a<b.children.length&&a<c.children.length;a++){var d=b.children[a].offsetWidth,e=c.children[a].offsetWidth;if(engine>=9){d=parseInt(b.children[a].width);e=parseInt(c.children[a].width)}if(d>e){var f=parseInt(c.children[a].width)+(d-e);c.children[a].width=f}else{var f=parseInt(b.children[a].width)+(e-d);b.children[a].width=f}}}function sizeColFooter(d,c,g){for(var a=0;a<d.children.length&&a<c.children.length;a++){var e=d.children[a].offsetWidth,f=c.children[a].offsetWidth;if(engine>=9){e=parseInt(d.children[a].width);f=parseInt(c.children[a].width)}if(e>f){var b=parseInt(c.children[a].width);if(isNaN(b))b=f;b+=e-f;if(getViewport().cellSpacing==0&&!g)if(getParentSpread()==null&&a==c.children.length-1)c.children[a].width=b+1;else c.children[a].width=b;else c.children[a].width=b}else{var b=parseInt(d.children[a].width);if(isNaN(b))b=e;b+=f-e;if(getViewport().cellSpacing==0&&!g)if(getParentSpread()==null&&a==c.children.length-1)d.children[a].width=Math.max(b-1,1);else d.children[a].width=b;else d.children[a].width=b}}}function sizeRowHeader(f,c){for(var a=0;a<f.children.length&&a<c.children.length;a++){var e=f.children[a].offsetWidth,d=c.children[a].offsetWidth;if(d>=e){var b=parseInt(c.children[a].width);if(isNaN(b))b=d;b-=d-e;c.children[a].width=b}else{var b=parseInt(c.children[a].width);if(isNaN(b))b=d;b+=e-d;c.children[a].width=b}}}function setRowHeaderColWidth(a,b,q){var c=getRowHeader(),h=getCorner();if(c==null)return;if(b>element.clientWidth)b=Math.max(element.clientWidth-10,10);var j=[getCorner(),getFrozRowHeader(),getRowHeader(),getFooterCorner()];$$.utils.cleanArray(j);restoreTableWidth(j);var d=getColGroup(c),o=a;if(element.getAttribute("layoutMode")&&d&&parseInt(a)>=d.children.length)a=d.children.length-1+"";var e=b-parseInt(d.children[a].width);d.children[a].width=b;var g=getFrozRowHeader();if(g!=null){var d=getColGroup(g);d.children[a].width=b;g.parentElement.style.posWidth+=e}c.parentElement.style.posWidth+=e;if(h!=null){h.parentElement.style.posWidth+=e;var f=getColGroup(h);if(f!=null)if(h.getAttribute("allowTableCorner"))f.children[a].width=b;else f.children[0].width=parseInt(f.children[0].width)+e}var n=getFooterCorner();if(n!=null)n.parentElement.style.posWidth+=e;var m=c.parentElement.parentElement.parentElement.parentElement.parentElement;if(g!=null)m=m.parentElement.parentElement.parentElement.parentElement;var r=m.rows(0).cells(0);r.style.width=c.parentElement.style.posWidth-parseInt(c.cellSpacing)+"px";var l=getColGroup(element.getElementsByTagName("TABLE")[0]);if(l!=null)l.children[0].width=parseInt(l.children[0].width)+e;fixMissedColumns(j,a);if(q){syncRowRange(-1,-1,true);syncRowRangeSafeMode(-1,-1,false);syncRowRange(-1,-1,false,true);sizeSpread(true)}if(element.getAttribute("layoutMode")&&o)a=o;var k=addColInfo(a,true);if(k!=null){xmlData.switchNodeContext(k);var i=xmlData.selectSingleNode("width");xmlData.resetNodeContext();if(i==null){i=xmlData.createElement("width");k.appendChild(i)}if(xhtml)b+=2;xmlData.textContent(i,b)}var p=getCmdBtn("Update");p!=null&&updateCmdBtnState(p,false);dirty=true}function setColHeaderRowHeight(c,d,j,g){var b=getColHeader();if(b==null)return;var h=b.rows(c);h.style.posHeight=d;if(b.__bkStyleHeight==null)b.__bkStyleHeight=b.style.height;b.style.height="";var a=getFrozColHeader();if(a!=null){h=a.rows(c);h.style.height=d+"px";if(a.__bkStyleHeight==null)a.__bkStyleHeight=a.style.height;a.style.height=""}if(j){syncRowRange(c.rowIndex,c.rowIndex,true);sizeSpread(true);b.style.height=b.__bkStyleHeight;if(a!=null){a.style.height=a.__bkStyleHeight;a.__bkStyleHeight=null}b.__bkStyleHeight=null}var f=addRowInfo(c,true);if(f!=null){xmlData.switchNodeContext(f);var e=xmlData.selectSingleNode("height");xmlData.resetNodeContext();if(e==null){e=xmlData.createElement("height");f.appendChild(e)}if(g!=null&&g.synDelt!=null)d-=g.synDelt;xmlData.textContent(e,d)}var i=getCmdBtn("Update");i!=null&&updateCmdBtnState(i,false);dirty=true}function EnsureRowHeight(a){var b=a;if(getViewport1()!=null)b=a-frzRows;if(getViewport0()!=null&&getViewport1()!=null)if(0<=a&&a<getViewport1().rows.length){synRowHeight(getViewport0(),getViewport1(),a,false,false);synRowHeight(getViewport0(),getViewport1(),a,false,false)}if(getViewport()!=null&&getViewport2()!=null)if(0<=b&&b<getViewport().rows.length){synRowHeight(getViewport2(),getViewport(),b,false,false);synRowHeight(getViewport2(),getViewport(),b,false,false)}if(getFrozRowHeader()!=null)if(0<=a&&a<getViewport1().rows.length){synRowHeight(getFrozRowHeader(),getViewport1(),a,false,true);synRowHeight(getFrozRowHeader(),getViewport0(),a,false,true)}if(getRowHeader()!=null)if(0<=b&&b<getViewport().rows.length){synRowHeight(getRowHeader(),getViewport(),b,false,true);synRowHeight(getRowHeader(),getViewport2(),b,false,true)}if(getViewport0()!=null&&getViewport1()!=null)if(0<=a&&a<getViewport1().rows.length){synRowHeight(getViewport0(),getViewport1(),a,false,false);synRowHeight(getViewport0(),getViewport1(),a,false,false)}if(getViewport()!=null&&getViewport2()!=null)if(0<=b&&b<getViewport().rows.length){synRowHeight(getViewport2(),getViewport(),b,false,false);synRowHeight(getViewport2(),getViewport(),b,false,false)}if(getFrozRowHeader()!=null)if(0<=a&&a<getViewport1().rows.length){synRowHeight(getFrozRowHeader(),getViewport1(),a,false,true);synRowHeight(getFrozRowHeader(),getViewport0(),a,false,true)}if(getRowHeader()!=null)if(0<=b&&b<getViewport().rows.length){synRowHeight(getRowHeader(),getViewport(),b,false,true);synRowHeight(getRowHeader(),getViewport2(),b,false,true)}}function cleanElementsStyle(e,b,c){if(e==null||e.length==0||typeof b=="undefined"||b==null)return;var h=typeof c=="function";if(c==null)c="";for(var d=null,f=0;f<e.length;f++){d=e[f];for(var g=[],a=0;a<b.length;a++){d.setAttribute("__bkStyle"+b[a],d.style[b[a]]);g.push(h?c(d,b[a]):c)}for(var a=0;a<b.length;a++)d.style[b[a]]=g[a]}}function restoreElementsStyle(c,a){if(c==null||c.length==0||typeof a=="undefined"||a==null)return;for(var d=null,f=null,e=0;e<c.length;e++){d=c[e];for(var b=0;b<a.length;b++){f=d.getAttribute("__bkStyle"+a[b]);d.style[a[b]]=f;d.removeAttribute("__bkStyle"+a[b])}}}function cleanTablesStyle(b,a){var c=getSpreadTables();cleanElementsStyle(c,b,a)}function restoreTablesStyle(a){var b=getSpreadTables();restoreElementsStyle(b,a)}function getSpreadTables(){var a=[getCorner(),getFrozColHeader(),getColHeader(),getFrozRowHeader(),getRowHeader(),getViewport0(),getViewport1(),getViewport2(),getViewport(),getFrozColFooter(),getColFooter()];$$.utils.cleanArray(a);return a}function EnsureAllRowHeights(a){cleanTablesStyle(["height"]);sync3Tables(getFrozRowHeader(),getViewport0(),getViewport1(),false,a);sync3Tables(getRowHeader(),getViewport2(),getViewport(),false,a);a&&frzRows==0&&$$.browser.quirksMode&&syncRowRange(0,0);sync2Tables(getFrozColFooter(),getColFooter(),false,false,a);var e=getCorner(),b=getColHeader(),c=getFrozColHeader();if(e!=null)if(e.getAttribute("allowTableCorner")!=null){sync3Tables(getCorner(),getFrozColHeader(),getColHeader(),false,a);sync3Tables(getCorner(),getFrozColHeader(),getColHeader(),false,a)}else{sync2Tables(c,b,false,false,a);sync2Tables(c,b,false,false,a)}else sync2Tables(c,b,false,false,a);if(getViewport()!=null){var d=getViewport(),f=d.align;d.align="middle";d.align=f}restoreTablesStyle(["height"])}function SuspendLayout(){bSuspendLayout=true}function ResumeLayout(d){bSuspendLayout=false;if(d){var b=[getFrozColHeader(),getColHeader(),getFrozColFooter(),getColFooter()];$$.utils.cleanArray(b);for(var a=0;a<b.length;a++){var c=b[a];c.__bkStyleHeight=c.style.height}syncRowRangeSafeMode(-1,-1);syncRowRange(-1,-1,true);syncRowRange(-1,-1,false,true);sizeSpread(true);for(var a=0;a<b.length;a++){var c=b[a];c.style.height=c.__bkStyleHeight;c.__bkStyleHeight=null}}}function processResize(){try{if(element.oldHeight==null)element.oldHeight=element.offsetHeight;else if(element.oldHeight!=element.offsetHeight){var g=getParentSpread();if(g!=null){element.oldHeight=element.offsetHeight;g.UpdateRowHeight(element)}}if(getViewport()!=null&&getViewport().parentElement==null)return;if(getTopSpread(element).resizing)return;sizeSpread(true);var a=getViewport2();if(a!=null&&a.parentElement.style.posWidth!=a.offsetWidth)a.parentElement.style.width=a.offsetWidth+"px";a=getViewport0();if(a!=null&&a.parentElement.style.posWidth!=a.offsetWidth)a.parentElement.style.width=a.offsetWidth+"px";if(getParentSpread()==null){var c=getRowHeader();if(c!=null)c.rows[c.rows.length-1].style.height=getTopSpread(element).clientHeight+999+"px";var f=getTopSpread(element).offsetWidth,e=getColHeader();if(e!=null){var b=getColGroup(e);if(b.children!=null&&b.children.length>0)b.children[b.children.length-1].width=f}var d=getColFooter();if(d!=null){var b=getColGroup(d);if(b.children!=null&&b.children.length>0)b.children[b.children.length-1].width=f}}}catch(h){$$.DEBUG.Log(h,"processResize")}}function backUpStyleSetting(){var b=false;ignorePropertyChanged=true;var a=element;while(a!=null&&a!=element.document&&a!=element.document.body){if(a.style.display=="none"){a.displaySetting=a.style.display;a.style.display="";b=true}else if(a.currentStyle!=null&&a.currentStyle.display=="none"){a.displaySetting="";a.style.display="block";b=true}a=a.parentNode}ignorePropertyChanged=false;return b}function restoreStyleSetting(b){ignorePropertyChanged=true;var a=element;while(a!=null&&a!=element.document&&a!=element.document.body){if(a.displaySetting!=null&&a.displaySetting!="null")if(!b)a.style.display="$";else if(a.style.display=="$"){a.style.display=a.displaySetting;a.displaySetting=null}a=a.parentNode}ignorePropertyChanged=false}function getChildSpreadOffsetWidth(a){if(typeof a=="undefined"||a==null)return 0;var g=0,h=0,b=element.document;if(!b.getElementById)b=window.document;var c=b.getElementById(a.id+"_corner");if(c!=null)g=parseInt(c.offsetWidth);else{c=b.getElementById(a.id+"_rowHeader");if(c!=null)g=parseInt(c.offsetWidth)}var d=b.getElementById(a.id+"_colHeader");if(d!=null)h=parseInt(d.offsetWidth);else{d=b.getElementById(a.id+"_viewport");if(d!=null)h=parseInt(d.offsetWidth)}var e=0,f=GetChildSpreads(a.id);if(f!=null&&f.length>0)for(var j=0,i=0,j=0;j<f.length;j++){i=getChildSpreadOffsetWidth(f[j]);if(i>e)e=i}return h>e?g+h:g+e}function prepairSpreadLayout(){for(var c=[getViewport(),getViewport0(),getViewport1(),getViewport2()],e=[],d=[],b=null,g=0,i=0,h=0,a=0;a<c.length;a++)if(c[a]!=null)for(var f=0;f<c[a].rows.length;f++){b=getFirstNonSpanCell(c[a].rows[f]);if(b!=null){g=b.clientHeight;i=parseInt(b.currentStyle.paddingTop.replace("px",""));h=parseInt(b.currentStyle.paddingBottom.replace("px",""));g-=i+h;e.push(g);d.push(b)}else{e.push(c[a].rows[f].clientHeight);d.push(c[a].rows[f])}}for(var a=0;a<d.length;a++)if(e[a]>0)d[a].style.height=e[a]+"px";e=null;d=null}function syncRowHeaderWidth(){if(element.getAttribute("mcctCellType")==null&&getRowHeader()!=null){var l=getRowHeader().parentElement.getAttribute("rhVisible")!="false";if(l){var n=xmlData.firstElementChild(element),k=getColGroup(n),d=[getCorner(),getFrozRowHeader(),getRowHeader(),getFooterCorner()];$$.utils.cleanArray(d);for(var f=0,h=Number.MAX_VALUE,a=0;a<d.length;a++){f=Math.max(f,d[a].offsetWidth);h=Math.min(h,parseInt(d[a].cellSpacing))}if(k!=null&&k.children.length>0)if(f-h>0)k.children[0].width=f-h+"px";for(var a=0,o=d.length;a<o;a++)d[a].parentElement.style.width=f+"px";var c=getCorner();if(c!=null&&c.getAttribute("allowTableCorner")==null){var b=getColGroup(c);if(b==null){b=element.document.createElement("COLGROUP");var m=element.document.createElement("COL");b.appendChild(m);var g=c.getElementsByTagName("TBODY");if(g!=null){g=g[0];c.insertBefore(b,g)}else c.insertBefore(b)}if(b!=null){var j=null,e=getRowHeader();if(e==null)e=getFrozRowHeader();if(e!=null){j=getColGroup(e);if(j!=null){for(var i=0,a=0;a<j.children.length;a++)i+=getRealColWidth(e,a);if(i>0)b.children[0].width=i}}}}}}}function syncColWidth(){var f=getFrozColHeader(),b=getColGroup(f);if(b!=null){var a=getColGroup(getViewport0());a!=null&&getViewport0().rows.length>0&&sizeFrozHeader(b,a);var c=getViewport2();a=getColGroup(c);if(a!=null&&c.rows.length>0){sizeFrozHeader(b,a);if(c.rows.length>0&&c.rows[0].cells.length>0&&f.rows.length>0&&f.rows[0].cells.length>0){var e=f.rows[0].cells[0].offsetLeft-c.rows[0].cells[0].offsetLeft;if(e>0)b.children[0].width-=e}}a=getColGroup(getFrozColFooter());a!=null&&getViewport2().rows.length>0&&sizeFrozHeader(b,a)}else{b=getColGroup(getViewport0());var a=getColGroup(getViewport2());b!=null&&a!=null&&sizeFrozHeader(b,a)}var h=getFrozColHeader()?getFrozColHeader():getFrozColFooter();if(h!=null){var i=element.all(element.id+"_hidencol2");i.style.posWidth=h.offsetWidth-parseInt(h.cellSpacing)}var g=getColHeader();b=getColGroup(g);if(b!=null){var d=getViewport(),a=getColGroup(d);a!=null&&sizeColHeader(b,a,false);if(d!=null&&d.rows.length>0&&d.rows[0].cells.length>0&&g.rows.length>0&&g.rows[0].cells.length>0){var e=g.rows[0].cells[0].offsetLeft-d.rows[0].cells[0].offsetLeft;if(e>0)b.children[0].width-=e}a=getColGroup(getViewport1());a!=null&&sizeColHeader(b,a,false);a=getColGroup(getColFooter());a!=null&&sizeColHeader(b,a,false)}else{b=getColGroup(getViewport());a=getColGroup(getViewport1());b!=null&&a!=null&&sizeColHeader(b,a,true)}}function setResizingFlag(b){var a=getTopSpread(element);if(b)a.resizing=true;if(a.resizePending==null)a.resizePending=0;if(b)a.resizePending=a.resizePending+1;else a.resizePending=Math.max(0,a.resizePending-1);if(!b&&a.resizePending==0){var c=element.offsetHeight;a.resizing=false}}function sizeSpread(b,c,a){setResizingFlag(true);_sizeSpread(b,c,a);setResizingFlag(false)}function shouldIgnoreSizeSpread(){return bSuspendLayout?true:(element.style.pixelHeight==0||element.style.pixelWidth==0)&&element.getAttribute("hostspread")!=null?true:element.isSizeSpread==true?true:false}function _sizeSpread(M,B,A){if(shouldIgnoreSizeSpread())return;var V=backUpStyleSetting();element.isSizeSpread=true;if(getViewport()==null)return;var K=A!=null&&A.NeedFixMissedColumns,W=A!=null&&A.NeedSyncColumns;K&&restoreBrowserColRender();var Z=xmlData.firstElementChild(element),t=getColGroup(Z),g=0,o=getFrozColHeader();if(o!=null){g=o.offsetWidth-parseInt(o.cellSpacing);if(t!=null&&g>0)if(getRowHeader()==null)t.children[0].width=g;else t.children[1].width=g;if(o!=null){o.parentNode.style.posWidth=g;var F=o.parentNode.parentNode.offsetWidth-o.parentNode.offsetWidth;if(!xhtml)F+=parseInt(o.cellSpacing);getColHeader().parentNode.style.posLeft=-F}}syncMsgs();W&&syncColWidth();if(getColHeader()!=null&&getColHeader().rows.length>0){var D=getColHeader().offsetHeight;if(xhtml){getColHeader().parentElement.style.posHeight=D-2*parseInt(getColHeader().cellSpacing);getColHeader().parentElement.parentElement.parentElement.style.posHeight=D-2*parseInt(getColHeader().cellSpacing)}else{getColHeader().parentElement.style.posHeight=D-parseInt(getColHeader().cellSpacing);getColHeader().parentElement.parentElement.parentElement.style.posHeight=D-parseInt(getColHeader().cellSpacing)}}var bb=false;K&&fixMissedColumns();syncRowHeaderWidth();if(M==null||M==false){if(B)try{syncChildViewColumnRange(element,-1,-1)}catch(cb){$$.DEBUG.Log(cb,"An exception is thrown when synchronize child view columns")}EnsureAllRowHeights(B)}var c=0;if(getFrozColHeader()!=null)c=getFrozColHeader().offsetWidth-parseInt(getFrozColHeader().cellSpacing);var h=getNoRow(0);if(h!=null)h.style.width=c+"px";if(getViewport0()!=null)c=Math.max(c,getViewport0().offsetWidth-parseInt(getViewport0().cellSpacing));h=getNoRow(2);if(h!=null)h.style.width=c+"px";c=0;if(getColHeader()!=null){var y=getColHeader();c=y.offsetWidth;if(y.rows.length>0&&y.rows[0].cells.length>0)c-=y.rows[0].cells[y.rows[0].cells.length-1].offsetWidth}h=getNoRow(1);if(h!=null)h.style.width=c+"px";if(getViewport1()!=null)c=Math.max(c,getViewport1().offsetWidth);if(element.getAttribute("UIVirtualization")=="True"||frzRows>0){h=getNoRow(-1);if(h!=null)h.style.width=c+"px"}var f=element.getAttribute("ClientAutoSize")=="True";updateAutoSize();var b=element.style.pixelHeight;if(getParentSpread()!=null||element.className.length>0&&element.style.pixelHeight==0)b=element.clientHeight;var j=Math.max(element.clientWidth,element.style.pixelWidth);if(getCommandBar()!=null){b-=getCommandBar().offsetHeight;getCommandBar().style.posWidth=j}if(getColFooter()!=null){b-=getColFooter().offsetHeight;if(getParentSpread()!=null)getColFooter().parentNode.style.position="absolute"}if(getColHeader()!=null){if(xhtml||GetColCount()>0||!xhtml&&GetRowCount()==0||!xhtml&&GetRowCount()>0&&getViewport().parentNode.style.position=="absolute")b-=getColHeader().offsetHeight;if(getParentSpread()!=null)getColHeader().parentNode.style.position="absolute"}var R=getHierBar();if(R!=null)b-=R.offsetHeight;var Q=getGroupBar();if(Q!=null)b-=Q.offsetHeight;var J=getPager1();if(J!=null){b-=J.offsetHeight;initSlideBar(J)}var l=getPager2();if(l!=null){if(element.inDesign)l.style.width=""+Math.max(element.offsetWidth-10,0)+"px";else l.style.width=""+Math.max(j-10,0)+"px";b-=l.offsetHeight;if(xhtml&&element.style.position!="absolute"&&element.style.position!="relative")l.style.position="";initSlideBar(l)}var i=null;if(getRowHeader()!=null)i=getRowHeader().parentElement;var d=null;if(getColHeader()!=null)d=getColHeader().parentElement;var k=null;if(getColFooter()!=null)k=getColFooter().parentElement;var a=getScrollvp();if(a!=null){a.style.display="block";updateDummyHeight()}else a=getViewport().parentElement;if(d!=null){d.style.posHeight=getColHeader().offsetHeight;if(getFrozColHeader()!=null){var F=Math.max(getMaxLastRowBorderHeight(getColHeader())-getMaxLastRowBorderHeight(getFrozColHeader()),0)/2,O=getColHeader().offsetHeight-F;getFrozColHeader().parentNode.style.posHeight=O;getFrozColHeader().parentNode.style.overflow="visible";getFrozColHeader().parentNode.style.width=""}if($$.browser.quirksMode){var O=getFrozColHeader()!=null?getFrozColHeader().parentElement.style.posHeight:0,ab=Math.max(O,d.style.posHeight);d.parentElement.parentElement.style.height=ab+"px"}var v=getCorner(),F=Math.max(getMaxLastRowBorderHeight(getColHeader())-getMaxLastRowBorderHeight(v),0)/2;if(v!=null){v.parentElement.style.posHeight=d.style.posHeight-F;if(v.getAttribute("allowTableCorner")==null){var p=v.rows[0];if(p!=null){var P=p.style.height;if(P.length>0){var X=p.offsetHeight;p.style.height=Math.max(p.style.posHeight-1,0)+"px";if(p.offsetHeight<X)p.style.height=P}}}}if(getParentSpread()!=null){var E;if(getViewport()!=null&&getViewport().offsetWidth<getColHeader().offsetWidth)E=getViewport().offsetWidth;else E=getColHeader().offsetWidth;d.style.posWidth=E;getColHeader().style.posWidth=E;if(!$$.browser.quirksMode)d.style.width=getColHeader().offsetWidth+"px"}}if(k!=null){k.style.posHeight=getColFooter().offsetHeight;if(getFrozColFooter()!=null)getFrozColFooter().parentNode.style.posHeight=getColFooter().offsetHeight;var N=getFooterCorner();if(N!=null)N.parentElement.style.posHeight=k.style.posHeight;if(getParentSpread()!=null){k.style.posWidth=getColFooter().offsetWidth;getColFooter().style.posWidth=getColFooter().offsetWidth}}var C=element.document;if(!C.getElementById)C=window.document;var U=C.getElementById(element.id+"_titleBar");if(U)b-=U.parentNode.clientHeight;if(a!=null){if(viewport!=null&&viewport.parentElement!=null&&viewport.parentElement!=a)a.style.position="absolute";if(i!=null){a.style.width=Math.max(j-i.offsetWidth+parseInt(getViewport().cellSpacing),1)+"px";a.style.height=Math.max(b,1)+"px";a.style.width=Math.max(j-i.offsetWidth+parseInt(getViewport().cellSpacing),1)+"px"}else{a.style.width=Math.max(j,1)+"px";a.style.height=Math.max(b,1)+"px";a.style.width=Math.max(j,1)+"px"}}if(d!=null&&getFrozColHeader()!=null&&getFrozColHeader().offsetWidth>a.clientWidth){getFrozColHeader().parentNode.style.overflow="hidden";getFrozColHeader().parentNode.style.posWidth=a.offsetWidth}var e=getParent(getViewport1()),x=getParent(getViewport2());if(e!=null){e.style.height=Math.max(0,getViewport1().offsetHeight-parseInt(getViewport1().cellSpacing))+"px";var G=getParent(getViewport0());if(G!=null){G.style.height=Math.max(0,getViewport0().offsetHeight-parseInt(getViewport0().cellSpacing))+"px";var S=Math.max(G.style.posHeight,e.style.posHeight)+"px";G.style.height=S;e.style.height=S}if(f)if(getViewport0()!=null)e.style.width=Math.max(1,a.offsetWidth-getViewport0().offsetWidth+parseInt(getViewport0().cellSpacing))+"px";else e.style.width=Math.max(1,a.offsetWidth)+"px";else if(getViewport0()!=null)e.style.width=Math.max(1,a.clientWidth-getViewport0().offsetWidth+parseInt(getViewport0().cellSpacing))+"px";else e.style.width=Math.max(1,a.clientWidth)+"px"}if(e!=null)if(frzCols>0)if(f)e.style.width=Math.max(1,a.offsetWidth-getViewport0().offsetWidth+parseInt(getViewport0().cellSpacing))+"px";else e.style.width=Math.max(1,a.clientWidth-getViewport0().offsetWidth+parseInt(getViewport0().cellSpacing))+"px";else if(f)e.style.width=Math.max(1,a.offsetWidth)+"px";else e.style.width=Math.max(1,a.clientWidth)+"px";if(x!=null)if(getViewport0()!=null)if(f)x.style.height=Math.max(1,a.offsetHeight-Math.max(getViewport0().offsetHeight,getViewport1().offsetHeight)+parseInt(getViewport2().cellSpacing))+"px";else x.style.height=Math.max(1,a.clientHeight-Math.max(getViewport0().offsetHeight,getViewport1().offsetHeight)+parseInt(getViewport2().cellSpacing))+"px";else if(f)x.style.height=Math.max(1,a.offsetHeight)+"px";else x.style.height=Math.max(1,a.clientHeight)+"px";if((frzRows>0||frzCols>0)&&getViewport()!=null){var n=getViewport().parentElement;if(frzCols>0){var c=0;if(getFrozColHeader()!=null)c=getFrozColHeader().offsetWidth-getFrozColHeader().cellSpacing;if(getViewport2()!=null)c=Math.max(c,getViewport2().offsetWidth-getViewport2().cellSpacing);if(f)n.style.width=Math.max(1,a.offsetWidth-getViewport2().offsetWidth+parseInt(getViewport2().cellSpacing))+"px";else n.style.width=Math.max(1,a.clientWidth-c)+"px"}else if(f)n.style.width=Math.max(1,a.offsetWidth)+"px";else n.style.width=Math.max(1,a.clientWidth)+"px";if(frzRows>0)if(f)n.style.height=Math.max(1,a.offsetHeight-getViewport1().offsetHeight+parseInt(getViewport1().cellSpacing))+"px";else n.style.height=Math.max(1,a.clientHeight-getViewport1().offsetHeight+parseInt(getViewport1().cellSpacing))+"px";else if(f)n.style.height=Math.max(1,a.offsetHeight)+"px";else n.style.height=Math.max(1,a.clientHeight)+"px"}if(i!=null){i.style.position="relative";if(frzRows>0){var z=0;if(getViewport0()!=null)z=getViewport0().offsetHeight-parseInt(getViewport0().cellSpacing);if(getViewport1()!=null&&getViewport1().offsetHeight>z)z=getViewport1().offsetHeight-parseInt(getViewport1().cellSpacing);i.style.height=Math.max(a.offsetHeight-z,1)+"px";getFrozRowHeader().parentNode.style.posHeight=Math.max(Math.min(z,a.offsetHeight),1);getFrozRowHeader().parentNode.style.overflow="hidden"}else i.style.height=Math.max(a.offsetHeight,1)+"px"}if((getParentSpread()==null||getParentSpread().getAttribute("hierView")!="true")&&(d!=null||k!=null)){var r=0;if(i!=null)if(frzCols>0)r=Math.max(j-i.offsetWidth-getViewport2().offsetWidth+parseInt(getRowHeader().cellSpacing)+parseInt(getViewport2().cellSpacing),1);else r=Math.max(j-i.offsetWidth+parseInt(getRowHeader().cellSpacing),1);else if(frzCols>0)r=Math.max(j-getViewport2().offsetWidth+parseInt(getViewport2().cellSpacing),1);else r=Math.max(j+parseInt(getViewport().cellSpacing),1);if(d!=null){d.style.width=r+"px";if(engine<8)d.parentElement.style.width=r+"px"}if(k!=null){k.style.width=r+"px";k.parentElement.style.width=k.style.width}}var w=getParentSpread(),L=!$$.browser.quirksMode||w==null;if(getViewport0()!=null){getViewport0().parentNode.style.position="relative";getViewport0().style.position="relative";getViewport0().style.posTop=-getViewport().cellSpacing}if(getViewport1()!=null){getViewport1().parentElement.style.position="relative";getViewport1().style.position="relative";getViewport1().style.posTop=-getViewport().cellSpacing}if(getViewport2()!=null){getViewport2().parentElement.style.position="relative";getViewport2().style.position="relative";getViewport2().style.posTop=-getViewport().cellSpacing}if(getViewport()!=null){if(getViewport().parentElement!=null)if(getParentSpread()==null)getViewport().parentElement.style.position="relative";else getViewport().parentElement.style.position="absolute";getViewport().style.position=L?"relative":"";getViewport().style.posTop=-getViewport().cellSpacing}if(getFrozRowHeader()!=null){getFrozRowHeader().style.position="relative";getFrozRowHeader().parentElement.style.position="relative";getFrozRowHeader().style.posTop=-getViewport().cellSpacing}rowHeader=getRowHeader();if(rowHeader!=null&&rowHeader.parentElement!=null){rowHeader.style.position="relative";rowHeader.parentElement.style.position=L?"relative":"";rowHeader.style.posTop=-getViewport().cellSpacing}var s=getViewportHolder();if(s!=null){s.style.overflow="hidden";if(f){s.style.height=a.offsetHeight+"px";s.style.width=a.offsetWidth+"px"}else{s.style.height=a.clientHeight+"px";s.style.width=a.clientWidth+"px"}if(vpholder_setSizeCallback==null){var Y=function(){var b=getViewportHolder(),a=arguments[arguments.length-1],c=element.getAttribute("ClientAutoSize")=="True";if(c){if(a.offsetHeight>0)b.style.height=a.offsetHeight+"px";if(a.offsetWidth>0)b.style.width=a.offsetWidth+"px"}else{if(a.clientHeight>0)b.style.height=a.clientHeight+"px";if(a.clientWidth>0)b.style.width=a.clientWidth+"px"}};vpholder_setSizeCallback=Function.CreateCallback(Y,a)}setTimeout(vpholder_setSizeCallback,100);if(smartPaint&&frzRows==0&&frzCols==0){getViewport().parentNode.style.height=a.clientHeight+"px";getViewport().parentNode.style.width=a.clientWidth+"px"}}var T=element.getAttribute("cmdTop")=="true";if(getCommandBar()!=null&&!T){b=a.offsetTop+a.offsetHeight;if(getColFooter()!=null)b+=getColFooter().offsetHeight;getCommandBar().style.top=b+"px";if(rowHeader==null)getCommandBar().style.position="absolute"}if(l!=null){l.style.position="absolute";if(getCommandBar()!=null&&!T)b=a.offsetTop+a.offsetHeight+getCommandBar().offsetHeight;else b=a.offsetTop+a.offsetHeight;if(getColFooter()!=null)b+=getColFooter().offsetHeight;l.style.top=b+"px"}if(getViewport0()!=null){if(getViewport0().rows.length>0){var u=getViewport0().offsetWidth-parseInt(getViewport0().cellSpacing);if(d==null&&xhtml)if(getViewport2()!=null&&getViewport2().offsetWidth>getViewport0().offsetWidth){u=getViewport2().offsetWidth-parseInt(getViewport2().cellSpacing);getViewport0().style.width=u+parseInt(getViewport0().cellSpacing)+"px"}getViewport0().parentElement.style.posWidth=u}}else if(getViewport1()!=null)getViewport1().parentElement.parentElement.parentElement.style.posHeight=getViewport1().offsetHeight-parseInt(getViewport1().cellSpacing);if(getViewport2()!=null)if(getViewport2().rows.length>0){var u=getViewport2().offsetWidth-parseInt(getViewport2().cellSpacing);if(d==null&&xhtml)if(getViewport0()!=null&&getViewport0().offsetWidth>getViewport2().offsetWidth){u=getViewport0().offsetWidth-parseInt(getViewport0().cellSpacing);getViewport2().style.width=u+parseInt(getViewport0().cellSpacing)+"px"}getViewport2().parentElement.style.width=u+"px"}var I=getFrozColFooter();if(I!=null){if(getFrozColHeader()==null){g=getViewport0()!=null?getViewport0().offsetWidth:getViewport2()!=null?getViewport2().offsetWidth:0;g-=parseInt(getViewport().cellSpacing);if(t!=null&&g>0)if(getRowHeader()==null)t.children[0].width=g;else t.children[1].width=g}I.parentElement.style.width=g+"px";I.style.width="1px"}ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false;if(w!=null&&typeof w.UpdateRowHeight=="function"){if(xhtml){var q=getViewport();if(q!=null)q.parentElement.style.height="";q=getRowHeader();if(q!=null)q.parentElement.style.height=""}!B&&w.UpdateRowHeight(element,B);w.sizeSpread(true)}if(!xhtml&&getColFooter()!=null)getColFooter().parentElement.parentElement.parentElement.style.height="auto";if(!xhtml&&getViewport()&&!getRowHeader()&&!getViewport0()&&!getViewport1()&&!getViewport2()){var q=getViewport();q.parentNode.parentNode.parentNode.style.height=""+q.parentNode.offsetHeight+"px"}if(getTitleBar()!=null||getPager1()!=null||getHierBar()!=null||getGroupBar()!=null||getColHeader()!=null||getColFooter()!=null){var m=0;if(getTitleBar()!=null)m+=parseInt(getTitleBar().offsetHeight);if(getGroupBar()!=null)m+=parseInt(getGroupBar().offsetHeight);if(getPager1()!=null)m+=parseInt(getPager1().offsetHeight);if(getHierBar()!=null)m+=parseInt(getHierBar().offsetHeight);if(getCommandBar()!=null)m+=parseInt(getCommandBar().offsetHeight);if(getColHeader()!=null)m+=parseInt(getColHeader().offsetHeight);if(getColFooter()!=null)m+=parseInt(getColFooter().offsetHeight);if(m>parseInt(element.style.height)){if(getColHeader()!=null&&getColHeader().parentNode.style.position!=null&&getColHeader().parentNode.style.position!="")getColHeader().parentNode.style.position="";if(getColFooter()!=null&&getColFooter().parentNode.style.position!=null&&getColFooter().parentNode.style.position!="")getColFooter().parentNode.style.position="";if(getCommandBar()!=null&&getCommandBar().style.position!=null&&getCommandBar().style.position!="")getCommandBar().style.position=""}}if(f&&a!=null&&dummy!=null)a.style.display="none";if((getViewport1()!=null||getViewport2()!=null||element.getAttribute("UIVirtualization")=="True")&&getColFooter()!=null&&getRowHeader()==null){var a=element.all(element.id+"_scrollvp");if(a!=null){var H=a.parentElement;if(H!=null)if(H.parentElement!=null&&H.parentElement.tagName=="TR")H.parentElement.style.height=a.style.height}}(C.FpActiveSpread==element||retainSelectionBlock)&&paintFocusRect();updateAutoSize();if(V){restoreStyleSetting();setTimeout(function(){restoreStyleSetting(true);element.isSizeSpread=false},0)}else element.isSizeSpread=false}function getMaxLastRowBorderHeight(a){if(a==null)return 0;for(var d=0,b=0;b<a.rows.length;b++)for(var e=a.rows[b],c=0;c<e.cells.length;c++){if(b+e.cells[c].rowSpan!=a.rows.length)continue;var f=getBorderWidth(e.cells[c],2);if(f>d)d=f}return d}function updateAutoSize(){var c=element.document;if(!c.getElementById)c=window.document;var m=c.documentElement!=null&&c.documentElement.currentStyle.height!=null&&c.documentElement.currentStyle.height.length>0,g=element.getAttribute("ClientAutoSize")=="True";if(g||xhtml&&!m&&element.style.position!="absolute"||!xhtml&&element.style.position!="absolute"&&element.style.position!="relative")if(g||element.style.height!=null&&element.style.height.indexOf("%")>=0){var f=getViewPortSize(g);if(g){var k=c.getElementById(element.id+"_view");if(k!=null){k.style.overflowX="hidden";k.style.overflowY="hidden"}var b=0;if(getRowHeader()!=null)b+=getRowHeader().offsetWidth;var h=getViewport2();if(h!=null)b+=h.rows.length>0?h.offsetWidth:getNoRow(2).offsetWidth+parseInt(h.cellSpacing);var e=GetChildSpreads();if(e!=null&&e.length>0){var d=0,j=2;for(i=0;i<e.length;i++){j=getChildSpreadOffsetWidth(e[i])+2;if(j>d)d=j}if(d>f.width)b+=d;else if(this.getViewport().rows.length>0)b+=f.width;else{var l=this.getViewport1();if(l!=null)b+=l.offsetWidth}}else if(this.getViewport().rows.length>0)b+=f.width;else b+=getMaxWidth([getColHeader(),getViewport1(),getViewport(),getColFooter()]);element.style.posWidth=b}var a=0;if(getTitleBar()!=null)a+=getTitleBar().offsetHeight;if(getSubTitleBar()!=null)a+=getSubTitleBar().offsetHeight;if(getCommandBar()!=null)a+=getCommandBar().offsetHeight;if(getColHeader()!=null)a+=getColHeader().offsetHeight;if(getColFooter()!=null)a+=getColFooter().offsetHeight;if(getViewport1()!=null)a+=getViewport1().offsetHeight;a+=f.height;if(getPager1()!=null)a+=getPager1().offsetHeight;if(getPager2()!=null)a+=getPager2().offsetHeight;if(getHierBar()!=null)a+=getHierBar().offsetHeight;if(getGroupBar()!=null)a+=getGroupBar().offsetHeight;element.style.height=a+"px"}}function getNoRow(c){var b=element.id+"_NoRow";if(c>-1)b=b+c.toString();var a=element.document;if(!a.getElementById)a=window.document;var d=a.getElementById(b);return d}function getMaxWidth(e){for(var b=0,d=0;d<e.length;d++){var a=e[d];if(a==null)continue;var f=a.offsetWidth;if((a==getColHeader()||a==getColFooter())&&a.rows.length>0){var c=a.rows[0];if(c.cells.length>0)f-=c.cells[c.cells.length-1].offsetWidth+parseInt(a.cellSpacing)}b=Math.max(b,f)}return b}function getMaxHeight(d){for(var b=0,c=0;c<d.length;c++){var a=d[c];if(a==null)continue;var e=a.offsetHeight;if(a==getRowHeader()&&a.rows.length>0)e-=a.rows[a.rows.length-1].offsetHeight+parseInt(a.cellSpacing);b=Math.max(b,e)}return b}function getViewPortSize(b){if(!b)b=false;var f=this.getViewport(),c=element.document;if(!c.getElementById)c=window.document;var i=c.getElementById(element.id+"_view"),a={top:element.virtualTop,left:0,right:f.offsetWidth,bottom:element.virtualTop+f.offsetHeight};if(b&&GetRowCountInternal()==0){var e=getColGroup(getColHeader());if(e!=null){for(var h=0,g=0;g<e.children.length-1;g++)h+=parseInt(e.children[g].width);a.right=h}}if(hasChart()&&f!=null&&i!=null){var d=FpChartUtil.getUnionChartsBounds(element);if(d){a.right=Math.max(d.right+5,a.right);a.bottom=Math.max(d.bottom+5,a.bottom)}a.width=a.right-a.left;a.height=a.bottom-a.top}else{a.width=a.right-a.left;a.height=a.bottom-a.top}return a}function getViewPortSize2(f){if(!f)f=false;var e=this.getViewport(),c=element.document;if(!c.getElementById)c=window.document;var b=c.getElementById(element.id+"_view"),a={top:element.virtualTop,left:0,right:e.offsetWidth,bottom:element.virtualTop+e.offsetHeight};if(hasChart()&&e!=null&&b!=null){var d=FpChartUtil.getUnionChartsBounds(element);if(d){a.right=Math.max(d.right+5,a.right);if(a.right>b.clientWidth&&a.right<b.scrollLeft+b.clientWidth)a.right=b.scrollLeft+b.clientWidth;a.bottom=Math.max(d.bottom+5,a.bottom);if(a.bottom>b.clientHeight&&a.bottom<b.scrollTop+b.clientHeight)a.bottom=b.scrollTop+b.clientHeight}a.width=a.right-a.left;a.height=a.bottom-a.top}else{a.width=a.right-a.left;a.height=a.bottom-a.top}return a}function hasChart(){return typeof FpChartUtil!=="undefined"&&FpChartUtil.getChartsIdCollection(element).length>0}function initSlideBar(a){var c=getElementById(a,element.id+"_slideBar");if(c!=null){var f=a.getElementsByTagName("TABLE");if(f!=null&&f.length>0){var e=f[0].rows[0].cells[1],r=e.offsetLeft;slideLeft=r;slideRight=e.offsetLeft+e.offsetWidth-c.offsetWidth;var p=a.offsetHeight,j=$$(a).offset(),k=$$(c.offsetParent).offset(),n=c.offsetParent.scrollLeft,o=c.offsetParent.scrollTop;e=f[0].rows[0].cells[0];var d=e.getElementsByTagName("IMAGE");if(d==null)d=[];for(var q=e.offsetHeight,g=[],h=[],b=0;b<d.length;b++){h.push(d[b].offsetTop);g.push(d[b].offsetHeight)}var l=a.style.paddingTop!=""?parseInt(a.style.paddingTop):0,u=a.style.paddingBottom!=""?parseInt(a.style.paddingBottom):0;c.style.posHeight=p-(l+u);var i=j.left-k.left+slideLeft+n,s=j.top-k.top+o+l,t=parseInt(a.getAttribute("curPage")),m=parseInt(a.getAttribute("totalPage"))-1;if(m>0)i+=t/m*(slideRight-slideLeft);c.style.left=i+"px";c.style.top=s+"px";for(var b=0;b<d.length;b++)d[b].style.marginTop=(q-h[b]-g[b])/2+"px"}}}function doMouseWheel(){if(window.event.ctrlKey){sizeSpread();return}var c=element.document.activeElement==window.event.srcElement&&window.event.srcElement.tagName=="SELECT";if(c)return;ignorePostbackEditmode=true;setTextBoxFocus();ignorePostbackEditmode=false;var d=EndEdit();if(!d)return;var b=getTopSpread();if(b.getAttribute("ClientAutoSize")!="True"){var e=window.event.wheelDelta,a=b.getScrollvp();if(a==null)a=getParent(b.getViewport());if(a!=null){var f=a.scrollTop;a.scrollTop-=e/10;window.event.returnValue=f==a.scrollTop}}window.event.cancelBubbling=true}var waittimeAdj=20,waittime=200,startTime=null;function vpscroll(){if(smartPaint){if(!editing){var a=getViewport().parentNode.scrollLeft!=event.srcElement.scrollLeft,e=getViewport().parentNode.scrollTop!=event.srcElement.scrollTop;element.getAttribute("scrollContent")&&(a||e)&&showScrollingContent(a);startTime=new Date;setTimeout(function(){stopScroll(!a,!e)},waittime)}}else{var c=event.srcElement.scrollLeft,d=event.srcElement.scrollTop;setScrollbarValues(d,c);getParentSpread()==null&&saveScrollbarState(d,c);if($$.browser.quirksMode){var b=createEventObject();b.spread=element;Scroll.fire(b)}else{var f={spread:element},b=$$.utils.createEvent("Scroll",false,true,f);element.dispatchEvent(b)}}}function stopScroll(k,f){var e=1e3;if(startTime!=null){var h=new Date;e=h.getTime()-startTime.getTime()}if(e>=waittime-waittimeAdj){var a=getScrollvp();if(a==null)a=getViewport().parentNode;var d=a.scrollLeft,b=a.scrollTop,j=newTop;newTop=getTopRow(b);var g=newPageCount;newPageCount=getRowsPerPage(newTop);(j!=newTop||g!=newPageCount)&&doUpdate();delayScrollView(b,d,10);getParentSpread()==null&&saveScrollbarState(b,d);if(arguments.length<2||!f)if($$.browser.quirksMode){var c=createEventObject();c.spread=element;Scroll.fire(c)}else{var i={spread:element},c=$$.utils.createEvent("Scroll",false,true,i);element.dispatchEvent(c)}}}function delayScrollView(c,b,d){var a=getParent(getViewport());if(a!=null){var f=a.scrollTop!=c,e=a.scrollLeft!=b,g=f||e;ignoreMainScroll=true;setScrollbarValues(c,b);setTimeout(function(){ignoreMainScroll=false;g&&scrollView()},d||10)}}function getTopRow(e){var b=element.getViewport();if(b.rows.length==0)return-1;var c=e;if(element.getAttribute("virtualPaging")=="true"){var g=getParent(b),f=getTopSpread(),d=g.document.getElementById(f.id+"_VirtualPaging_Top").style.height;d=parseInt(d);c=c-d;if(c<0)c=0}var a=current;if(a==-1)a=0;if(c<b.rows[a].offsetTop)while(a>0){a--;if(c>=b.rows[a].offsetTop+b.rows[a].offsetHeight)return Math.max(0,a)}else if(c>b.rows[a].offsetTop+b.rows[a].offsetHeight)for(a=current+1;a<b.rows.length;a++)if(c<b.rows[a].offsetTop+b.rows[a].offsetHeight)break;a=Math.max(0,a);return a}function GetTopRowIndex(){var a=element.getViewport(),b=frzRows+getTopRow(a.parentNode.scrollTop);return b}function GetLeftColIndex(){var d=element.getViewport(),b=d.parentNode.scrollLeft;if(scrollvp!=null)b=scrollvp.scrollLeft;for(var c=0,a=0,a=0;a<GetColCount();a++){c+=getColWidthFromCol(frzCols+a);if(c>b)break}return c>b?frzCols+a:a-1}function setScrollbarValues(d,c){var e=getTopSpread();if(e!=element)return;var k=getParent(e.getRowHeader()),j=getParent(e.getColHeader()),b=getParent(e.getViewport());ignoreScroll=true;var g=e.getViewport2();if(g!=null)g.parentElement.scrollTop=d;var f=0,h=0,a=e.getScrollvp();if(a!=null){a.onscroll=null;a.scrollLeft=c;if(d!=null)a.scrollTop=d;a.scrollLeft=c;a.onscroll=vpscroll;f=a.scrollLeft;h=a.scrollTop}var i=true;if(b!=null){b.scrollLeft=c;if(b.scrollLeft!=c)i=false;if(d!=null){b.scrollTop=d;if(b.scrollTop>h)h=b.scrollTop}if(b.scrollLeft>f)f=b.scrollLeft}var g=e.getViewport1();if(g!=null&&i)g.parentElement.scrollLeft=c;if(d!=null)if(k!=null)k.scrollTop=Math.min(h,d);if(j!=null&&i)j.scrollLeft=Math.min(f,c);if(colFooter!=null)colFooter.scrollLeft=Math.min(f,c);setTimeout(function(){ignoreScroll=false},200)}function fixMissedColumns(a,d){if($$.browser.quirksMode)return false;if(a==null)a=getSpreadTables();$$.utils.cleanArray(a);for(var e=false,c=0;c<a.length;c++){var f=a[c];if(f.rows.length>0){var b=f.getAttribute("LastDisplayedColumn");if(b!=null){b=parseInt(b);if(typeof d!="undefined"&&d<b)continue;e=fixMissedColumnsForTable(a[c])}}}return e}function fixMissedColumnsForTable(c){if(c==null)return false;var a=c.getAttribute("LastDisplayedColumn");if(a!=null){a=parseInt(a);for(var f=getColGroup(c),b=f.getElementsByTagName("COL"),e=0,d=a+1;d<b.length;d++)e+=parseInt(b[d].width)+parseInt(c.cellSpacing);b[a].setAttribute("__originalWidth",b[a].width);b[a].width=parseInt(b[a].width)+e+"px";return true}return false}function restoreTableWidth(a,c){if(typeof a.length!="undefined"&&a.length>0)for(var d=0;d<a.length;d++)restoreTableWidth(a[d],c);else{if(a==null)return;var b=a.getAttribute("LastDisplayedColumn");if(b==null)return;b=parseInt(b);if(typeof c!="undefined"&&c<b)return;var e=getColGroup(a),f=e.children[b].getAttribute("__originalWidth");f!=null&&e.children[b].setAttribute("width",f)}}function restoreBrowserColRender(h){if($$.browser.quirksMode)return;if(h!=null)for(var b=0;b<h.length;b++)restoreTableWidth(h[b]);else{for(var g=[getCorner(),getFrozColHeader(),getColHeader()],c=[[getFrozRowHeader(),getRowHeader()],[getViewport0(),getViewport2(),getFrozColFooter()],[getViewport1(),getViewport(),getColFooter()]],a=0;a<c.length;a++)$$.utils.cleanArray(c[a]);for(var a=0;a<g.length;a++)if(g[a]==null)for(var b=0;b<c[a].length;b++)restoreTableWidth(c[a][b]);else{var f=getColGroup(g[a]);if(f==null)continue;for(var b=0;b<c[a].length;b++){var e=getColGroup(c[a][b]);if(f.children.length<e.children.length)break;for(var d=0;d<e.children.length;d++){var i=f.children[d].getAttribute("width");i!=null&&e.children[d].setAttribute("width",i)}}}}}function fixBrokenColumn(c){$$.utils.cleanArray(c);var d=$$.utils.getMinColumnsWidth(c,getRealColWidth);if(d==null)return;for(var e=0;e<c.length;e++){var g=c[e],a=g.getElementsByTagName("COLGROUP");if(a==null||a.length==0)continue;a=a[0];for(var b=0;b<d.length;b++){var f=a.children[b];if(parseInt(f.width)<d[b])f.width=d[b]}}}function fixBrokenColumns(){var a=[getFrozRowHeader(),getRowHeader()];$$.utils.cleanArray(a);var b=getCorner();b!=null&&b.getAttribute("allowTableCorner")&&a.push(b);if(a.length>0){cleanElementsStyle(a,["width"],"");var c=a[0].offsetHeight;restoreElementsStyle(a,["width"]);cleanElementsStyle(a,["width"],"1px");fixBrokenColumn(a);restoreElementsStyle(a,["width"])}a=[getColHeader(),getViewport1(),getViewport(),getColFooter()];$$.utils.cleanArray(a);if(a.length>0){cleanElementsStyle(a,["width"],"");var c=a[0].offsetHeight;restoreElementsStyle(a,["width"]);cleanElementsStyle(a,["width"],"1px");fixBrokenColumn(a);restoreElementsStyle(a,["width"])}if(frzCols>0){a=[getFrozColHeader(),getViewport0(),getViewport2(),getFrozColFooter()];$$.utils.cleanArray(a);if(a.length>0){cleanElementsStyle(a,["width"],"");var c=a[0].offsetHeight;restoreElementsStyle(a,["width"]);cleanElementsStyle(a,["width"],"1px");fixBrokenColumn(a);restoreElementsStyle(a,["width"])}}}function initLayout(f){var i=fpSpreadJS.childViewIndexes.length,g=element.getAttribute("childViewsLoaded");if(element.initLayout==null)element.initLayout=initLayout;if(i>0&&(g==null||i>parseInt(g)))return;if(element.initLayout!=null)element.initLayout=null;setResizingFlag(true);fixBrokenColumns();setResizingFlag(false);needFixMissedColumns=true;sizeSpread(false,f,{NeedSyncColumns:true,NeedFixMissedColumns:true});needFixMissedColumns=false;xhtml&&!f&&sizeSpread(false,f);if(f&&!$$.browser.quirksMode)if(fpSpreadJS.childViewIndexes.length>0){syncRowRange(-1,-1);sizeSpread(true)}else{var a=[];if(frzRows>0){getFrozRowHeader()!=null&&a.push(getFrozRowHeader().rows[0]);getViewport0()!=null&&a.push(getViewport0().rows[0]);getViewport1()!=null&&a.push(getViewport1().rows[0])}else{getRowHeader()!=null&&a.push(getRowHeader().rows[0]);getViewport2()!=null&&a.push(getViewport2().rows[0]);getViewport()!=null&&a.push(getViewport().rows[0])}$$.utils.cleanArray(a);for(var c=[],e=0,b=0;b<a.length;b++){c.push(a[b].offsetTop);if(e<c[b])e=c[b]}for(var b=0;b<a.length;b++)a[b].style.posHeight=Math.max(0,a[b].style.posHeight-(e-c[b]));syncRowRange(0,0);if(frzRows>0){a=[];getRowHeader()!=null&&a.push(getRowHeader().rows[0]);getViewport2()!=null&&a.push(getViewport2().rows[0]);getViewport()!=null&&a.push(getViewport().rows[0]);$$.utils.cleanArray(a);for(var c=[],e=0,b=0;b<a.length;b++){c.push(a[b].offsetTop);if(e<c[b])e=c[b]}for(var b=0;b<a.length;b++)a[b].style.posHeight=Math.max(0,a[b].style.posHeight-(e-c[b]));syncRowRange(frzRows,frzRows)}sizeSpread(true)}var j=getScrollvp();if(j!=null)j.onscroll=vpscroll;var h=getViewportHolder();if(h!=null){h.onscroll=noScroll;h.onmousewheel=doMouseWheel}var k=getParent(getViewport2());if(k!=null)k.onscroll=vp2Scroll;var d=getParentSpread();if(d!=null){f&&$$.browser.quirksMode&&d.UpdateRowHeight(element,true);var g=d.getAttribute("childViewsLoaded")==null?1:parseInt(d.getAttribute("childViewsLoaded"))+1;d.setAttribute("childViewsLoaded",g);d.initLayout!=null&&d.initLayout(f)}else loadScrollbarState(element);getRowHeader()==null&&frzCols==0&&prepairSpreadLayout()}function vp2Scroll(){var a=getParent(getViewport2());if(a!=null){var b=getParent(getViewport());if(b!=null&&b.scrollTop!=a.scrollTop)b.scrollTop=a.scrollTop}}function noScroll(){var a=window.event.srcElement;if(a.scrollTop!=0)a.scrollTop=0;if(a.scrollLeft!=0)a.scrollLeft=0}function getRowByKey2(a){return getRowByKey(a,-1)}function getRowByKey(b,a){return fpSpreadJS.getRowByKey(b,a)}function getColByKey2(a){return getColByKey(a,-1)}function getColByKey(e,g){if(e=="-1")return-1;var b=null,c=getViewport0();if(c==null)c=getViewport2();if(c!=null){b=getColGroup(c);if(b!=null)for(var a=0;a<b.children.length;a++){var h=b.children[a];if(h.getAttribute("FpCol")==e)return a}}var d=getViewport();if(d==null)d=getViewport1();if(d!=null){var f=getColGroup(d);if(f!=null)for(var a=0;a<f.children.length;a++){var h=f.children[a];if(h.getAttribute("FpCol")==e){if(b!=null)a+=b.children.length;return a}}}return g?g:0}function isRowSelected(e){var d=getSelection();if(d!=null){var a=xmlData.firstElementChild(d);while(a!=null){var b,c;if(element.getAttribute("layoutMode")&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect")){var f=parseInt(a.getAttribute("row"));b=getFirstRowFromKey(f)}else b=parseInt(a.getAttribute("rowIndex"));if(element.getAttribute("layoutMode")&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect"))c=parseInt(element.getAttribute("layoutRowCount"));else c=parseInt(a.getAttribute("rowcount"));if(b<=e&&e<b+c)return true;a=xmlData.nextElementSibling(a)}}}function initSelection(){var n=getSelection();if(element.document.FpActiveSpread==element)anchorCell=findAnchorCell();var m=this.xmlData.selectSingleNode("root state activeRow"),l=this.xmlData.selectSingleNode("root state activeColumn"),q=m!=null?parseInt(this.xmlData.textContent(m)):-1,p=l!=null?parseInt(this.xmlData.textContent(l)):-1,c=Math.max(q,0),b=Math.max(p,0);if(element.getAttribute("layoutMode")){var i=getCellByRowCol2(c,b);if(i){c=getRowFromCell(i);b=getColFromCell(i)}}else{c=getRowByKey(c);b=getColByKey(b)}leadingCellRow=c;leadingCellCol=b;if(q>-1&&p>-1){var o=element;if(getParentSpread()!=null){var r=getTopSpread(element);o=r}var h=$$.fn.createXMLDOMWrapper(o),e=h.selectSingleNode("root activechild");if(getParentSpread()==null&&(e==null||h.textContent(e)=="")||e!=null&&element.id==h.textContent(e)){var s=retainSelectionBlock||element.document.FpActiveSheetView!=null&&element.document.FpActiveSheetView.id==element.id;updateAnchorCell(c,b,s)}}var a=this.xmlData.firstChild(n),k=false;while(a!=null){updateSelectionViewIndexes(a);a=this.xmlData.nextSibling(a);k=true}a=this.xmlData.lastChild(n);if(element.getAttribute("LayoutMode")&&anchorCell!=null&&a!=null&&a.getAttribute("col")!="-1"&&a.getAttribute("row")=="-1"&&a.getAttribute("rowcount")=="-1")copymultiCol=true;var f=element.document.FpActiveSheetView;if(f!=null&&f!=element&&getTopSpread(f)==getTopSpread(element))return;if(!retainSelectionBlock){var j=element.document.FpActiveSheetView;if(j==null||j.id!=element.id)return}var d=getParentSpread(element),g=findAnchorCell();if(k){if(g!=null)anchorCell=g;paintSelections(true);if(g!=null)while(d!=null&&typeof d.paintAnchorCell!="undefined"){d.paintAnchorCell(false);d=getSpreadControl(d.parentElement)}}paintFocusRect()}function paintSelections(d,j){!j&&fpSpreadJS.updateSelectionRangeFromCell(anchorCell);(d==null||d)&&paintSelections(false);var f=getSelection();if(f!=null){var a=xmlData.firstChild(f);if(a==null){d&&anchorCell!=null&&paintAnchorCell();return}while(a!=null){var b=a.getAttribute("row"),c=parseInt(a.getAttribute("col"));if(a.getAttribute("rowIndex")==null||a.getAttribute("rowIndex")=="-1"){if(b=="newRow"||parseInt(b)>-1)b=getRowByKey(b,0)}else b=parseInt(a.getAttribute("rowIndex"));if(a.getAttribute("colIndex")==null||a.getAttribute("colIndex")=="-1"){if(c>-1){if(element.getAttribute("layoutMode")){var l=getRowKeyFromRow(b==-1?0:b),e=getCellByRowCol2(l,c);if(e){b=getRowFromCell(e);c=getColFromCell(e)}}if(element.getAttribute("layoutMode")==null)c=getColByKey(c,0)}}else c=parseInt(a.getAttribute("colIndex"));var g=parseInt(a.getAttribute("rowcount")),i=parseInt(a.getAttribute("colcount")),k=GetRowCountInternal();if(k==0&&ignorePaintSelection)return;a.setAttribute("rowIndex",b);a.setAttribute("colIndex",c);if(element.getAttribute("layoutMode")&&a.getAttribute("col")>=0&&a.getAttribute("row")>=0&&(a.getAttribute("rowcount")>=1||a.getAttribute("colcount")>=1)){var h=xmlData.nextSibling(a);if(h!=null){typeof activeRow!="undefined"&&typeof activeCol!="undefined"&&activeRow!=null&&activeCol!=null&&(parseInt(a.getAttribute("row"))!=parseInt(xmlData.textContent(activeRow))||parseInt(a.getAttribute("col"))!=parseInt(xmlData.textContent(activeCol)))&&f.removeChild(a);a=h;continue}}if(element.getAttribute("layoutMode")&&a.getAttribute("col")=="-1"&&a.getAttribute("colcount")=="-1"&&a.getAttribute("row")!=-1)g=parseInt(element.getAttribute("layoutRowCount"));if(element.getAttribute("layoutMode")&&a.getAttribute("col")!="-1"&&a.getAttribute("row")=="-1"&&a.getAttribute("rowcount")=="-1"){var e=getFirstCellFromCol(a.getAttribute("col"));if(e){b=parseInt(e.parentElement.getAttribute("row"));c=getColFromCell(e)}paintMultipleRowSelection(b,c,1,1,d)}else if(element.getAttribute("OperationMode")=="Normal"&&element.getAttribute("SelectionPolicy")=="MultiRange")paintSelection2(b,c,g,i,d);else paintSelection(b,c,g,i,d);a=xmlData.nextSibling(a)}}}var rowEditTemplateContainer_keyDownEvent=null,rowEditTemplateContainer_textBoxFocusing=false;function rowEditTemplateContainer_keyDown(){if(event.keyCode==tab)if(!rowEditTemplateContainer_textBoxFocusing){var a=createEventObject();a.keyCode=event.keyCode;a.type=event.type;a.target=event.srcElement;a.altKey=event.altKey;a.altLeft=event.altLeft;a.ctrlKey=event.ctrlKey;a.ctrlLeft=event.ctrlLeft;a.shiftKey=event.shiftKey;a.shiftLeft=event.shiftLeft;rowEditTemplateContainer_keyDownEvent=a}else{rowEditTemplateContainer_textBoxFocusing=false;translateKey()}else rowEditTemplateContainer_keyDownEvent=null;if(event.preventDefault==null){event.cancelBubble=true;event.returnValue=true}return true}function rowEditTemplateContainer_textBoxFocus(){if(rowEditTemplateContainer_keyDownEvent&&rowEditTemplateContainer_keyDownEvent.keyCode==tab){rowEditTemplateContainer_textBoxFocusing=true;rowEditTemplateContainer_keyDownEvent.target.fireEvent("onkeydown",rowEditTemplateContainer_keyDownEvent)}}function translateKey(){ignoreElementActive=false;if(event.type=="keydown"&&event.keyCode==9&&(typeof textBox.tabIndex=="undefined"||textBox.tabIndex<0))ignoreElementActive=true;try{element.preventPopUp=false;var b=getCell(event.srcElement,false);if(isHeaderCell(b)&&!event.ctrlKey)return;if(event.srcElement!=textBox&&getSpreadControl(event.srcElement,true)!=element){if(!retainSelectionBlock)element.focusedOut=true;return}if(typeof element.getAttribute("mcctCellType")!="undefined"&&element.getAttribute("mcctCellType")=="true")return;if(element.document.readyState!="complete")return;var a=getTopSpread(element);if((element.document.activeElement==textBox||element.document.activeElement==element)&&(element.document.FpActiveSpread==null||getTopSpread(element.document.FpActiveSpread)!=a)&&(a.getAttribute("ProcessTab")=="True"||event.keyCode!=tab)){element.document.FpActiveSpread=element;element.document.FpActiveSheetView=element.document.FpActiveSpread;textBox.focus();setActiveSpreadID(a,element.id,element.id)}if(element.document.FpActiveSpread==element){if(element.inDesign&&window.event.altKey)return;keyDown()}}catch(c){$$.DEBUG.Log(c,"translateKey")}}var keyMap=[];function KeyAction(e,c,b,d,a){this.key=e;this.ctrl=c;this.shift=b;this.alt=d;this.action=a}function RemoveKeyMap(e,g,f,h){for(var d=keyMap.length,b=0;b<d;b++){var a=keyMap[b];if(a!=null&&a.key==e&&a.ctrl==g&&a.shift==f&&a.alt==h){for(var c=b+1;c<d;c++)keyMap[c-1]=keyMap[c];keyMap.length=keyMap.length-1;break}}}function AddKeyMap(a,d,c,e,b){var f=getKeyAction(a,d,c,e);if(f!=null)f.action=b;else{var g=keyMap.length;keyMap.length=g+1;keyMap[g]=new KeyAction(a,d,c,e,b)}}function getKeyAction(c,e,d,f){for(var g=keyMap.length,b=0;b<g;b++){var a=keyMap[b];if(a!=null&&a.key==c&&a.ctrl==e&&a.shift==d&&a.alt==f)return a}return null}function IsValid(){return element.valid!=null?element.valid:true}function MoveToPrevCell(a){var b=EndEdit();if(b)if(a)nextCell(tab,true);else nextCell(left,false)}function MoveToNextCell(a){var b=EndEdit();if(b)if(a)nextCell(tab,false);else nextCell(right,false)}function MoveToNextRow(b){var a=EndEdit();a&&nextCell(down,false,b)}function MoveToPrevRow(b){var a=EndEdit();a&&nextCell(up,false,b)}function MoveToFirstColumn(){var a=EndEdit();a&&nextCell(home,false)}function MoveToLastColumn(){var a=EndEdit();a&&nextCell(end,false)}function UpdatePostbackData(){saveData()}function addBrowserDocumentMode(){var e=xmlData.selectSingleNode("root"),a=xmlData.selectSingleNode("browser");if(a==null){a=xmlData.createElement("browser");var c=xmlData.createElement("documentmode");xmlData.textContent(c,document.documentMode);a.appendChild(c);var b=xmlData.createElement("ieversion"),d=$$.browser;xmlData.textContent(b,d.ieversion);a.appendChild(b);e.appendChild(a)}}function saveData(){try{if(element.childNodes.length==0)return;var d=element.document;if(!d.all)d=window.document;addBrowserDocumentMode();for(var a=getSelection(),c=0;c<a.childNodes.length;c++)if(a.childNodes[c].getAttribute("anchor")!=null){a.removeChild(a.childNodes[c]);break}var e=element.id+"_data",b=d.all[e];if(b==null)b=element.all[e];if(b!=null)b.value=encodeURIComponent(xmlData.serializeXML())}catch(f){$$.DEBUG.Log(f,"saveData")}}function setActiveSpread(){__setActiveSpread(window.event.srcElement);ignoreEditorFocus=false}function __setActiveSpread(target){try{var document=element.document;if(!document.getElementById)document=window.document;if(document.FpActiveSpread==element&&isExtenderPopupControl(target))return;isactive=false;document.FpActiveSpread!=null&&document.FpActiveSpread.setActiveField(true);ignoreElementActive=false;if(target==null||target.parentElement==null&&target.tagName!="HTML"&&target.tagName!="BODY")return;if(editing&&target!=null&&target.tagName=="HTML")return;var spread=getSpreadControl(target);if(spread==null)ignoreEditorFocus=true;if(document.FpActiveSpread!=spread&&!isExtenderPopupControl(target)){if(target!=editor&&editor!=null)typeof editor.blur!="undefined"&&editor.parentElement!=null&&editor.blur();typeof target.focus!="undefined"&&(target.tagName=="INPUT"||target.tagName=="TEXTAREA"||target.tagName=="SELECT")&&target.focus();var valid=true,as=document.FpActiveSpread;if(as==null)as=element;if(as!=null&&(spread==null||spread.getAttribute("mcctCellType")!="true"))valid=as.EndEdit();if(spread==null)ignoreEditorFocus=false;if(!valid)return;if(editing&&editModePermanent){ignoreBlur=false;textBoxBlur()}}if(spread==null)var targetSpread=getSpreadControl(target,true);var hitCmdBar=false;if(spread==null){spread=getSpreadControl(target,true);hitCmdBar=spread!=null;if(hitCmdBar&&spread!=document.FpActiveSpread){var valid=spread.EndEdit();if(!valid)return}}if(spread==null||document.FpActiveSpread!=null&&getTopSpread(document.FpActiveSpread)!=getTopSpread(element)){spread==null&&element.EndEdit();hideSelectionBlock()}var cell=getCell(target,true);if(cell==null&&dirty){saveData();dirty=false}if(dirty&&(document.FpActiveSpread!=element||spread==null||hitCmdBar)){saveData();dirty=false}if(dirty&&document.FpActiveSpread==element&&target.tagName=="INPUT"&&(target.type=="submit"||target.type=="button"||target.type=="image")){saveData();dirty=false}if(spread!=null&&spread!=element)return;if(spread!=null&&spread.getAttribute("OperationMode")=="ReadOnly")return;var topSpread=null;if(spread==null){topSpread=getTopSpread(element);setActiveSpreadID(topSpread,"",null);document.FpActiveSpread=null}else{topSpread=getTopSpread(spread);var activeElement=target,tableRow=FpSpreadJS.getTableRow(activeElement);if(hitCommandBar()||activeElement==getParent(getViewport())||activeElement==getParent(getViewport1())||activeElement==getParent(getViewport2())||activeElement!=null&&activeElement.getAttribute&&(activeElement.getAttribute("ControlType")=="chgrayarea"||activeElement.getAttribute("FpSpread")=="rowpadding")||sizeRow!=null||sizeColumn!=null||tableRow!=null&&FpSpreadJS.getTable(tableRow)==getRowHeader()&&FpSpreadJS.isChildSpreadRow(getViewport(),tableRow.rowIndex)){var xmlData=$$.fn.createXMLDOMWrapper(topSpread),activeChild=xmlData.selectSingleNode("root activechild");if(activeChild!=null&&xmlData.textContent(activeChild)!="")document.FpActiveSpread=eval(xmlData.textContent(activeChild));else{for(var allSpreads=FpSpreadJS.getAllSpreads(topSpread),i=0;i<allSpreads.length;i++){var ss=allSpreads[i];if(ss.getAnchorCell()!=null&&ss.getAnchorCell().paintSelected){spread=ss;break}}document.FpActiveSpread=spread}document.FpActiveSheetView=document.FpActiveSpread;setActiveSpreadID(topSpread,document.FpActiveSpread.id,document.FpActiveSpread.id)}else{setActiveSpreadID(topSpread,spread.id,spread.id);document.FpActiveSpread=spread;document.FpActiveSheetView=document.FpActiveSpread}document.FpActiveSpread!=element&&hideSelectionBlock()}isactive=false;document.FpActiveSpread!=null&&document.FpActiveSpread.setActiveField(true)}catch(ex){$$.DEBUG.Log(ex,"setActiveSpread")}}function hideSelectionBlock(){if(!retainSelectionBlock){isactive=false;paintSelections(false);anchorCell!=null&&updateSelectedCell(anchorCell,[],false);hideFocusBorder()}}function isCalendarExtenderPopup(c){var a=false;if(c._isPopupCalendar!=null)a=c._isPopupCalendar;else{a=c.id!=null&&c.id.indexOf("CalendarExtender")!=-1;if(!a){var b=c.parentElement;while(!a&&b!=null&&b.getAttribute("FpSpread")==null){a=b.id!=null&&b.id.indexOf("CalendarExtender")!=-1;b=b.parentElement}c._isPopupCalendar=a}}return a}function isExtenderPopupControl(a){var b=editor!=null?editor.getAttribute("Extenders"):null,c=a.id!=null&&a.id.indexOf("FpComboBox_OptionList")!=-1||isCalendarExtenderPopup(a)||a.tagName=="LI"&&editing&&editor!=null&&b!=null&&b.indexOf("AutoCompleteExtender")!=-1;return c}function getCellOffsetX(b){if(b==null)return 0;var d=getViewport();if(d==null)return 0;var a=b,c=b.offsetLeft;if(b.parentElement.getAttribute("FpSpread")!="rh")c-=d.parentElement.scrollLeft;while(a.offsetParent!=null&&a.offsetParent!=element){c+=a.offsetParent.offsetLeft;a=a.offsetParent}return c}function getCellOffsetY(b){if(b==null)return 0;var d=getViewport();if(d==null)return 0;var a=b,c=b.offsetTop;if(b.parentElement.getAttribute("FpSpread")!="ch")c-=d.parentElement.scrollTop;while(a.offsetParent!=null&&a.offsetParent!=element){c+=a.offsetParent.offsetTop;a=a.offsetParent}return c}function setActiveSpreadID(h,d,f,g){var a=$$.fn.createXMLDOMWrapper(h),e=a.selectSingleNode("root activespread"),b=a.selectSingleNode("root activechild");if(e==null||b==null)return;var c=getParentSpread();if(c!=null&&d!=f&&a.textContent(b)!=element.id)return;if(g&&b!=null&&a.textContent(b)!="")a.textContent(e,a.textContent(b));else{a.textContent(e,d==null?"":d);a.textContent(b,f==null?"":f)}c!=null&&c.SetActiveSpreadID(c,c.id,d,false);saveData();dirty=false}function getSpreadControl(c,d){var a=c;while(a!=null&&a.tagName!=null&&a.tagName!="BODY"){if(a.getAttribute("FpSpread")=="Spread"){if(!d){var b=c;while(b!=null&&b!=a){if(b.id==a.id+"_commandBar"||b.id==a.id+"_pager1"||b.id==a.id+"_pager2")return null;b=b.parentElement}}return a}a=a.parentElement}return null}function ScrollTo(d,c){var a=GetCellByRowCol(d,c);if(a==null)return;var b=getViewport().parentElement;b.fromScrollTo=true;b.scrollTop=a.offsetTop;b.scrollLeft=a.offsetLeft}function scrollView(){if(ignoreMainScroll)return;var b=getTopSpread();if(b!=element)return;if(typeof b.getRowHeader=="undefined")return;var e=getParent(b.getRowHeader()),r=getParent(b.getColHeader()),q=getParent(b.getColFooter()),m=getScrollvp(),a=getParent(b.getViewport());if(a==null)return;var c=b.getViewport1();if(c!=null&&c.parentElement.scrollLeft!=a.scrollLeft)c.parentElement.scrollLeft=a.scrollLeft;var c=b.getViewport2();if(c!=null&&c.parentElement.scrollTop!=a.scrollTop)c.parentElement.scrollTop=a.scrollTop;var g=getScrollValuesState();if(scrollTop==a.scrollTop&&scrollLeft==a.scrollLeft&&g==0)return;var h=scrollTop!=a.scrollTop||(g&2)==2,d=scrollLeft!=a.scrollLeft||(g&1)==1,o=d||h;if(engine>=9&&m!=null){d=scrollLeft!=m.scrollLeft||(g&1)==1;h=scrollTop!=m.scrollTop||(g&2)==2;o=d||h;if(!o){a.scrollTop=scrollTop;a.scrollLeft=scrollLeft;if(getViewport2()!=null)getViewport2().parentNode.scrollTop=scrollTop;if(getViewport1()!=null)getViewport1().parentNode.scrollLeft=scrollLeft}}if(!o&&(engine<8||m==null))return;var z=scrollTop>a.scrollTop;if(editing&&editor!=null){var E=editor.currentStyle||editor.style,j=getCell(editor);if(E.position=="absolute"&&j!=null){var u=editor.offsetParent,A=j.getBoundingClientRect(),B=u.getBoundingClientRect();editor.style.top=A.top-B.top+u.scrollTop+j.clientTop+"px";editor.style.left=A.left-B.left+u.scrollLeft+j.clientLeft+"px"}}scrollLeft=a.scrollLeft;scrollTop=a.scrollTop;ignoreScroll=true;if(e!=null&&e.scrollTop!=a.scrollTop){e.scrollTop=a.scrollTop;var v=getRowHeader().getBoundingClientRect(),w=getViewport().getBoundingClientRect();if(v.top!=w.top&&!$$.browser.quirksMode){var k=v.top-w.top;e.scrollTop+=k;var s=a.scrollTop;a.scrollTop+=k;if(a.scrollTop==s){a.scrollTop=s-k;e.scrollTop=s-k}}}if(r!=null&&r.scrollLeft!=a.scrollLeft)r.scrollLeft=a.scrollLeft;if(q!=null&&q.scrollLeft!=a.scrollLeft)q.scrollLeft=a.scrollLeft;var f=b.getScrollvp();if(f!=null){if(f.scrollLeft!=a.scrollLeft)f.scrollLeft=a.scrollLeft;if(f.scrollTop!=a.scrollTop&&element.getAttribute("virtualPaging")!="true")f.scrollTop=a.scrollTop}var G=a.scrollTop;setValidatorPos();getParentSpread()==null&&saveScrollbarState(a.scrollTop,a.scrollLeft);if(o)if($$.browser.quirksMode){var i=createEventObject();i.spread=element;i.vertical=h;i.horizontal=d;Scroll.fire(i)}else{var F={spread:element,vertical:h,horizontal:d},i=$$.utils.createEvent("Scroll",false,true,F);element.dispatchEvent(i)}setTimeout(function(){ignoreScroll=false},200);var y=false,t=b.getViewport();if(!z&&element.getAttribute("AllRowsLoaded")==null&&a.scrollTop>0&&isChild(t,a)&&a.scrollTop+a.offsetHeight+2>=t.offsetHeight)if((!editing||smartPaint&&typeof element.forceLOD!="undefined"&&element.forceLOD)&&element.getAttribute("loadOnDemand")=="true"){if(element.LoadState!=null)return;element.LoadState=true;var l=getScrollvp();if(l==null)l=getViewport().parentNode;var C=l.scrollLeft,D=l.scrollTop;saveScrollbarState(D,C);y=true;saveData();setTimeout(function(){CallBack("LoadOnDemand",true)},0)}if(smartPaint&&typeof element.forceLOD!="undefined")element.forceLOD=null;if(!y&&!element.LoadState&&element.__scrollByEditing)element.__scrollByEditing=null;if(element.getAttribute("virtualPaging")=="true"&&!d&&!ignoreVirtualPaging&&!element.virtualPagingProcessing&&element.getAttribute("loadOnDemand")!="true"&&isChild(t,a)){var n=scrollView,x=false;while(n.caller!=null){n=n.caller;var p=n.toString();callerFuncName=p.substring(p.indexOf("function")+9,p.indexOf("("))||"anoynmous";if(callerFuncName=="processData"){x=true;break}}element.isScrollUp=z;if(!x&&canMoveToPage().canMove){element.virtualPagingProcessing=true;setTimeout(doVirtualPaging,0)}}}function getScrollValuesState(){for(var c=0,d=getScrollvp(),b=[getColHeader(),getColFooter(),getViewport1(),getViewport()],f=d!=null?d.scrollLeft:null,g=d!=null?d.scrollTop:null,a=0;a<b.length;a++){var e=b[a];if(e!=null){var h=e.parentElement.scrollLeft;if(f==null)f=h;else if(f!=h){c=c|1;break}}}b=[getRowHeader(),getViewport2(),getViewport()];for(var a=0;a<b.length;a++){var e=b[a];if(e!=null){var i=e.parentElement.scrollTop;if(g==null)g=i;else if(g!=i){c=c|2;break}}}return c}function doVirtualPaging(){var e=getTopSpread(),d=e.getViewport(),c=getParent(d);if(d==null||c==null)return;var a=c.scrollTop;if(element.virtualPagingCurrentScroll!=null&&a==element.virtualPagingCurrentScroll){var g=element.GetCurrentPageIndex(),b=canMoveToPage();if(b.canMove)if(element.getAttribute("IgnoreHiddenRowsWhenPaging")=="True"){var f=Math.abs(b.scrollValue-a);ScrollToPage(f,element.isScrollUp,true)}else GotoPage(b.ToPage,true);element.virtualPagingProcessing=false}else{element.virtualPagingCurrentScroll=a;setTimeout(doVirtualPaging,500)}}function canMoveToPage(){var l=getTopSpread(),d=l.getViewport(),b=getParent(d);if(d==null||b==null)return false;var g=b.scrollTop,c=getViewPortSize(false),e=element.GetCurrentPageIndex(),f=parseInt(l.getAttribute("pageCount")),a={canMove:false,scrollValue:-1};if(element.getAttribute("IgnoreHiddenRowsWhenPaging")=="False"){var i=parseInt(element.getAttribute("__defaultPageHeight")),m=element.document.getElementById(element.id+"_VirtualPaging_Bottom"),p=m.getBoundingClientRect(),o=element.document.getElementById(element.id+"_VirtualPaging_Top"),q=d.getBoundingClientRect(),h=b.getBoundingClientRect(),k=element.isScrollUp&&o.getBoundingClientRect().bottom>h.top,r=!element.isScrollUp&&(d.offsetHeight>b.clientHeight?q.bottom<h.bottom-(b.offsetHeight-b.clientHeight):true);a.canMove=k&&e>0||r&&e<f-1;if(a.canMove)if(k)a.ToPage=Math.floor(g/i);else{var j=h.bottom-p.top,n=$$.browser.quirksMode&&getNoRow(-1)!=null;if(d.offsetHeight<b.clientHeight)j-=b.clientHeight-(!n?d.offsetHeight:getNoRow(-1).offsetHeight);a.ToPage=e+Math.ceil(j/i);if(a.ToPage>=f)a.ToPage=f-1}}else{var s=element.getAttribute("showFocusRect")=="true"?1:0;if(element.isScrollUp&&g<c.top&&e!=0){a.canMove=true;a.scrollValue=c.top}else if(!element.isScrollUp&&c.height+c.top-g-s<b.offsetHeight&&e!=f-1){a.canMove=true;var t=c.height>b.offsetHeight?c.height-b.offsetHeight:0;a.scrollValue=element.virtualTop+t}}return a}function LoadData(a){if(!editing&&element.getAttribute("loadOnDemand")=="true")smartPaint=false;CallBack("LoadOnDemand",a)}function saveScrollbarState(c,d){if(!initialized)return;if(getParentSpread()!=null)return;var a=xmlData.selectSingleNode("root scrollTop"),b=xmlData.selectSingleNode("root scrollLeft");if(element.getAttribute("scrollContent"))if(a!=null&&b!=null)(xmlData.textContent(a)!=c||xmlData.textContent(b)!=d)&&showScrollingContent(xmlData.textContent(a)==c);a!=null&&xmlData.textContent(a,c);b!=null&&xmlData.textContent(b,d);dirty=true}function loadScrollbarState(d,j){if(getParentSpread()!=null)return;if(element.getAttribute("ClientAutoSize")=="True")return;if(smartPaint&&(typeof j=="undefined"||!j))return;var a=xmlData.selectSingleNode("root scrollTop");if(a!=null&&xmlData.textContent(a)!="")a=parseInt(xmlData.textContent(a));else a=0;if(!smartPaint)d.virtualPagingProcessing=false;a=a>0&&a>=d.virtualTop?a:a+d.virtualTop;var e=xmlData.selectSingleNode("root scrollLeft");if(e!=null&&xmlData.textContent(e)!="")e=parseInt(xmlData.textContent(e));else e=0;if(d.getAttribute("virtualPaging")=="true"&&!smartPaint){var g=getDummy(),b=getViewport();if(g!=null&&g.isBuild==null){var i=g.parentElement.document.getElementById(d.id+"_dummy_VPBottom"),b=getViewport(),h=getViewport2(),f=parseInt(i.style.height);if(b!=null){var c=b.parentElement.offsetHeight-b.offsetHeight;if($$.browser.quirksMode&&getNoRow(-1)!=null)c-=getNoRow(-1).offsetHeight;if(c>0){i.style.height=c+f+"px";b.parentElement.document.getElementById(d.id+"_VirtualPaging_Bottom").style.height=c+f+"px";b.isBuild=true}}if(h!=null){var c=h.parentElement.offsetHeight-h.offsetHeight;if(c>0)h.parentElement.document.getElementById(d.id+"_VirtualPaging_Bottom2").style.height=c+f+"px"}g.isBuild=true}else if(b!=null&&b.isBuild==null){var f=parseInt(b.parentElement.document.getElementById(d.id+"_VirtualPaging_Bottom").style.height),c=b.parentElement.offsetHeight-b.offsetHeight;if($$.browser.quirksMode&&getNoRow(-1)!=null)c-=getNoRow(-1).offsetHeight;if(c>0)b.parentElement.document.getElementById(d.id+"_VirtualPaging_Bottom").style.height=c+f+"px";b.isBuild=true}}if(isNaN(a))a=0;if(isNaN(e))e=0;if(!smartPaint)ignoreVirtualPaging=true;setScrollbarValues(smartPaint?null:a,e);!smartPaint&&setTimeout(function(){ignoreVirtualPaging=false},100)}function getParent(a){return a==null?null:a.parentElement}function getViewport(){return viewport}function getCommandBar(){return commandBar}function getRowHeader(){return rowHeader}function getColHeader(){return colHeader}function getColFooter(){return colFooter}function getCmdBtn(c){var a=getTopSpread(),b=a.getCommandBar();return b!=null?b.all(a.id+"_"+c):null}function Range(){reset(this)}function setRange(a,b,e,d,g,f,c){a.type=b;a.row=e;a.col=d;a.rowCount=g;a.colCount=f;a.innerRow=c;if(b=="Row")a.col=a.colCount=-1;else if(b=="Column")a.row=a.rowCount=-1;else if(b=="Table"){a.col=a.colCount=-1;a.row=a.rowCount=-1}}function reset(a){a.type="Cell";a.row=-1;a.col=-1;a.rowCount=0;a.colCount=0;a.innerRow=0}function Margin(){this.left;this.top;this.right;this.bottom}function findContentTag(a){xmlData.switchNodeContext(a);var b=xmlData.selectSingleNode("[content='true']");xmlData.resetNodeContext();return b}function getRender(d){var c=findContentTag(d);if(c!=null)return c;var b=d;if(b.children.length>0){var a=b.children[0];if(a!=null&&a.tagName!=null&&a.tagName!="BR")b=a;if(a!=null&&typeof a.value!="undefined")b=a}return b}function getCell(c,b){var a=c;while(a!=null){if(b){if((a.tagName=="TD"||a.tagName=="TH")&&a.parentElement!=null&&a.parentElement.getAttribute("FpSpread")=="r")return a}else if((a.tagName=="TD"||a.tagName=="TH")&&a.parentElement!=null&&(a.parentElement.getAttribute("FpSpread")=="r"||a.parentElement.getAttribute("FpSpread")=="ch"||a.parentElement.getAttribute("FpSpread")=="rh"))return a;a=a.parentElement}return null}function inFrozCols(a){return isChild(a,getFrozColHeader())||isChild(a,getViewport0())||isChild(a,getViewport2())}function inFrozRows(a){isChild(a,getFrozRowHeader())||isChild(a,getViewport0())||isChild(a,getViewport1())}function inRowHeader(a){return isChild(a,getFrozRowHeader())||isChild(a,getRowHeader())}function inColHeader(a){return isChild(a,getFrozColHeader())||isChild(a,getColHeader())}function isHeaderCell(a){return a!=null&&(a.tagName=="TD"||a.tagName=="TH")&&(a.parentElement.getAttribute("FpSpread")=="ch"||a.parentElement.getAttribute("FpSpread")=="rh")}function getRealColWidth(d,b){var c=d.getAttribute("LastDisplayedColumn"),a=0,e=getColGroup(d);if(c!=null&&b==c)a=parseInt(e.children[b].getAttribute("__originalWidth"));else a=parseInt(e.children[b].width);return a}function getSizeColumn(g){var o=getSizeHeader();if(!o&&getColHeader()==null&&getFrozColHeader()==null)return null;if(g==null||g.tagName=="INPUT"||g.tagName=="TEXTAREA"||g.tagName=="SELECT"||g.tagName=="BR")return null;var a=-1,b=getCell(g);while(b!=null&&b.parentElement!=null){if(b.parentElement.getAttribute("FpSpread")=="ch"){if(window.event.offsetX<3&&getOffsetLeft(g,b)<3)a=getColFromCell(b)-1;else if(window.event.offsetX>b.offsetWidth-4){a=getColFromCell(b);var d=getSpanCell(b.parentElement.rowIndex,a,colSpanCells);if(d!=null)a=d.col+d.colCount-1}else{a=getColFromCell(b);var d=getSpanCell(b.parentElement.rowIndex,a,colSpanCells);if(d!=null){var h=0;a=-1;for(var e=d.col;e<d.col+d.colCount&&e<GetColCount();e++){if(isChild(b,getColHeader()))h+=getRealColWidth(getColHeader(),e-frzCols);else h+=getRealColWidth(getFrozColHeader(),e);if(window.event.offsetX>h-3&&window.event.offsetX<h+3){a=e;break}}}else a=-1}if(isNaN(a)||a<0)return null;var i=0,k=GetColCount(),j=true,q=null,c=a+1;while(c<k){if(c>=frzCols){var l=getColGroup(getColHeader());if(c-frzCols<l.children.length)i=getRealColWidth(getColHeader(),c-frzCols)}else{var l=getColGroup(getFrozColHeader());if(c<l.children.length)i=getRealColWidth(getFrozColHeader(),c)}if(i>1){j=false;break}c++}if(j){c=a+1;while(c<k){if(getSizable(c)){a=c;break}c++}}return!getSizable(a)?null:isChild(b,getColHeader())?window.event.offsetX<3&&a+1==frzCols&&b.cellIndex==0&&getFrozColHeader()!=null?getFrozColHeader().all(element.id+"col"+(frzCols-1)):getColHeader().all(element.id+"col"+a):getFrozColHeader().all(element.id+"col"+a)}else if(b.parentElement.getAttribute("FpSpread")=="rh"){if(!getSizeHeader())return;var f=getColGroup(getRowHeader());if(f==null||f.children.length==0)return null;if(window.event.offsetX<3)a=getColFromCell(b)-1;else if(window.event.offsetX>b.offsetWidth-4){a=getColFromCell(b);var d=getSpanCell(b.parentElement.rowIndex,a,rowSpanCells);if(d!=null)a=d.col+d.colCount-1}else{a=getColFromCell(b);var d=getSpanCell(b.parentElement.rowIndex,a,rowSpanCells);if(d!=null){var h=0;a=-1;for(var p=f.children.length,e=d.col;e<d.col+d.colCount&&e<p;e++){h+=parseInt(f.children(e).width);if(window.event.offsetX>h-3&&window.event.offsetX<h+3){a=e;break}}}else a=-1}if(isNaN(a)||a<0)return null;var i=0,k=f.children.length,j=true,c=a+1;while(c<k){var n=f.children(c);if(n!=null)i=parseInt(n.width);if(i>1){j=false;break}c++}if(j){c=a+1;while(c<k){if(getSizable(f.children(c))){a=c;break}c++}}var m=f.children(a);return!getSizable(m)?null:m}b=b.parentElement}return null}function getElementById(c,b){if(c==null)return null;var a=xmlData.firstElementChild(c,true);while(a!=null){if(a.id==b||a.getAttribute("name")==b)return a;var d=getElementById(a,b);if(d!=null)return d;a=xmlData.nextElementSibling(a,true)}return null}function getSizeRow(e){var l=GetRowCount();if(l==0)return null;if(element.getAttribute("layoutMode"))return null;if(e==null||e.tagName=="INPUT"||e.tagName=="TEXTAREA"||e.tagName=="SELECT")return null;var g=getCell(e);if(g==null){if(e.getAttribute("FpSpread")=="rowpadding"){if(window.event.offsetY<3){var a=e.parentElement.rowIndex;if(a>1){var o=e.parentElement.parentElement.rows(a-1);if(getSizable(o))return o}}if(e!=null&&e.style!=null&&(e.getAttribute("FpSpread")=="rowpadding"||e.getAttribute("ControlType")=="chgrayarea"))e.style.cursor=getgrayAreaCursor()}var n=getCorner();if(n!=null&&n.contains(e))if(window.event.offsetY>e.offsetHeight-4){var b=getFrozRowHeader(),a=0;if(b!=null){while(a<b.rows.length&&b.rows(a).offsetHeight<2&&!getSizable(b.rows(a)))a++;if(a<b.rows.length&&getSizable(b.rows(a))&&b.rows(a).offsetHeight<2)return b.rows(a)}b=getRowHeader();if(b!=null){while(a<b.rows.length&&b.rows(a).offsetHeight<2&&!getSizable(b.rows(a)))a++;if(a<b.rows.length&&getSizable(b.rows(a))&&b.rows(a).offsetHeight<2)return b.rows(a)}}else e.style.cursor="default";return null}var k=isChild(g,getFrozRowHeader()),d=g;while(d!=null){if(d.getAttribute("FpSpread")=="rh"){var a=-1,j=0;if(k)j=getFrozRowHeader().cellSpacing;else j=getRowHeader().cellSpacing;if(window.event.offsetY<3&&getOffsetTop(e,d)-d.offsetTop<j+3){if(d.rowIndex>0)a=d.rowIndex-1;else if(d.rowIndex==0&&!k&&getFrozRowHeader()!=null){k=true;a=frzRows-1}}else if(window.event.offsetY>getOffsetHeight(d)-4-j){var i=getSpanCell(getRowFromCell(g),getColFromCell(g),rowSpanCells);if(i!=null)for(var f=0,h=i.row;h<i.row+i.rowCount;h++){if(k)f+=getOffsetHeight(getFrozRowHeader().rows(h));else f+=getOffsetHeight(getRowHeader().rows(h-frzRows));if(window.event.offsetY>f-3&&window.event.offsetY<f+3){a=h;break}}else if(d.rowIndex>=0)a=d.rowIndex}else break;var f=0,l=getRowHeader().rows.length;if(k)l=getFrozRowHeader().rows.length;var m=true,b=null;if(k)b=getFrozRowHeader();else b=getRowHeader();var c=a+1;while(c<l){if(b.rows(c).style.posHeight!=null)f=b.rows(c).style.posHeight;else f=getOffsetHeight(b.rows(c));if(f>1){m=false;break}c++}if(m){c=a+1;while(c<l){if(getSizable(getRowHeader().rows(c))){a=c;break}c++}}if(a>=0&&getSizable(b.rows(a)))return b.rows(a);else if(window.event.offsetY<3){while(a>1&&getOffsetHeight(b.rows(a))==0&&!getSizable(b.rows(a)))a--;return a>=0&&getSizable(b.rows(a))?b.rows(a):null}}else if(d.getAttribute("FpSpread")=="ch"){if(!getSizeHeader())return;var b=getColHeader();if(b==null)return null;if(getColFromCell(g)==GetColCount())return null;var j=0;if(getFrozColHeader()!=null)j=getFrozColHeader().cellSpacing;else j=getColHeader().cellSpacing;var a=-1;if(window.event.offsetY<3){if(d.rowIndex>0)a=d.rowIndex-1}else if(window.event.offsetY>getOffsetHeight(d)-4-j){var i=getSpanCell(getRowFromCell(g),getColFromCell(g),colSpanCells);if(i!=null)for(var f=parseInt(b.cellSpacing),h=i.row;h<i.row+i.rowCount;h++){f+=b.rows(h).style.posHeight;if(window.event.offsetY>f-3&&window.event.offsetY<f+3){a=h;break}}else if(d.rowIndex>=0)a=d.rowIndex}else break;var f=0,l=b.rows.length,m=true,c=a+1;while(c<l){if(b.rows(c).style.posHeight!=null)f=b.rows(c).style.posHeight;else f=getOffsetHeight(b.rows(c));if(f>1){m=false;break}c++}if(m){c=a+1;while(c<l){if(getSizable(b.rows(c))){a=c;break}c++}}if(a>=0&&getSizable(b.rows(a)))return b.rows(a);else if(window.event.offsetY<3){while(a>1&&getOffsetHeight(b.rows(a))==0&&!getSizable(b.rows(a)))a--;return a>=0&&getSizable(b.rows(a))?b.rows(a):null}}d=d.parentElement}g.style.cursor="default";return null}function getSizable(b){var a;if(typeof b=="number")if(b<frzCols){var c=getFrozColHeader().all(element.id+"col"+b);return c!=null&&((a=c.getAttribute("Sizable"))==null||a=="True")}else{var c=getColHeader().all(element.id+"col"+b);return c!=null&&((a=c.getAttribute("Sizable"))==null||a=="True")}return b!=null&&((a=b.getAttribute("Sizable"))==null||a=="True")}function getSpanWidth(c,f){var e=0,a=getViewport2();if(a==null)a=getViewport0();if(frzCols>0&&c<frzCols&&a!=null){var d=getColGroup(a);if(d!=null)for(var b=c;b<c+f&&b<frzCols;b++)e+=parseInt(d.children[b].width)}a=getViewport();if(a==null)a=getViewport1();var d=getColGroup(a);if(d!=null)for(var b=Math.max(c,frzCols);b<c+f;b++)e+=parseInt(d.children[b-frzCols].width);return e}function getCellType(a){if(a!=null&&a.getAttribute("FpCellType")!=null)return a.getAttribute("FpCellType");if(a!=null&&a.getAttribute("FpRef")!=null){var b=element.document;if(!b.getElementById)b=window.document;var c=b.getElementById(a.getAttribute("FpRef"));return c.getAttribute("FpCellType")}return a!=null&&a.getAttribute("FpCellType")!=null?a.getAttribute("FpCellType"):"text"}function getCellType2(b){if(b!=null&&b.getAttribute("FpRef")!=null){var c=element.document;if(!c.getElementById)c=window.document;b=c.getElementById(b.getAttribute("FpRef"))}var a=null;if(b!=null){a=b.getAttribute("FpCellType");if(typeof a=="undefined"||a==null||a=="readonly")a=b.getAttribute("CellType");if(a==null)a=b.getAttribute("CellType2")}return a!=null?a:"text"}function getCellEditorID(a){if(a!=null&&a.getAttribute("FpRef")!=null){var b=element.document;if(!b.getElementById)b=window.document;var c=b.getElementById(a.getAttribute("FpRef"));return c.getAttribute("FpEditorID")}return a!=null&&a.getAttribute("FpEditorID")!=null?a.getAttribute("FpEditorID"):element.getAttribute("FpDefaultEditorID")}function EditorMap(a,b){this.id=a;this.editor=b}function ValidatorMap(a,b){this.id=a;this.validator=b}function getCellEditor(c,f){for(var a=null,d=0;d<editorList.length;d++){var e=editorList[d];if(e.id==c){a=e.editor;break}}if(a==null){var b=element.document;if(!b.getElementById)b=window.document;a=b.getElementById(c);editorList[editorList.length]=new EditorMap(c,a)}return f?a:a.cloneNode(true)}function getCellValidatorID(a){return a==null?null:a.getAttribute("FpValidatorID")}function getCellValidator(b){for(var a=null,d=0;d<validatorList.length;d++){var e=validatorList[d];if(e.id==b){a=e.validator;break}}if(a==null){var c=element.document;if(!c.getElementById)c=window.document;a=c.all(b);validatorList[validatorList.length]=new ValidatorMap(b,a)}return a}function getTableRow(c){var a=xmlData.selectSingleNode("data");if(a==null)return null;xmlData.switchNodeContext(a);var b=xmlData.selectSingleNode("row[key='"+c+"']");xmlData.resetNodeContext();return b}function getTableCell(a,c){if(a==null)return null;xmlData.switchNodeContext(a);var b=xmlData.selectSingleNode("cell[key='"+c+"']");xmlData.resetNodeContext();return b}function addTableRow(b){if(b==null)return null;var a=getTableRow(b);if(a!=null)return a;var c=xmlData.selectSingleNode("data");if(c==null)return null;a=xmlData.createElement("row");a.setAttribute("key",b);c.appendChild(a);return a}function addTableCell(b,c){if(b==null)return null;var a=getTableCell(b,c);if(a!=null)return a;a=xmlData.createElement("cell");if(c==null)a.setAttribute("key","");else a.setAttribute("key",c);b.appendChild(a);return a}function getCellValue(a){if(a==null)return null;var d=getRowKeyFromCell(a),c=element.getAttribute("layoutMode")?getColKeyFromCell2(a):getColKeyFromCell(a),b=addTableCell(addTableRow(d),c);return xmlData.textContent(b)}function setCellValue(a,d,p,q){if(a==null)return;if(d==" ")a.setAttribute("whiteSpace","1");else a.removeAttribute("whiteSpace");a.getAttribute("specialValue")!=null&&a.removeAttribute("specialValue");if(d!=null&&d==""){var k=getCellEditorID(a);if(k!=null){var j=getCellEditor(k,true);j!=null&&j.tagName=="SELECT"&&a.setAttribute("specialValue","1")}}var o=getCellType(a);if(o=="readonly"&&a.getAttribute("locked")=="true"&&a.getAttribute("CellType2")!="MutuallyExclusiveCheckBoxCellType")return;var i=getRowKeyFromCell(a),g=element.getAttribute("layoutMode")?getColKeyFromCell2(a):getColKeyFromCell(a);if(i==null||g==null)return;var n=addTableCell(addTableRow(i),g);xmlData.textContent(n,d);if(!p){fireDataChangedEvent(a,d,element,i,g);var l=getTopSpread(element);l!=element&&l.fireDataChangedEvent(a,d,element,i,g)}if(smartPaint){var f=getRowFromCell(a)-frzRows,m=getViewport(),r=getViewport2(),c=null;if(isChild(a,m)){saveRowsImp(m,f,1,vpList);c=vpList.getRow(f)}else if(isChild(a,r)){saveRowsImp(viewport2,f,1,vp2List);c=vp2List.getRow(f)}if(c!=null)for(var h=0;h<c.cells.length;h++){var e=$$.utils.cloneNode(c.cells[h]);if(e.paintSelected=="null")e.paintSelected=null;c.replaceChild(e,c.cells[h]);paintSelectedCell(e,false,false)}}var b=getCmdBtn("Update");b!=null&&b.disabled&&updateCmdBtnState(b,false);b=getCmdBtn("Cancel");b!=null&&b.disabled&&updateCmdBtnState(b,false);dirty=true;q&&updateValues()}function clearCellData(){var f=xmlData.selectSingleNode("data");if(f==null)return null;if(dataBuff!=null){var c=xmlData.firstChild(dataBuff);while(c!=null){var k=c.getAttribute("key"),d=xmlData.firstChild(c);while(d!=null){var j=d.getAttribute("key"),a=xmlData.firstChild(f);while(a!=null){var i=a.getAttribute("key");if(k==i){var e=false,b=xmlData.firstChild(a);while(b!=null){var h=b.getAttribute("key");if(j==h){a.removeChild(b);e=true;break}b=xmlData.nextSibling(b)}if(e)break}a=xmlData.nextSibling(a)}d=xmlData.nextSibling(d)}c=xmlData.nextSibling(c)}}dataBuff=null;var g=getCmdBtn("Cancel");g!=null&&updateCmdBtnState(g,true)}function storePostData(){var a=xmlData.selectSingleNode("data");if(a!=null)dataBuff=a.cloneNode(true)}function GetSelectedRanges(){for(var f=getSelection(),a=[],c=f.childNodes,b=0,g=c.length;b<g;b++){var h=c[b],d=new Range;getRangeFromNode(h,d);var e=a.length;a.length=e+1;a[e]=d}return a}function GetSelectedRange(){var b=new Range,c=getSelection(),a=xmlData.lastChild(c);a!=null&&getRangeFromNode(a,b);return b}function getRangeFromNode(a,h){if(a==null||h==null)return;h.anchor=a.getAttribute("anchor")!=null;updateSelectionViewIndexes(a);var b=parseInt(a.getAttribute("rowIndex")),e=parseInt(a.getAttribute("colIndex")),c=parseInt(a.getAttribute("rowcount")),g=parseInt(a.getAttribute("colcount")),j;if(frzRows==0&&frzCols==0){var f=getViewport();if(f!=null){for(var k=b,i=k;i<k+c;i++)if(IsChildSpreadRow(f,i))c--;b=GetSheetIndex(b,f)}}if(element.getAttribute("layoutMode")){var l=parseInt(a.getAttribute("col"));if(l!=-1&&parseInt(a.getAttribute("row"))==-1&&c==-1){b=parseInt(a.getAttribute("row"));j=parseInt(a.getAttribute("rowIndex"))}}var d=null;if(b<0&&e<0&&c!=0&&g!=0)d="Table";else if(b<0&&e>=0&&g>0)d="Column";else if(e<0&&b>=0&&c>0)d="Row";else d="Cell";setRange(h,d,b,e,c,g,j)}function getSelection(){return xmlData.selectSingleNode("selection")}function getRowKeyFromRow2(b){var a=getRowKeyFromRow(b);return a==null?-1:a}function getRowKeyFromRow(b){if(b<0)return null;var a=null;if(b<frzRows){a=getViewport0();if(a==null)a=getViewport1()}else{a=getViewport2();if(a==null)a=getViewport()}if(b>=frzRows)b-=frzRows;return a.rows(b)==null&&a.rows[b]==null?-1:a.rows(b)!=null?a.rows(b).getAttribute("FpKey"):a.rows[b].getAttribute("FpKey")}function getColKeyFromCol(b){if(b<0)return null;var a=null;if(b>=frzCols){a=getViewport1();if(a==null)a=getViewport();if(a==null)a=getColHeader()}else{a=getViewport0();if(a==null)a=getViewport2();if(a==null)a=getFrozColHeader()}if(b>=frzCols)b=b-frzCols;var c=getColGroup(a);return c!=null&&b>=0&&b<c.children.length?c.children[b].getAttribute("FpCol"):null}function getColKeyFromCol3(b){var a=getColKeyFromCol(b);return a==null?-1:a}function getColGroup(b){if(b==null)return null;var a=b.getElementsByTagName("COLGROUP");return a!=null&&a.length>0?a[0]:null}function getRowKeyFromCell(a){return a.parentElement.getAttribute("FpKey")}function getColKeyFromCol2(c,b){var a=getCellFromRowCol(c,b);return a?getColKeyFromCell2(a):b}function getColKeyFromCell2(a){return!a?-1:a.getAttribute("col")?a.getAttribute("col")=="-1"?"0":a.getAttribute("col"):getColKeyFromCell(a)}function getRowTemplateRowFromCell(a){if(!a)return-1;try{var b;if(a.getAttribute("group")!=null)b=getRowTemplateRowFromGroupCell(a);else b=parseInt(a.parentElement.getAttribute("row"));return b}catch(c){$$.DEBUG.Log(c,"getRowTemplateRowFromCell");return-1}}function getRowTemplateRowFromGroupCell(b,k){var l=GetColCount(),h=getColHeader();if((!element.getAttribute("allowGroup")||k)&&h!=null)for(var f=0;f<h.rows.length;f++)for(var i=0;i<l;i++){var j=h.rows(f).cells(i),g=isNaN(b)?parseInt(b.getAttribute("col")):b;if(j!=null&&b!=null&&parseInt(j.getAttribute("col"))==g)return f}var d=getViewport1();if(d!=null)for(var a=0;a<d.rows.length;a++)for(var c=0;c<d.rows(a).cells.length;c++){var g=isNaN(b)?parseInt(b.getAttribute("col")):b;if(d.rows(a).cells(c).getAttribute("col")==g&&d.rows(a).cells(c).getAttribute("group")==null)return parseInt(d.rows(a).getAttribute("FpKey"))}var e=getViewport();if(e!=null)for(var a=0;a<e.rows.length;a++)for(var c=0;c<e.rows(a).cells.length;c++){var g=isNaN(b)?parseInt(b.getAttribute("col")):b;if(e.rows(a).cells(c).getAttribute("col")==g&&e.rows(a).cells(c).getAttribute("group")==null)return parseInt(e.rows(a).getAttribute("FpKey"))}return-1}function getColTemplateRowFromGroupCell(e){var g=GetColCount(),a=getColHeader(),h=getRowTemplateRowFromGroupCell(e,true),f=null;if(a==null)return-1;for(var c=0;c<a.rows.length;c++)for(var d=0;d<g;d++){var b=a.rows(c).cells(d);if(b!=null&&parseInt(b.getAttribute("col"))==e){f=b;break}}return getColFromCell(f)}function getRowTemplateRowFromGroupCell2(c){var d=getViewport1();if(d!=null)for(var a=0;a<d.rows.length;a++)for(var b=0;b<d.rows(a).cells.length;b++){var f=isNaN(c)?parseInt(c.getAttribute("col")):c;if(d.rows(a).cells(b).getAttribute("col")==f&&d.rows(a).cells(b).getAttribute("group")==null)return parseInt(d.rows(a).getAttribute("FpKey"))}var e=getViewport();if(e!=null)for(var a=0;a<e.rows.length;a++)for(var b=0;b<e.rows(a).cells.length;b++){var f=isNaN(c)?parseInt(c.getAttribute("col")):c;if(e.rows(a).cells(b).getAttribute("col")==f&&e.rows(a).cells(b).getAttribute("group")==null)return parseInt(e.rows(a).getAttribute("FpKey"))}return-1}function getCellByRowCol2(c,b){if(c==null||b==null||c.length<=0||b.length<=0||c=="-1"||b=="-1")return null;var d=getRowByKey(c,-1);if(d==-1)return null;for(var h=element.getAttribute("LayoutMode")!=null?parseInt(element.getAttribute("LayoutRowCount")):1,f=d;f<d+h;f++)for(var g=getTableRows(f),a=0;a<g.length;a++)for(var e=g[a],a=0;a<e.cells.length;a++)if(e.cells[a].getAttribute("col")==b)return e.cells[a];return null}function getTableRows(c){var d=[],a=[getViewport0(),getViewport1()];if(c>=frzRows){c-=frzRows;a=[getViewport2(),getViewport()]}for(var b=0;b<a.length;b++)a[b]!=null&&a[b].rows[c]!=null&&d.push(a[b].rows[c]);return d}function paintMultipleRowSelection(i,h,f,d,e){for(var k=GetRowCountInternal(),j=GetColCount(),g=true,a=i;a<k;a++){if(frzCols==0&&frzRows==0&&IsChildSpreadRow(getViewport(),a))continue;for(var c=null,b=h;b<h+d&&b<j;b++){if(isCovered(a,b,spanCells))continue;c=getCellFromRowCol(a,b,c);if(c!=null&&parseInt(c.parentElement.getAttribute("row"))==i){paintViewportSelection(a,b,f,d,e);getColHeader()!=null&&operationMode=="Normal"&&g&&paintHeaderSelection(a,b,f,d,e,true);getRowHeader()!=null&&paintHeaderSelection(a,b,f,d,e,false);g=false}}}paintAnchorCell()}function getRowFromViewPort(b,e){if(b<0||e<0)return null;var a=null;if(b<frzRows)a=getViewport1();else a=getViewport();if(b>=0&&b<a.rows.length)for(var c=0;c<a.rows.length;c++){var d=a.rows[c].getAttribute("row");if(d!=null&&parseInt(d)==b)return c}return 0}function getFirstRowFromKey(b){var a=getRowByKey(b,-1);return a>-1?a:null}function getFirstMultiRowFromViewport(f,h){var a=null,c=null;if(f<frzRows)a=getViewport1();else a=getViewport();if(!h){c=getRowKeyFromRow(f);if(c!=null)return getRowByKey(c,-1)}for(var g=parseInt(element.getAttribute("layoutRowCount")),e,b=0;b<a.rows.length;b++){e=0;if(c!=null){if(a.rows(b).getAttribute("FpKey")==c)return frzRows!=null&&f<frzRows?b:b+frzRows}else for(var d=b+1;d<a.rows.length;d++){if(a.rows(b)!=null&&a.rows(d)!=null&&a.rows(b).getAttribute("FpKey")==a.rows(d).getAttribute("FpKey"))e++;if(e==g-1)return b}}}function getDisplayIndex(b){if(b==null)return-1;if(!element.getAttribute("allowGroup"))return b!=null?GetDisplayIndex(b):0;else{var d=getViewport1();if(d!=null)for(var a=b;a<d.rows.length;a++)if(d.rows(a).getAttribute("row")==b)return a;var c=getViewport();if(c!=null)for(var a=b;a<c.rows.length;a++){if(IsChildSpreadRow(c,a))continue;if(c.rows(a).getAttribute("row")==b)return a}}return-1}function getColKeyFromCell(c){var a=getColFromCell(c);if(a>=frzCols){vp=getViewport();if(vp==null||!isChild(c,vp))vp=getViewport1();var b=getColGroup(vp);if(b!=null&&a-frzCols>=0&&a-frzCols<b.children.length)return b.children[a-frzCols].getAttribute("FpCol")}else{vp=getViewport0();if(vp==null||!isChild(c,vp))vp=getViewport2();var b=getColGroup(vp);if(b!=null&&a>=0&&a<b.children.length)return b.children[a].getAttribute("FpCol")}return null}function setSelection(c,b,h,g,j,e,f){var l=xmlData.selectSingleNode("selection");if(l==null)return;if(h==-1&&e!=null)e=-1;if(g==-1&&f!=null)f=-1;var d=c,k=f==null?b:f;if(typeof c!="undefined"&&parseInt(c)>=0){c=getRowKeyFromRow(c);if(c!="newRow")c=parseInt(c)}if(typeof b!="undefined"&&parseInt(b)>=0)if(element.getAttribute("layoutMode")){var m=d>-1?d:e;if(m>-1){var n=getCellFromRowCol(m,k);if(n&&n.getAttribute("col")!="-1")b=parseInt(getColKeyFromCol2(d,b));else b=-1}}else b=parseInt(getColKeyFromCol(b));if(element.getAttribute("layoutMode")&&e!=null)d=e;if(j==null)j=element.getAttribute("multiRange")=="true"&&event!=null&&event.type!="mousemove";var a=xmlData.lastChild(l);if(a==null||j){a=createSelectionNode(c,b,h,g,d,k);l.appendChild(a)}else{a.setAttribute("row",c);a.setAttribute("col",b);a.setAttribute("rowcount",h);a.setAttribute("colcount",g);a.setAttribute("rowIndex",d);a.setAttribute("colIndex",k)}(h>1||g>1)&&a.removeAttribute("anchor");dirty=true;var o=getCmdBtn("Update");updateCmdBtnState(o,false);inactiveAllChart(element);fireSelectionChangedEvent(element);var i=getTopSpread(element);if(i!=element)i.inactiveAllChart(i),i.fireSelectionChangedEvent(element);paintFocusRect()}function createSelectionNode(g,f,d,b,e,c){var a=xmlData.createElement("range");a.setAttribute("row",g);a.setAttribute("col",f);a.setAttribute("rowcount",d);a.setAttribute("colcount",b);a.setAttribute("rowIndex",e);a.setAttribute("colIndex",c);return a}function addRowToSelection(d,a){if(element.getAttribute("layoutMode")&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect"))return;var b=a;if(typeof a!="undefined"&&parseInt(a)>=0){a=getRowKeyFromRow(a);if(a!="newRow")a=parseInt(a)}if(!isRowSelected(a)&&!isNaN(a)){var c=createSelectionNode(a,-1,1,-1,b,-1);d.appendChild(c)}}function RemoveSelection(f){var c=xmlData.selectSingleNode("selection");if(c==null)return;var a=xmlData.firstChild(c);while(a!=null){var b,d;if(element.getAttribute("layoutMode")&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect")){var i=parseInt(a.getAttribute("row"));b=getFirstRowFromKey(i)}else b=parseInt(a.getAttribute("rowIndex"));if(element.getAttribute("layoutMode")&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect"))d=parseInt(element.getAttribute("layoutRowCount"));else d=parseInt(a.getAttribute("rowcount"));if(b<=f&&f<b+d){c.removeChild(a);for(var e=b;e<b+d;e++)e!=f&&addRowToSelection(c,e);break}a=xmlData.nextSibling(a)}dirty=true;var h=getCmdBtn("Update");updateCmdBtnState(h,false);fireSelectionChangedEvent(element);var g=getTopSpread(element);g!=element&&g.fireSelectionChangedEvent(element)}function updateSelectionViewIndexes(c){if(c.getAttribute("rowIndex")==null||c.getAttribute("colIndex")==null){var a=c.getAttribute("row"),f=parseInt(c.getAttribute("col")),e=a==-1?-1:null,d=f==-1?-1:null;if(element.getAttribute("layoutMode")){var b=null;if(f>-1)if(a=="newRow"||parseInt(a)>-1){b=getCellByRowCol2(a,f);if(b){e=getRowFromCell(b);d=getColFromCell(b)}}else{b=getFirstCellFromCol(c.getAttribute("col"));if(b)d=getColFromCell(b)}else if(a=="newRow"||parseInt(a)>-1)e=getFirstRowFromKey(a)}else{if(a=="newRow"||parseInt(a)>-1)e=getRowByKey(a,-1);if(f>-1)d=getColByKey(f,-1)}e!=null&&c.setAttribute("rowIndex",e);d!=null&&c.setAttribute("colIndex",d)}}function getColInfo(e,a){a=a||a=="true";var d=null;if(a)return xmlData.selectSingleNode("colinfo col[key='"+e+"'][header='"+a+"']");else{var b=xmlData.selectNodes("colinfo col[key='"+e+"']");if(b!=null)for(var c=0;c<b.length;c++){var f=b[c];if(f.getAttribute("header")!="true"){d=f;break}}}return d}function getColWidthFromCol(b){if(b<0)return 0;if(b<frzCols){var a=getColGroup(getViewport0());if(a==null||a.children.length==0)a=getColGroup(getViewport2());if(a==null||a.children.length==0)a=getColGroup(getFrozColHeader());return a!=null&&b<a.children.length?parseInt(a.children[b].width):0}else{var a=getColGroup(getViewport1());if(a==null||a.children.length==0)a=getColGroup(getViewport());if(a==null||a.children.length==0)a=getColGroup(getColHeader());return a!=null&&b-frzCols<a.children.length?parseInt(a.children[b-frzCols].width):0}}function getColWidth(a){if(a==null)return null;xmlData.switchNodeContext(a);var b=xmlData.selectSingleNode("width");xmlData.resetNodeContext();return b!=null?xmlData.textContent(b):null}function addColInfo(d,b){var e="false";if(b)e="true";var a=getColInfo(d,e);if(a!=null)return a;var c=xmlData.selectSingleNode("colinfo");if(c==null)return null;a=xmlData.createElement("col");a.setAttribute("key",d);b&&a.setAttribute("header","true");c.appendChild(a);return a}function setColWidthForViewport(b,e,c,d){if(b!=null){var a=getColGroup(b);if(a.children.length==0)a=getColGroup(getFrozColHeader());setColGroupWidth(a,e,c,d)}}function setColWidthForColFooter(b,e,c,d){if(b!=null){var a=getColGroup(b);if(a.children.length==0)a=getColGroup(getFrozColFooter());setColGroupWidth(a,e,c,d)}}function getFrozColFooterColWidth(a){var c=0,b=getColGroup(getFrozColFooter());if(b!=null&&0<=a&&a<b.children.length)c=parseInt(b.children[a].width);return c}function setColGroupWidth(a,b,d,c){if(a!=null)if(c==null)a.children[b].width=d;else a.children[b].width=Math.max(1,parseInt(a.children[b].width)+c)}function getFrozViewportColWidth(b){var c=0,a=getColGroup(getFrozColHeader());if(a==null||a.children.length==0)a=getColGroup(getViewport0());if(a==null||a.children.length==0)a=getColGroup(getViewport2());if(a!=null&&0<=b&&b<a.children.length)c=parseInt(a.children[b].width);return c}function setTableColWidth(b,d,c){if(b==null)return;var a=getColGroup(b);if(a!=null&&a.children.length>0)a.children[d].width=c}function setColWidth(d,c,b,a){if(arguments.length<4)a=true;setColWidthInternal(d,c,b,a)}function setColWidthInternal(a,b,e,s){if(a==null)return;a=parseInt(a);if(b<10)b=10;var k=0,d=null;if(e!=null)d=b-e;var f=null,t=a,n=a<frzCols?[getFrozColHeader(),getViewport0(),getViewport2(),getFrozColFooter()]:[getColHeader(),getViewport1(),getViewport(),getColFooter()];$$.utils.cleanArray(n);restoreTableWidth(n,a);if(a<frzCols){setTableColWidth(getFrozColHeader(),a,b);var l=getViewport0(),g=e;if(g==null)g=getFrozViewportColWidth(a);setColWidthForViewport(l,a,b,d);var o=getViewport2();setColWidthForViewport(o,a,b,d);if(getFrozColFooter()!=null){if(g==null)g=getFrozColFooterColWidth(a);setColWidthForColFooter(getFrozColFooter(),a,b,d)}if(l==null)l=o;if(l!=null){var c=getColGroup(l);if(c.children.length==0)c=getColGroup(getFrozColHeader());f=addColInfo(c.children[a].getAttribute("FpCol"));if(xhtml&&a==0)k=1;if(!xhtml&&a==0)k=-2;var r=getViewportHolder();if(r!=null)r.children(0).rows(0).cells(0).style.posWidth+=b-g}if(getFrozColHeader()!=null){getFrozColHeader().parentElement.style.posWidth=b;var u=element.all(element.id+"_hidencol2");u.style.posWidth+=b-g;getFrozColHeader().parentElement.parentElement.style.posWidth=getFrozColHeader().parentElement.style.posWidth;if(b<=0)b=1;getFrozColHeader().all(element.id+"col"+a).width=b}}else{a-=frzCols;setTableColWidth(getColHeader(),a,b);if(getViewport()!=null){var c=getColGroup(getViewport());if(c.children.length==0)c=getColGroup(getColHeader());f=addColInfo(c.children[a].getAttribute("FpCol"));if(b<=0)b=1;setColGroupWidth(c,a,b,d)}else if(getViewport1()!=null)f=addColInfo(getColGroup(getViewport1()).children[a].getAttribute("FpCol"));var q=getViewport1();if(q!=null){var c=getColGroup(q);setColGroupWidth(c,a,b,d)}if(getColFooter()!=null){var c=getColGroup(getColFooter());if(c.children.length==0)c=getColGroup(getColHeader());if(b<=0)b=1;setColGroupWidth(c,a,b,d);if(b<=0)b=1;getColFooter().all(element.id+"col"+(a+frzCols)).width=b}}fixMissedColumns(n,t);if(s){var i=[getCorner(),getFrozColHeader(),getColHeader(),getFooterCorner(),getFrozColFooter(),getColFooter()];$$.utils.cleanArray(i);for(var h=0;h<i.length;h++){var j=i[h];if(j.__bkStyleHeight==null)j.__bkStyleHeight=j.style.height}syncRowRange(-1,-1,true);syncRowRangeSafeMode(-1,-1,false);syncRowRange(-1,-1,false,true);sizeSpread(true);for(var h=0;h<i.length;h++){var j=i[h];j.style.height=j.__bkStyleHeight}}if(f!=null){xmlData.switchNodeContext(f);var m=xmlData.selectSingleNode("width");xmlData.resetNodeContext();if(m==null){m=xmlData.createElement("width");f.appendChild(m)}if(e==null)k=0;if(engine>=8){if(e==null&&a==0)k=-2;if(e!=null&&a==0)k=-1}xmlData.textContent(m,b)}var p=getCmdBtn("Update");p!=null&&updateCmdBtnState(p,false);dirty=true;getRowHeader()==null&&frzCols==0&&prepairSpreadLayout()}function createTestBox(){var b=element.document;if(!b.createElement)b=window.document;var a=b.all(element.id+"_testBox");if(a==null){a=b.createElement("span");a.style.position="absolute";a.style.borderWidth=0;a.style.top="-500px";a.style.left="-100px";a.id=element.id+"_testBox";element.insertBefore(a)}return a}function getPreferredRowHeight(d){var b=createTestBox();d=GetDisplayIndex(d);var c=null;if(d<frzRows){c=getViewport1();if(c==null)c=getViewport0()}else{c=getViewport();if(c==null)c=getViewport2();d-=frzRows}var e=0,g=c.rows(d).offsetHeight;n=c.rows(d).cells.length;for(var i=0;i<n;i++){var f=c.rows(d).cells(i),a=getRender(f);if(a!=null){b.style.fontFamily=a.currentStyle.fontFamily;b.style.fontSize=a.currentStyle.fontSize;b.style.fontWeight=a.currentStyle.fontWeight;b.style.fontStyle=a.currentStyle.fontStyle}var l=getColFromCell(f);b.style.posWidth=getColWidthFromCol(l);if(a!=null&&a.tagName=="SELECT"){for(var k="",j=0;j<a.children.length;j++){var h=a.children[j];if(xmlData.textContent(h)!=null&&xmlData.textContent(h).length>k.length)k=xmlData.textContent(h)}b.innerHTML=k}else if(a!=null&&a.tagName=="INPUT")b.innerHTML=a.value;else b.innerHTML=f.innerHTML;g=b.offsetHeight;if(g>e)e=g}return Math.max(0,e)+3}function getRowHeightInternal(b){var a=null;if(b<frzRows){if(getFrozRowHeader()!=null)a=getFrozRowHeader().rows(b);else if(getViewport1()!=null)a=getViewport1().rows(b);else if(getViewport0()!=null)a=getViewport0().rows(b)}else{b-=frzRows;if(getRowHeader()!=null)a=getRowHeader().rows(b);else if(getViewport()!=null)a=getViewport().rows(b);else if(getViewport2()!=null)a=getViewport2().rows(b)}return a!=null?a.offsetHeight:0}function getRowHeightInternal2(b){var a=null;if(b<frzRows){if(getFrozRowHeader()!=null)a=getFrozRowHeader().rows(b);else if(getViewport1()!=null)a=getViewport1().rows(b);else if(getViewport0()!=null)a=getViewport0().rows(b)}else{b-=frzRows;if(getRowHeader()!=null)a=getRowHeader().rows(b);else if(getViewport()!=null)a=getViewport().rows(b);else if(getViewport2()!=null)a=getViewport2().rows(b)}return a!=null?a.style!=null&&a.style.pixelHeight!=null?a.style.pixelHeight:a.offsetHeight:0}function setRowHeight2(c,j,o,n){if(j<1)j=1;var l=c;c=GetDisplayIndex(c);var a=null,e=getViewport2(),b=null,d=null;if(c<frzRows){if(getFrozRowHeader()!=null)a=getFrozRowHeader().rows(c);b=getViewport1();if(b==null)b=getViewport0();e=getViewport0()}else{c-=frzRows;if(getRowHeader()!=null)a=getRowHeader().rows(c);b=getViewport();if(b==null)b=getViewport2()}if(a!=null)a.style.posHeight=j;if(a!=null){b.rows(a.rowIndex).style.posHeight=a.style.posHeight;d=getFirstNonSpanCell(b.rows[a.rowIndex]);if(d!=null)d.style.height="";if(e!=null){e.rows(a.rowIndex).style.posHeight=b.rows(a.rowIndex).style.posHeight;d=getFirstNonSpanCell(e.rows[a.rowIndex]);if(d!=null)d.style.height=""}}else{if(b!=null){b.rows(c).style.posHeight=j;d=getFirstNonSpanCell(b.rows[c]);if(d!=null)d.style.height=""}if(e!=null){e.rows(c).style.posHeight=b.rows(c).style.posHeight;d=getFirstNonSpanCell(e.rows[c]);if(d!=null)d.style.height=""}a=b.rows(c)}count=rowSpanCells.length;var i=null;if(o)i=addRowInfo(a.getAttribute("FpKey"),false,true);else i=addRowInfo(a.getAttribute("FpKey"));i!=null&&setRowHeight(i,a.style.posHeight-(a.synDelt!=null?a.synDelt:0));if(n){var g=[getCorner(),getFrozColHeader(),getColHeader(),getFooterCorner(),getFrozColFooter(),getColFooter()];$$.utils.cleanArray(g);for(var f=0;f<g.length;f++){var h=g[f];if(h.__bkStyleHeight==null)h.__bkStyleHeight=h.style.height}syncRowRange(l,l);sizeSpread(true);for(var f=0;f<g.length;f++){var h=g[f];h.style.height=h.__bkStyleHeight}}var m=getParentSpread();m!=null&&m.UpdateRowHeight(element);var k=getScrollvp();if(k!=null)k.style.posWidth=k.style.posWidth-1}function getRowInfo(f,a){var c=null;a=a||a=="true";if(a)c=xmlData.selectSingleNode("rowinfo row[key='"+f+"'][header='"+a+"']");else{var b=xmlData.selectNodes("rowinfo row[key='"+f+"']");if(b!=null)for(var d=0;d<b.length;d++){var e=b[d];if(e.getAttribute("header")!="true"){c=e;break}}}return c}function getRowHeight(a){if(a==null)return null;xmlData.switchNodeContext(a);var b=xmlData.selectSingleNode("height");xmlData.resetNodeContext();return b!=null?xmlData.textContent(b):null}function addRowInfo(b,c,f){if(b==null)return;var e="false";if(c)e="true";var a=getRowInfo(b,e,f);if(a!=null)return a;var d=xmlData.selectSingleNode("rowinfo");if(d==null)return null;a=xmlData.createElement("row");a.setAttribute("key",b);c&&a.setAttribute("header","true");d.appendChild(a);return a}function getTopSpread(b){if(b==null)b=element;var c=b,a=b.parentElement;while(a!=null){if(a.getAttribute("FpSpread")=="Spread")if(a.getAttribute("hierView")=="true")c=a;else break;a=a.parentElement}return c}function getParentSpread(){try{if(element.getAttribute("hostspread")!=null)return null;var a=element.parentElement;while(a!=null&&a.getAttribute("FpSpread")!="Spread")a=a.parentElement;return a!=null&&a.getAttribute("hierView")=="true"?a:null}catch(b){$$.DEBUG.Log(b,"getParentSpread");return null}}function setRowHeight(b,d){if(b==null)return;xmlData.switchNodeContext(b);var a=xmlData.selectSingleNode("height");xmlData.resetNodeContext();if(a==null){a=xmlData.createElement("height");b.appendChild(a)}xmlData.textContent(a,d);var c=getCmdBtn("Update");c!=null&&updateCmdBtnState(c,false);dirty=true}function findAnchorCell(){var g=xmlData.selectSingleNode("root state activeRow"),f=xmlData.selectSingleNode("root state activeColumn"),a=g!=null?parseInt(xmlData.textContent(g)):-1,b=f!=null?parseInt(xmlData.textContent(f)):-1;if(getSelection().childNodes.length==0||a>-1&&b>-1){var c=null;if(a==-1&&b===-1)return null;else if(element.getAttribute("layoutMode")){if(b>-1){if(a>-1)c=getCellByRowCol2(xmlData.textContent(g),xmlData.textContent(f));if(c==null)c=getFirstCellFromCol(xmlData.textContent(f))}if(c==null){a=getFirstRowFromKey(a);if(a==null)a=0;for(var p=parseInt(element.getAttribute("layoutRowCount")),o=GetColCount(),n=false,d=a;d<a+p;d++){for(var l=0;l<o;l++){c=getCellFromRowCol(d,l);if(c!=null){n=true;break}}if(n)break}}}else{a=g!=null&&a!=-1?getRowByKey(xmlData.textContent(g),0):0;b=f!=null&&b!=-1?getColByKey(xmlData.textContent(f),0):0;c=getCellFromRowCol(a,b)}if(c!=null&&c.getAttribute("canFocus")=="false"){a=getRowFromCell(c);b=getColFromCell(c);var j=moveRightInternal(a,b,false);if(j!=null)c=getCellFromRowCol(j.row,j.col)}c!=null&&saveAnchorCell(c);return c}else if(a<=-1&&b>-1||a>-1&&b<=-1)if(a<=-1&&b>-1){var i=b>=frzCols?getColHeader():getFrozColHeader();if(i){a=i.rows.length+a;if(a>=0&&a<i.rows.length)for(var e=i.rows[a],d=0;d<e.cells.length;d++)if(e.cells[d].getAttribute("col")!=null&&parseInt(e.cells[d].getAttribute("col"))==b)return e.cells[d];for(var k=getColGroup(i),d=0;d<k.children.length;d++)if(k.children[d].getAttribute("FpCol")!=null&&parseInt(k.children[d].getAttribute("FpCol"))==b)return e.cells[d]}}else{var h=getRowByKey(a,-1),m=h>=frzRows?getRowHeader():getFrozRowHeader();if(m&&h>=0){if(h>=frzRows)h-=frzRows;var e=m.rows[h];b=e.cells.length+b;return e.cells[b]}}return null}function saveAnchorCell(a){if(a==null)return;var b=a.parentElement.getAttribute("FpSpread");if(b=="r"||b=="rh"||b=="ch"){var f=null,c=null;if(b=="r"||b=="ch")if(a.getAttribute("col")!=null&&a.getAttribute("col")!="-1")c=parseInt(a.getAttribute("col"));else if(a.getAttribute("col")==null){var d=getColFromCell(a);if(d>=frzCols)d=d-frzCols;var g=getColGroup(a.parentElement.parentElement.parentElement);if(g.children.length>d&&g.children[d].getAttribute("FpCol")!=null)c=parseInt(g.children[d].getAttribute("FpCol"))}else c=0;else{c=-1;for(var e=a.parentElement.cells.length-1;e>=0;e--){if(e==a.cellIndex)break;c--}}if(b=="r"||b=="rh")f=getRowKeyFromCell(a);else{f=-1;for(var h=a.parentElement.parentElement.parentElement,e=h.rows.length-1;e>=0;e--){if(e==a.parentElement.rowIndex)break;f--}}if(f!=null&&c!=null){setActiveRow(f);setActiveCol(c)}}else if(isChild(a,getCorner())){setActiveRow(-1);setActiveCol(-1)}}function setActiveRow(b){if(GetRowCount()<1)return;if(b==null)b=-1;var c=xmlData.selectSingleNode("root state activeRow");if(c==null)return;xmlData.textContent(c,b);if(typeof b!="undefined"&&element.getAttribute("IsNewRow")!="true"&&element.getAttribute("AllowInsert")=="true"){var a=getCmdBtn("Insert");updateCmdBtnState(a,false);a=getCmdBtn("Add");updateCmdBtnState(a,false)}else{var a=getCmdBtn("Insert");updateCmdBtnState(a,true);a=getCmdBtn("Add");updateCmdBtnState(a,true)}if(typeof b!="undefined"&&element.getAttribute("IsNewRow")!="true"&&element.getAttribute("AllowDelete")=="true"){var a=getCmdBtn("Delete");updateCmdBtnState(a,b==-1)}else{var a=getCmdBtn("Delete");updateCmdBtnState(a,true)}dirty=true}function setActiveCol(b){var a=xmlData.selectSingleNode("root state activeColumn");if(a==null)return;xmlData.textContent(a,b);dirty=true}function getActiveRow(){if(anchorCell==null)return-1;var a=getRowFromCell(anchorCell);return GetSheetIndex(a)}function getActiveCol(){if(anchorCell==null)return-1;var a=getColFromCell(anchorCell);return a}function getLeadingCellRow(){return leadingCellRow}function getLeadingCellCol(){return leadingCellCol}function GetActiveChildSheetView(){var a=element.document.FpActiveSheetView;if(typeof a=="undefined")return null;var c=getTopSpread(element),b=getTopSpread(a);return b!=c?null:a==b?null:a}function getTextElement(a){if(a.tagName.toUpperCase()=="INPUT"&&a.type=="text"||a.tagName.toUpperCase()=="TEXTAREA")return a;for(var b=0;b<a.children.length;b++){var c=a.children[b];if(!c.tagName)continue;var d=getTextElement(c);if(d!=null)return d}return null}function getEditor(d){if(d==null)return null;var e=getCellType(d);if(e=="readonly")return null;var a=d.getElementsByTagName("DIV");if(a!=null&&a.length>0&&!a[0].select){var b=getTextElement(a[0]);if(b!=null&&b.select){a[0].select=Function.CreateDelegate(b,b.select);if(!b.getValue)b.getValue=function(){return this.value};if(!b.setValue)b.setValue=function(a){this.value=a};a[0].getValue=Function.CreateDelegate(b,b.getValue);a[0].setValue=Function.CreateDelegate(b,b.setValue)}}if(e=="MultiColumnComboBoxCellType"||e=="ExtenderCellType")if(a!=null&&a.length>0){var c=a[0];c.type="div";return c}a=d.getElementsByTagName("INPUT");if(a!=null&&a.length>0){var c=a[0];while(c!=null&&c.getAttribute("FpEditor")==null)c=c.parentElement;return c}a=d.getElementsByTagName("SELECT");if(a!=null&&a.length>0)return a[0];a=d.getElementsByTagName("TEXTAREA");if(a!=null&&a.length>0){var c=a[0];if(e=="text")return c}return null}var renderAsEditor=-1;function dblclick(){if(element.document.FpActiveSpread==null||element.document.FpActiveSpread!=element)return;var a=getCell(window.event.srcElement,true),d=getSpreadControl(a,false);if(d!=element)return;if(a!=null&&!isHeaderCell(a)&&a==anchorCell&&operationMode=="RowMode"&&enableRowEditTemplate=="true"&&!element.getAttribute("layoutMode")){var b=a.getElementsByTagName("DIV");if(b!=null&&b.length>0&&b[0].id==element.id+"_RowEditTemplateContainer")return;Edit(getRowKeyFromCell(a));var c=getCmdBtn("Cancel");c!=null&&updateCmdBtnState(c,false);return}if(a!=null&&!isHeaderCell(a)&&a==anchorCell)a.getAttribute("canFocus")!="false"&&StartEdit(a)}function isAllInitialized(){var c=getTopSpread(element);if(!c.initialized)return false;for(var b=FpSpreadJS.getAllChildViews(c),a=0;a<b.length;a++)if(!b[a].initialized)return false;return true}function prepairEditCell(a){if(smartPaint&&a!=null&&(a.offsetParent==null||getRowFromCell(a)>=frzRows&&a.parentElement.rowIndex==0&&newTop!=0||$$.browser.quirksMode&&element.document!=a.document)){var b=getRowFromCell(a),e=getColFromCell(a);if(window.event!=null&&window.event.type=="keydown")element.__scrollByEditing=true;if(element.getAttribute("layoutMode")&&allowGroup&&isColHeader)b=getRowFromViewPort(b,e);if(smartPaint&&vpList.table.rows.length>0&&b>=frzRows)if(b<current+frzRows)showRows(b-frzRows,current+frzRows-b+1);else b-frzRows>=current+currentCount&&showRows(b-frzRows,1);anchorCell=findAnchorCell();paintAnchorCell(true);var c=getScrollvp();if(c!=null)c.onscroll=null;var d=getViewport().parentElement;if(getRowFromCell(anchorCell)>=frzRows)d.scrollTop=anchorCell.offsetTop+element.virtualTop;if(getColFromCell(anchorCell)>=frzCols)d.scrollLeft=anchorCell.offsetLeft;scrollView();newTop=getTopRow(c.scrollTop);doUpdate();c!=null&&setTimeout(function(){getScrollvp().onscroll=vpscroll},10);a=anchorCell}return a}function scrollToCell(a){var b=getParent(getViewport()),c=b;if(a.offsetWidth<b.clientWidth){if((isChild(a,b)||isChild(a,getViewport1()))&&a.offsetLeft+a.offsetWidth>b.scrollLeft+b.clientWidth)c.scrollLeft=a.offsetLeft+a.offsetWidth-b.clientWidth;if(a.offsetLeft<b.scrollLeft&&(isChild(a,getViewport())||isChild(a,getViewport1())))c.scrollLeft=a.offsetLeft}if((isChild(a,b)||isChild(a,getViewport2()))&&a.offsetTop+a.offsetHeight>c.scrollTop+b.clientHeight&&a.offsetHeight<b.clientHeight)c.scrollTop=a.offsetTop+a.offsetHeight-b.clientHeight;if(a.offsetTop<c.scrollTop-element.virtualTop&&a.offsetHeight<b.offsetHeight&&(isChild(a,getViewport())||isChild(a,getViewport2())))c.scrollTop=a.offsetTop+element.virtualTop;syncScrollByCell(a,up);if(engine>=9&&getScrollvp()!=null){ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}}function StartEdit(C){if(operationMode=="SingleSelect"||operationMode=="ReadOnly"||editing)return;if(operationMode=="RowMode"&&enableRowEditTemplate=="true"&&!element.getAttribute("layoutMode"))return;if(editModePermanent&&!isAllInitialized())return;var a=C;if(a==null)a=anchorCell;if(a==null)return;if(isHeaderCell(a))return;scrollToCell(a);a=prepairEditCell(a);if(a.children.length>0&&a.children(0).getAttribute("FpSpread")=="Spread")return;element.document.focus();element.document.FpActiveSpread!=element&&focus();renderAsEditor=-1;var f=getEditor(a);if(f!=null){setEditorFocus(f);editing=true;editor=f;renderAsEditor=1;editingValue=getEditorValue(f)}if(a!=null){var y=getRowFromCell(a),r=getColFromCell(a),v=GetSheetIndex(y);if(fireEditStartEvent(v,r,a,element))return;var w=getTopSpread(element);if(w!=element)if(w.fireEditStartEvent(v,r,a,element))return;var B=getCellType(a);if(B=="readonly")return;if(anchorCell!=a){anchorCell=a;setActiveRow(getRowKeyFromCell(a));setActiveCol(element.getAttribute("layoutMode")?getColKeyFromCell2(a):getColKeyFromCell(a))}if(f==null){var c=getRender(a),e=getValueFromRender(c);editingValue=e;editingFormula=getFormulaFromCell(a);if(editingFormula!=null)e=editingFormula;var d=a.clientHeight;if(frameSet)d=parseInt(a.currentStyle.height)-2;if(!isNaN(a.clientTop)){var l=a.clientTop;if(l==0&&y==0)l=1;d=d-2*l}try{if(c!=a)c.style.display="none";else if(xmlData.firstElementChild(c)!=null&&xmlData.firstElementChild(c).tagName=="NOBR")xmlData.firstElementChild(c).innerHTML="&nbsp;";else c.innerHTML="&nbsp;"}catch(E){$$.DEBUG.Log(E,"StartEdit");return}var m=getCellEditorID(a);if(m!=null&&typeof m!="undefined"){editor=getCellEditor(m,true);editor.style.display="inline"}else{editor=document.createElement("input");editor.type="text"}editor.style.fontFamily=c.currentStyle.fontFamily;if(c.currentStyle.fontSize==null||c.currentStyle.fontSize.indexOf("%")<0)editor.style.fontSize=c.currentStyle.fontSize;editor.style.fontWeight=c.currentStyle.fontWeight;editor.style.fontStyle=c.currentStyle.fontStyle;editor.style.textDecoration=c.style.textDecoration;editor.style.position="absolute";a.insertBefore(editor);if(frameSet&&getScrollvp()!=null){var p=getOffsetTop(a)+a.clientTop,o=getOffsetLeft(a)+a.clientLeft;if(isChild(a,getViewport())||isChild(a,getViewport2())){var h=getViewport1();if(h==null)h=getViewport0();if(h!=null)p+=h.offsetHeight;p-=getScrollvp().scrollTop}if(isChild(a,getViewport())||isChild(a,getViewport1())){var i=getViewport2();if(i==null)i=getViewport0();if(i!=null)o+=i.offsetWidth;o-=getScrollvp().scrollLeft}editor.style.top=p+"px";editor.style.left=o+"px"}else{var s=editor.offsetParent.getBoundingClientRect(),t=a.getBoundingClientRect(),u=editor.offsetParent,A=u.scrollTop,z=u.scrollLeft;editor.style.top=t.top+A-s.top+a.clientTop+"px";editor.style.left=t.left+z-s.left+a.clientLeft+"px"}var g=0;if(!isNaN(a.clientLeft)){var k=a.clientLeft;if(k==0&&r==0)k=1;g=2*k}if(frameSet)editor.style.width=parseInt(a.currentStyle.width)-g-2+"px";else if(xhtml)editor.style.width=Math.max(1,a.clientWidth-g-2)+"px";else{editor.style.width=Math.max(1,a.clientWidth-g)+"px";saveMargin(a)}if(editor.tagName=="INPUT"&&editor.type=="text"||editor.tagName=="TEXTAREA"){if(editor.style.backgroundColor==""||typeof editor.backColorSet!="undefined"){editor.style.backgroundColor=a.currentStyle.backgroundColor;editor.backColorSet=true}if(editor.style.color==""||typeof editor.colorSet!="undefined"){editor.style.color=a.currentStyle.color;editor.colorSet=true}if(xhtml)editor.style.height=Math.max(1,d-2)+"px";else editor.style.height=Math.max(1,d)+"px";editor.style.border=$$.browser.version>=9?"none":"";restoreMargin(editor,false)}renderAsEditor=0;setEditorValue(editor,e);if(editor.tagName=="SELECT"){editorSelectedIndex=editor.selectedIndex;if(e==null||e==""&&a.getAttribute("specialValue")==null)editor.selectedIndex=editorSelectedIndex=-1}if(editor.offsetHeight<a.clientHeight&&editor.tagName!="TEXTAREA")if(a.vAlign=="middle")editor.style.posTop+=(d-editor.offsetHeight)/2;else if(a.vAlign=="bottom")editor.style.posTop+=d-editor.offsetHeight;if(element.__scrollByEditing)editor.__bkLength=e!=null?e.length:0;waitForAttachBehavior();var q=a.rowSpan;if(isNaN(q))q=1;var x=getRowFromCell(a);setResizingFlag(true);syncRowRangeSafeMode(x,x+q-1);ignoreMainScroll=true;sizeSpread(true);ignoreMainScroll=false;setResizingFlag(false)}if(isEditModeReplace(a))if(editor.select)try{var D=editor.tagName=="INPUT"&&(editor.type=="button"||editor.type=="submit");!D&&editor.select()}catch(E){$$.DEBUG.Log(E,"StartEdit")}else for(var n=editor.getElementsByTagName("INPUT"),j=0;j<n.length;j++)if(n[j].type=="text"){n[j].select();break}editing=true;var b=getCmdBtn("Update");b!=null&&b.disabled&&updateCmdBtnState(b,false);b=getCmdBtn("Copy");b!=null&&!b.disabled&&updateCmdBtnState(b,true);b=getCmdBtn("Paste");b!=null&&!b.disabled&&updateCmdBtnState(b,true);b=getCmdBtn("Clear");b!=null&&!b.disabled&&updateCmdBtnState(b,true)}}function setEditorFocus(g){if(ignoreEditorFocus)return;var d=true,b=getCell(g,true),e=getCellType(b);if(e!=null){var f=getFunction(e+"_setFocus");if(f!=null){f(g);d=false}}try{if(d){var a=getEditor(b);if(a!=null)b.getAttribute("RowEditTemplate")!="true"&&a.focus();else{var c=getCellEditorID(b);if(c!=null&&typeof c!="undefined"){a=getCellEditor(c,true);a!=null&&a.focus()}else editor!=null&&editor.focus()}}}catch(h){$$.DEBUG.Log(h,"setEditorFocus")}}function setEditorValue(b,d){var e=getCell(b,true),a=getCellType(e);if(a!=null){var c=getFunction(a+"_setEditorValue");if(c!=null){c(b,d,element);return}}a=b.getAttribute("FpEditor");if(a!=null){var c=getFunction(a+"_setEditorValue");if(c!=null){c(b,d,element);return}}b.value=d}function getEditorValue(a){var d=this.getCell(a,true),b=this.getCellType(d);if(b!=null){var c=this.getFunction(b+"_getEditorValue");if(c!=null)return c(a,element)}b=a.getAttribute("FpEditor");if(b!=null){var c=this.getFunction(b+"_getEditorValue");if(c!=null)return c(a,element)}return typeof a.value=="boolean"?a.value?"True":"False":a.value}function getCurrency(a){var b=a.getAttribute("CurrencySymbol");if(b!=null)return b;var c=element.all(a.id+"cs");return c!=null?xmlData.textContent(c):""}function waitForAttachBehavior(){if(editor.readyState=="complete"){setEditorFocus(editor);(element.document.activeElement==null||element.document.activeElement!=editor)&&setEditorFocus(editor);return}setTimeout("eval("+element.id+").waitForAttachBehavior()",20)}function getValueFromRender(a){var c=getCell(a),d=getCellType2(c);if(d!=null){var b=null;if(d=="ExtenderCellType"){b=getFunction(d+"_getEditor");if(b!=null)if(b(a)!=null)b=getFunction(d+"_getEditorValue");else b=null}else b=getFunction(d+"_getValue");if(b!=null)return b(a,element)}if(xmlData.firstElementChild(a)!=null&&xmlData.firstElementChild(a).tagName=="NOBR")a=xmlData.firstElementChild(a);if(c!=null&&trim(a.innerHTML)=="&nbsp;")return c.getAttribute("whiteSpace")==null?"":" ";var e=a.value;if(c!=null&&a.tagName=="NOBR")e=c.value;if(typeof e=="undefined")e=trim(a.innerText);return e}function GetFormula(a,d){a=GetDisplayIndex(a);var c=getCellFromRowCol(a,d),b=getFormulaFromCell(c);return b}function SetFormula(a,f,c,e,d){a=GetDisplayIndex(a);var b=getCellFromRowCol(a,f);b.setAttribute("FpFormula",c);!d&&setCellValue(b,c,null,e)}function getFormulaFromCell(b){var a=null;if(b.getAttribute("FpFormula")!=null)a=b.getAttribute("FpFormula");if(a!=null)a=trim(new String(a));return a}function setValueToRender(a,b,e){var c=null,d=getCellType2(getCell(a));if(d!=null)if(d=="ExtenderCellType"){c=getFunction(d+"_getEditor");if(c!=null)if(c(a)!=null)c=getFunction(d+"_setEditorValue");else c=null}else c=getFunction(d+"_setValue");if(c!=null)c(a,b,element);else{if(a.tagName=="NOBR")a=getCell(a);if(typeof a.value!="undefined"){if(b==null)b="";if(typeof a.maxLength!="undefined"&&a.maxLength>0)b=b.substring(0,a.maxLength);a.value=b;a.style.display="block"}else if(b==null||b=="")if(xmlData.firstElementChild(a)!=null&&xmlData.firstElementChild(a).tagName=="NOBR")xmlData.firstElementChild(a).innerHTML="&nbsp;";else a.innerHTML="&nbsp;";else if(xmlData.firstElementChild(a)!=null&&xmlData.firstElementChild(a).tagName=="NOBR")xmlData.textContent(xmlData.firstElementChild(a),b);else xmlData.textContent(a,b)}if(a.tagName=="NOBR")a=getCell(a);(typeof e=="undefined"||!e)&&a.getAttribute("FpFormula")!=null&&a.setAttribute("FpFormula",b)}function trim(b){var a=b.match(new RegExp("^\\s*(\\S+(\\s+\\S+)*)\\s*$"));return a==null?"":a[1]}function getOffsetLeft(d,f,e){var b=f;if(b==null)b=getViewportFromCell(d);var c=0,a=d;while(a!=null&&a!=b&&isChild(a,b)){c+=a.offsetLeft;if(!e)c+=a.clientLeft;a=a.offsetParent;if(a!=null&&a!=b)c-=a.scrollLeft}return c}function getElementOffsetLeft(c){var b=0;b+=c.offsetLeft;b+=c.clientLeft;var a=c.offsetParent;while(a&&(a.tagName=="TD"||a.tagName=="TR"||a.tagName=="TBODY"||a.tagName=="TABLE")&&a.style.position!="relative"&&a.style.position!="absolute"){b+=a.offsetLeft;b+=a.clientLeft;a=a.offsetParent}return b}function getOffsetTop(d,f,e){var b=f;if(b==null)b=getViewportFromCell(d);var c=0,a=d;while(a!=null&&a!=b&&isChild(a,b)){c+=a.offsetTop;if(!e)c+=a.clientTop;a=a.offsetParent;if(a!=null&&a!=b)c-=a.scrollTop}return c}function getElementOffsetTop(c){var b=0;b+=c.offsetTop;b+=c.clientTop;var a=c.offsetParent;while(a&&(a.tagName=="TD"||a.tagName=="TR"||a.tagName=="TBODY"||a.tagName=="TABLE")&&a.style.position!="relative"&&a.style.position!="absolute"){b+=a.offsetTop;b+=a.clientTop;a=a.offsetParent}return b}function getScrollTop(c){var b=0,a=c;while(a!=null&&a!=element.document.body.parentElement){b+=a.scrollTop;a=a.offsetParent}if(element.document.body.parentElement!=null)b+=element.document.body.parentElement.scrollTop;return b}function getScrollLeft(c){var b=0,a=c;while(a!=null&&a!=element.document.body.parentElement){b+=a.scrollLeft;a=a.offsetParent}if(element.document.body.parentElement!=null)b+=element.document.body.parentElement.scrollLeft;return b}function getFunction(fn){if(fn==null||fn=="")return null;try{return eval(fn)}catch(ex){return null}}function getMaskedEditValidtor(b){if(typeof Page_Validators!="undefined"){var a=null;for(i=0;i<Page_Validators.length;i++){a=Page_Validators[i];if(typeof a.enabled=="undefined"||a.enabled!=false)if(a.id==b+"")return a}}}function EndEdit(){if(editor==null||editor.parentElement==null)return true;element.valid=true;var cell=getCell(editor.parentElement);if(cell==null)return;var val=getEditorValue(editor),tval=val;if(typeof val=="string")tval=trim(val);var ignoreValidation=element.getAttribute("AcceptFormula")=="true"&&tval!=null&&tval.charAt(0)=="=",checkbox=renderAsEditor!=0,canExtenderValidation=false,maskedEditExtenderDiv=cell.getElementsByTagName("div")[0],maskedEditValidtorItem;if(typeof maskedEditExtenderDiv!="undefined"&&maskedEditExtenderDiv!=null)if(maskedEditExtenderDiv.getAttribute("Extenders")!=null&&maskedEditExtenderDiv.getAttribute("Extenders").indexOf("MaskedEditExtender")!=-1){canExtenderValidation=getMaskedEditValidtor((maskedEditExtenderDiv.id+"validator").replace(new RegExp(",","g"),"_"))!=null;maskedEditValidtorItem=getMaskedEditValidtor((maskedEditExtenderDiv.id+"validator").replace(new RegExp(",","g"),"_"))}if(canValidate()&&!ignoreValidation&&!checkbox||canExtenderValidation){var validatorID=getCellValidatorID(cell);if(validatorID!=null&&typeof Page_ValidationVer!="undefined"){var validator=getCellValidator(validatorID);validator.isvalid=true;if(validator.type=="Double")validator.isvalid=isDouble(val,validator);else if(validator.evaluationfunction!=null){if(typeof validator.evaluationfunction=="string")validator.evaluationfunction=eval(validator.evaluationfunction);if(typeof validator.evaluationfunction=="function"){var document=element.document;if(!document.all)document=window.document;var tmp=document.all(validator.controltovalidate);if(tmp!=null){tmp.value=val;validator.isvalid=validator.evaluationfunction(validator);tmp.value=""}}}if(validator.isvalid)hideMsg();else{validator.style.position="absolute";validator.style.visibility="visible";validator.style.display="block";var vh=getViewportHolder();vh!=null&&validator.parentElement!=vh&&vh.insertBefore(validator);setValidatorPos();window.event.returnValue=false;showMsg(validator);element.valid=false;return maskedEditValidtorItem!=null&&maskedEditValidtorItem.focusOnError==null?true:false}}else{var msg=null;if(typeof editor.isValid!="undefined")msg=editor.isValid(val);else{var ct=getCellType(cell);if(ct!=null){var f=getFunction(ct+"_isValid");if(f!=null){msg=f(cell,val);if($$.browser.quirksMode){var e=createEventObject();e.spread=element;e.row=getRowFromCell(cell);e.col=getColFromCell(cell);e.errorMessage=msg;if(msg=="")e.isValid=true;else e.isValid=false;ErrorMessageShown.fire(e)}else{var data={spread:element,row:getRowFromCell(cell),col:getColFromCell(cell),errorMessage:msg,isValid:msg==""},e=$$.utils.createEvent("ErrorMessageShown",false,true,data);element.dispatchEvent(e)}}}}if(canExtenderValidation){var exvalidator=getMaskedEditValidtor((maskedEditExtenderDiv.id+"validator").replace(new RegExp(",","g"),"_"));if(exvalidator)try{ExtenderCellType_validateValue&&ExtenderCellType_validateValue(editor);var crtret=true;if(typeof exvalidator.evaluationfunction=="function"){crtret=exvalidator.evaluationfunction(exvalidator);if(!crtret)if(typeof exvalidator.errormessage=="string"){if(msg!="")msg+=", ";msg=exvalidator.errormessage}}else if(typeof exvalidator.evaluationfunction=="string"){eval("crtret = "+exvalidator.evaluationfunction+"("+exvalidator.id+")");if(!crtret)if(typeof exvalidator.errormessage=="string"){if(msg!="")msg+=", ";msg=exvalidator.errormessage}}if(ExtenderCellType_setValidateEditor)if(!crtret){var inputs=editor.getElementsByTagName("INPUT");for(i=0;i<inputs.length;i++){var textInput=inputs[i];if(textInput.type=="text")textInput.isInvalid=true}ExtenderCellType_setValidateEditor(editor)}else{var inputs=editor.getElementsByTagName("INPUT");for(i=0;i<inputs.length;i++){var textInput=inputs[i];if(textInput.type=="text"&&textInput.isInvalid)textInput.isInvalid=null}ExtenderCellType_setValidateEditor(null)}if(!crtret&&typeof exvalidator.focusOnError=="string"&&exvalidator.focusOnError=="t"){var ctrl=editor.getElementsByTagName("input")[0];ctrl!=null&&ctrl.focus!="undefined"&&ctrl.focus!=null&&setTimeout(function(){try{ctrl.focus()}catch(a){$$.DEBUG.Log(a,"EndEdit")}},0)}}catch(ex){$$.DEBUG.Log(ex,"EndEdit")}}if(msg!=null&&msg!=""){if(validationMsg==null){var document=element.document;if(!document.createElement)document=window.document;validationMsg=document.createElement("div");validationMsg.style.position="absolute";var vh=getViewportHolder();if(vh==null)vh=getViewport().parentElement;vh.insertBefore(validationMsg)}validationMsg.innerHTML=msg;validationMsg.style.position="absolute";validationMsg.style.visibility="visible";validationMsg.style.display="block";setValidatorPos();if(window.event)window.event.returnValue=false;showMsg(validationMsg);element.valid=false}else hideMsg();if(msg!=null&&msg!=""||crtret!=null&&!crtret)return false}}else hideMsg();var selectedIndex=-1;if(!checkbox){if(editor.tagName=="SELECT")selectedIndex=editor.selectedIndex;!xhtml&&textBox!=null&&textBox.blur();cell.removeChild(editor);editor.style.display="none";getViewport().appendChild(editor);setEditorValue(editor,"");if(editor.tagName=="SELECT")editor.selectedIndex=-1;var rd=getRender(cell);if(rd.style.display=="none")rd.style.display="";if(editingFormula!=null&&editingFormula==val)setValueToRender(rd,editingValue,true);else setValueToRender(rd,val);restoreMargin(cell);if(getFirstNonSpanCell(cell.parentNode)==null&&cell.style.height!="")cell.style.height=""}var ct=getCellType(cell);if(editingFormula!=null&&editingFormula!=val||editingFormula==null&&editingValue!=val||editor.tagName=="SELECT"&&editorSelectedIndex!=selectedIndex){if(ct=="RadioButtonListCellType"&&val==null)val="";setCellValue(cell,val);if(val!=null&&val.length>0&&trim(val).indexOf("=")==0)cell.setAttribute("FpFormula",val);else cell.removeAttribute("FpFormula")}editorSelectedIndex=-1;editor=null;editing=false;if(!checkbox){var rc=cell.rowSpan;if(isNaN(rc))rc=1;var r1=getRowFromCell(cell);setResizingFlag(true);syncRowRangeSafeMode(r1,r1+rc-1);sizeSpread(true);setResizingFlag(false)}fireEditStoppedEvent(cell,element);var ts=getTopSpread(element);ts!=element&&ts.fireEditStoppedEvent(cell,element);if(element.getAttribute("virtualPaging")=="true"&&element.getAttribute("EditModePermanent")){ignorePostbackEditmode=true;!ignoreEditorFocus&&setTextBoxFocus();ignorePostbackEditmode=false}else{focus();focus()}btn=getCmdBtn("Copy");btn!=null&&btn.disabled&&updateCmdBtnState(btn,false);btn=getCmdBtn("Clear");btn!=null&&btn.disabled&&updateCmdBtnState(btn,false);var data=getClipboardData();btn=getCmdBtn("Paste");btn!=null&&btn.disabled&&updateCmdBtnState(btn,data==null);renderAsEditor=-1;var autoCalc=element.getAttribute("autoCalc");if(autoCalc!="false")(editingFormula!=null&&editingFormula!=val||editingFormula==null&&editingValue!=val)&&updateValues();getRowHeader()==null&&frzCols==0&&prepairSpreadLayout();return true}function showMsg(b){var d=getTopSpread(element),c=element.document;if(!c.getElementById)c=window.document;var a=c.getElementById(d.id+"mholder");if(a==null){a=c.createElement("iframe");a.frameBorder="no";a.scrolling="no";a.src="javascript:false;";d.appendChild(a);a.style.position="absolute";a.id=d.id+"mholder"}d.insertBefore(b,null);getMsgStyle();if(msgStyle!=null){if(msgStyle.fontFamily!=null)b.style.fontFamily=msgStyle.fontFamily;if(msgStyle.fontSize!=null)b.style.fontSize=msgStyle.fontSize;if(msgStyle.fontStyle!=null)b.style.fontStyle=msgStyle.fontStyle;if(msgStyle.fontVariant!=null)b.style.fontVariant=msgStyle.fontVariant;if(msgStyle.fontWeight!=null)b.style.fontWeight=msgStyle.fontWeight}a.style.top=b.style.top;a.style.left=b.style.left;a.contentWindow.document.write(b.innerHTML);a.contentWindow.document.close();b.style.left="0px";a.width=b.offsetWidth+6;a.height=b.offsetHeight+6;if(a.style.posLeft+parseInt(a.width)>a.parentElement.offsetWidth+a.parentElement.scrollLeft)a.style.posLeft=a.parentElement.offsetWidth-parseInt(a.width)+a.parentElement.scrollLeft;if((element.currentStyle.position=="absolute"||element.currentStyle.position=="relative")&&a.style.posTop+parseInt(a.height)>a.parentElement.offsetHeight)a.style.posTop=a.style.posTop-parseInt(a.height)-anchorCell.offsetHeight;a.contentWindow.document.body.style.fontFamily=b.currentStyle.fontFamily;a.contentWindow.document.body.style.fontSize=b.currentStyle.fontSize;a.contentWindow.document.body.style.fontStyle=b.currentStyle.fontStyle;a.contentWindow.document.body.style.fontVariant=b.currentStyle.fontVariant;a.contentWindow.document.body.style.fontWeight=b.currentStyle.fontWeight;a.contentWindow.document.body.style.background="yellow";a.contentWindow.document.body.style.color="red";if(msgStyle!=null){if(msgStyle.backgroundColor!=null)a.contentWindow.document.body.style.backgroundColor=msgStyle.backgroundColor;if(msgStyle.color!=null)a.contentWindow.document.body.style.color=msgStyle.color}a.contentWindow.document.body.style.marginLeft="2px";a.contentWindow.document.body.style.marginTop="2px";a.contentWindow.document.body.style.marginRight="0px";a.contentWindow.document.body.style.marginBottom="0px";a.style.border="1px solid black";a.style.display="inline";b.style.display="none";a.contentWindow.document.attachEvent("onmousedown",function(){var a=EndEdit();!a&&editor.focus()})}function hideMsg(){var c=getTopSpread(element),a=element.document;if(!a.getElementById)a=window.document;var b=a.getElementById(c.id+"mholder");if(b!=null)b.style.display="none"}function setValidatorPos(){if(editor==null)return;var c=getCell(editor.parentElement);if(c==null)return;var d=null,m=getCellValidatorID(c);if(m!=null&&typeof Page_ValidationVer!="undefined")d=getCellValidator(m);if(d==null)d=validationMsg;var b=getTopSpread(element),l=element.document;if(!l.getElementById)l=window.document;var a=l.getElementById(b.id+"mholder");if(d!=null&&d.style.display!="none"||a!=null){var i=b.getScrollvp();if(i==null)i=b.getViewport().parentElement;var k=getOffsetTop(c,b)+c.offsetHeight,j=getOffsetLeft(c,b),e=true,f=getViewport(),g=getViewport1(),h=getViewport2();if(isChild(c,f)||isChild(c,g)){var n=h!=null?getOffsetLeft(h,b)+h.offsetWidth:getOffsetLeft(f.parentNode,b);e=n<=j;if(e)e=n+f.parentNode.offsetWidth>=j}if(e&&(isChild(c,f)||isChild(c,h))){var o=g!=null?getOffsetTop(g,b)+g.offsetHeight:getOffsetTop(f.parentNode,b);e=o<k;if(e)e=o+f.parentNode.offsetHeight>=k}if(d!=null){d.style.posTop=k;d.style.posLeft=j}if(a!=null){a.style.posTop=k;a.style.posLeft=j;a.style.visibility=e?"visible":"hidden";if(getOffsetLeft(i,b)>parseInt(a.style.posLeft)||getOffsetTop(i,b)>parseInt(a.style.posTop)){if(!a.backDisplayValue)a.backDisplayValue=a.style.display;a.style.display="none"}else if(a.backDisplayValue)a.style.display=a.backDisplayValue}}}function canValidate(){return typeof clientInformation!="undefined"&&clientInformation.appName.indexOf("Explorer")!=-1}function saveMargin(a){if(typeof a.currentStyle.paddingLeft!="undefined"&&a.currentStyle.paddingLeft!=""){editorMargin.left=a.currentStyle.paddingLeft;a.style.paddingLeft="0px"}if(typeof a.currentStyle.paddingRight!="undefined"&&a.currentStyle.paddingRight!=""){editorMargin.right=a.currentStyle.paddingRight;a.style.paddingRight="0px"}if(typeof a.currentStyle.paddingTop!="undefined"&&a.currentStyle.paddingTop!=""){editorMargin.top=a.currentStyle.paddingTop;a.style.paddingTop="0px"}if(typeof a.currentStyle.paddingBottom!="undefined"&&a.currentStyle.paddingBottom!=""){editorMargin.bottom=a.currentStyle.paddingBottom;a.style.paddingBottom="0px"}}function restoreMargin(b,a){if(typeof editorMargin.left!="undefined"&&editorMargin.left!=-1){b.style.paddingLeft=editorMargin.left;if(a==null||a)editorMargin.left=-1}if(typeof editorMargin.right!="undefined"&&editorMargin.right!=-1){b.style.paddingRight=editorMargin.right;if(a==null||a)editorMargin.right=-1}if(typeof editorMargin.top!="undefined"&&editorMargin.top!=-1){b.style.paddingTop=editorMargin.top;if(a==null||a)editorMargin.top=-1}if(typeof editorMargin.bottom!="undefined"&&editorMargin.bottom!=-1){b.style.paddingBottom=editorMargin.bottom;if(a==null||a)editorMargin.bottom=-1}}function getMsgStyle(){if(msgStyle!=null)return;for(var e=element.document.styleSheets.length,a=0;a<e;a++){for(var c=element.document.styleSheets[a],b=0;b<c.rules.length;b++){var d=c.rules[b];if(d.selectorText=="."+element.id+"msgStyle"){msgStyle=d.style;break}}if(msgStyle!=null)break}}var colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};function getColorValue(b){var a=b.match(/^rgb\s*\(\s*([^\)]+),\s*([^\)]+),\s*([^\)]+)\)/i);if(a!=null&&a.length==4)try{return"#"+parseInt(a[1]).toString(16)+parseInt(a[2]).toString(16)+parseInt(a[3]).toString(16)}catch(e){$$.DEBUG.Log(e,"getColorValue");return null}for(var c in colors)if(b!=null&&b.toLowerCase()==c)return"#"+colors[c];return null}function darker(b,f){if(b==null)return null;if(b.substring(0,1)!="#"){var g=getColorValue(b);if(g==null)return b;b=g}if(f.substring(0,1)!="#"){var g=getColorValue(f);if(g==null)g="#bbbbbb";f=g}var j=256-parseInt(f.substring(1,3),16),i=256-parseInt(f.substring(3,5),16),h=256-parseInt(f.substring(5,7),16),e,d,c,a;e=parseInt(b.substring(1,3),16);d=parseInt(b.substring(3,5),16);c=parseInt(b.substring(5,7),16);e-=j;if(e>255)e=255;if(e<0)e=0;d-=i;if(d>255)d=255;if(d<0)d=0;c-=h;if(c>255)c=255;if(c<0)c=0;a=c.toString(16);if(a.length<2)a="0"+a;a=d.toString(16)+a;if(a.length<4)a="0"+a;a=e.toString(16)+a;if(a.length<6)a="0"+a;return"#"+a.toUpperCase()}function paintSelectedCell(a,d,c){if(a==null)return;var b=c?anchorBackColor:selectedBackColor;if(d){if(a.bgColorBak==null)a.bgColorBak=a.currentStyle.backgroundColor;if(a.paintSelected==null||c){if(b!=null)if(element.getAttribute("semiTransparentSelectedBackColor")==null||a.all&&(a.currentStyle.backgroundColor==null||a.currentStyle.backgroundColor.length==0||a.currentStyle.backgroundColor=="transparent"))a.style.backgroundColor=b;else a.style.backgroundColor=darker(a.currentStyle.backgroundColor,b);a.paintSelected=true}if(a.getAttribute("bgSelImg")!=null)a.style.backgroundImage=a.getAttribute("bgSelImg");else if(a.currentStyle)if(a.currentStyle.backgroundImage!=null&&a.currentStyle.backgroundImage!="")a.style.backgroundImage="url('')"}else{a.paintSelected=null;a.style.removeAttribute("backgroundColor");a.style.removeAttribute("backgroundImage");if(a.getAttribute("bgColor")!=null&&a.getAttribute("bgColor")!="")a.style.backgroundColor=a.getAttribute("bgColor");if(a.getAttribute("bgImg")!=null)a.style.backgroundImage=a.getAttribute("bgImg")}}function paintAnchorCell(c){if(anchorCell==null||anchorCell.parentElement==null)return;var a=operationMode;if(anchorCell==null||a!="Normal"&&a!="RowMode")return;if(a=="MultiSelect"||a=="ExtendedSelect")return;if(typeof c=="undefined"||c){if(oldAnchorCell&&oldAnchorCell!=anchorCell){var e=oldAnchorCell.paintSelected!=null;if(element.getAttribute("SelectionPolicy")!="MultiRange"){var f=getRowFromCell(oldAnchorCell),d=getColFromCell(oldAnchorCell);getColHeader()!=null&&!isColSelected(d)&&paintHeaderSelection(f,d,1,1,false,true)}paintSelectedCell(oldAnchorCell,false);e&&paintSelectedCell(oldAnchorCell,true,false);oldAnchorCell=null}var b=frzRows==0&&frzCols==0&&getTopSpread().getAttribute("hierView")!="true";if(element.getAttribute("showFocusRect")=="false")b=false;if(b){paintSelectedCell(anchorCell,false);paintFocusRect();paintAnchorCellHeader(true);return}if(!isChild(anchorCell,element))return;if(anchorCell.parentElement.cells(0).children.length>0&&anchorCell.parentElement.cells(0).children(0).getAttribute("FpSpread")=="Spread")return;if(!initialized||isactive&&element.document.FpActiveSheetView==element){paintSelectedCell(anchorCell,false);paintSelectedCell(anchorCell,true,true);paintAnchorCellHeader(true)}else updateSelectedCell(anchorCell,GetSelectedRanges(),false)}else updateSelectedCell(anchorCell,GetSelectedRanges(),false)}function updateSelectedCell(f,j,h){var e=getRowFromCell(f),d=getColFromCell(f),b=false,c=false;if(h)b=c=true;else for(var i=j||GetSelectedRanges(),g=0;g<i.length;g++){var a=i[g];if(a.anchor)continue;if(a.row==-1&&a.rowCount==-1&&a.col==-1&&a.colCount==-1){b=c=true;break}else{c=a.row==-1&&a.rowCount==-1||a.row<=e&&e<=a.row+a.rowCount;b=a.col==-1&&a.colCount==-1||a.col<=d&&d<=a.col+a.colCount}if(c&&b)break}!c&&paintHeaderSelection(e,d,1,1,false,false);!b&&paintHeaderSelection(e,d,1,1,false,true);paintSelectedCell(f,c&&b,h)}function ClearSelection(h,c){var d=getParentSpread();if(h==null&&d!=null&&d.getAttribute("hierView")=="true"){d.ClearSelection(null,c);return}var a=getViewport();if(frzRows==0&&frzCols==0&&a!=null&&a.rows.length>rowCount)for(var b=0;b<a.rows.length;b++)if(a.rows(b).cells.length>0&&a.rows(b).cells(0)!=null&&a.rows(b).cells(0).children.length>0){var e=a.rows(b).cells(0).children(0);e.getAttribute("FpSpread")=="Spread"&&typeof e.ClearSelection!="undefined"&&e.ClearSelection(true,c)}if(c==null||element!=c){doClearSelection();if(anchorCell!=null){if(operationMode=="RowMode"||operationMode=="SingleSelect"||operationMode=="ExtendedSelect"||operationMode=="MultiSelect"){var g=fpSpreadJS.getRowRangeFromCell(anchorCell);paintSelection(g.row,-1,g.rowCount,-1,false)}paintSelectedCell(anchorCell,false);paintAnchorCellHeader(false)}else{var f=getCellFromRowCol(1,0);f!=null&&paintSelectedCell(f,false)}paintFocusRect();selectedCols=[];saveData();dirty=true}}function SetSelectedRange(a,c,b,d,k){ClearSelection();var o=a,a=GetDisplayIndex(a),f,g;if(frzRows==0&&frzCols==0){var j=0,m=b,h=getViewport();if(h!=null)for(i=a;i<h.rows.length&&j<m;i++)if(IsChildSpreadRow(h,i))b++;else j++}anchorCell==null&&SetActiveCell(o,c);if(element.getAttribute("layoutMode")){if(c>=0&&b<0){if(d!=1)return;var n=getDisplayIndex(k),e=GetCellByRowCol(n,c);if(e!=null&&parseInt(e.getAttribute("col"))!=-1){c=parseInt(e.getAttribute("col"));g=parseInt(e.parentElement.getAttribute("row"));f=getColFromCell(e)}else return;paintMultipleRowSelection(g,f,1,d,true)}else if(a>=0&&d<0){if(b>parseInt(element.getAttribute("layoutRowCount")))return;var l=parseInt(getRowKeyFromRow(a)),a=parseInt(getFirstRowFromKey(l));updateAnchorCell(a,0,true);b=parseInt(element.getAttribute("layoutRowCount"));paintSelection(a,c,b,d,true)}else if(a>=0&&c>=0&&(d>1||b>1))return}else paintSelection(a,c,b,d,true);setSelection(a,c,b,d,null,g,f)}function AddSelection(b,d,a,c,k){var b=GetDisplayIndex(b),f,g;if(frzRows==0&&frzCols==0){var j=0,m=a,h=getViewport();if(h!=null)for(i=b;i<h.rows.length&&j<m;i++)if(IsChildSpreadRow(h,i))a++;else j++}if(element.getAttribute("layoutMode")){if(d>=0&&a<0){if(c!=1)return;var n=getDisplayIndex(k),e=GetCellByRowCol(n,d);if(e!=null&&parseInt(e.getAttribute("col"))!=-1){g=parseInt(e.parentElement.getAttribute("row"));f=getColFromCell(e);d=parseInt(e.getAttribute("col"))}else return;paintMultipleRowSelection(g,f,1,c,true)}else if(b>=0&&c<0){if(a>parseInt(element.getAttribute("layoutRowCount")))return;var l=parseInt(getRowKeyFromRow(b)),b=parseInt(getFirstRowFromKey(l));if(element.getAttribute("allowGroup")){ClearSelection();updateAnchorCell(b,0,true)}a=parseInt(element.getAttribute("layoutRowCount"));paintSelection(b,d,a,c,true)}else if(b>=0&&d>=0&&(c>1||a>1))return}else paintSelection(b,d,a,c,true);setSelection(b,d,a,c,true,g,f)}function selectRow(a,h,g,k){if((selectionBlockOptions&SelectionBlockOptions.Rows)==0&&operationMode=="Normal")return;var m=selectionUnit;if(m=="Column"){selectTable(g);return}selectStartRow=a;selectStartCol=-1;var d=getViewport();if(d==null)return;if(!k){var f=d.rows.length;if(getViewport2()!=null&&getViewport2().rows.length>f)f=getViewport2().rows.length;var c=0,b=getColGroup(d);if(b!=null)c=b.children.length;b=getColGroup(getViewport1());if(b!=null&&b.children.length>c)c=b.children.length;var l=d.parentElement.scrollLeft;if(a>=0&&a<f+frzRows)for(var e=0;e<frzCols+c;e++){var i=getCellFromRowCol(a,e);if(i!=null&&i.getAttribute("canFocus")!="false"&&i.offsetLeft>=l){updateAnchorCell(a,e,false);break}}}selectType="r";var j=h;if(element.getAttribute("layoutMode"))j=parseInt(element.getAttribute("layoutRowCount"));paintSelection(a,-1,j,-1,g);if(g){setSelection(a,-1,h,-1);paintFocusRect()}else{RemoveSelection(a,-1,h,-1);paintFocusRect()}}function selectColumn(d,h,f,k){if((selectionBlockOptions&SelectionBlockOptions.Columns)==0&&operationMode=="Normal")return;var l=selectionUnit;if(l=="Row"){selectTable(f);return}selectStartRow=-1;selectStartCol=d;var b=getViewport();if(b==null)return;if(!k){for(var a=0,j=b.parentElement.scrollTop-element.virtualTop,a=0;a<b.rows.length;a++){if(!b.rows(a).getAttribute("FpKey"))continue;if(b.rows(a).offsetTop>=j)break}a+=frzRows;var c=d;if(element.getAttribute("layoutMode")){var i=anchorCell;if(parseInt(anchorCell.getAttribute("col"))==-1)return;if(i){a=getRowFromCell(i);c=getColFromCell(i)}copymultiCol=true}var g=a;while(g<frzRows+b.rows.length){var e=getCellFromRowCol(g,c);if(e!=null&&!e.getAttribute("group")&&e.getAttribute("canFocus")!="false"&&e.offsetTop>=j&&e.parentNode.getAttribute("previewRow")==null){updateAnchorCell(g,c,false,true);break}g+=element.getAttribute("layoutMode")?parseInt(element.getAttribute("layoutRowCount")):1}}selectType="c";if(!element.getAttribute("layoutMode"))paintSelection(-1,d,-1,h,f);else paintMultipleRowSelection(a,c,1,h,f);if(f){setSelection(-1,d,-1,h,null,a,c);addColSelection(d)}}function adjustAnchorCell(h){var b=getViewport();if(b==null)return-1;for(var a=0,g=b.parentElement.scrollTop-element.virtualTop,a=0;a<b.rows.length;a++){if(!b.rows(a).getAttribute("FpKey"))continue;if(b.rows(a).offsetTop>=g)break}a+=frzRows;var c=h;if(element.getAttribute("layoutMode")){var f=anchorCell;if(parseInt(anchorCell.getAttribute("col"))==-1)return;if(f){a=getRowFromCell(f);c=getColFromCell(f)}copymultiCol=true}var e=a;while(e<frzRows+b.rows.length){var d=getCellFromRowCol(e,c);if(d!=null&&!d.getAttribute("group")&&d.getAttribute("canFocus")!="false"&&d.offsetTop>=g){updateAnchorCell(e,c,false,true);break}e+=element.getAttribute("layoutMode")?parseInt(element.getAttribute("layoutRowCount")):1}return c}function addColSelection(b){for(var c=0,a=0;a<selectedCols.length;a++){if(selectedCols[a]==b)return;if(b>selectedCols[a])c=a+1}selectedCols.length++;for(var a=selectedCols.length-1;a>c;a--)selectedCols[a]=selectedCols[a-1];selectedCols[c]=b}function isColSelected(b){for(var a=0;a<selectedCols.length;a++)if(selectedCols[a]==b)return true;return false}function syncColSelection(){selectedCols=[];for(var d=GetSelectedRanges(),b=0;b<d.length;b++){var a=d[b];if(a.type=="Column")for(var c=a.col;c<a.col+a.colCount;c++)addColSelection(c)}}function initMovingCol(c,p,m){var o=window.event.srcElement;if(o.tagName=="INPUT"||o.tagName=="TEXTAREA"||o.tagName=="SELECT")return;if(element.getAttribute("layoutMode")&&c==-1)return;if(element.getAttribute("OperationMode")!="Normal"){selectedCols=[];selectedCols.push(c)}if(p){dragCol=c;dragViewCol=getColByKey(c)}else{if(element.getAttribute("layoutMode"))dragCol=getColTemplateRowFromGroupCell(c);else dragCol=parseInt(GetSheetColIndex(c));dragViewCol=c}var a=getMovingCol(),i=element.document;if(!i.createElement)i=window.document;if(p){ClearSelection();a.innerHTML="";var g=i.createElement("DIV");g.innerHTML=m.innerHTML;g.style.borderTop="0px solid";g.style.borderLeft="0px solid";g.style.borderRight="#808080 1px solid";g.style.borderBottom="#808080 1px solid";g.style.width=Math.max(getPreferredCellWidth(m),80)+"px";a.appendChild(g);if(element.getAttribute("DragColumnCssClass")==null){a.style.backgroundColor=m.currentStyle.backgroundColor;a.style.paddingTop=1;a.style.paddingBottom=1}}else{var q=0;a.innerHTML="";for(var t=i.createElement("table"),x=t.insertRow(),b=0;b<selectedCols.length;b++){var d=x.insertCell(),h,l;if(element.getAttribute("layoutMode")){h=getRowTemplateRowFromGroupCell(c,true);l=getColTemplateRowFromGroupCell(c)}else{if(element.columnHeaderAutoTextIndex!=null)h=parseInt(element.columnHeaderAutoTextIndex);else h=getColHeader().rows.length-1;l=selectedCols[b]}var f=getHeaderCellFromRowCol(h,l,true);if(f.getAttribute("FpCellType")=="ExtenderCellType"&&f.getElementsByTagName("DIV").length>0){var u=getEditor(f),v=getFunction("ExtenderCellType_getEditorValue");if(u!=null&&v!=null)d.innerHTML=v(u)}else d.innerHTML=f.innerHTML;d.style.cssText=f.style.cssText;d.style.textAlign=f.currentStyle.textAlign;d.style.borderTop="0px solid";d.style.borderLeft="0px solid";d.style.borderRight="#808080 1px solid";d.style.borderBottom="#808080 1px solid";var w=Math.max(getPreferredCellWidth(f)+6,80);d.style.width=w+"px";q+=w}a.appendChild(t);if(element.getAttribute("DragColumnCssClass")==null){a.style.backgroundColor=element.selectedBackColor;a.style.tableLayout="fixed";a.style.width=q+"px"}}var n=-1;if(!xhtml)n+=parseInt(element.style.borderWidth);a.style.posTop=window.event.clientY-getOffsetTop(element,element.document.body)+getScrollTop(element)-n;a.style.posLeft=window.event.clientX-getOffsetLeft(element,element.document.body)+getScrollLeft(element)-n;selectedCols.context=[];var r=selectedCols.context,k=0,e=getColGroup(getFrozColHeader());if(e!=null)for(var b=0;b<e.children.length;b++){var j=parseInt(e.children[b].width),s=parseInt(e.children[b].getAttribute("FpCol"));r.push({left:k,width:j,colKey:s,frozen:true});k+=j}e=getColGroup(getColHeader());if(e!=null)for(var b=0;b<e.children.length;b++){var j=parseInt(e.children[b].width),s=parseInt(e.children[b].getAttribute("FpCol"));r.push({left:k,width:j,colKey:s});k+=j}}function selectTable(h){if((selectionBlockOptions&SelectionBlockOptions.Sheet)==0&&operationMode=="Normal")return;var f=-1,e=-1,b=getViewport(),m=b.parentElement.scrollTop-element.virtualTop,l=b.parentElement.scrollLeft;if(h){ClearSelection();for(var a=null,i=false,c=0;c<b.rows.length;c++){var g=c+frzRows;if(!b.rows[c].getAttribute("FpKey"))continue;for(var k=parseInt(b.getAttribute("cols")),d=0;d<k;d++){a=getCellFromRowCol(g,d);if(a!=null&&!a.getAttribute("group")&&a.offsetTop>=m&&a.offsetLeft>=l)if(!(a.getAttribute("canFocus")=="false")){updateAnchorCell(g,d,false);f=g;e=d;c=b.rows.length;i=true;break}}if(i)break}}selectType="t";paintSelection(-1,-1,-1,-1,false);h&&setSelection(-1,-1,-1,-1);var j=null;if(f!=-1&&e!=-1){j=getCellFromRowCol(f,e);j.style.backgroundColor=selectedBackColor}}function getSpanCell(e,d,b){if(b==null)return null;for(var g=b.length,c=0;c<g;c++){var a=b[c],f=a.row<=e&&e<a.row+a.rowCount&&a.col<=d&&d<a.col+a.colCount;if(f)return a}return null}function isCovered(c,b,d){var a=getSpanCell(c,b,d);return a==null?false:a.row==c&&a.col==b?false:true}function isSpanCell(f,e){for(var d=spanCells.length,b=0;b<d;b++){var a=spanCells[b],c=a.row==f&&a.col==e;if(c)return a}return null}function selectRange(h,g,e,d,b){var f=selectionUnit;if(f=="Row"){selectRow(h,e,b,false);return}else if(f=="Column"){selectColumn(g,d,b,false);return}selectType="";if(b){setSelection(h,g,e,d);paintAnchorCell();if(anchorCell!=null){var c=anchorCell.getElementsByTagName("SELECT");if(c!=null&&c.length>0)return}detachOnActiveEvents();var i=getTopSpread(element),a=element.document;if(!a.all)a=window.document;textBox=a.all(i.id+"_textBox");if(textBox!=null){textBox.value="123";try{textBox.focus()}catch(j){$$.DEBUG.Log(j,"selectRange")}}attachOnActiveEvents()}}function getSpanCells(a){return a==getViewport()||a==getViewport0()||a==getViewport1()||a==getViewport2()?spanCells:a==getFrozColHeader()||a==getColHeader()?colSpanCells:a==getFrozRowHeader()||a==getRowHeader()?rowSpanCells:null}function updateRangeSelection(g,f,j,i,h,a){if(typeof a=="undefined")a=getViewport();if(a==null)return;for(var b=g;b<g+j&&b<a.rows.length;b++){var d=a==getViewport()||a==getViewport2()?b+frzRows:b;if(IsChildSpreadRow(a,d))continue;for(var c=getCellIndex(d,f,getSpanCells(a)),e=0;e<i;e++){if(isCovered(d,f+e,getSpanCells(a)))continue;c<a.rows(b).cells.length&&paintSelectedCell(a.rows(b).cells(c),h);c++}}}function getColFromCell(a){if(a==null||a.style.display=="none"||a.parentElement==null)return-1;var b=getRowFromCell(a);return a.parentElement.parentElement==null?-1:a.parentElement.viewport!=null?getColIndex(b,a.cellIndex,getSpanCells(a.parentElement.viewport),a.parentElement.viewport==getViewport2(),a.parentElement.viewport==getFrozRowHeader()||a.parentElement.viewport==getRowHeader()):getColIndex(b,a.cellIndex,getSpanCells(a.parentElement.parentElement.parentElement),inFrozCols(a),isChild(a,getFrozRowHeader())||isChild(a,getRowHeader()))}function getRowFromCell(a){if(a==null||a.parentElement==null)return-1;var b=a.parentElement.rowIndex;if(frzRows>0&&(smartPaint&&(isChild(a,vpList.table)||isChild(a,vp2List.table)||isChild(a,rhList.table))||isChild(a,getViewport2())||isChild(a,getViewport())||isChild(a,getRowHeader())))b+=frzRows;return b}function getColIndex(j,f,i,h,g){var e=0,a=GetColCount(),d=frzCols;if(h){a=frzCols;d=0}else if(g){d=0;var b=null;if(getFrozRowHeader()!=null)b=getColGroup(getFrozRowHeader());else if(getRowHeader()!=null)b=getColGroup(getRowHeader());if(b!=null)a=b.children.length}for(var c=d;c<a;c++){if(isCovered(j,c,i))continue;if(e==f)return c;e++}return a}function getCellIndex(i,a,b){var d="false",h=getViewport();if(h!=null)d=h.parentNode.getAttribute("hiddenCells");if(d=="true"&&b==spanCells)return b!=rowSpanCells&&a>=frzCols?a-frzCols:a;else{var g=0,e=a;if(b!=rowSpanCells&&a>=frzCols){g=frzCols;e=a-frzCols}for(var f=0,c=0;c<e;c++){if(isCovered(i,g+c,b))continue;f++}return f}}function nextCell(j,n,y){var h=window.event;if(h!=null&&h.altKey)return;if(n==null)n=h!=null&&h.shiftKey;var c=getScrollvp();if(c==null)c=getParent(getViewport());if(anchorCell==null){var l=fireActiveCellChangingEvent(0,0,element);if(!l){var o=getTopSpread(element);if(o!=element)l=o.fireActiveCellChangingEvent(0,0,element)}if(!l){ClearSelection();leadingCellCol=0;leadingCellRow=0;updateAnchorCell(0,0);enableButtons();fireActiveCellChangedEvent(0,0,element);o!=element&&o.fireActiveCellChangedEvent(0,0,element);if(h!=null)h.returnValue=false}return}if(n&&j!=tab){if(operationMode=="RowMode"||operationMode=="SingleSelect"||operationMode=="MultiSelect"||operationMode=="Normal"&&element.getAttribute("SelectionPolicy")=="Single")return;var e=getSpanCell(leadingCellRow,leadingCellCol,getSpanCells(getViewportFromCell(anchorCell)));switch(j){case right:var a=leadingCellRow,d=leadingCellCol+1;if(e!=null)d=e.col+e.colCount;if(d>GetColCount()-1)return;leadingCellCol=d;leadingCell=getCellFromRowCol(a,d);select(anchorCell,leadingCell);break;case left:var a=leadingCellRow,d=leadingCellCol-1;if(e!=null)d=e.col-1;e=getSpanCell(a,d,getSpanCells(getViewportFromCell(anchorCell)));if(e!=null)if(isSpanCell(a,e.col))d=e.col;if(d<0)return;leadingCellCol=d;leadingCell=getCellFromRowCol(a,d);select(anchorCell,leadingCell);break;case down:var a=leadingCellRow+1,d=leadingCellCol;if(e!=null)a=e.row+e.rowCount;a=getNextRow(a);if(a>GetRowCountInternal()-1)return;leadingCellRow=a;leadingCell=getCellFromRowCol(a,d);select(anchorCell,leadingCell);paintSelections(true);break;case up:var a=leadingCellRow-1,d=leadingCellCol;if(e!=null)a=e.row-1;a=getPrevRow(a);e=getSpanCell(a,d,getSpanCells(getViewportFromCell(anchorCell)));if(e!=null)if(isSpanCell(e.row,d))a=e.row;if(a<0)return;leadingCellRow=a;leadingCell=getCellFromRowCol(a,d);select(anchorCell,leadingCell);paintSelections(true);break;case home:if(anchorCell.parentElement.rowIndex>=0){leadingCellCol=0;leadingCell=getCellFromRowCol(leadingCellRow,leadingCellCol);select(anchorCell,leadingCell)}break;case end:if(anchorCell.parentElement.rowIndex>=0){leadingCellCol=GetColCount()-1;leadingCell=getCellFromRowCol(leadingCellRow,leadingCellCol);select(anchorCell,leadingCell)}break;case pdn:if(getViewport()!=null&&leadingCellRow>=0){var p=0;for(a=leadingCellRow;a<getViewport().rows.length;a++){var f=getViewport().rows(a).offsetHeight;if(f==0)f=getViewport().rows(a).style.posHeight;p+=f;if(p>getViewport().parentElement.offsetHeight)break}a=getNextRow(a);if(a<getViewport().rows.length){var i=getScrollvp();if(i==null)i=getViewport().parentElement;i.scrollTop=getViewport().rows(a-frzRows).offsetTop;leadingCellRow=a}else{a=GetRowCountInternal()-1;leadingCellRow=a}leadingCell=getCellFromRowCol(leadingCellRow,leadingCellCol);select(anchorCell,leadingCell)}break;case pup:if(getViewport()!=null&&leadingCellRow>=0){a=0;for(a=0;a<getViewport().rows.length;a++){var f=getViewport().rows(a).offsetHeight;if(f==0)f=getViewport().rows(a).style.posHeight;if(getViewport().rows(a).offsetTop+f>getViewport().parentElement.scrollTop)break}if(a<getViewport().rows.length){var r=0;while(a>=0){var f=getViewport().rows(a).offsetHeight;if(f==0)f=getViewport().rows(a).style.posHeight;r+=f;if(r>getViewport().parentElement.offsetHeight)break;a--}var z=frzRows;if(a<0){z=0;a=0}else a=getPrevRow(a);if(a>=0){var i=getScrollvp();if(i==null)i=getViewport().parentElement;i.scrollTop=frzRows>a?element.virtualTop:element.virtualTop+getViewport().rows(a).offsetTop;leadingCellRow=z+a;leadingCell=getCellFromRowCol(leadingCellRow,leadingCellCol);select(anchorCell,leadingCell)}}}}syncColSelection()}else{var x=j==tab;if(j==tab){if(n)j=left;else j=right;if(h!=null)h.returnValue=false}var E=anchorCell,a,d;if(n){a=leadingCellRow;d=leadingCellCol}else if(getCellFromRowCol(leadingCellRow,leadingCellCol)==anchorCell){a=leadingCellRow;d=leadingCellCol}else{a=getRowFromCell(anchorCell);d=getColFromCell(anchorCell)}switch(j){case right:moveRight(a,d,x);break;case left:moveLeft(a,d,x);break;case down:moveDown(a,d,y,false,true);break;case up:moveUp(a,d,y,false,true);break;case home:anchorCell.parentElement.rowIndex>=0&&moveRight(a,-1,false);break;case end:anchorCell.parentElement.rowIndex>=0&&moveLeft(a,GetColCount(),false);break;case pdn:if(getViewport()!=null&&leadingCellRow>=0){var p=0;for(a=anchorCell.parentElement.rowIndex;a<getViewport().rows.length;a++){var f=getViewport().rows(a).offsetHeight;if(f==0)f=getViewport().rows(a).style.posHeight;p+=f;if(p>getViewport().parentElement.offsetHeight)break}a=getNextRow(a);if(a<getViewport().rows.length){var t=getViewport().rows(a).offsetTop;if(element.getAttribute("virtualPaging")=="true"){var m=element.document;if(!m.getElementById)m=window.document;var v=m.getElementById(element.id+"_VirtualPaging_Top");t+=v.offsetHeight}var i=getScrollvp();if(i==null)i=getViewport().parentElement;i.scrollTop=t;var q=getCellFromRowCol(frzRows+a,leadingCellCol);q.getAttribute("canFocus")!="false"&&updateLeadingCell(frzRows+a,leadingCellCol)}else{a=getPrevRow(parseInt(element.RowCount)-1);var q=getCellFromRowCol(frzRows+a,leadingCellCol);q.getAttribute("canFocus")!="false"&&updateLeadingCell(frzRows+a,leadingCellCol)}}break;case pup:if(getViewport()!=null&&leadingCellRow>=0){var s=0;if(element.getAttribute("virtualPaging")=="true"){var m=element.document;if(!m.getElementById)m=window.document;var v=m.getElementById(element.id+"_VirtualPaging_Top");s=v.offsetHeight}a=0;for(a=0;a<getViewport().rows.length;a++){var f=getViewport().rows(a).offsetHeight;if(f==0)f=getViewport().rows(a).style.posHeight;if(getViewport().rows(a).offsetTop+f>getViewport().parentElement.scrollTop-s)break}if(a<getViewport().rows.length){var r=0;while(a>=0){var f=getViewport().rows(a).offsetHeight;if(f==0)f=getViewport().rows(a).style.posHeight;r+=f;if(r>getViewport().parentElement.offsetHeight)break;a--}a=getPrevRow(a);var l=true;if(frzRows>a&&a>=0){var i=getScrollvp();if(i==null)i=getViewport().parentElement;i.scrollTop=element.virtualTop;var q=getCellFromRowCol(frzRows+a,leadingCellCol);q.getAttribute("canFocus")!="false"&&updateLeadingCell(a,leadingCellCol);l=false}if(a>=0&&l){var t=getViewport().rows(a).offsetTop+s,i=getScrollvp();if(i==null)i=getViewport().parentElement;i.scrollTop=t;var q=getCellFromRowCol(frzRows+a,leadingCellCol);q.getAttribute("canFocus")!="false"&&updateLeadingCell(frzRows+a,leadingCellCol)}}}}if(E!=anchorCell&&anchorCell!=null){updateCmdBtnState("Update",false);operationMode=="Normal"&&fireSelectionChangedEvent(element);fpSpreadJS.keepGeneratedSelectionFromAnchorCell();var B=GetSheetIndex(getRowFromCell(anchorCell)),A=getColFromCell(anchorCell),C=parseInt(anchorCell.parentElement.getAttribute("row"));fireActiveCellChangedEvent(B,A,element,C);var o=getTopSpread(element);o!=element&&o.fireActiveCellChangedEvent(B,A,element,C)}operationMode=="ExtendedSelect"&&selectRow(leadingCellRow,1,true,true)}ignoreVirtualPaging=true;var b=getCellFromRowCol(leadingCellRow,leadingCellCol);if((isChild(b,getViewport())||isChild(b,getViewport1()))&&b.offsetWidth<c.clientWidth){if(j==left||j==home)if(b.offsetLeft<c.scrollLeft)if(b.cellIndex>0)c.scrollLeft=anchorCell.offsetLeft;else c.scrollLeft=0;else if(b.offsetLeft>=c.scrollLeft+c.clientWidth)c.scrollLeft=anchorCell.offsetLeft+anchorCell.offsetWidth-c.clientWidth;if(j==right||j==down)if(b.offsetLeft+b.offsetWidth>c.scrollLeft+c.clientWidth)c.scrollLeft=b.offsetLeft+b.offsetWidth-c.clientWidth;else if(b.offsetLeft<c.scrollLeft)if(b.cellIndex>0)c.scrollLeft=anchorCell.offsetLeft;else c.scrollLeft=0}syncScrollByCell(b,j);var k=getScrollvp();if(k==null)k=getParent(getViewport());c=getParent(getViewport());if(b!=null&&b.offsetWidth<c.clientWidth){if((isChild(b,c)||isChild(b,getViewport1()))&&b.offsetLeft+b.offsetWidth>c.scrollLeft+c.clientWidth)k.scrollLeft=b.offsetLeft+b.offsetWidth-c.clientWidth;if(getViewport1()!=null&&isChild(b,getViewport1())&&b.offsetLeft+b.offsetWidth>getViewport1().parentElement.scrollLeft+getViewport1().parentElement.clientWidth)k.scrollLeft=b.offsetLeft+b.offsetWidth-getViewport1().parentElement.clientWidth}if((isChild(b,c)||isChild(b,getViewport2()))&&b.offsetTop+b.offsetHeight>k.scrollTop+c.clientHeight&&b.offsetHeight<c.clientHeight)k.scrollTop=b.offsetTop+b.offsetHeight-c.clientHeight;if(getViewport2()!=null&&isChild(b,getViewport2())&&b.offsetTop+b.offsetHeight>getViewport2().parentElement.scrollTop+getViewport2().parentElement.clientHeight&&b.offsetHeight<getViewport2().parentElement.clientHeight)k.scrollTop=b.offsetTop+b.offsetHeight-getViewport2().parentElement.clientHeight;if(isChild(b,getViewport())||isChild(b,getViewport2())){if(b.offsetTop<c.scrollTop-element.virtualTop)k.scrollTop=b.offsetTop+element.virtualTop;if(getViewport2()!=null&&b.offsetTop<getViewport2().parentElement.scrollTop-element.virtualTop)k.scrollTop=b.offsetTop+element.virtualTop}if(h!=null)h.returnValue=false;enableButtons();saveData();var l=true;if(anchorCell!=null){var g=getEditor(anchorCell);if(g!=null){scrollView();var u=h!=null&&(h.type=="keydown"||h.type=="keyup"||h.type=="keypress"),D=h==null?true:u&&j!=h.keyCode;if(!D&&n&&u&&h.keyCode!=tab)g.blur();else{var w=getCellType(anchorCell);if(!g.disabled&&(w=="MultiColumnComboBoxCellType"||w=="ExtenderCellType"&&g.getElementsByTagName("INPUT").length>0||g.type==null||g.type=="checkbox"||g.type=="radio"||g.type=="text"||g.type=="password"||g.tagName=="TEXTAREA"||g.tagName=="SELECT")){editing=true;setEditorFocus(g);editor=g;editingValue=getEditorValue(g)}else setEditorFocus(g);l=false}if(isEditModeReplace(anchorCell))g.select&&g.select()}}l&&focus(null,element.getAttribute("layoutMode")!=null);setTimeout(function(){ignoreVirtualPaging=false},100)}function syncScrollByCell(b,d){if(isChild(b,getViewport())||isChild(b,getViewport2())){var a=getScrollvp();if(a==null)a=getParent(getViewport());if(a.offsetHeight<getViewport().clientHeight||d==up){var c=getViewport().parentElement.clientHeight;if(d==up||d==left){if(b.parentElement.rowIndex>0){var f=b.parentElement.offsetTop+element.virtualTop-a.scrollTop,e=f+b.parentElement.offsetHeight;if(e>c)a.scrollTop=a.scrollTop+e-c;else if(f<0)a.scrollTop=a.scrollTop-(a.scrollTop-element.virtualTop-b.parentElement.offsetTop)}else a.scrollTop=element.virtualTop;if(b.offsetLeft<a.scrollLeft)a.scrollLeft=b.offsetLeft}var h=getViewport2(),g=getViewport().offsetHeight;if(h!=null&&g<h.offsetHeight)g=h.offsetHeight;var c=getViewport().parentElement.clientHeight;if(d==down||d==right){if(b.parentElement.rowIndex<b.parentElement.parentElement.rows.length-1){var f=b.parentElement.offsetTop+element.virtualTop-a.scrollTop,e=f+b.parentElement.offsetHeight;if(e>c)a.scrollTop=a.scrollTop+e-c;else if(f<0)a.scrollTop=a.scrollTop-(a.scrollTop-element.virtualTop-b.parentElement.offsetTop)}else a.scrollTop=element.virtualTop+g-c;if(b.offsetLeft<a.scrollLeft)a.scrollLeft=b.offsetLeft}}}}function moveUp(a,b,h,e,d){var g=GetRowCountInternal(),k=GetColCount(),f=1,i=false,c=getSpanCell(a,b,getSpanCells(getViewportFromCell(anchorCell)));if(c!=null){a=c.row-1;if(c.col!=b)f=b-c.col+1}else a--;a=getPrevRow2(a,leadingCellCol,e,d);if(a<0&&h){if(b==f-1){a=getPrevCellRowIndex(g-1,k-1,e,d);b=getPrevCellColIndex(g-1,k-1,e,d)}else{a=getPrevCellRowIndex(g-1,b-f,e,d);b=getPrevCellColIndex(g-1,b-f,e,d)}i=true}if(a>=0){if(h&&i){var c=getSpanCell(a,b,spanCells);if(c!=null){a=c.row;b=c.col;var j=getCellFromRowCol(a,b);if(j.getAttribute("TabStop")=="false"||j.getAttribute("canFocus")=="false"){moveUp(a,b,h,e,d);return}}}updateLeadingCell(a,b)}}function moveDown(a,b,h,d,c){var g=GetRowCountInternal(),i=GetColCount(),f=1,e=getSpanCell(a,b,getSpanCells(getViewportFromCell(anchorCell)));if(e!=null){a=e.row+e.rowCount;f=e.colCount}else a++;a=getNextRow2(a,b,d,c);if(a==g)if(h)if(b==i-f){a=getNextCellRowIndex(0,0,d,c);b=getNextCellColIndex(0,0,d,c)}else{a=getNextCellRowIndex(0,b+f,d,c);b=getNextCellColIndex(0,b+f,d,c)}a<g&&updateLeadingCell(a,b)}function moveLeft(a,b,c){var f=a,h=GetRowCountInternal(),g=GetColCount();if(typeof c=="undefined")c=true;b=getPrevCol(a,b,c,true);if(b<0){b=g-1;a--;if(a<0)a=h-1;a=getPrevRow(a);leadingCellRow=a}var d=getCellFromRowCol(a,b);if(anchorCell!=d&&(c&&d.getAttribute("TabStop")=="false"||d.getAttribute("canFocus")=="false"))moveLeft(a,b,c);else{var e=updateLeadingCell(leadingCellRow,b);if(e)leadingCellRow=f}}function getPrevCol(d,g,f,e){var b=null,a=g,i=GetColCount();while(a>=0){var c=getSpanCell(d,a,getSpanCells(getViewportFromCell(anchorCell)));if(c!=null)a=c.col-1;else a--;b=getCellFromRowCol(d,a);if(b==null)break;var h=f&&b.getAttribute("TabStop")=="false"||e&&b.getAttribute("canFocus")=="false";if(!h)break}return a}function moveRight(b,f,d){var e=b,a=moveRightInternal(b,f,d);if(a!=null){var c=updateLeadingCell(a.row,a.col);if(c)leadingCellRow=e}}function moveRightInternal(a,b,c){var d=GetRowCountInternal(),h=GetColCount();if(d==0||h==0)return null;var g=a>-1&&a<d?a:-1,f=b>-1&&b<h?b:-1,i=-1;if(typeof c=="undefined")c=true;do{if(a>=d){b=0;a=0;a=getNextRow(a);leadingCellRow=a}else{b=getNextCol(a,b,c,true);if(b>=h){b=0;a++;if(a>=d)a=0;a=getNextRow(a);leadingCellRow=a}}if(g<0||f<0){g=a;f=b}var e=getCellFromRowCol(a,b);if(e!=null&&e.getAttribute("canFocus")!="false"&&!(c&&e.getAttribute("TabStop")=="false"))return{row:a,col:b};i++}while(i==0||g!=a||f!=b);return null}function getPrevCellRowIndex(g,c,e,d){for(var h=GetColCount(),f=GetRowCountInternal(),b=g,a=c,a=c;a>=0;a--){if(a==c)b=getPrevRow2(g,a,e,d);else b=getPrevRow2(f-1,a,e,d);if(b>=0)break}if(b<0)for(a=h-1;a>c;a--){b=getPrevRow2(f-1,a,e,d);if(b>=0)break}return b}function getPrevCellColIndex(g,c,e,d){for(var h=GetColCount(),f=GetRowCountInternal(),b=g,a=c,a=c;a>=0;a--){if(a==c)b=getPrevRow2(g,a,e,d);else b=getPrevRow2(f-1,a,e,d);if(b>=0)break}if(b<0)for(a=h-1;a>c;a--){b=getPrevRow2(f-1,a,e,d);if(b>=0)break}return a}function getNextCellRowIndex(g,f,d,c){for(var h=GetColCount(),e=GetRowCountInternal(),b=g,a=0,a=f;a<h;a++){if(a==f)b=getNextRow2(g,a,d,c);else b=getNextRow2(0,a,d,c);if(b<e)break}if(b==e)for(a=0;a<f;a++){b=getNextRow2(0,a,d,c);if(b<e)break}return b}function getNextCellColIndex(g,f,d,c){for(var h=GetColCount(),e=GetRowCountInternal(),b=g,a=0,a=f;a<h;a++){if(a==f)b=getNextRow2(g,a,d,c);else b=getNextRow2(0,a,d,c);if(b<e)break}if(b==e)for(a=0;a<f;a++){b=getNextRow2(0,a,d,c);if(b<e)break}return a}function getNextCol(d,h,f,e){var b=null,a=h,g=GetColCount();while(a<g){var c=getSpanCell(d,a,getSpanCells(getViewportFromCell(anchorCell)));if(c!=null)a=c.col+c.colCount;else a++;b=getCellFromRowCol(d,a);if(b==null)break;var i=f&&b.getAttribute("TabStop")=="false"||e&&b.getAttribute("canFocus")=="false";if(!i)break}return a}function updateLeadingCell(b,a){var c=0;if(element.getAttribute("layoutMode")){c=getRowFromViewPort(b,a);var e=getCellFromRowCol(c,a);if(e)c=e.parentElement.getAttribute("row")}var d=fireActiveCellChangingEvent(b,a,element,c);if(!d){var f=getTopSpread(element);if(f!=element)d=f.fireActiveCellChangingEvent(b,a,element,c)}if(!d){var g=operationMode;g!="MultiSelect"&&ClearSelection();leadingCellCol=a;leadingCellRow=b;selectStartCol=a;selectStartRow=b;updateAnchorCell(b,a,null,false,element.getAttribute("layoutMode")!=null)}return d}function getPrevRow2(g,e,d,c){var b=null,a=g;while(a>=0){a=getPrevRow(a);b=getCellFromRowCol(a,e);var f=d&&b.getAttribute("TabStop")=="false"||c&&b.getAttribute("canFocus")=="false";if(!f)break;a=a-1}return a}function getPrevRow(a){if(a<0)a=0;var b=getViewport();if(a<frzRows){b=getViewport0();if(b==null)b=getViewport1()}if(frzCols==0&&frzRows==0&&b!=null)while(a>0&&b.rows(a).cells.length>0)if(IsChildSpreadRow(b,a))a--;else break;var d=0;if(a>=frzRows){a=a-frzRows;d=frzRows}if(frzCols<GetColCount()){var c=getViewport2();while((c==null||a<c.rows.length&&c.rows(a).cells.length==0)&&b!=null&&a>0&&b.rows(a).cells.length==0)a--}if(b!=null&&a<b.rows.length)if(b.rows(a).getAttribute("previewRow")=="true")a--;return a+d}function getNextRow2(h,f,e,d){var b=null,a=h,c=GetRowCount();while(a<c){a=getNextRow(a);if(a>=c)break;b=getCellFromRowCol(a,f);var g=e&&b.getAttribute("TabStop")=="false"||d&&b.getAttribute("canFocus")=="false";if(!g)break;a=a+1}return a}function getNextRow(a){var b=getViewport();if(a<frzRows){b=getViewport0();if(b==null)b=getViewport1()}if(frzCols==0&&frzRows==0&&b!=null)while(b!=null&&a<b.rows.length)if(IsChildSpreadRow(b,a))a++;else break;var d=0;if(a>=frzRows){a=a-frzRows;d=frzRows}if(frzCols<GetColCount()){var c=getViewport2();while((c==null||a<c.rows.length&&c.rows(a).cells.length==0)&&b!=null&&a<b.rows.length&&b.rows(a).cells.length==0)a++}if(b!=null&&a<b.rows.length)if(b.rows(a).getAttribute("previewRow")=="true")a++;return a+d}function fireActiveCellChangingEvent(c,f,b,d){if($$.browser.quirksMode){var a=createEventObject();a.spread=b;a.cancel=false;a.cmdID=element.id;if(b!=null)a.row=b.GetSheetIndex(c);else a.row=GetSheetIndex(c);a.col=f;if(element.getAttribute("layoutMode"))a.innerRow=d;ActiveCellChanging.fire(a)}else{var e={spread:element,cancel:false,cmdID:element.id,row:b!=null?b.GetSheetIndex(c):GetSheetIndex(c),col:f};if(element.getAttribute("layoutMode"))e.innerRow=d;var a=$$.utils.createEvent("ActiveCellChanging",false,true,e);element.dispatchEvent(a)}return a.cancel}function fireActiveCellChangedEvent(d,c,f,e){if($$.browser.quirksMode){var a=createEventObject();a.spread=f;a.cmdID=element.id;a.row=a.Row=d;a.col=a.Col=c;if(element.getAttribute("layoutMode"))a.innerRow=a.InnerRow=e;ActiveCellChanged.fire(a)}else{var g=$$.utils,b={spread:f,cmdID:element.id,row:d,Row:d,col:c,Col:c};if(element.getAttribute("layoutMode"))b.innerRow=b.InnerRow=e;var a=g.createEvent("ActiveCellChanged",false,true,b);element.dispatchEvent(a)}editModePermanent&&doGetFocus()}function fireDataChangedEvent(b,f,e,d,c){if($$.browser.quirksMode){var a=createEventObject();a.spread=e;a.cell=b;a.cellValue=f;a.row=d;a.col=c;DataChanged.fire(a)}else{var g={spread:e,cell:b,cellValue:f,row:d,col:c},a=$$.utils.createEvent("DataChanged",false,true,g);element.dispatchEvent(a)}}function fireSelectionChangedEvent(b){if(ignoreFireSelectionChanged)return;if($$.browser.quirksMode){var a=createEventObject();a.spread=b;SelectionChanged.fire(a)}else{var c={spread:b},a=$$.utils.createEvent("SelectionChanged",false,true,c);element.dispatchEvent(a)}}function fireEditStartEvent(d,c,b,e){if($$.browser.quirksMode){var a=createEventObject();a.spread=e;a.cell=b;a.row=d;a.col=c;a.cancel=false;EditStart.fire(a)}else{var f={spread:e,cell:b,row:d,col:c,cancel:false},a=$$.utils.createEvent("EditStart",false,true,f);element.dispatchEvent(a)}return a.cancel}function fireEditStoppedEvent(b,c){if($$.browser.quirksMode){var a=createEventObject();a.spread=c;a.cell=b;EditStopped.fire(a)}else{var d={spread:c,cell:b},a=$$.utils.createEvent("EditStopped",false,true,d);element.dispatchEvent(a)}}function GetSheetRowIndex(a){a=GetDisplayIndex(parseInt(a));if(a<0)return-1;var b=null;if(frzRows>0){if(a>=frzRows&&getViewport()!=null)b=getViewport().rows(a-frzRows);else if(a<frzRows&&getViewport1()!=null){var c=getViewport1();b=c.rows(a)!=null?c.rows(a):c.rows[a]}}else b=getViewport().rows(a);return b!=null?b.getAttribute("FpKey"):-1}function GetSheetColIndex(c,d){var a=-1;if(element.getAttribute("layoutMode")){var e=getDisplayIndex(d),b=GetCellByRowCol(e,c);if(b!=null)a=parseInt(b.getAttribute("col"))}else a=element.GetColKeyFromCol(c);return a}function GetCellByRowCol(a,b){a=GetDisplayIndex(a);return getCellFromRowCol(a,b)}function getHeaderCellFromRowCol(a,c,f){if(a<0||c<0)return null;var b=null;if(f)if(c<frzCols)b=getFrozColHeader();else b=getColHeader();else if(a<frzRows)b=getFrozRowHeader();else b=getRowHeader();var d=getSpanCell(a,c,getSpanCells(b));if(d!=null){a=d.row;c=d.col}var e=getCellIndex(a,c,getSpanCells(b));if(!f)if(a>=frzRows){a-=frzRows;if(b.rows(a).rowHolder)return rhList.getRow(a).cells(e)}return b.rows(a).cells(e)}function getCellFromRowCol(a,c,e){if(a<0||c<0)return null;var b=null;if(a<frzRows)if(c<frzCols)b=getViewport0();else b=getViewport1();else if(c<frzCols)b=getViewport2();else b=getViewport();if(b.parentNode==null)return;var f=getSpanCell(a,c,spanCells);if(f!=null){a=f.row;c=f.col}var d=0,g="false";if(b!=null)g=b.parentNode.getAttribute("hiddenCells");if(e!=null&&g!="true"){if(e.cellIndex<e.parentElement.cells.length-1)d=e.cellIndex+1}else d=getCellIndex(a,c,spanCells);if(a>=frzRows){a-=frzRows;if(a>=0&&a<b.rows.length&&b.rows(a).rowHolder)if(b==getViewport())return vpList.getRow(a).cells(d);else if(b==getViewport2())return vp2List.getRow(a).cells(d)}return a>=0&&a<b.rows.length?b.rows(a).cells(d):null}function getFirstCellFromCol(f){for(var e=GetRowCountInternal(),d=GetColCount(),b=0;b<e;b++)for(var c=0;c<d;c++){var a=getCellFromRowCol(b,c);if(a!=null&&a.getAttribute("col")==f)return a}return null}function GetHiddenValue(b,d){if(d==null)return;b=GetDisplayIndex(b);var c=null,a=null;if(b<frzRows){a=getViewport0();if(a!=null&&b>=0&&b<a.rows.length){var e=a.rows(b);c=e.getAttribute("hv"+d)}if(c==null){a=getViewport1();if(a!=null&&b>=0&&b<a.rows.length){var e=a.rows(b);c=e.getAttribute("hv"+d)}}}else{b-=frzRows;a=getViewport2();if(a!=null&&b>=0&&b<a.rows.length){var e=a.rows(b);c=e.getAttribute("hv"+d)}if(c==null){a=getViewport();if(a!=null&&b>=0&&b<a.rows.length){var e=a.rows(b);c=e.getAttribute("hv"+d)}}}return c}function GetValue(a,e){a=GetDisplayIndex(a);var b=getCellFromRowCol(a,e),d=getRender(b),c=getValueFromRender(d);return c==" "&&b.getAttribute("whiteSpace")==null?"":c}function SetValue(c,g,a,e,f){var d=c;c=GetDisplayIndex(c);if(typeof a!="undefined"&&typeof a!="string")a=new String(a);var b=getCellFromRowCol(c,g);if(validateCell(b,a)){setCellValueFromView(b,a);if(a!=null)setCellValue(b,""+a,e,f);else setCellValue(b,"",e,f);if(!shouldIgnoreSizeSpread()){syncRowRangeSafeMode(d,d);sizeSpread(true)}}else if(element.getAttribute("lcidMsg")!=null)alert(element.getAttribute("lcidMsg"));else alert("Can't set the data into the cell. The data type is not correct for the cell.")}function SetActiveCell(c,d){ignoreFireSelectionChanged=true;element.getAttribute("mcctCellType")==null&&(element.document.FpActiveSpread==null||element.document.FpActiveSpread!=element)&&doGetFocus();var e=anchorCell;ClearSelection(true);c=GetDisplayIndex(c);updateAnchorCell(c,d);updateLeadingCell(c,d);var a=getScrollvp();if(a==null)a=getParent(getViewport());var b=getCellFromRowCol(c,d);if(b!=null&&a!=null){if(b.offsetLeft<a.scrollLeft||b.offsetLeft+b.offsetWidth>a.scrollLeft+a.clientWidth)a.scrollLeft=b.offsetLeft;if(b.offsetTop<a.scrollTop||b.offsetTop+b.offsetHeight>a.scrollTop+a.clientHeight)a.scrollTop=b.offsetTop}ignoreFireSelectionChanged=false;if(anchorCell!=null&&e!=anchorCell){fireSelectionChangedEvent(element);fireActiveCellChangedEvent(c,d,element)}}function updateAnchorCell(a,b,c,e,d){if(a<0||b<0)return;if(element.getAttribute("layoutMode")&&allowGroup&&e)a=getRowFromViewPort(a,b);if(smartPaint&&vpList.table.rows.length>0&&a>=frzRows)if(a<current+frzRows)showRows(a-frzRows,current+frzRows-a+1);else a-frzRows>=current+currentCount&&showRows(a-frzRows,1);anchorCell=getCellFromRowCol(a,b);if(anchorCell==null)return;var f=getRowKeyFromCell(anchorCell);setActiveRow(f);setActiveCol(element.getAttribute("layoutMode")?getColKeyFromCell2(anchorCell):getColKeyFromCell(anchorCell));if(c==null||c){if(operationMode=="RowMode"||operationMode=="SingleSelect")!isRowSelected(a)&&selectRow(a,1,true,true);paintSelections(true,d);paintFocusRect();if(!(operationMode=="RowMode"||operationMode=="SingleSelect")&&operationMode!="MultiSelect"&&operationMode!="ExtendedSelect")selectType=""}}function resetLeadingCell(){ClearSelection();if(anchorCell==null)return;leadingCellRow=getRowFromCell(anchorCell);leadingCellCol=getColFromCell(anchorCell);selectRange(leadingCellRow,leadingCellCol,1,1,true)}function Edit(a){var d=operationMode;if(d!="RowMode")return;var b=element.getAttribute("name");if(dirty){saveData();dirty=false}var c=element.getAttribute("ajax")!="false";if(c){FarPoint&&FarPoint.System.WebControl.MultiColumnComboBoxCellTypeUtilitis&&FarPoint.System.WebControl.MultiColumnComboBoxCellTypeUtilitis.CloseAll();syncData(b,"Edit,"+a)}else __doPostBack(b,"Edit,"+a);element.setAttribute("editingInTemplate","true")}function Update(){enableRowEditTemplate&&operationMode=="RowMode"&&element.setAttribute("editingInTemplate","false");if(editing)return;saveData();var a=element.getAttribute("name"),b=element.getAttribute("ajax")!="false";if(b)syncData(a,"Update");else __doPostBack(a,"Update")}function MoveCol(e,c){if(editing)return;var a=null;if(element.document.FpActiveSpread!=null)a=element.document.FpActiveSpread.getAttribute("name");else a=element.getAttribute("name");if(selectedCols&&selectedCols.length>0){for(var d=[],b=0;b<selectedCols.length;b++)d[b]=GetSheetColIndex(selectedCols[b]);var g=d.join("+");moveMultiCol(g,c);return}var f=element.getAttribute("ajax")!="false";if(f)syncData(a,"MoveCol,"+e+","+c);else __doPostBack(a,"MoveCol,"+e+","+c)}function moveMultiCol(b,c){if(editing)return;var a=null;if(element.document.FpActiveSpread!=null)a=element.document.FpActiveSpread.getAttribute("name");else a=element.getAttribute("name");var d=element.getAttribute("ajax")!="false";if(d)syncData(a,"MoveCol,"+b+","+c);else __doPostBack(a,"MoveCol,"+b+","+c)}function Group(d,c){if(editing)return;var e=element.getAttribute("name");if(selectedCols&&selectedCols.length>0){for(var b=[],a=0;a<selectedCols.length;a++)if(element.getAttribute("layoutMode"))b[a]=parseInt(selectedCols[a]);else b[a]=GetSheetColIndex(selectedCols[a]);var g=b.join("+");groupMultiCol(g,c);selectedCols=[];return}var f=element.getAttribute("ajax")!="false";if(f)syncData(e,"Group,"+d+","+c);else __doPostBack(e,"Group,"+d+","+c)}function groupMultiCol(b,a){if(editing)return;var c=element.getAttribute("name"),d=element.getAttribute("ajax")!="false";if(d)syncData(c,"Group,"+b+","+a);else __doPostBack(c,"Group,"+b+","+a)}function Ungroup(b,a){if(editing)return;var c=element.getAttribute("name"),d=element.getAttribute("ajax")!="false";if(d)syncData(c,"Ungroup,"+b+","+a);else __doPostBack(c,"Ungroup,"+b+","+a)}function Regroup(a,b){if(editing)return;var c=element.getAttribute("name"),d=element.getAttribute("ajax")!="false";if(d)syncData(c,"Regroup,"+a+","+b);else __doPostBack(c,"Regroup,"+a+","+b)}function GroupBar(a){if(editing)return;var b=element.getAttribute("name"),c=element.getAttribute("ajax")!="false";if(c)syncData(b,"GroupBar,"+a);else __doPostBack(b,"GroupBar,"+a)}function GotoPage(b,c){if(editing)return;if(dirty){saveData();dirty=false}var a=element.getAttribute("name"),d=element.getAttribute("ajax")!="false";if(d)syncData(a,"Page,"+b,c);else __doPostBack(a,"Page,"+b)}function ScrollToPage(b,g,e){if(editing)return;if(dirty){saveData();dirty=false}var c=g?"ScrollUpToPage":"ScrollDownToPage",d=element.getAttribute("name"),a=element.GetCurrentPageIndex(),f=element.getAttribute("ajax")!="false";if(f)syncData(d,c+","+b+","+a,e);else __doPostBack(d,c+","+b+","+a)}function Cancel(){var a=xmlData.selectSingleNode("data");if(a!=null){var b=xmlData.firstChild(a);while(b!=null){a.removeChild(b);b=xmlData.firstChild(a)}saveData()}var c=element.getAttribute("name"),d=element.getAttribute("ajax")!="false";if(d)syncData(c,"Cancel");else __doPostBack(c,"Cancel")}function Add(){if(editing)return;var a=null;if(element.document.FpActiveSpread!=null)a=element.document.FpActiveSpread.getAttribute("name");else a=element.getAttribute("name");var b=element.getAttribute("ajax")!="false";if(b)syncData(a,"Add");else __doPostBack(a,"Add")}function Insert(){if(editing)return;var a=null;if(element.document.FpActiveSpread!=null)a=element.document.FpActiveSpread.getAttribute("name");else a=element.getAttribute("name");var b=element.getAttribute("ajax")!="false";if(b)syncData(a,"Insert");else __doPostBack(a,"Insert")}function Delete(){if(editing)return;var a=null;if(element.document.FpActiveSpread!=null)a=element.document.FpActiveSpread.getAttribute("name");else a=element.getAttribute("name");var b=element.getAttribute("ajax")!="false";if(b)syncData(a,"Delete");else __doPostBack(a,"Delete")}function Next(){if(editing)return;var a=element.getAttribute("name"),b=element.getAttribute("ajax")!="false";if(b)syncData(a,"Next");else __doPostBack(a,"Next")}function Prev(){if(editing)return;var a=element.getAttribute("name"),b=element.getAttribute("ajax")!="false";if(b)syncData(a,"Prev");else __doPostBack(a,"Prev")}function getViewportFromCell(b){if(b!=null){var a=b;while(a!=null){if(a.tagName=="TABLE")break;a=a.parentElement}if(a==getViewport0()||a==getViewport1()||a==getViewport2()||a==getViewport())return a}return null}function isChild(c,b){if(c==null||b==null)return false;var a=c.parentElement;while(a!=null){if(a==b)return true;a=a.parentElement}return false}function getCorner(){return corner}function getFrozColHeader(){return frozColHeader}function getFrozColFooter(){return frozColFooter}function getFooterCorner(){return footerCorner}function getFrozRowHeader(){return frozRowHeader}function getViewport0(){return viewport0}function getViewport1(){return viewport1}function getViewport2(){return viewport2}function getScrollvp(){return scrollvp}function select(g,f){if(!smartPaint&&(getSpreadControl(g)!=element||getSpreadControl(f)!=element))return;if(inRowHeader(g)||inRowHeader(f))if((selectionBlockOptions&SelectionBlockOptions.Rows)==0&&selectType!="r"&&operationMode=="Normal")return;if(inColHeader(g)||inColHeader(f))if((selectionBlockOptions&SelectionBlockOptions.Columns)==0&&selectType!="c"&&operationMode=="Normal")return;if(!isHeaderCell(g)&&!isHeaderCell(f))if((selectionBlockOptions&SelectionBlockOptions.Cells)==0&&selectType==""&&operationMode=="Normal")return;if(selectStartRow==null)selectStartRow=getRowFromCell(g);if(selectStartCol==null)selectStartCol=getColFromCell(g);var e=selectStartRow,d=selectStartCol,c=getRowFromCell(f),b=0;if(selectType=="r"){b=-1;if(isChild(f,getColHeader())||isChild(f,getFrozColHeader()))c=0}else if(selectType=="c"){if(isChild(f,getRowHeader())||isChild(f,getFrozRowHeader()))b=0;else b=getColFromCell(f);c=-1}else if(isChild(f,getColHeader())||isChild(f,getFrozColHeader())){c=0;b=getColFromCell(f)}else if(isChild(f,getRowHeader())||isChild(f,getFrozRowHeader()))b=0;else b=getColFromCell(f);if(selectType=="t")d=b=e=c=-1;var h=Math.max(e,c);e=Math.min(e,c);c=h;h=Math.max(d,b);d=Math.min(d,b);b=h;var a=null,j=getSelection(),i=xmlData.lastChild(j);if(i!=null){var n=parseInt(i.getAttribute("rowIndex")),m=parseInt(i.getAttribute("colIndex")),l=parseInt(i.getAttribute("rowcount")),k=parseInt(i.getAttribute("colcount"));a=new Range;setRange(a,"cell",n,m,l,k)}if(a!=null&&a.col==-1&&a.row==-1)return;if(a!=null&&a.col==-1&&a.row>=0)if(a.row>c||a.row+a.rowCount-1<e){paintSelection(a.row,a.col,a.rowCount,a.colCount,false);paintSelection(e,d,c-e+1,b-d+1,true)}else if(e>a.row){var h=e-a.row;if(a.row<frzRows&&frzRows<a.row+h)h--;paintSelection(a.row,a.col,h,a.colCount,false);if(c<a.row+a.rowCount-1)paintSelection(c,a.col,a.row+a.rowCount-c,a.colCount,false);else paintSelection(a.row+a.rowCount,a.col,c-a.row-a.rowCount+1,a.colCount,true)}else{paintSelection(e,a.col,a.row-e,a.colCount,true);if(c<a.row+a.rowCount-1)paintSelection(c+1,a.col,a.row+a.rowCount-c-1,a.colCount,false);else paintSelection(a.row+a.rowCount,a.col,c-a.row-a.rowCount+1,a.colCount,true)}else if(a!=null&&a.row==-1&&a.col>=0)if(a.col>b||a.col+a.colCount-1<d){paintSelection(a.row,a.col,a.rowCount,a.colCount,false);paintSelection(e,d,c-e+1,b-d+1,true)}else if(d>a.col){paintSelection(a.row,a.col,a.rowCount,d-a.col,false);if(b<a.col+a.colCount-1)paintSelection(a.row,b,a.rowCount,a.col+a.colCount-b,false);else paintSelection(a.row,a.col+a.colCount,a.rowCount,b-a.col-a.colCount,true)}else{paintSelection(a.row,d,a.rowCount,a.col-d,true);if(b<a.col+a.colCount-1)paintSelection(a.row,b+1,a.rowCount,a.col+a.colCount-b-1,false);else paintSelection(a.row,a.col+a.colCount,a.rowCount,b-a.col-a.colCount+1,true)}else if(a!=null&&a.row>=0&&a.col>=0)extendSelection(a,e,d,c-e+1,b-d+1);else paintSelection(e,d,c-e+1,b-d+1,true);setSelection(e,d,c-e+1,b-d+1,a==null)}function extendSelection(a,c,b,h,g){var i=Math.max(a.col,b),e=Math.min(a.col+a.colCount-1,b+g-1),f=Math.max(a.row,c),d=Math.min(a.row+a.rowCount-1,c+h-1);if(a.row<f)if(a.row<frzRows&&frzRows<f)paintSelection(a.row,a.col,f-a.row-1,a.colCount,false);else paintSelection(a.row,a.col,f-a.row,a.colCount,false);a.col<i&&paintSelection(a.row,a.col,a.rowCount,i-a.col,false);a.row+a.rowCount-1>d&&paintSelection(d+1,a.col,a.row+a.rowCount-d-1,a.colCount,false);a.col+a.colCount-1>e&&paintSelection(a.row,e+1,a.rowCount,a.col+a.colCount-e-1,false);c<f&&paintSelection(c,b,f-c,g,true);b<i&&paintSelection(c,b,h,i-b,true);c+h-1>d&&paintSelection(d+1,b,c+h-d-1,g,true);b+g-1>e&&paintSelection(c,e+1,h,b+g-e-1,true)}function paintSelection2(b,a,e,d,c){b<0&&a<0&&paintCornerSelection(c);if(b<0){rowIndex=b;b=0;e=GetRowCountInternal()}if(a<0){colIndex=a;a=0;d=GetColCount()}paintViewportSelection(b,a,e,d,c);paintAnchorCell();getColHeader()!=null&&operationMode=="Normal"&&paintHeaderSelection(b,a,e,d,c,true);getRowHeader()!=null&&paintHeaderSelection(b,a,e,d,c,false)}function paintSelection(a,b,d,c,e){a<0&&b<0&&paintCornerSelection(e);var m=false,n=false,r,q,u;if(a<0){r=a;a=0;d=GetRowCountInternal()}if(b<0){q=b;b=0;c=GetColCount()}paintViewportSelection(a,b,d,c,e);paintAnchorCell();for(var o=getSelection(),i,k,j,h,g,t=0,s=0,l,f,p=o.childNodes.length-1;p>=0;p--){i=o.childNodes[p];if(i){k=parseInt(i.getAttribute("rowIndex"));j=parseInt(i.getAttribute("colIndex"));h=parseInt(i.getAttribute("rowcount"));g=parseInt(i.getAttribute("colcount"));if(k<0||h<0){k=0;h=GetRowCountInternal()}if(j<0||g<0){j=0;g=GetColCount()}if(t<h)t=h;if(s<g)s=g;if(p>=o.childNodes.length-1){if(a<=k&&d>=h||element.getAttribute("layoutMode")&&c==1&&a<parseInt(element.getAttribute("layoutRowCount")))if(getColHeader()!=null&&operationMode=="Normal"){paintHeaderSelection(a,b,d,c,e,true);m=true}if(b<=j&&c>=g)if(getRowHeader()!=null){paintHeaderSelection(a,b,d,c,e,false);n=true}if(!m&&!n){if(getColHeader()!=null&&operationMode=="Normal"){paintHeaderSelection(a,b,d,c,e,true);m=true}if(getRowHeader()!=null){paintHeaderSelection(a,b,d,c,e,false);n=true}}}else if(!e&&operationMode=="Normal"&&!element.getAttribute("layoutMode")){l=rangeIntersection(a,b,d,c,k,j,h,g);l&&paintViewportSelection(l.row,l.col,l.rowCount,l.colCount,true);if(m){f=lineIntersection(b,c,j,g);f&&paintHeaderSelection(a,f.s,d,f.c,true,true)}if(n){f=lineIntersection(a,d,k,h);f&&paintHeaderSelection(f.s,b,f.c,c,true,false)}}}}if(r!=null||q!=null)if(t<d&&r<0||s<c&&q<0)u=true;if(o.childNodes.length<=0||element.getAttribute("SelectionPolicy")=="MultiRange"&&u){getColHeader()!=null&&operationMode=="Normal"&&paintHeaderSelection(a,b,d,c,e,true);getRowHeader()!=null&&paintHeaderSelection(a,b,d,c,e,false)}}function paintAnchorCellHeader(d){if(anchorCell==null||anchorCell.parentElement==null)return;var c,b;c=getRowFromCell(anchorCell);b=getColFromCell(anchorCell);if(d&&operationMode=="Normal"&&anchorCell.getAttribute("group")!=null){var e=getSpanCell(c,b,spanCells);if(e!=null&&e.colCount>1){var a=GetSelectedRange();if(c<a.row||c>=a.row+a.rowCount||b<a.col||b>=a.col+a.colCount)return}}getColHeader()!=null&&paintHeaderSelection(c,b,1,1,d,true);getRowHeader()!=null&&paintHeaderSelection(c,b,1,1,d,false)}function rangeIntersection(i,g,e,c,j,h,f,d){var b=lineIntersection(i,e,j,f),a=lineIntersection(g,c,h,d);return b&&a?{row:b.s,col:a.s,rowCount:b.c,colCount:a.c}:null}function lineIntersection(c,e,d,f){var a,b;a=Math.max(c,d);b=Math.min(c+e,d+f);return a<b?{s:a,c:b-a}:null}function isBorderInCellRange(a){var b=null;if(a.type=="Cell"){if(a.rowCount==1)for(var c=a.col;c<a.col+a.colCount;c++){b=getCellFromRowCol(a.row,c);if(b!=null&&getBorderWidth(b,2)>0)return true}if(a.colCount==1)for(var d=a.row;d<a.row+a.rowCount;d++){b=getCellFromRowCol(d,a.col);if(b!=null&&getBorderWidth(b,1)>0)return true}}else if(a.type=="Row"&&a.rowCount==1)for(var e=GetColCount(),c=0;c<e;c++){b=getCellFromRowCol(a.row,c);if(b!=null&&getBorderWidth(b,2)>0)return true}else if(a.type=="Column"&&a.colCount==1)for(var f=GetRowCountInternal(),d=0;d<f;d++){b=getCellFromRowCol(d,a.col);if(b!=null&&getBorderWidth(b,1)>0)return true}return false}function getColGroupColumnWidth(b,a){var c=b.children,d=engine>=9?getRealColWidth(b.parentElement,a):c[a].offsetWidth;return d}function paintFocusRect(){var j=element.document;if(!j.all)j=window.document;var c=j.all(element.id+"_focusRectT");if(c==null)return;var a=GetSelectedRange();if(anchorCell==null&&(a==null||a.rowCount==0&&a.colCount==0)){hideFocusBorder();return}var p=element.getAttribute("OperationMode");if(p=="RowMode"||p=="SingleSelect"||p=="MultiSelect"||p=="ExtendedSelect"){var i=getActiveRow();if(i<0){var x=findAnchorCell();if(x!=null)i=GetSheetIndex(getRowFromCell(x));else return}if(element.getAttribute("layoutMode"))i=getFirstMultiRowFromViewport(i,false);a=new Range;setRange(a,"Row",i,-1,1,-1)}else if(a==null||a.rowCount==0&&a.colCount==0){var i=getActiveRow(),g=getActiveCol();a=new Range;setRange(a,"Cell",i,g,anchorCell.rowSpan,anchorCell.colSpan)}if(a.row<0){a.row=0;a.rowCount=GetRowCountInternal()}if(a.col<0){a.col=0;a.colCount=GetColCount();if(element.getAttribute("layoutMode")&&a.rowCount<parseInt(element.getAttribute("layoutRowCount"))&&a.type=="Row")a.rowCount=parseInt(element.getAttribute("layoutRowCount"))}var d;if(element.getAttribute("layoutMode"))d=a.innerRow!=null?a.innerRow:a.row;else d=a.row;var b=null;if(d>-1)b=getCellFromRowCol(d,a.col);else if(element.getAttribute("layoutMode"))if(anchorCell!=null){d=parseInt(anchorCell.parentElement.getAttribute("row"));b=getCellFromRowCol(d,a.col)}else{var t=xmlData.lastChild(getSelection());if(t!=null&&t.getAttribute("col")!="-1"){b=getFirstCellFromCol(t.getAttribute("col"));if(b)d=parseInt(b.parentElement.getAttribute("row"))}}if(b==null)return;if(a.rowCount==1&&a.colCount==1){a.rowCount=b.rowSpan;a.colCount=b.colSpan;if(b.colSpan>1&&!isNaN(b.getAttribute("col"))&&!element.getAttribute("layoutMode"))a.col=getColByKey(b.getAttribute("col"))}var m=getViewport().parentElement,l=getOffsetTop(b,m,true)-1;if(a.type=="Column"&&!element.getAttribute("layoutMode")&&getColFromCell(b)<a.col){var i=getRowFromCell(b)+1,G=GetRowCountInternal(),w=null;while(i<G){w=getSpanCell(i,a.col,spanCells);if(w==null||w.col>=a.col)break;i++}b=getCellFromRowCol(i,a.col);if(b==null)b=getCellFromRowCol(d+a.rowCount-1,a.col);if(b==null)return}var F=b,s=d;if(d>-1)while(!isChild(b,m)){s++;if(s>=d+a.rowCount)return;b=getCellFromRowCol(s,a.col);if(b==null)return}var h=getOffsetLeft(b,m,true)-1;b=F;if(parseInt(getViewport().cellSpacing)==0){if(a.row==0)l=l+1;if(a.col==0)h=h+1}if(b.rowSpan>1){d=b.parentNode.rowIndex;var n=getCellFromRowCol(d,a.col+a.colCount-1);if(n!=null&&n.parentNode.rowIndex>b.parentNode.rowIndex)l=getOffsetTop(n,m)-1;if(element.getAttribute("layoutMode")&&a.rowCount<b.rowSpan&&(a.type=="Column"||a.type=="Row"))a.rowCount=b.rowSpan}if(b.colSpan>1){var n=getCellFromRowCol(d+a.rowCount-1,a.col),z=getOffsetLeft(n,m)-1;if(z>h){h=z;b=n}if(element.getAttribute("layoutMode")&&a.colCount<b.colSpan&&(a.type=="Column"||a.type=="Row"))a.colCount=b.colSpan}var e=0,k=getViewport().rows;if(k.length>0){var q=d+a.rowCount,B=k[q]?getOffsetTop(k[q],m,true):getOffsetTop(k[k.length-1],m,true)+k[k.length-1].offsetHeight;e=B-l;if(q<k.length)e-=parseInt(getViewport().cellSpacing)}var D=$$.browser,r=getViewport(),A=-1;if(D.ieversion>=9){var y=r.getAttribute("LastDisplayedColumn");if(y!=null)A=parseInt(y)}var f=0,o=getColGroup(r);if(o.children==null||o.children.length==0)return;for(var g=a.col,C=o.children.length,E=a.col+a.colCount;g<E&&g<C;g++){f+=getColGroupColumnWidth(o,g);if(g>a.col)f+=parseInt(r.cellSpacing)}if(a.col>b.cellIndex&&a.type=="Column"){var u=element.getAttribute("layoutMode")?parseInt(b.getAttribute("scol")):parseInt(b.getAttribute("col"));if(b.getAttribute("group")!=null)u=b.cellIndex;for(var g=u;g<a.col;g++){h+=getColGroupColumnWidth(o,g);if(g>u)h+=parseInt(getViewport().cellSpacing)}}if(parseInt(getViewport().cellSpacing)==0){f+=1;e+=1;if(a.col+a.colCount>=GetColCount())f-=1;if(a.row+a.rowCount>=GetRowCountInternal())e-=1}else if(isBorderInCellRange(a))if(a.type=="Cell"){if(a.rowCount==1)e=e+1;if(a.colCount==1)f=f+1}else if(a.type=="Row")e=e+1;else if(a.type=="Column")f=f+1;e=e-1;f=f-1;if(f<0)f=0;if(e<0)e=0;c.style.left=""+h+"px";c.style.top=""+l+"px";c.style.width=""+f+"px";var j=element.document;if(!j.getElementById)j=window.document;var v=element.id;c=j.getElementById(v+"_focusRectB");c.style.left=""+h+"px";c.style.top=""+(l+e)+"px";c.style.width=""+f+"px";c=j.getElementById(v+"_focusRectL");c.style.left=""+h+"px";c.style.top=""+l+"px";c.style.height=""+e+"px";c=j.getElementById(v+"_focusRectR");c.style.left=""+(h+f)+"px";c.style.top=""+l+"px";c.style.height=""+e+"px"}function paintCornerSelection(e){var d=true;if(getTopSpread(element).getAttribute("ShowHeaderSelection")=="false")d=false;if(!d)return;var a=getCorner();if(a!=null&&a.rows.length>0)for(var b=0;b<a.rows.length;b++)for(var c=0;c<a.rows(b).cells.length;c++)a.rows(b).cells(c)!=null&&paintSelectedCell(a.rows(b).cells(c),e)}function paintHeaderSelection(a,f,e,j,n,d){var k=true;if(getTopSpread(element).getAttribute("ShowHeaderSelection")=="false")k=false;if(!k)return;var q=d?colSpanCells:rowSpanCells;if(element.getAttribute("layoutMode")&&d){if(e>parseInt(element.getAttribute("layoutRowCount")))e=parseInt(element.getAttribute("layoutRowCount"));var l=getCellFromRowCol(a,f);if(element.getAttribute("allowGroup")&&l&&l.getAttribute("group")!=null)a=getFirstMultiRowFromViewport(a,true);for(var b=a;b<a+e;b++)for(var c=f;c<f+j;c++){var o=getCellFromRowCol(b,c);if(o){var h=getRowTemplateRowFromCell(o);if(!isNaN(h)){if(h>=parseInt(element.getAttribute("layoutRowCount")))h=parseInt(element.getAttribute("layoutRowCount"))-1;var g=getHeaderCellFromRowCol(h,c,d);g!=null&&getRowTemplateRowFromCell(g)==h&&paintSelectedCell(g,n)}}}}else{var i=GetRowCountInternal(),p=GetColCount();if(d){if(getColHeader()==null)return;a=0;e=i=getColHeader().rows.length}else{if(getRowHeader()==null)return;f=0;var m=getColGroup(getRowHeader());if(m==null)return;j=p=m.children.length}if(element.getAttribute("layoutMode")&&operationMode!="Normal"&&!d)a=getFirstMultiRowFromViewport(a,false);if(element.getAttribute("layoutMode")&&anchorCell!=null&&anchorCell.getAttribute("group")!=null&&!d&&e!=i)e=1;for(var b=a;b<a+e&&b<i;b++){if(!d&&IsChildSpreadRow(getViewport(),b))continue;for(var c=f;c<f+j&&c<p;c++){if(!element.getAttribute("layoutMode")&&isCovered(b,c,q))continue;var g=getHeaderCellFromRowCol(b,c,d);g!=null&&paintSelectedCell(g,n)}}}}function paintViewportSelection(e,g,d,j,h){var f=GetRowCountInternal(),i=GetColCount();if(element.getAttribute("layoutMode")&&operationMode!="Normal"&&d==parseInt(element.getAttribute("layoutRowCount")))e=getFirstMultiRowFromViewport(e,false);if(element.getAttribute("layoutMode")&&anchorCell!=null&&anchorCell.getAttribute("group")!=null&&d!=f)d=1;for(var a=e;a<e+d&&a<f;a++){if(frzCols==0&&frzRows==0&&IsChildSpreadRow(getViewport(),a))continue;for(var b=null,c=g;c<g+j&&c<i;c++){if(isCovered(a,c,spanCells))continue;b=getCellFromRowCol(a,c,b);b!=null&&b.parentNode.getAttribute("previewRow")==null&&paintSelectedCell(b,h)}}}function Copy(){if(window.event!=null)window.event.returnValue=false;if(element.document.FpActiveSpread!=null&&element.document.FpActiveSpread!=element){element.document.FpActiveSpread.Copy();return}var n=getCmdBtn("Copy");if(n!=null&&n.ignoreClick){n.ignoreClick=null;return}if(enableRowEditTemplate=="true"&&operationMode=="RowMode")return;var r=getSelection(),c=xmlData.lastChild(r);if(c!=null){var g,e,j,i;copymultiCol=false;if(element.getAttribute("layoutMode")&&c.getAttribute("col")!="-1"&&c.getAttribute("row")=="-1"&&c.getAttribute("rowcount")=="-1"){var a=anchorCell;if(a){g=parseInt(a.parentElement.getAttribute("row"));e=getColFromCell(a);j=GetRowCountInternal();i=parseInt(c.getAttribute("colcount"));copymultiCol=true}}else if(element.getAttribute("layoutMode")&&c.getAttribute("col")=="-1"&&c.getAttribute("colcount")=="-1"&&c.getAttribute("row")!=-1){var s=parseInt(c.getAttribute("row"));g=getFirstRowFromKey(s);e=parseInt(c.getAttribute("colIndex"));j=parseInt(element.getAttribute("layoutRowCount"))}else{g=element.getAttribute("layoutMode")?parseInt(c.getAttribute("rowIndex")):getRowByKey(c.getAttribute("row"));e=element.getAttribute("layoutMode")?parseInt(c.getAttribute("colIndex")):getColByKey(c.getAttribute("col"));j=parseInt(c.getAttribute("rowcount"));i=parseInt(c.getAttribute("colcount"))}var m=false;if(g<0||copymultiCol){if(!copymultiCol){g=0;j=GetRowCountInternal()}if($$.browser.quirksMode){var k=createEventObject();k.spread=element;k.includeColHeader=false;CopyData.fire(k)}else{var d={spread:element,includeColHeader:false},k=$$.utils.createEvent("CopyData",false,true,d);element.dispatchEvent(k)}m=k.includeColHeader}if(e<0){e=0;i=GetColCount()}var d="";if(m)for(var h=g;h<getColHeader().rows.length;h++){for(var a=null,f=e;f<e+i;f++){if(isCovered(h,f,colSpanCells))d+="";else{a=getHeaderCellFromRowCol(h,f,true);if(element.getAttribute("layoutMode")&&copymultiCol&&(a==null||parseInt(a.parentElement.getAttribute("row"))!=g))continue;var l=getCellType(a);if(l=="TextCellType"||l=="text")if(a!=null&&a.getAttribute("password")!=null)d+="";else{var b=getCellValueFromView(a);if(b!=null){var p=b.length,q=new RegExp("\x0d\x0a","g");b=b.replace(q,"\n");if(b.length<p)b='"'+b+'"'}else b="";d+=b}else d+=getCellValueFromView(a)}if(f+1<e+i)d+="\t"}d+="\r\n"}var o=g;if(m)o=0;for(var h=o;h<g+j;h++){if(IsChildSpreadRow(getViewport(),h))continue;for(var a=null,f=e;f<e+i;f++){if(isCovered(h,f,spanCells))d+="";else{a=getCellFromRowCol(h,f,a);if(element.getAttribute("layoutMode")&&copymultiCol&&(a==null||parseInt(a.parentElement.getAttribute("row"))!=g))continue;if(a!=null&&a.parentNode.getAttribute("previewRow")=="true")continue;var l=getCellType(a);if(l=="TextCellType"||l=="text")if(a!=null&&a.getAttribute("password")!=null)d+="";else{var b=getCellValueFromView(a);if(b!=null){var p=b.length,q=new RegExp("\x0d\x0a","g");b=b.replace(q,"\n");if(b.length<p)b='"'+b+'"'}else b="";d+=b}else d+=getCellValueFromView(a)}if(f+1<e+i)d+="\t"}d+="\r\n"}setClipboardData(d)}else if(anchorCell!=null){var d=getCellValueFromView(anchorCell);setClipboardData(d)}}function getClipboardData(){var a=element.getAttribute("clipboard")==null;try{if(a){a=false;window.clipboardData.getData("Text");a=true}}catch(b){$$.DEBUG.Log(b,"getClipboardData")}return a?window.clipboardData.getData("Text"):window.ssClipboardData}function setClipboardData(b){var a=element.getAttribute("clipboard")==null;try{if(a){a=false;window.clipboardData.getData("Text");a=true}}catch(c){$$.DEBUG.Log(c,"getClipboardData")}if(a)window.clipboardData.setData("Text",b);else window.ssClipboardData=b}function getCellValueFromView(b){var a=null;if(b!=null){var c=getRender(b);a=getValueFromRender(c);if(a==null||a==" ")a=""}return a}function setCellValueFromView(a,f,e){if(a!=null){var b=getRender(a),d=getCellType(a),c=false;if(d=="readonly"&&a.getAttribute("locked")!="true"&&a.getAttribute("canFocus")=="false")c=true;if((d!="readonly"||e||c)&&b!=null&&b.getAttribute("FpEditor")!="Button"){setValueToRender(b,f);return true}}return false}function Paste(){if(window.event!=null)window.event.returnValue=false;if(element.document.FpActiveSpread!=null&&element.document.FpActiveSpread!=element){element.document.FpActiveSpread.Paste();return}if(enableRowEditTemplate=="true"&&operationMode=="RowMode")return;if(anchorCell==null)return;var p=getCmdBtn("Paste");if(p!=null&&p.ignoreClick){p.ignoreClick=null;return}var t=element.document;if(!t.getElementById)t=window.document;var w=getClipboardData();if(w==null)return;var C=getViewportFromCell(anchorCell),g=getRowFromCell(anchorCell),h=getColFromCell(anchorCell),x=GetColCount(),q=GetRowCountInternal(),s=getSelection();if(s!=null){var b=xmlData.lastChild(s);if(b!=null){var g=parseInt(b.getAttribute("row")),h=parseInt(b.getAttribute("col"));if(element.getAttribute("layoutMode")&&b.getAttribute("col")!="-1"&&b.getAttribute("row")=="-1"&&b.getAttribute("rowcount")=="-1"){var a=anchorCell;if(a){g=parseInt(a.parentElement.getAttribute("row"));h=getColFromCell(a)}}else if(element.getAttribute("layoutMode")&&b.getAttribute("col")=="-1"&&b.getAttribute("colcount")=="-1"&&b.getAttribute("row")!=-1){var B=parseInt(b.getAttribute("row"));g=getFirstRowFromKey(B);h=parseInt(b.getAttribute("colIndex"))}else{g=element.getAttribute("layoutMode")?parseInt(b.getAttribute("rowIndex")):getRowByKey(b.getAttribute("row"));h=element.getAttribute("layoutMode")?parseInt(b.getAttribute("colIndex")):getColByKey(b.getAttribute("col"))}if(g<0)g=0;if(h<0)h=0}}var f=g,e=h,j=new String(w);if(j.length==0)return;var r=j.lastIndexOf("\r\n");if(r>=0&&r==j.length-2)j=j.substring(0,r);for(var o=0,d=j.split("\r\n"),c=0;c<d.length&&f<q;c++){if(typeof d[c]=="string"){d[c]=d[c].split("\t");if(d[c].length>o)o=d[c].length}f++}if(canValidate()){f=GetSheetIndex(g);for(var c=0;c<d.length&&f<q;c++){var k=d[c];if(k!=null){e=h;for(var a=null,v=null,l="",y=false,n=GetDisplayIndex(f),i=0;i<k.length&&e<x;i++){if(!isCovered(n,e,spanCells)){a=getCellFromRowCol(n,e,a);if(a==null)continue;v=getEditor(a);l=getCellType(a);var y=v!=null&&(l=="text"||l=="TextCellType");if(element.getAttribute("layoutMode")&&copymultiCol&&parseInt(a.parentElement.getAttribute("row"))!=parseInt(anchorCell.parentElement.getAttribute("row")))continue;if(a.parentNode.getAttribute("previewRow")=="true")continue;var m=k[i];if(!y&&!validateCell(a,m)){if(element.getAttribute("lcidMsg")!=null)alert(element.getAttribute("lcidMsg"));else alert("Can't set the data into the cell. The data type is not correct for the cell.");return}}e++}}f++}}if(d.length==0)return;f=GetSheetIndex(g);for(var c=0;c<d.length&&f<q;c++){e=h;for(var k=d[c],a=null,n=GetDisplayIndex(f),i=0;i<o&&e<x;i++){if(!isCovered(n,e,spanCells)){a=getCellFromRowCol(n,e,a);if(a==null)continue;if(element.getAttribute("layoutMode")&&copymultiCol&&parseInt(a.parentElement.getAttribute("row"))!=parseInt(anchorCell.parentElement.getAttribute("row")))continue;if(a.parentNode.getAttribute("previewRow")=="true")continue;var l=getCellType(a),u=getRender(a);if(a.getAttribute("CellType2")=="HyperLinkCellType")continue;if(l!="readonly"&&u.getAttribute("FpEditor")!="Button"||l=="readonly"&&a.getAttribute("locked")!="true"){var m=null;if(k!=null&&i<k.length)m=trimQuote(k[i]);var A=setCellValueFromView(a,m);if(A)if(m!=null)setCellValue(a,""+getValueFromRender(u));else setCellValue(a,"")}}e++}f++}if(xhtml){syncRowRangeSafeMode(g,g+d.length-1,false);sizeSpread(true)}var z=element.getAttribute("autoCalc");z!="false"&&updateValues();getRowHeader()==null&&frzCols==0&&prepairSpreadLayout()}function getFrozenRowCount(){if(frzRows==0)return 0;var a=getViewport0();if(a==null)a=getViewport1();for(var c=0,b=0;b<a.rows.length;b++){if(!a.rows[b].getAttribute("FpKey"))continue;c++}return Math.min(frzRows,c)}function trimQuote(a){if(a==null||a.length==0)return null;if(a.indexOf("\n")<=0)return a;if(a.charAt(0)=='"'&&a.charAt(a.length-1)=='"')a=a.substring(1,a.length-1);var b=new RegExp('""',"g");a=a.replace(b,'"');return a}function updateValues(){if(dataBuff==null&&getParentSpread()==null&&element.getAttribute("rowFilter")!="true"&&element.getAttribute("hierView")!="true"&&element.getAttribute("IsNewRow")!="true"){saveData();storePostData();syncData(element.getAttribute("name"),"UpdateValues")}}function validateCell(c,a){if(c==null||a==null||a=="")return true;var f=getCellValidatorID(c);if(f!=null){var b=getCellValidator(f);if(b.type=="Double")return isDouble(a,b);else if(b.type=="Currency"){var k=getCurrency(b);a=a.replace(k,"")}var j=ValidatorConvert(a,b.type,b);return j!=null}else{var d=getEditor(c);if(d==null){var g=getCellEditorID(c);if(g!=null)d=getCellEditor(g,true)}if(d!=null&&typeof d.isValid!="undefined"){var e=d.isValid(a);return e==""}var h=this.getCellType(c);if(h!=null){var i=this.getFunction(h+"_isValid");if(i!=null){var e=i(c,a);return e==null||e==""}}return true}}function isDouble(e,b){if(e==null||e.length==0)return true;var i=new RegExp("^\\s*([-\\+])?(\\d+)?(\\"+b.getAttribute("decimalchar")+"(\\d+))?([eE]([-\\+])?(\\d+))?\\s*$"),a=e.match(i);if(a==null)return false;var h=a[1]+(a[2].length>0?a[2]:"0")+"."+a[4]+"E"+a[6]+(a[7].length>0?a[7]:"0"),d=parseFloat(h);if(isNaN(d))return false;var c=true;if(b.getAttribute("minimumvalue")!=null){var g=parseFloat(b.getAttribute("minimumvalue"));c=!isNaN(g)&&d>=g}if(c&&b.getAttribute("maximumvalue")!=null){var f=parseFloat(b.getAttribute("maximumvalue"));c=!isNaN(f)&&d<=f}return c}function updateSelectionsBackColor(j,i){for(var h=getSelection(),b=null,f=0;f<h.childNodes.length;f++){b=h.childNodes[f];var g=parseInt(b.getAttribute("rowIndex")),e=parseInt(b.getAttribute("colIndex")),l=parseInt(b.getAttribute("rowcount")),k=parseInt(b.getAttribute("colcount"));if(g!=-1&&e!=-1)for(var c=0;c<l;c++)for(var d=0;d<k;d++){if(j==g+c&&i==e+d)continue;var a=getCellFromRowCol(g+c,e+d);if(a!=null&&a.paintSelected==null){if(element.getAttribute("semiTransparentSelectedBackColor")==null||a.currentStyle.backgroundColor==null||a.currentStyle.backgroundColor.length==0||a.currentStyle.backgroundColor=="transparent")a.style.backgroundColor=selectedBackColor;else a.style.backgroundColor=darker(a.currentStyle.backgroundColor,selectedBackColor);a.paintSelected=true}}}}function doClearSelection(){var e=getSelection(),a=xmlData.lastChild(e);while(a!=null){var b=parseInt(a.getAttribute("rowIndex")),d=parseInt(a.getAttribute("colIndex")),c=parseInt(a.getAttribute("rowcount")),g=parseInt(a.getAttribute("colcount"));if(element.getAttribute("layoutMode")&&b!=-1&&(g==-1||operationMode!="Normal")){c=parseInt(element.getAttribute("layoutRowCount"));paintSelection(b,-1,c,-1,false)}if(element.getAttribute("layoutMode")&&d!=-1&&(c==-1||operationMode!="Normal")){var f=getFirstCellFromCol(a.getAttribute("col"));if(f){b=parseInt(f.parentElement.getAttribute("row"));d=getColFromCell(f)}paintMultipleRowSelection(b,d,1,g,false)}else paintSelection(b,d,c,g,false);e.removeChild(a);a=xmlData.lastChild(e)}}function Clear(){var btn=getCmdBtn("Clear");if(btn!=null&&btn.ignoreClick){btn.ignoreClick=null;return}if(window.event!=null)window.event.returnValue=false;if(element.document.FpActiveSpread!=null&&element.document.FpActiveSpread!=element){element.document.FpActiveSpread.Clear();return}if(enableRowEditTemplate=="true"&&operationMode=="RowMode")return;var cellType=getCellType(anchorCell);if(cellType=="readonly")return;var selection=getSelection(),node=xmlData.lastChild(selection);if(anyReadOnlyCell(node))return;Copy();if(node!=null){var r,c,rc,cc,IsColumn=false;if(element.getAttribute("layoutMode")&&node.getAttribute("col")!="-1"&&node.getAttribute("row")=="-1"&&node.getAttribute("rowcount")=="-1"){var cell=anchorCell;if(cell){r=parseInt(cell.parentElement.getAttribute("row"));c=getColFromCell(cell);rc=GetRowCountInternal();cc=parseInt(node.getAttribute("colcount"));IsColumn=true}}else if(element.getAttribute("layoutMode")&&node.getAttribute("col")=="-1"&&node.getAttribute("row")!=-1){var rowKey=parseInt(node.getAttribute("row"));r=getFirstRowFromKey(rowKey);c=parseInt(node.getAttribute("colIndex"));rc=parseInt(element.getAttribute("layoutRowCount"))}else{r=parseInt(node.getAttribute("rowIndex"));c=parseInt(node.getAttribute("colIndex"));rc=parseInt(node.getAttribute("rowcount"));cc=parseInt(node.getAttribute("colcount"))}if(r<0){r=0;rc=GetRowCountInternal()}if(c<0){c=0;cc=GetColCount()}for(var i=r;i<r+rc;i++){if(IsChildSpreadRow(getViewport(),i))continue;for(var cell=null,j=c;j<c+cc;j++)if(!isCovered(i,j,spanCells)){cell=getCellFromRowCol(i,j,cell);if(cell==null)continue;if(element.getAttribute("layoutMode")&&IsColumn&&parseInt(cell.parentElement.getAttribute("row"))!=r)continue;if(cell.parentNode.getAttribute("previewRow")=="true")continue;var cellType=getCellType(cell);if(cellType!="readonly"){var edit=getEditor(cell);if(edit!=null&&edit.getAttribute("FpEditor")=="Button")continue;if(edit!=null&&edit.getAttribute("FpEditor")=="MultiColumnComboBoxCellType"){var mccbId=getMccbID(cell,element);if(mccbId!=null){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval(mccbId+"_Obj");editorObj!=null&&editorObj.SetText(null)}}else{cell.removeAttribute("FpFormula");setCellValueFromView(cell,null)}setCellValue(cell,"")}}}if(xhtml){syncRowRangeSafeMode(r,r+rc-1,false,false);sizeSpread(true)}var autoCalc=element.getAttribute("autoCalc");autoCalc!="false"&&updateValues()}}function anyReadOnlyCell(b){if(b!=null){var f=parseInt(b.getAttribute("rowIndex")),d=parseInt(b.getAttribute("colIndex")),i=parseInt(b.getAttribute("rowcount")),h=parseInt(b.getAttribute("colcount")),g=null;if(element.getAttribute("layoutMode")&&b.getAttribute("col")!="-1"){var a=getFirstCellFromCol(b.getAttribute("col"));if(a)g=a.parentElement.getAttribute("row")}if(f<0){f=0;i=GetRowCountInternal()}if(d<0){d=0;h=GetColCount()}for(var c=f;c<f+i;c++){if(IsChildSpreadRow(getViewport(),c))continue;for(var a=null,e=d;e<d+h;e++)if(!isCovered(c,e,spanCells)){a=getCellFromRowCol(c,e,a);if(g!=null&&a!=null&&parseInt(a.parentElement.getAttribute("row"))!=g)continue;var j=getCellType(a);if(j=="readonly")return true}}}return false}function moveSlideBar(e){var c=getElementById(activePager,element.id+"_slideBar"),a=e.clientX-12,b=getOffsetLeft(activePager,element.document.body);a-=b;if(element.style.position!="absolute"&&element.style.position!="relative"&&!xhtml)a-=element.document.body.leftMargin;if(a<slideLeft)a=slideLeft;if(a>slideRight)a=slideRight;var d=parseInt(activePager.getAttribute("totalPage"))-1,f=parseInt((a-slideLeft)/(slideRight-slideLeft)*d)+1;if(xhtml&&element.style.position!="absolute"&&element.style.position!="relative"&&activePager.id.indexOf("pager2")<0)a+=getElementOffsetLeft(activePager);c.style.posLeft=a;return f}function getOffsetParent(b){var a=b;while(a!=null&&a.currentStyle.position!="absolute"&&a.currentStyle.position!="relative"&&a.currentStyle.position!="fixed")a=a.offsetParent;if(a==null)a=element.document.documentElement;return a}var scrollTop=0,scrollLeft=0;function setScrollTop(a){var b=getParent(getViewport());b.scrollTop=a}function setScrollLeft(a){var b=getParent(getViewport());b.scrollLeft=a}function mouseMove(){if(window.fpPostOn!=null)return;if(dragSlideBar){if(window.event.button==1&&activePager!=null){var hb=moveSlideBar(window.event),q=getElementById(activePager,element.id+"_posIndicator");q.innerHTML=activePager.getAttribute("pageText")+hb}return}if(!working&&hitCommandBar())return;if(element.getAttribute("OperationMode")=="ReadOnly")return;working&=window.event.button==1;if(!working&&!editing)sizeColumn==null&&sizeRow==null&&element.document.FpActiveSpread==element&&element.document.releaseCapture();if(working){if(dragCol>=0){var n=getMovingCol();if(n!=null){var q=getPosIndicator();if(n.style.display=="none")n.style.display="";var i=-3;if(!xhtml)i+=parseInt(element.style.borderWidth);var w=element.document;if(!w.getElementById)w=window.document;var r=window.event.clientX;n.style.top=window.event.clientY-getOffsetTop(n.offsetParent,w.body,false)+getScrollTop(n.offsetParent)-i+"px";n.style.left=window.event.clientX-getOffsetLeft(n.offsetParent,w.body,false)+getScrollLeft(n.offsetParent)-i+"px";var kb=getViewport(),jb=element.document.body,d=getGroupBar(),a=-1,J=$$(element).offset(),l=J.left,F=J.top;r=window.event.clientX+(J.left-element.getBoundingClientRect().left);if(d!=null&&(isChild(event.srcElement,d)||event.srcElement==d)){for(var e=0;e<d.children.length;e++){var K=d.children[e].offsetWidth;if(K==null)continue;if(l<=r&&r<l+K){a=e;break}l+=K}if(a==-1&&r>=l)a=-2;element.targetCol=a}else{if(getRowHeader()!=null)l+=getRowHeader().offsetWidth;if(d!=null)F+=d.offsetHeight;if(r<l)a=0;else{var h=selectedCols.context;if(h){var G=0;if(getColHeader()!=null)G=getColHeader().parentNode.scrollLeft;for(var e=0;e<h.length;e++){var H=!h[e].frozen?h[e].left-G:h[e].left;if(H+l<=r&&r<H+l+h[e].width){a=e;break}}if(isColSelected(a))while(isColSelected(a)&&isColSelected(a-1))a--;else if(isColSelected(a-1))a++;if(a<0)a=0;if(a>=h.length)a=h.length-1;var H=!h[a].frozen?h[a].left-G:h[a].left;l+=H}}var A=parseInt(GetSheetColIndex(a));if(A<0)if(selectedCols.context){var T=selectedCols.context[a].colKey;A=T?T:a}else A=a;element.targetCol=A}var V=w.getElementById(element.id+"_titleBar");if(V)F+=V.parentNode.parentNode.offsetHeight;if(getPager1()!=null)F+=getPager1().offsetHeight;var M=$$(q.offsetParent).offset();q.style.posLeft=l-6-M.left;q.style.posTop=F-M.top;if(d!=null&&(isChild(event.srcElement,d)||event.srcElement==d)&&(d.children.length<1||d.children[0].tagName==null))q.style.display="none";else if(allowColMove||(isChild(event.srcElement,d)||event.srcElement==d)&&allowGroup)q.style.display="";else q.style.display="none"}var b=getScrollvp();if(b==null)b=getParent(getViewport());if(b!=null){var f=getOffsetLeft(b.offsetParent,element.document.body)-getScrollLeft(element),g=0;if(getViewportHolder()!=null){f+=getViewportHolder().offsetLeft;g=f+getViewportHolder().offsetWidth-10}else{f+=b.offsetLeft;g=f+b.offsetWidth-20}if(event.clientX>g){setScrollLeft(b.scrollLeft+10);UpdatePostbackData()}else{if(getViewportHolder()!=null&&getViewport2()!=null)g=f+getViewport2().offsetWidth+5;else g=f+5;if(event.clientX<g){setScrollLeft(b.scrollLeft-10);UpdatePostbackData()}}}return}if(sizeColumn==null&&sizeRow==null){if(anchorCell!=null){var b=getScrollvp();if(b==null)b=getParent(getViewport());if(b!=null){var s=getOffsetTop(b.offsetParent,element.document.body)-getScrollTop(element),u=0;if(getViewportHolder()!=null){s+=getViewportHolder().offsetTop;u=s+getViewportHolder().offsetHeight-10}else{s+=b.offsetTop;u=s+b.offsetHeight-10}var C=element.getAttribute("ClientAutoSize")!="True";if(event.clientY>u){C&&setScrollTop(b.scrollTop+10);ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}else{if(getViewportHolder()!=null&&getViewport1()!=null)u=s+getViewport1().offsetHeight+5;else u=s+5;if(event.clientY<u){var v=true,S=getSelection(),o=xmlData.lastChild(S);if(o!=null){var fb=parseInt(o.getAttribute("rowcount")),eb=parseInt(o.getAttribute("colcount"));v=(eb>0||element.getAttribute("OperationMode")=="SingleSelect")&&getRowFromCell(anchorCell)>=frzRows;if(parseInt(o.getAttribute("row"))<0)v=false}if(v){if(C)if(b.scrollTop-10>=element.virtualTop)setScrollTop(b.scrollTop-10);else setScrollTop(element.virtualTop);ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}}}var f=getOffsetLeft(b.offsetParent,element.document.body)-getScrollLeft(element),g=0;if(getViewportHolder()!=null){f+=getViewportHolder().offsetLeft;g=f+getViewportHolder().offsetWidth-10}else{f+=b.offsetLeft;g=f+b.offsetWidth-20}if(event.clientX>g){C&&setScrollLeft(b.scrollLeft+10);ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}else{if(getViewportHolder()!=null&&getViewport2()!=null)g=f+getViewport2().offsetWidth+5;else g=f+5;if(event.clientX<g){var v=true,S=getSelection(),o=xmlData.lastChild(S);if(o!=null){var fb=parseInt(o.getAttribute("rowcount")),eb=parseInt(o.getAttribute("colcount"));v=fb>0&&(isChild(anchorCell,getViewport())||isChild(anchorCell,getViewport1()));if(parseInt(o.getAttribute("col"))<0)v=false}if(v){C&&setScrollLeft(b.scrollLeft-10);ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}}}}var c=getCell(window.event.srcElement),gb=getSpreadControl(c);if(gb!=element)return;if(c!=null&&c!=leadingCell){var p=element.getAttribute("OperationMode");if(p!="MultiSelect"){if(!inColHeader(c)&&(p=="SingleSelect"||p=="RowMode")){var y=getRowFromCell(c),k;if(inRowHeader(c)){if(anchorCell!=null)if(inRowHeader(anchorCell))k=-1;else k=getColFromCell(anchorCell);else k=-1;if(k==-1){var db=fpSpreadJS.getNextColumn(y,0,false,true,true);if(db==-1)k=getColFromCell(c)}}else k=getColFromCell(c);var bb=fireActiveCellChangingEvent(y,k,element);if(bb)return;oldAnchorCell=anchorCell;ClearSelection();updateAnchorCell(y,k,false);selectRow(y,1,true,true);if(getCellFromRowCol(selectStartRow,k)==anchorCell)leadingCellRow=selectStartRow;fireActiveCellChangedEvent(y,k,element)}else if(!(inColHeader(c)&&p=="ExtendedSelect")&&p!="SingleSelect"&&p!="RowMode"&&!(p=="Normal"&&element.getAttribute("SelectionPolicy")=="Single")&&!element.getAttribute("layoutMode")){select(anchorCell,c);syncColSelection()}leadingCell=c}}}}else if(sizeColumn!=null){var E=window.event.clientX-activeX,W=parseInt(sizeColumn.width)+E,Y=0,U=W>Y;if(U){var Q=getSizeHeader();if(Q||frzRows>0||frzCols>0){var i=0;if(!xhtml)i+=parseInt(element.style.borderWidth);var j=getScrollvp();if(j==null)j=getViewport().parentElement;var B=false,a=element;while(a!=element.offsetParent.parentNode){if(a.style.position=="absolute"||a.style.position=="relative"){B=true;break}a=a.parentNode}sizeBar.style.cursor=getResizeCursor(false);if(a==element.offsetParent||a==element)sizeBar.style.posLeft=window.event.clientX-getOffsetLeft(j.offsetParent,element.document.body)+getScrollLeft(element)-i;else if(B)sizeBar.style.posLeft=window.event.clientX-a.offsetLeft-getOffsetLeft(j.offsetParent,element.document.body)+getScrollLeft(element)-i;else sizeBar.style.posLeft=window.event.clientX-getOffsetLeft(j.offsetParent,element.document.body)+getScrollLeft(element)-i}else{sizeColumn.width=W;activeX=window.event.clientX;var R=getCorner();R&&R.getAttribute("allowTableCorner")!=null&&syncRowRange(-1,-1,true,false)}}}else if(sizeRow!=null){ignoreSynRowHeight=true;var E=window.event.clientY-activeY,c=getFirstNonSpanCell(sizeRow),cb=c?c.offsetHeight+E:sizeRow.offsetHeight+E,Y=0,U=Y<cb;if(U){var Q=getSizeHeader();if(Q||frzRows>0||frzCols>0){var i=0;if(!xhtml)i+=parseInt(element.style.borderWidth);var j=getScrollvp();if(j==null)j=getViewport().parentElement;var B=false,a=element;while(a!=element.offsetParent.parentNode){if(a.style.position=="absolute"||a.style.position=="relative"){B=true;break}a=a.parentNode}if(a==element.offsetParent||a==element)sizeBar.style.posTop=window.event.clientY-getOffsetTop(j.offsetParent,element.document.body)+getScrollTop(element)-i;else if(B)sizeBar.style.posTop=window.event.clientY-a.offsetTop-getOffsetTop(j.offsetParent,element.document.body)+getScrollTop(element)-i;else sizeBar.style.posTop=window.event.clientY-getOffsetTop(j.offsetParent,element.document.body)+getScrollTop(element)-i}else{sizeRow.style.posHeight=Math.max(10,getOffsetHeight(sizeRow)+E);if(c)c.style.height="";activeY=window.event.clientY}}}}else{activeElement=window.event.srcElement;if(activeElement==null||getSpreadControl(activeElement)!=element)return;var N=null,m=getCell(activeElement,false),P=false;if(activeElement!=null)N=activeElement.style.cursor;var D=getSizeColumn(window.event.srcElement);if(D!=null){sizeColumn=D;if(!editing)activeElement.style.cursor=getResizeCursor(false)}else{var D=getSizeRow(window.event.srcElement);if(D!=null){P=true;sizeRow=D;if(!editing&&activeElement!=null&&activeElement.style!=null)activeElement.style.cursor=getResizeCursor(true)}else if(!editing&&activeElement!=null&&activeElement.style!=null&&activeElement.tagName!="BR"){var c=getCell(activeElement);if(c!=null&&isHeaderCell(c))if(activeElement.getAttribute("FpSpread")=="rowpadding"||activeElement.getAttribute("ControlType")=="chgrayarea")activeElement.style.cursor=getgrayAreaCursor();else activeElement.style.cursor="default";else if(activeElement!=null&&activeElement.style!=null&&(activeElement.getAttribute("FpSpread")=="rowpadding"||activeElement.getAttribute("ControlType")=="chgrayarea"))activeElement.style.cursor=getgrayAreaCursor()}}var O=activeElement.style.cursor!=N;if(activeElement.FpSpread=="rowpadding"){m=activeElement;O=true}if($$.browser.quirksMode&&m!=null&&O){var t=null,X=getFrozRowHeader(),Z=getRowHeader();if(isChild(m,X))t=X;else if(isChild(m,Z))t=Z;if(t!=null&&parseInt(t.cellSpacing)==0)if(!P){for(var ib=false,L=m.parentNode.rowIndex,e=L-1;e>=0;e--)for(var x=t.rows[e],z=0;z<x.cells.length;z++)if(x.cells[z].rowSpan>1&&x.rowIndex+x.cells[z].rowSpan==L)return setFixBorderTopStyle(m,x.cells[z])}else if(m.rowSpan>1&&m.parentNode.cells.length==1){var I=t.rows[sizeRow.rowIndex+1];if(I!=null&&I.cells.length>0){var ab=I.cells[0];setFixBorderTopStyle(ab,m)}}}}}function setFixBorderTopStyle(a,c){var b=c.currentStyle||c.style;if(a.style.borderTopStyle=="")a.style.borderTopStyle=b.borderBottomStyle;if(a.style.borderTopColor==""||a.style.borderTopColor=="transparent")a.style.borderTopColor=b.borderBottomColor;if(a.style.borderTopWidth==""||parseInt(a.style.borderTopWidth)=="0")a.style.borderTopWidth=b.borderBottomWidth}function getgrayAreaCursor(){if(tableView!=null&&tableView.style.cursor!=null){if(tableView.style.cursor=="auto")tableView.style.cursor="default";return tableView.style.cursor}else return"default"}function getResizeCursor(a){return a?clientInformation.appVersion.indexOf("MSIE 6.0")!=-1?"row-resize":"n-resize":clientInformation.appVersion.indexOf("MSIE 6.0")!=-1?"col-resize":"w-resize"}function hitCommandBar(){var b=getCommandBar();if(window.event==null)return false;var a=window.event.srcElement;while(a!=null&&a!=this){if(a==b)return true;a=a.parentElement}return false}function hitView(){var b=getViewport(),a=window.event.srcElement;while(a!=null&&a!=this){if(a==b)return true;a=a.parentElement}return false}function openWaitMsg(){var h=element.document;if(!h.getElementById)h=window.document;var b=h.getElementById(element.id+"_waitmsgcontainer");if(b==null){var e=h.getElementById(element.id+"_waitmsg");e.style.display="block";var j=element.offsetWidth,i=element.offsetHeight,c=Math.max(10,(j-parseInt(e.offsetWidth))/2),d=Math.max(10,(i-parseInt(e.offsetHeight))/2);if(element.currentStyle.position!="absolute"&&element.currentStyle.position!="relative"){c+=element.offsetLeft;d+=element.offsetTop;if(element.parentElement!=null){var f=0,g=0,a=element;while(a.parentElement!=null){if(a.nodeName=="TD"){f=a.offsetLeft;g=a.offsetTop}a=a.parentElement}c+=f;d+=g}}e.style.top=d+"px";e.style.left=c+"px"}else{b.style.display="block";var d=Math.max(10,(element.offsetHeight-parseInt(b.offsetHeight))/2),c=element.clientLeft+8;if(element.currentStyle.position!="absolute"&&element.currentStyle.position!="relative"){c+=element.offsetLeft;d+=element.offsetTop;if(element.parentElement!=null){var f=0,g=0,a=element;while(a.parentElement!=null){if(a.nodeName=="TD"){f=a.offsetLeft;g=a.offsetTop}a=a.parentElement}c+=f;d+=g}}b.style.top=d+"px";b.style.left=c+"px";b.style.width=element.offsetWidth-element.clientLeft-8+"px"}}function closeWaitMsg(){var a=element.document;if(!a.getElementById)a=window.document;var b=a.getElementById(element.id+"_waitmsgcontainer");if(b==null){var c=a.getElementById(element.id+"_waitmsg");if(c!=null)c.style.display="none"}else b.style.display="none"}function checkRightButton(g){if(!element.inDesign)return true;if(g.button!=2)return true;var c=getCell(g.srcElement);if(!c){var i=getCorner();return i==null||!i.contains(g.srcElement)}var f=GetSelectedRanges();if(f!=null&&f.length>0){for(var b=false,h=0;h<f.length&&!b;h++){var a=f[h];if(a.row==-1&&a.col==-1)b=false;var d=getColFromCell(c),e=getRowFromCell(c);if(d==null||e==null)b=true;if(c.parentElement.getAttribute("FpSpread")=="ch")b=d>=a.col&&d<a.col+a.colCount&&a.row==-1;else if(c.parentElement.getAttribute("FpSpread")=="rh")b=e>=a.row&&e<a.row+a.rowCount&&a.col==-1;else b=(a.col==-1||d>=a.col&&d<a.col+a.colCount)&&(a.row==-1||e>=a.row&&e<a.row+a.rowCount)}return b}return false}function cmdBtnClickHandler(){var a=window.event.srcElement;a._clickHandler!=null&&endEditSpread()&&a._clickHandler.apply(a,arguments)}function documentMouseMove(a){if(sizeRow==null&&sizeColumn==null)return;var b=getSpreadControl(a.srcElement);b!=element&&mouseMove(a);element.captureElement!=null&&element.captureElement.setCapture()}function documentMouseUp(a){element.document.detachEvent("onmousemove",documentMouseMove);element.document.detachEvent("onmouseup",documentMouseUp);var b=getTopSpread(element);a.srcElement!=b&&!isChild(a.srcElement,b)&&mouseUp(a)}function mouseDown(){if(element.getAttribute("childViewsLoaded")!=null&&isExtenderPopupControl(window.event.srcElement)){$$.utils.cancelBubble(window.event);return}if(window.fpPostOn!=null){window.event.returnValue=false;window.event.cancelBubbling=true;return}ignoreBlur=true;isactive=true;element.preventPopUp=false;element.working=false;mouseY=window.event.clientY;if(isChild(window.event.srcElement,getCommandBar())){CBMouseDown();var n=window.event.srcElement;if(n.onclick!=null&&n.onclick!=cmdBtnClickHandler){n._clickHandler=n.onclick;n.onclick=cmdBtnClickHandler}if(!endEditSpread())window.event.returnValue=false;return}var v=checkRightButton(window.event);if(window.event.srcElement.parentElement!=null&&window.event.srcElement.parentElement.getAttribute("name")==element.id+"_slideBar"){if(isChild(window.event.srcElement,getPager1()))activePager=getPager1();else if(isChild(window.event.srcElement,getPager2()))activePager=getPager2();if(activePager!=null){var s=true;if(editing)s=EndEdit();if(s){dragSlideBar=true;activePager.setCapture()}}return}dragCol=-1;dragViewCol=-1;if(v&&window.event.button!=1)return;if(getViewport0()==null&&getViewport()==null)return;if(element.getAttribute("OperationMode")=="ReadOnly")return;if(getSpreadControl(event.srcElement,true)!=element)return;var c=window.event.srcElement;if(editing){if(window.event.srcElement!=editor&&editor!=null&&!isChild(c,editor))typeof editor.blur!="undefined"&&editor.parentElement!=null&&editor.blur();var d=getCell(c);if(d!=anchorCell||d==c){var J=ignoreEditorFocus;ignoreEditorFocus=true;var s=EndEdit();if(!s){editor.focus();return}ignoreEditorFocus=J}else return}else if(!endEditSpread())return false;if(!isChild(c,element))return false;sizeColumn=getSizeColumn(c);if(sizeColumn==null)sizeRow=getSizeRow(c);var A=element.document.FpActiveSpread==null||element.document.FpActiveSpread!=element,b=c,r=FpSpreadJS.getTableRow(b);if(sizeColumn==null&&sizeRow==null&&(hitCommandBar()||b==getParent(getViewport())||b==getParent(getViewport1())||b==getParent(getViewport2())||b.getAttribute&&(b.getAttribute("ControlType")=="chgrayarea"||b.getAttribute("FpSpread")=="rowpadding")||r!=null&&FpSpreadJS.getTable(r)==getRowHeader()&&FpSpreadJS.isChildSpreadRow(getViewport(),r.rowIndex))){getTopSpread(element.document.FpActiveSpread)!=element&&setActiveSpread();return}(element.document.FpActiveSpread==null||sizeColumn==null&&sizeRow==null)&&setActiveSpread();if(element.document.FpActiveSpread!=element&&sizeColumn==null&&sizeRow==null)return;if(v&&window.event.button!=1)return;if(working)return;if(isChild(c,getGroupBar())){var w=parseInt(c.id.replace(element.id+"_group",""));if(!isNaN(w)){initMovingCol(w,true,c);working=true;event.returnValue=false;window.event.cancelBubbling=true;element.setCapture();element.dragFromGroupbar=true;return}}if(sizeColumn!=null){getTopSpread(element).resizing=true;working=true;activeX=activeY=window.event.clientX;if(sizeColumn.style!=null)sizeColumn.style.cursor=getResizeCursor(false);b=c;b.setCapture();var t=getSizeHeader();if(t||frzRows>0||frzCols>0){var e=getScrollvp();if(e==null)e=getViewport().parentElement;var l=false,d=element;while(d!=element.offsetParent.parentNode){if(d.style.position=="absolute"||d.style.position=="relative"||d.style.position=="fixed"){l=true;break}d=d.parentNode}sizeBar.style.cursor=getResizeCursor(false);if(l||engine<8)sizeBar.style.posTop=element.offsetTop;else{var C=getColHeader()!=null?getColHeader().offsetHeight:0;sizeBar.style.posTop=element.offsetParent.offsetTop+getOffsetTop(e.parentNode,element.offsetParent)-C}var k=0;if(!xhtml)k+=parseInt(element.style.borderWidth);if(d==element.offsetParent||d==element)sizeBar.style.posLeft=activeX-getOffsetLeft(e.offsetParent,element.document.body)+getScrollLeft(element)-k;else if(l)sizeBar.style.posLeft=activeX-d.offsetLeft-getOffsetLeft(e.offsetParent,element.document.body)+getScrollLeft(element)-k;else sizeBar.style.posLeft=activeX-getOffsetLeft(e.offsetParent,element.document.body)+getScrollLeft(element)-k;if(getColHeader()!=null)sizeBar.style.height=getColHeader().offsetHeight+e.clientHeight+"px";else sizeBar.style.height=e.offsetHeight+"px";sizeBar.style.width="2px"}}else if(sizeRow!=null){getTopSpread(element).resizing=true;working=true;activeX=activeY=window.event.clientY;b=c;b.setCapture();element.captureElement=b;element.document.detachEvent("onmousemove",documentMouseMove,true);element.document.attachEvent("onmousemove",documentMouseMove,true);element.document.detachEvent("onmouseup",documentMouseUp,true);element.document.attachEvent("onmouseup",documentMouseUp,true);element.working=true;var t=getSizeHeader();if(t||frzRows>0||frzCols>0){var e=getScrollvp();if(e==null)e=getViewport().parentElement;if(getRowHeader()!=null)sizeBar.style.width=getRowHeader().offsetWidth+e.clientWidth+parseInt(getViewport().cellSpacing)+"px";else sizeBar.style.width=e.clientWidth+parseInt(getViewport().cellSpacing)+"px";var l=false,d=element;while(d!=element.offsetParent.parentNode){if(d.style.position=="absolute"||d.style.position=="relative"||d.style.position=="fixed"){l=true;break}d=d.parentNode}if(l||engine<8)sizeBar.style.posLeft=element.offsetLeft;else{var G=getRowHeader()!=null?parseInt(getRowHeader().cellSpacing)-getRowHeader().offsetWidth:0;sizeBar.style.posLeft=element.offsetParent.offsetLeft+getOffsetLeft(e.parentNode,element.offsetParent)+G}sizeBar.style.height="2px";var k=0;if(!xhtml)k+=parseInt(element.style.borderWidth);if(d==element.offsetParent||d==element)sizeBar.style.posTop=activeY-getOffsetTop(e.offsetParent,element.document.body)+getScrollTop(element)-k;else if(l)sizeBar.style.posTop=activeY-d.offsetTop-getOffsetTop(e.offsetParent,element.document.body)+getScrollTop(element)-k;else sizeBar.style.posTop=activeY-getOffsetTop(e.offsetParent,element.document.body)+getScrollTop(element)-k}}else{var a=getCell(c);if(a==null){var u=getCorner();if(u!=null&&u.contains(c)){if(operationMode=="Normal"){anchorCell==null&&focus();if(anchorCell!=null)saveAnchorCell(anchorCell);else{setActiveRow(-1);setActiveCol(-1)}oldAnchorCell=anchorCell;selectTable(true);if(anchorCell){leadingCellRow=getRowFromCell(anchorCell);leadingCellCol=getColFromCell(anchorCell)}}else ClearSelection(null,element);doGetFocus()}return}var g=getColFromCell(a);if(a.parentElement.getAttribute("FpSpread")=="ch"&&g>=GetColCount()){doGetFocus();return}if(a.parentNode.getAttribute("FpSpread")=="rh"&&FpSpreadJS.isChildSpreadRow(getViewport(),a.parentNode.rowIndex)){ClearSelection(null,element);return}var H=a.getAttribute("canFocus")=="false";if(H)return;if(a.parentElement.getAttribute("FpSpread")=="ch"&&element.getAttribute("OperationMode")!="Normal"){ClearSelection(null,element);if(allowColMove||allowGroup){if(element.getAttribute("layoutMode"))g=parseInt(a.col);initMovingCol(g)}working=true;b=c;b.tagName!="INPUT"&&b.tagName!="TEXTAREA"&&b.tagName!="SELECT"&&b.setCapture();return}if(a.parentElement.getAttribute("FpSpread")=="ch"&&(element.getAttribute("OperationMode")=="RowMode"||element.getAttribute("OperationMode")=="SingleSelect"||element.getAttribute("OperationMode")=="ExtendedSelect")){if(!allowColMove&&!allowGroup)return}else{var I=fireActiveCellChangingEvent(getRowFromCell(a),g,element,a.parentElement.getAttribute("row"));if(I)return;var p=getTopSpread(element);if(p!=element)if(p.fireActiveCellChangingEvent(getRowFromCell(a),g,element,a.parentElement.getAttribute("row")))return;var f=element.getAttribute("OperationMode");if(!window.event.ctrlKey||element.getAttribute("multiRange")!="true"){if(f!="MultiSelect"&&!(window.event.shiftKey&&f=="ExtendedSelect"&&element.getAttribute("layoutMode")==null))if(!((allowColMove||allowGroup)&&a.parentElement.getAttribute("FpSpread")=="ch"&&f=="Normal"&&(element.getAttribute("SelectionPolicy")=="Range"||element.getAttribute("SelectionPolicy")=="MultiRange")&&selectedCols.length!=0&&isColSelected(g))){var q=!isChild(a,getFrozRowHeader())&&!isChild(a,getRowHeader())||(selectionBlockOptions&SelectionBlockOptions.Rows)!=0&&operationMode!="ReadOnly";q=q&&(!isChild(a,getFrozColHeader())&&!isChild(a,getColHeader())||(selectionBlockOptions&SelectionBlockOptions.Columns)!=0&&operationMode=="Normal");if(q)ClearSelection();else return}}else if(f!="ExtendedSelect"&&f!="MultiSelect")if(anchorCell!=null){fpSpreadJS.updateSelectionRangeFromCell(anchorCell);fpSpreadJS.keepGeneratedSelectionFromAnchorCell();paintSelectedCell(anchorCell,true);updateSelectionsBackColor(getRowFromCell(a),getColFromCell(a))}}var o=anchorCell;anchorCell=a;if(o)oldAnchorCell=o;scrollToCell(anchorCell);var f=operationMode,h=a.parentElement.getAttribute("FpSpread"),E=h=="rh",D=h=="ch";if(h=="r"||h=="ch"||h=="rh"){saveAnchorCell(a);if(h=="ch")leadingCellRow=0;else if(h=="rh")leadingCellCol=0}if(anchorCell.parentElement.getAttribute("FpSpread")=="r"){if(window.event.shiftKey&&f=="ExtendedSelect"&&element.getAttribute("layoutMode")==null){var j=getExtendedSelectRows(o,leadingCell,anchorCell);ClearSelection();j!=null&&j.length>0&&selectRow(j[0],j[1],true,true)}else if(f=="ExtendedSelect"||f=="MultiSelect")if(isRowSelected(getRowFromCell(anchorCell)))selectRow(getRowFromCell(anchorCell),1,false,true);else selectRow(getRowFromCell(anchorCell),1,true,true);else if(f=="RowMode"||f=="SingleSelect")selectRow(getRowFromCell(anchorCell),1,true,true);else selectRange(getRowFromCell(anchorCell),g,1,1,true);selectStartRow=getRowFromCell(anchorCell);selectStartCol=g}else if(anchorCell.parentElement.getAttribute("FpSpread")=="ch")if(allowColMove||allowGroup){var i=g;if(f=="Normal"&&(element.getAttribute("SelectionPolicy")=="Range"||element.getAttribute("SelectionPolicy")=="MultiRange"))if(isColSelected(i)){adjustAnchorCell(i);paintAnchorCell();initMovingCol(i)}else selectColumn(i,1,true);else{if(element.getAttribute("layoutMode"))i=parseInt(anchorCell.getAttribute("col"));if(operationMode=="Normal"||operationMode=="ReadOnly")selectColumn(i,1,true);else selectedCols.push(i);initMovingCol(i)}}else if(operationMode=="Normal"){var i=g;if(element.getAttribute("layoutMode"))i=parseInt(anchorCell.getAttribute("col"));selectColumn(i,1,true)}else return;else if(anchorCell.parentElement.getAttribute("FpSpread")=="rh")if(window.event.shiftKey&&f=="ExtendedSelect"&&element.getAttribute("layoutMode")==null){var j=getExtendedSelectRows(o,leadingCell,anchorCell);ClearSelection();j!=null&&j.length>0&&selectRow(j[0],j[1],true,true)}else if(f=="ExtendedSelect"||f=="MultiSelect")if(isRowSelected(getRowFromCell(anchorCell)))selectRow(getRowFromCell(anchorCell),1,false,true);else selectRow(getRowFromCell(anchorCell),1,true,true);else selectRow(getRowFromCell(anchorCell),1,true);if((A||anchorCell!=o)&&anchorCell!=null){var y=GetSheetIndex(getRowFromCell(anchorCell)),x=g,z=parseInt(anchorCell.parentElement.getAttribute("row"));if(c.tagName=="SELECT")ignorePostbackEditmode=true;fireActiveCellChangedEvent(y,x,element,z);if(c.tagName=="SELECT")ignorePostbackEditmode=false;var p=getTopSpread(element);p!=element&&p.fireActiveCellChangedEvent(y,x,element,z)}if(isChild(anchorCell,element)){leadingCell=anchorCell;if(anchorCell!=null){h=anchorCell.parentElement.getAttribute("FpSpread");if(h=="rh"||h=="r")leadingCellRow=getRowFromCell(anchorCell);if(anchorCell==a)leadingCellCol=g;else if(h=="ch"||h=="r")leadingCellCol=getColFromCell(anchorCell);if(E&&getCellFromRowCol(selectStartRow,leadingCellCol)==anchorCell)leadingCellRow=selectStartRow;if(D&&getCellFromRowCol(leadingCellRow,selectStartCol)==anchorCell)leadingCellCol=selectStartCol}}b=c;var F=fpSpreadJS.getExtender(b)!=null,B=F||isExtenderPopupControl(b);b.tagName!="INPUT"&&b.tagName!="TEXTAREA"&&b.tagName!="SELECT"&&!B&&b.setCapture();working=!(b.tagName=="SELECT"&&(isChild(a,getColHeader())||isChild(a,getFrozColHeader())))}enableButtons();if(engine>=9){ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}if(!editing&&sizeRow==null&&sizeColumn==null)if(anchorCell!=null&&isChild(anchorCell,element)&&!isHeaderCell(getCell(c))){var m=getEditor(anchorCell);if(m!=null){if(c==anchorCell)element.preventPopUp=true;setEditorFocus(m);editing=m.type!="button"&&m.type!="submit";editor=m;renderAsEditor=1;editingValue=getEditorValue(m)}}}function getMovingCol(){if(movingCol!=null)return movingCol;var b=element.document;if(!b.createElement)b=window.document;var a=b.createElement("div");movingCol=a;a.style.position="absolute";a.style.top="0px";a.style.left="20px";a.id=element.id+"movingCol";a.align="center";element.insertBefore(a);a.style.display="none";if(element.getAttribute("DragColumnCssClass")!=null)a.className=element.getAttribute("DragColumnCssClass");else a.style.border="1px solid black";a.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=50)";return a}function isControl(a){return a!=null&&(a.tagName=="INPUT"||a.tagName=="TEXTAREA"||a.tagName=="SELECT")}function changeButtonsState(b){var a=getCmdBtn("Update");a!=null&&a.disabled&&updateCmdBtnState(a,!b);a=getCmdBtn("Cancel");a!=null&&a.disabled&&updateCmdBtnState(a,!b)}function enableButtons(){var f=getCellType(anchorCell),e=getSelection(),b=xmlData.lastChild(e),c=operationMode=="ReadOnly"||operationMode=="SingleSelect"||f=="readonly";if(!c)c=anyReadOnlyCell(b);if(c){var a=getCmdBtn("Copy");updateCmdBtnState(a,b==null);var d=getClipboardData();a=getCmdBtn("Paste");updateCmdBtnState(a,b==null||d==null);a=getCmdBtn("Clear");updateCmdBtnState(a,true)}else{var a=getCmdBtn("Copy");updateCmdBtnState(a,b==null);var d=getClipboardData();a=getCmdBtn("Paste");updateCmdBtnState(a,b==null||d==null);a=getCmdBtn("Clear");updateCmdBtnState(a,b==null)}}function getCmdButtonState(a){return a==null||a.disabled||/true/i.test(a.getAttribute("disabled"))||a.tagName=="IMG"&&new RegExp(a.getAttribute("disabledImg")+"$","i").test(a.src)?false:true}function updateCmdBtnState(a,d){if(typeof a=="string")a=getCmdBtn(a);if(a==null)return;var e=a.disabled;if(e==d)return;a.disabled=d;if(a.tagName=="IMG"){var b=a.getAttribute("disabledImg");if(d&&b!=null){if(a.src.indexOf(b)<0)a.src=b}else{var c=a.getAttribute("enabledImg");if(c!=null&&a.src.indexOf(c)<0)a.src=c}}}function setImageButtonSrc(a,e){if(a==null)return;if(a.tagName!="IMG")return;switch(e){case 0:case"enable":var c=a.getAttribute("enabledImg");if(c!=null&&a.src.indexOf(c)<0)a.src=c;break;case 1:case"disable":var b=a.getAttribute("disabledImg");if(b!=null&&a.src.indexOf(b)<0)a.src=b;break;case 2:case"hover":var d=a.getAttribute("hoverImg");if(d!=null&&a.src.indexOf(d)<0)a.src=d}}function getExtendedSelectRows(h,e,g){var a=[],d=e!=null?getRowFromCell(e):getRowFromCell(h),b=getRowFromCell(g),f=getSelection();if(f==null){a.push(null);a.push(1)}else{var c=getSelectRowNode(f,d);if(c!=null)if(b<c.startRow){a.push(b);if(d==c.startRow)a.push(c.endRow-b+1);else a.push(c.startRow-b+1)}else if(c.startRow<=b&&b<=c.endRow)if(b>=d){a.push(b);a.push(c.endRow-b+1)}else{a.push(c.startRow);a.push(b-c.startRow+1)}else if(d==c.startRow){a.push(c.endRow);a.push(b-c.endRow+1)}else{a.push(c.startRow);a.push(b-c.startRow+1)}else if(d<b){a.push(d+1);a.push(b-d-1)}else{a.push(b);a.push(Math.max(1,d-b))}}return a}function getSelectRowNode(f,d){var a=null,c=xmlData.firstChild(f),h;for(var c in childs){var g=parseInt(c.getAttribute("colIndex"));if(g==-1){var b=parseInt(c.getAttribute("rowIndex")),e=parseInt(c.getAttribute("rowcount"));if(b<=d&&d<b+e){a={};a.startRow=b;a.endRow=b+e-1;break}}}return a}function mouseUp(){mouseUpInternal();try{!fpSpreadJS.isOutOfView(anchorCell)&&fpSpreadJS.correctFocusOnActiveCell(anchorCell)}catch(a){}}function mouseUpInternal(){element.captureElement=null;if(window.fpPostOn!=null||isExtenderPopupControl(window.event.srcElement)){window.event.returnValue=false;window.event.cancelBubbling=true;return}ignoreSynRowHeight=false;if(isChild(window.event.srcElement,getCommandBar())){CBMouseUp();focus();if(!working){ignoreBlur=false;return}}if(editing){var q=getCell(window.event.srcElement),J=getCellType(q);if(q!=null){var H=getEditor(q);if(H!=null&&renderAsEditor==1)if(J==$$.CellTypes.CHECKBOX||J==$$.CellTypes.RADIO_BUTTON_LIST){var U=getEditorValue(H);editingValue=U;changeButtonsState(true)}}}if(dragSlideBar){dragSlideBar=false;if(activePager!=null){activePager.releaseCapture();element.document.focus();setTextBoxFocus();var db=moveSlideBar(window.event)-1;activePager=null;GotoPage(db)}ignoreBlur=false;return}if(getViewport0()==null&&getViewport()==null)return;if(element.getAttribute("OperationMode")=="ReadOnly")return;var y=true;if(working){if(dragCol>=0){if(element.dragFromGroupbar)if(event.srcElement==getGroupBar()||isChild(event.srcElement,getGroupBar()))if(element.targetCol>0)Regroup(dragCol,parseInt((element.targetCol+1)/2));else Regroup(dragCol,element.targetCol);else Ungroup(dragCol,element.targetCol);else if(event.srcElement==getGroupBar()||isChild(event.srcElement,getGroupBar())){if(allowGroup)if(element.targetCol>0)Group(dragCol,parseInt((element.targetCol+1)/2));else Group(dragCol,element.targetCol)}else if(allowColMove)if(element.targetCol!=null){var L=$$.browser;if(L.quirksMode){var b=createEventObject();b.cancel=false;b.col=selectedCols;b.spread=element;ColumnDragMove.fire(b)}else{var v={spread:element,cancel:false,col:selectedCols},b=$$.utils.createEvent("ColumnDragMove",false,true,v);element.dispatchEvent(b)}if(!b.cancel){var bb=dragViewCol,S=operationMode!=$$.OperationModes.NORMAL?fpSpreadJS.buildTargetColsMoved(selectedCols,bb,element.targetCol):null;MoveCol(dragCol,element.targetCol);var G=operationMode!=$$.OperationModes.NORMAL?S:selectedCols;if(L.quirksMode){b=createEventObject();b.col=G;b.spread=element;ColumnDragMoveCompleted.fire(b)}else{var v={spread:element,col:G},b=$$.utils.createEvent("ColumnDragMoveCompleted",false,true,v);element.dispatchEvent(b)}}}var P=getMovingCol();if(P!=null)P.style.display="none";var Q=getPosIndicator();if(Q!=null)Q.style.display="none";dragCol=-1;dragViewCol=-1;element.dragFromGroupbar=false;element.targetCol=null}if(sizeColumn!=null){y=false;var k=window.event.clientX-activeX,ab=window.event.clientX-activeY,V=sizeColumn.parentElement.parentElement,B=parseInt(sizeColumn.getAttribute("index")),g=getRealColWidth(V,B<frzCols?B:B-frzCols),K=g-ab+k;g+=k;if(g<1)g=1;if(xhtml&&g<20&&isChild(sizeColumn,getRowHeader()))g=20;var d=false,j=null;if(activeY!=window.event.clientX){d=isChild(sizeColumn,getRowHeader())||isChild(sizeColumn,getFrozRowHeader());if(d)setRowHeaderColWidth(sizeColumn.getAttribute("index"),g,false);else{setColWidth(sizeColumn.getAttribute("index"),g,K,false);j=[];j.push(element);if(getTopSpread()!=element){var u=element.document;if(!u.all)u=window.document;for(var a=0;a<u.all.length;a++){var R=u.all(a);if(R.getAttribute("NAME")==sizeColumn.getAttribute("NAME")){var E=getSpreadControl(R);if(E!=element){E.setColWidth(sizeColumn.getAttribute("index"),g,K,false);j.push(E)}}}}}if($$.browser.quirksMode){var b=createEventObject();b.sizeHeader=d;b.col=sizeColumn.getAttribute("index");b.width=Math.max(g,sizeColumn.offsetWidth);b.spread=element;ColWidthChanged.fire(b)}else{var v={spread:element,sizeHeader:d,col:sizeColumn.getAttribute("index"),width:Math.max(g,sizeColumn.offsetWidth)},b=$$.utils.createEvent("ColWidthChanged",false,true,v);element.dispatchEvent(b)}}if(sizeBar!=null){sizeBar.style.left="-400px";sizeBar.style.cursor="default"}var N=getViewport().parentElement;saveScrollbarState(N.scrollTop,N.scrollLeft);fixBrokenColumns();loadScrollbarState(element,true);if(j==null)j=[element];var f=[getFrozColHeader(),getColHeader(),getFrozColFooter(),getColFooter()];getCorner()!=null&&getCorner().getAttribute("allowTableCorner")!=null&&f.push(getCorner());$$.utils.cleanArray(f);for(var a=0;a<f.length;a++){var p=f[a];p.__bkStyleHeight=p.style.height}for(var a=0;a<j.length;a++){var x=j[a];x.syncRowRange(-1,-1,true);x.syncRowRangeSafeMode(-1,-1,false);x.syncRowRange(-1,-1,false,true);x.sizeSpread(true)}for(var a=0;a<f.length;a++){var p=f[a];p.style.height=p.__bkStyleHeight;p.__bkStyleHeight=null}if(smartPaint){startTime=null;stopScroll()}scrollView();if(element.document.FpActiveSpread==null||element.document.FpActiveSpread==element){anchorCell==null&&focus();paintSelections(true);paintAnchorCell();paintFocusRect()}}else if(sizeRow!=null){y=false;var k=window.event.clientY-activeY,ab=window.event.clientY-activeX,c=Math.max(sizeRow.style.posHeight,getOffsetHeight(sizeRow))+k;if(isNaN(c)&&sizeRow.getAttribute("previewRow")=="true")c=sizeRow.offsetHeight;if(c<1){c=1;k=1-sizeRow.style.posHeight}if(xhtml&&c<10){c=10;k=10-sizeRow.style.posHeight}var l=getFirstNonSpanCell(sizeRow);if(k!=0){var X=c;sizeRow.style.posHeight=X}sizeRow.style.cursor="auto";var d=false;if(activeX!=window.event.clientY){d=isChild(sizeRow,getColHeader())||isChild(sizeRow,getFrozColHeader());if(d){var m=getCorner();if(m!=null&&m.getAttribute("allowTableCorner")&&m.rows(sizeRow.rowIndex).style.height!="")m.rows[sizeRow.rowIndex].style.posHeight=c;setColHeaderRowHeight(sizeRow.rowIndex,sizeRow.style.posHeight,false,sizeRow)}else{var e=null;if(isChild(sizeRow,getFrozRowHeader()))e=getViewport1();else e=getViewport();if(sizeRow.rowIndex<e.rows.length){if(c<1)c=1;if(xhtml&&c<10)c=10;var F=e.rows[sizeRow.rowIndex],z=getMaxRowSpanInRow(F);if(z>1){for(var O=[],a=0;a<z;a++)if(sizeRow.rowIndex+a<e.rows.length)O[a]=getOffsetHeight(e.rows(sizeRow.rowIndex+a));for(var a=0;a<z;a++)if(sizeRow.rowIndex+a<e.rows.length)e.rows(sizeRow.rowIndex+a).style.posHeight=O[a]}F.style.posHeight=c;var i=getFirstNonSpanCell(F);if(i!=null){i.style.posHeight=c;if(i.offsetHeight>c){var cb=i.style.posHeight-(i.offsetHeight-c);i.style.posHeight=Math.max(cb,0)}var I=i.vAlign;i.vAlign="";i.vAlign=I}if(l&&xhtml){var I=l.currentStyle!=null?l.currentStyle.verticalAlign:l.vAlign;l.vAlign="";l.vAlign=I}}var C=getViewport2();if(isChild(sizeRow,getFrozRowHeader()))C=getViewport0();if(C!=null){var D=C.rows(sizeRow.rowIndex);if(D!=null){var q=getFirstNonSpanCell(D);if(q!=null)q.style.posHeight="";D.style.posHeight=c}}if(isChild(sizeRow,getFrozRowHeader())&&engine<8)getFrozRowHeader().parentElement.parentElement.parentElement.style.posHeight+=k;if($$.browser.quirksMode||Number(getViewport().cellSpacing)>0)sizeRow.__updateXmlClientData=true;else saveRowInfo(sizeRow)}if($$.browser.quirksMode){var b=createEventObject();b.spread=element;b.sizeHeader=d;if(d)b.row=sizeRow.rowIndex;else b.row=getRowFromCell(sizeRow.cells[0]);b.height=Math.max(sizeRow.style.posHeight,sizeRow.offsetHeight);RowHeightChanged.fire(b)}else{var v={spread:element,sizeHeader:d,row:d?sizeRow.rowIndex:getRowFromCell(sizeRow.cells[0]),height:Math.max(sizeRow.style.posHeight,sizeRow.offsetHeight)},b=$$.utils.createEvent("RowHeightChanged",false,true,v);element.dispatchEvent(b)}}var o=sizeRow.rowIndex;if(!d&&!isChild(sizeRow,getFrozRowHeader()))o+=frzRows;var f=null;if(d){f=[getFrozColHeader(),getColHeader(),getFrozColFooter(),getColFooter()];getCorner()!=null&&getCorner().getAttribute("allowTableCorner")!=null&&f.push(getCorner());$$.utils.cleanArray(f);cleanElementsStyle(f,["height"])}if(d)syncRowRange(o,o,true);else syncRowRangeSafeMode(o,o,false);sizeSpread(true);if(sizeRow.__updateXmlClientData){sizeRow.__updateXmlClientData=null;saveRowInfo(sizeRow)}d&&restoreElementsStyle(f,["height"]);var M=getParentSpread();M!=null&&M.UpdateRowHeight(element);if(smartPaint){var T=newPageCount;newPageCount=getRowsPerPage(newTop);T!=newPageCount&&doUpdate()}if(smartPaint){startTime=null;stopScroll()}if(element.document.FpActiveSpread==null||element.document.FpActiveSpread==element){anchorCell==null&&focus();paintSelections(true);paintAnchorCell();paintFocusRect()}window.event.returnValue=false;if(sizeBar!=null)sizeBar.style.top="-400px"}if(activeElement!=null){if(activeElement.tagName!="INPUT"&&activeElement.tagName!="TEXTAREA"&&activeElement.tagName!="SELECT"){element.document.releaseCapture();if(editor==null&&(activeElement.id==null||activeElement.id.indexOf("RowEditTemplateContainer")==-1)){element.document.focus();setTextBoxFocus()}}activeElement=null}working=false;getTopSpread(element).resizing=false}if(y&&hitCommandBar()){ignorePaintSelection=true;doGetFocus();ignorePaintSelection=false;return}var t=false;if(frzRows==0&&frzCols==0){var W=getSelection(),r=xmlData.firstChild(W),h=new Range;if(r!=null){h.row=parseInt(r.getAttribute("rowIndex"));h.col=parseInt(r.getAttribute("colIndex"));h.rowCount=parseInt(r.getAttribute("rowcount"));h.colCount=parseInt(r.getAttribute("colcount"))}switch(selectType){case"":if(h.row>=0)for(var w=getViewport().rows,a=h.row;a<h.row+h.rowCount&&a<w.length;a++)if(w(a).cells.length>0&&w(a).cells(0).children.length>0)if(w(a).cells(0).children(0).getAttribute("FpSpread")=="Spread"){t=true;break}break;case"c":for(var e=getViewport(),a=0;a<e.rows.length;a++)if(IsChildSpreadRow(e,a)){t=true;break}break;case"r":for(var e=getViewport(),Z=h.rowCount,a=h.row;a<h.row+Z&&a<e.rows.length;a++)if(IsChildSpreadRow(e,a)){t=true;break}}}if(t){var s=getCmdBtn("Copy");updateCmdBtnState(s,true);s=getCmdBtn("Paste");updateCmdBtnState(s,true);s=getCmdBtn("Clear");updateCmdBtnState(s,true)}if(!this.IsInRowEditTemplate(window.event.srcElement)){if(window.event.srcElement.tagName=="SELECT")ignorePostbackEditmode=true;var n=getCell(window.event.srcElement);if(n==null){var Y=getViewportHolder();if(isChild(window.event.srcElement,Y)&&getTopSpread(element.document.FpActiveSpread)==element){ignorePaintSelection=true;doGetFocus();ignorePaintSelection=false;return}if(window.event.srcElement==getParent(getViewport())&&getTopSpread(element.document.FpActiveSpread)==element){ignorePaintSelection=true;doGetFocus();ignorePaintSelection=false;return}var m=getCorner();if(m==null||!m.contains(window.event.srcElement)){ignorePaintSelection=true;doGetFocus();ignorePaintSelection=false;return}}if(editModePermanent)if(n!=null)n.getAttribute("canFocus")!="false"&&doGetFocus();else doGetFocus();if(y){focus();if(element.document.FpActiveSpread==element&&n!=null&&n.parentElement.getAttribute("FpSpread")=="ch"&&(operationMode=="RowMode"||operationMode=="SingleSelect"||operationMode=="MultiSelect"||operationMode=="ExtendedSelect"))if(anchorCell!=null){paintSelections(true);paintAnchorCell()}}if(window.event.srcElement.tagName=="SELECT")ignorePostbackEditmode=false}this.UpdatePostbackData();var A=getEditor(anchorCell);A!=null&&window.event.srcElement.type=="radio"&&setTimeout(setRadioBtnFocus,0);A!=null&&isChild(window.event.srcElement,A)&&window.event.srcElement.type=="button"&&window.event.srcElement.focus();setTimeout(resetBlurFlag,0)}function saveRowInfo(c){var d=addRowInfo(c.getAttribute("FpKey"));if(d!=null){height=c.style.posHeight;if(c.synDelt!=null){var b=c.synDelt;if(frzCols>0){var a=frzRows>0?getViewport0().rows[0]:getViewport2().rows[0];if(a!=null&&a.synDelt!=null)b=Math.max(b,a.synDelt)}else{var a=frzRows>0?getViewport1().rows[0]:getViewport().rows[0];if(a!=null&&a.synDelt!=null)b=Math.max(b,a.synDelt)}height-=b}setRowHeight(d,height)}}function IsInRowEditTemplate(a){while(a&&a.parentNode){a=a.parentNode;if(a.tagName=="DIV"&&a.id==element.id+"_RowEditTemplateContainer")return true}return false}function processEditMode(){try{if(element.document.FpActiveSheetView!=element)return}catch(a){$$.DEBUG.Log(a,"processEditMode");return}ignoreBlur=true;editModePermanent&&StartEdit(anchorCell);focus();setTimeout(resetBlurFlag,0)}function doGetFocus(){var e=getTopSpread(element),c=$$.fn.createXMLDOMWrapper(e),b=c.selectSingleNode("root activechild");if(b!=null&&c.textContent(b)!=""){var a=element.document.getElementById(c.textContent(b));if(a!=null&&a!=element){a.doGetFocus();return}}element.document.FpActiveSpread!=element&&__setActiveSpread(element);if(activeChartObj!=null)return;var d=anchorCell&&anchorCell.getAttribute("CellType2")=="AjaxComboBoxCellType"&&anchorCell.getElementsByTagName("INPUT").length>0;!editModePermanent&&!d&&setTextBoxFocus();paintAnchorCell();paintSelections(true);isactive=true;if(editModePermanent&&!ignorePostbackEditmode)setTimeout(processEditMode,200);else setTimeout(resetBlurFlag,0)}function resetBlurFlag(){var e=getRowHeader(),f=getViewport(),d=getViewport2(),b=e!=null&&e.parentNode!=null?e.parentNode.scrollTop:-1,c=f!=null&&f.parentNode!=null?f.parentNode.scrollTop:-1,a=d!=null&&d.parentNode!=null?d.parentNode.scrollTop:-1;if(b!=-1&&c!=-1&&b!=c||b!=-1&&a!=-1&&b!=a||a!=-1&&c!=-1&&a!=c){var g=ignoreVirtualPaging;ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=g}ignoreBlur=false}function setRadioBtnFocus(){var a=getEditor(anchorCell);a!=null&&setEditorFocus(a)}function SynRowHeight(){}function UpdateRowHeight(d,i){var a=d.parentElement;while(a!=null){if(a.tagName=="TR")break;a=a.parentElement}if(a!=null){var b=a.rowIndex;if(getRowHeader()!=null&&b<getRowHeader().rows.length)if(xhtml){var e=getRowHeader(),c=getPagers(d).length>0?1:0,f=d.offsetHeight;a.cells[0].style.height="";e.rows[b].cells[0].style.height="";a.style.height=f+1+c+"px";a.synDelt=c;e.rows[b].style.height=f+1+c+"px";e.rows[b].synDelt=c}else{getRowHeader().rows(b).cells(0).style.height="";a.cells[0].style.height="";var g=d.offsetHeight+1;getRowHeader().rows(b).style.height=g+"px";a.style.height=g+"px"}}var h=getParentSpread();h!=null&&h.UpdateRowHeight(element,i)}function mouseOut(){if(isChild(window.event.srcElement,getCommandBar())||isChild(window.event.srcElement,getPager1())||isChild(window.event.srcElement,getPager2())){CBMouseOut();return}if(!working&&sizeColumn!=null&&sizeColumn.style!=null)sizeColumn.style.cursor="auto"}function CBMouseDown(){if(event.srcElement!=null&&event.srcElement.tagName=="IMG"&&!event.srcElement.disabled)var a=cb_btn=event.srcElement;if(event.srcElement!=null&&event.srcElement.tagName=="IMG"&&event.srcElement.disabled)event.srcElement.ignoreClick=true}function CBMouseUp(){var a=cb_btn;a!=null}function CBMouseOut(){var a=cb_btn;if(a!=null){var b=getCommandBar();if(isChild(a,getPager1()))b=getPager1();else if(isChild(a,getPager2()))b=getPager2();a.style.backgroundColor="";setImageButtonSrc(a,"enable");cb_btn=null}}function mouseOver(){if(!isChild(window.event.srcElement,getCommandBar())&&!isChild(window.event.srcElement,getPager1())&&!isChild(window.event.srcElement,getPager2()))return;var a=cb_btn;if(a==null&&event.srcElement!=null&&event.srcElement.tagName=="IMG"&&!event.srcElement.disabled&&event.srcElement.className!="aspNetDisabled"){a=cb_btn=event.srcElement;a.style.backgroundColor="cyan";setImageButtonSrc(a,"hover")}}function keyup(){if(window.event.keyCode==enter)if(editing&&editor!=null&&editor.tagName=="SELECT"){if(enter==window.event.keyCode)window.event.returnValue=false;var b=EndEdit();if(!b)return;var c=getTopSpread(element),a=element.document;if(!a.all)a=window.document;textBox=a.all(c.id+"_textBox");enter==window.event.keyCode&&textBox.focus()}resetBlurFlag()}function doIgnoreVirtualPaging(){if(!ignoreVirtualPaging){ignoreVirtualPaging=true;setTimeout(function(){ignoreVirtualPaging=false},300)}}function processKeyMap(){for(var ret=true,n=keyMap.length,i=0;i<n;i++){var ka=keyMap[i];if(window.event.keyCode==ka.key&&window.event.ctrlKey==ka.ctrl&&window.event.shiftKey==ka.shift&&window.event.altKey==ka.alt){ret=false;if(typeof ka.action=="function")ret=ka.action();else ret=eval(ka.action);break}}return ret}function keyDown(){if(window.fpPostOn!=null)return;ignoreBlur=true;var n=processKeyMap();if(!n)return;doIgnoreVirtualPaging();if(window.event.keyCode==space&&anchorCell!=null){var o=operationMode;if(o=="MultiSelect"){if(isRowSelected(getRowFromCell(anchorCell)))selectRow(getRowFromCell(anchorCell),1,false,true);else selectRow(getRowFromCell(anchorCell),1,true,true);return}}if(window.event.keyCode==27)window.event.returnValue=false;var b=false,a=null;if(editing&&editor!=null){a=getEditor(anchorCell);b=a!=null}if(window.event.keyCode!=left&&window.event.keyCode!=right&&window.event.keyCode!=enter&&window.event.keyCode!=tab&&editing&&!b&&editor.tagName=="SELECT")return;switch(window.event.keyCode){case left:case right:if(b&&editor.getAttribute("FpEditor")!="RadioButton"&&editor.getAttribute("FpEditor")!="TextBox"){editor!=null&&editor.tagName=="SELECT"&&editor.blur();EndEdit()}if(!editing||editor!=null&&editor.tagName=="SELECT"){editor!=null&&editor.blur();editing&&EndEdit();nextCell(window.event.keyCode)}break;case up:case down:case enter:if(editor!=null&&(editor.tagName=="TEXTAREA"||editor.tagName=="SELECT"))return;if(b&&this.editing&&editor.getAttribute("FpEditor")=="ExtenderEditor"){var f=editor.getAttribute("Extenders");if(f&&(f.indexOf("AutoCompleteExtender")!=-1||f.indexOf("FpComboBox")!=-1))return}if(enter==window.event.keyCode&&window.event.srcElement.tagName=="A")return;if(editing){if(enter==window.event.keyCode)window.event.returnValue=false;if(editor!=null&&editor.getAttribute("FpEditor")=="MultiColumnComboBoxCellType"&&anchorCell.getAttribute("FpEditorID")==null){var d=getRowFromCell(anchorCell);if(d==0&&window.event.keyCode==up)return;if(window.event.keyCode==down){d+=anchorCell.rowSpan-1;var j=GetRowCountInternal(),g=d==j-1;if(!g&&d==j-2){var l=getViewportFromCell(anchorCell);if(l.rows[l.rows.length-1].getAttribute("previewRow")=="true")g=true}if(g)return}}var k=EndEdit();if(!k)return}nextCell(window.event.keyCode);var h=element.document;if(!h.all)h=window.document;var c=getTopSpread(element);textBox=h.all(c.id+"_textBox");enter==window.event.keyCode&&textBox.focus();break;case tab:if(editing){var k=EndEdit();if(!k){window.event.returnValue=false;window.event.cancelBubble=true;return}}var c=getTopSpread(element),m=c.getAttribute("ProcessTab")=="true"||c.getAttribute("ProcessTab")=="True";if(m)nextCell(window.event.keyCode);else{hideSelectionBlock();setActiveSpreadID(c,"",null);element.document.FpActiveSpread=null}break;case shift:break;case home:case end:case pup:case pdn:!editing&&nextCell(window.event.keyCode);break;case space:if(b&&a!=null&&a.getAttribute("FpEditor")=="MultiColumnComboBoxCellType"){window.event.returnValue=false;break}default:var e=a!=null&&a.getAttribute("FpEditor")!=null&&(a.tagName=="INPUT"&&a.type=="text"||a.tagName=="TEXTAREA");if(window.event.keyCode==67&&event.ctrlKey&&(!editing||b&&!e))Copy();else if(window.event.keyCode==86&&event.ctrlKey&&(!editing||b&&!e))Paste();else if(window.event.keyCode==88&&event.ctrlKey&&(!editing||b&&!e))Clear();else if(!editing&&anchorCell!=null&&!isHeaderCell(anchorCell)&&!window.event.ctrlKey&&window.event.keyCode!=altkey&&anchorCell.getAttribute("canFocus")!="false"){var i=anchorCell.getElementsByTagName("INPUT");!(i!=null&&i.length>0&&i[0].getAttribute("FpEditor")=="Button")&&StartEdit(anchorCell);if(window.event.keyCode==backspace&&editor.tagName=="SELECT")window.event.returnValue=false;if(space==window.event.keyCode&&editor.getAttribute("FpEditor")!="Button"&&(editor.tagName!="INPUT"||editor.type!="checkbox"))window.event.returnValue=false}}}function Print(){if(editing)return;if(getParentSpread()!=null)return;saveData();element.document.printSpread==null&&element.document.body.insertAdjacentHTML("beforeEnd",'<iframe onload="javascript:eval('+element.id+").printSpread()\" name=printSpread width=0 height=0 src='scid=dummy.htm'></iframe>");var b=getForm();if(b==null)return;var a=b;a.__EVENTTARGET.value=element.getAttribute("name");a.__EVENTARGUMENT.value="Print";var c=a.target;a.target="printSpread";a.submit();a.target=c}function printSpread(){var a=element.document.activeElement;element.document.printSpread.focus();element.document.printSpread.print();a&&!a.disabled&&a.focus()}function PrintPDF(){if(editing)return;if(getParentSpread()!=null)return;saveData();var b=getForm();if(b==null)return;var a=b;a.__EVENTTARGET.value=element.getAttribute("name");a.__EVENTARGUMENT.value="PrintPDF";a.submit()}function ExpandRow(c){var a=element.document.FpActiveSpread;if(a==null)a=element;if(!a.IsValid())return;saveData();var d=element.getAttribute("ajax")!="false";if(d){var b=getViewport();if(b!=null)fpSpreadJS.cachedValues.scrollbarValues={scrollTop:b.parentNode.scrollTop,scrollLeft:b.parentNode.scrollLeft};syncData(element.getAttribute("name"),"ExpandView, "+c)}else __doPostBack(element.getAttribute("name"),"ExpandView, "+c)}function SortColumn(a,c){var d=element.getAttribute("ajax")!="false";if(element.getAttribute("layoutMode")&&c!=null){var e=getDisplayIndex(c),b=GetCellByRowCol(e,a);if(b!=null&&parseInt(b.getAttribute("col"))!=-1)a=parseInt(b.getAttribute("col"))}if(d)syncData(element.getAttribute("name"),"SortColumn, "+a);else __doPostBack(element.getAttribute("name"),"SortColumn, "+a)}function Filter(){if(!element.IsValid())return;var b=window.event.srcElement.value;if(window.event.srcElement.tagName=="SELECT"){var i=new RegExp("\\s*"),h=new RegExp("\\S*"),e=window.event.srcElement[window.event.srcElement.selectedIndex].text,f="",c=0,g=b.length;while(g>0){var a=b.match(i);if(a!=null){f+=a[0];c=a[0].length;g-=c;b=b.substring(c);a=b.match(h);if(a!=null){c=a[0].length;g-=c;b=b.substring(c)}}else break;a=e.match(h);if(a!=null){f+=a[0];c=a[0].length;e=e.substring(c);a=e.match(i);if(a!=null){c=a[0].length;e=e.substring(c)}}else break}b=f}if($$.browser.quirksMode){var d=createEventObject();d.cancel=false;d.col=selectedCols;d.spread=element;d.filterString=b;AutoFilteringColumn.fire(d)}else{var k={spread:element,cancel:false,col:selectedCols,filterString:b},d=$$.utils.createEvent("AutoFilteringColumn",false,true,k);element.dispatchEvent(d)}ignoreVirtualPaging=true;if(!d.cancel){saveScrollbarState(0,0);saveData();dirty=false;var j=element.getAttribute("ajax")!="false";if(j){syncData(window.event.srcElement.getAttribute("name"),b);element.LoadState=null}else __doPostBack(window.event.srcElement.getAttribute("name"),b)}ignoreVirtualPaging=false}function CallBack(b,a){syncData(element.getAttribute("name"),b,a)}function fireCallBackStartEvent(a){if($$.browser.quirksMode)CallBackStart.fire(a);else{var b={cancel:a.cancel,command:a.command,spread:a.spread,async:a.async};a=$$.utils.createEvent("CallBackStart",false,true,b);element.dispatchEvent(a)}return a.cancel}function fireCallBackStoppedEvent(b,c){if($$.browser.quirksMode){var a=createEventObject();a.command=b;a.spread=c;CallBackStopped.fire(a)}else{var d={spread:c,command:b},a=$$.utils.createEvent("CallBackStopped",false,false,d);element.dispatchEvent(a)}}function getForm(){var a=element.parentNode;while(a!=null&&a.tagName!="FORM")a=a.parentNode;return a}function syncData(id,cmd,asyncCallBack){if(window.fpPostOn!=null){element.LoadState=null;return}var ts=getTopSpread(element),e=createEventObject();e.cancel=false;e.command=cmd;e.spread=element;if(asyncCallBack==null)asyncCallBack=false;e.async=asyncCallBack;var cancel=ts.fireCallBackStartEvent(e);if(cancel){element.clearCellData();return}if(cmd!=null&&(cmd.indexOf("SelectView,")==0||cmd=="Next"||cmd=="Prev"||cmd.indexOf("Group,")==0||cmd.indexOf("Page,")==0))element.LoadState=null;var async=e.async;async&&openWaitMsg();window.fpPostOn=true;if(error)cmd="update";try{var form=getForm();if(form==null)return;form.__EVENTTARGET.value=id;form.__EVENTARGUMENT.value=encodeURIComponent(cmd);var ss=element,href=form.action,t;if(href.indexOf("?")>-1)t="&";else t="?";href=href+t;var target=element.id,data;if(cmd.indexOf("RefreshChart")>=0)data=collectLightData();else data=collectData();var respText="",req=null;try{if(window.external)req=window.external.XMLHttpRequest}catch(ex1){$$.DEBUG.Log(ex1,"syncData")}if(!req)req=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");if(req==null)return;req.open("POST",href,async);req.setRequestHeader("Content-Type","application/x-www-form-urlencoded, charset=UTF-8");req.onreadystatechange=processData;req.send(data);cmd!=null&&cmd.indexOf("SelectView,")==0&&element.focus();function processData(){if(req.readyState!=4)return;try{closeWaitMsg();var doc=element.document,oldActive=element.id;try{doc.selection.empty()}catch(ex){$$.DEBUG.Log(ex,"processData")}var buff=doc.createElement("div");if(buff==null)return;var respText=req.responseText;if(respText.indexOf("<body>")>-1){error=true;var ep=element.errorPage;if(ep!=null&&ep.length>0){var document=element.document;if(!document.createElement)document=window.document;var tmp=document.createElement("a");tmp.style.display="none";tmp.attachEvent("onclick",cancelBubble);tmp.href=ep;document.body.appendChild(tmp);tmp.click();tmp.detachEvent("onclick",cancelBubble);document.body.removeChild(tmp);function cancelBubble(a){a.cancelBubble=true}}return}if(element.inDesign&&respText=="__only_postdata__"){window.fpPostOn=null;dataBuff=null;var ts=getTopSpread(doc.getElementById(target));ts!=null&&ts.fireCallBackStoppedEvent(cmd,element);return}buff.innerHTML=respText;vpholder_setSizeCallback=null;if(cmd.indexOf("RefreshChart")>=0){var data=eval("("+respText+")");updateChartURL(data);form.__EVENTTARGET.value="";form.__EVENTARGUMENT.value="";window.fpPostOn=null;var ts=getTopSpread(doc.getElementById(target));ts!=null&&ts.fireCallBackStoppedEvent(cmd,element);return}var ts=getTopSpread(doc.getElementById(target)),pt=getElementById(buff,target+"_values");if(pt!=null){xmlData.switchNodeContext(pt);var nodes=xmlData.selectSingleNode("data");xmlData.resetNodeContext();var node=xmlData.firstElementChild(nodes);error=false;var ss=doc.getElementById(target);ss.SuspendLayout();while(node!=null){var r=ss.getRowByKey(node.getAttribute("r"),-1),c=ss.getColByKey(node.getAttribute("c"),-1);if(r>-1&&c>-1){var old=ss.GetValue(r,c);if(xmlData.textContent(node)!=old){var f=ss.GetFormula(r,c),cl=ss.GetCellByRowCol(r,c);ss.setCellValueFromView(cl,xmlData.textContent(node),true);cl.setAttribute("FpFormula",f)}}node=xmlData.nextElementSibling(node)}ss.clearCellData();ss.ResumeLayout(true)}else{ignorePostbackEditmode=true;element.preventPopUp=true;updateSpread(doc,buff,target,cmd);ignorePostbackEditmode=false}form.__EVENTTARGET.value="";form.__EVENTARGUMENT.value="";var old=doc.getElementById("__VIEWSTATE"),t=getElementById(buff,"__VIEWSTATE");if(old!=null&&t!=null)old.value=t.value;old=doc.getElementById("__EVENTVALIDATION");t=getElementById(buff,"__EVENTVALIDATION");if(old!=null&&t!=null)old.value=t.value;buff.innerHTML="";var newActive=doc.activeElement;window.fpPostOn=null;dataBuff=null}catch(ex){$$.DEBUG.Log(ex,"processData");window.fpPostOn=null;dataBuff=null}ts!=null&&ts.fireCallBackStoppedEvent(cmd,element)}}catch(ex){window.fpPostOn=null;dataBuff=null;$$.DEBUG.Log(ex,"processData")}}function getStyle(a,b){for(j=0;j<a.rules.length;j++)if(a.rules[j].selectorText==b)return a.rules[j];return null}function updateStyles(g,j){var b=j.getElementsByTagName("style");if(b!=null){var d=element.document;if(!d.createElement)d=window.document;var a=d.styleSheets[element.id+"_style"];if(a==null){a=d.createElement("style");a.id=element.id+"_style";d.body.appendChild(a)}a=d.styleSheets[element.id+"_style"];if(a!=null){for(var f="",c=0;c<b.length;c++)if(b[c]!=null&&b[c].innerHTML!=null&&b[c].innerHTML!=""&&b[c].innerHTML.indexOf(g.id+"msgStyle")<0)for(var h=0;h<b[c].styleSheet.rules.length;h++){var e=b[c].styleSheet.rules[h],i=getStyle(a,e.selectorText);if(i!=null)i.style.cssText=e.style.cssText;else if((g.getViewport1()==null||e.selectorText.indexOf(g.getViewport1().id)<0)&&(g.getViewport0()==null||e.selectorText.indexOf(g.getViewport0().id)<0))f+=e.selectorText+"{"+e.style.cssText+"}"}if(a.cssText!=null&&a.cssText.length>0)f=a.cssText+f;if(f.length>0)a.cssText=f}}}function updateSpread(u,k,t,d){var a=getTopSpread(u.getElementById(t)),c=getElementById(k,a.id);if(c!=null){if(typeof Sys!="undefined"&&typeof $get!="undefined"){FarPoint.System.ExtenderHelper.saveLoadedExtenderScripts(element,d);FarPoint.System.ExtenderHelper.processCss(k)}(!smartPaint||d!="LoadOnDemand")&&a.dispose();element.LoadState=null;if(d=="LoadOnDemand"&&c.getAttribute("error")!="true"){var r=a.all[a.id+"_data"],p=c.all[a.id+"_data"];r!=null&&p!=null&&r.setAttribute("data",p.getAttribute("data"));var o=a.all[a.id+"_LoadInfo"],n=c.all[a.id+"_LoadInfo"];if(o!=null&&n!=null)o.value=n.value;updateStyles(a,c);var j=a.GetRowCount()-1,f=Number.MAX_VALUE,i=false,h=getElementById(c,a.id+"_rowHeader");if(h!=null){h=xmlData.firstElementChild(h);f=Math.min(f,h.rows.length);i=h.rows.length>1;var v=a.getRowHeader();loadRows(v,h,true)}var b=getElementById(c,a.id+"_viewport2");if(b!=null){f=Math.min(f,b.rows.length);i=b.rows.length>0;var s=a.getViewport2();loadRows(s,b,false)}b=getElementById(c,a.id+"_viewport");if(b!=null){f=Math.min(f,b.rows.length);i=b.rows.length>0;var s=a.getViewport();loadRows(s,b,false)}if(smartPaint){if(d!="LoadOnDemand"){showPage(current+1,currentCount);updateDummyHeight()}rowCount+=b.rows.length;element.RowCount=parseInt(element.RowCount)+b.rows.length;if(d=="LoadOnDemand"){showRows(current+currentCount,f);currentCount=getRowsPerPage(current);syncRowRangeSafeMode(current+currentCount,GetRowCountInternal()-1,false);sizeSpread(true);if(editing&&element.__scrollByEditing){editing=false;element.__scrollByEditing=null;restartEditing(anchorCell)}}}else if(i&&j>0){var w=a.getRowHeightInternal(j);a.setRowHeight2(j,w,null,false)}if(i)element.LoadState=null;else element.LoadState="complete"}else{var e=element.document;if(!e.styleSheets)e=window.document;var q=e.styleSheets[element.id+"_style"];if(q!=null)q.cssText="";$$(a).copyInnerHTML(c)}a.removeAttribute("childViewsLoaded");copySpreadAttrs(c,a);error=c.getAttribute("error")=="true";typeof Sys!="undefined"&&typeof $get!="undefined"&&FarPoint.System.ExtenderHelper.loadExtenderScripts(element,k);if(!smartPaint||d!="LoadOnDemand"){a.preventScrollView=true;a.init(d);a.preventScrollView=false;a.fireAutoFilterColumnCompleted(d)}d!="LoadOnDemand"&&element.document.FpActiveSpread===element&&a.focus()}else{error=true;var l=element.errorPage;if(l!=null&&l.length>0){var e=element.document;if(!e.createElement)e=window.document;var g=e.createElement("a");g.style.display="none";g.attachEvent("onclick",m);g.href=l;e.body.appendChild(g);g.click();g.detachEvent("onclick",m);e.body.removeChild(g);function m(a){a.cancelBubble=true}}}}function importRows(e,g,j,d,b,i){if(g<0)return;var a=0;if(e!=null){var h=null;if(i)h=b.rows[b.rows.length-1];var l=e.rows.length;for(a=0;a<j;a++){var f=g+a;d.setAt(f,fpCloneNode(e.rows[a]));d.getRow(f).viewport=b;var c=d.getRow(f).cloneNode();b.tBodies[0].insertBefore(c,h);var k=c.insertCell();k.style.borderColor="transparent";c.style.borderColor="transparent";c.rowHolder=1}}}function loadRows(b,a,c){if(b==null||a==null)return;if(smartPaint)if(c)importRows(a,rhList.table.rows.length,a.rows.length-1,rhList,b,c);else if(b==element.getViewport())importRows(a,vpList.table.rows.length,a.rows.length,vpList,b,c);else importRows(a,vp2List.table.rows.length,a.rows.length,vp2List,b,c);else{var e=b.tBodies[0],g=a.rows.length,f=null;if(c){g--;if(e.rows.length>0)f=e.rows(e.rows.length-1)}for(var d=0;d<g;d++){var i=fpCloneNode(a.rows(d));e.insertBefore(i,f)}}if(!c)for(var d=0;d<a.parentNode.children.length;d++){var h=a.parentNode.children[d];h!=a&&b.parentNode.insertBefore(fpCloneNode(h))}}function copySpreadAttrs(a,b){if(a.getAttribute("selectionBlockOptions")!=null)b.setAttribute("selectionBlockOptions",a.getAttribute("selectionBlockOptions"));else b.removeAttribute("selectionBlockOptions");if(a.getAttribute("RetainSelectionBlock")&&a.getAttribute("RetainSelectionBlock")=="false"){b.setAttribute("RetainSelectionBlock","false");retainSelectionBlock=false}else{b.setAttribute("RetainSelectionBlock","true");retainSelectionBlock=true}if(a.getAttribute("AllRowsLoaded")!=null)b.setAttribute("AllRowsLoaded",a.getAttribute("AllRowsLoaded"));else b.removeAttribute("AllRowsLoaded");if(a.getAttribute("totalRowCount")!=null)b.setAttribute("totalRowCount",a.getAttribute("totalRowCount"));else b.removeAttribute("totalRowCount");if(a.getAttribute("pageCount")!=null)b.setAttribute("pageCount",a.getAttribute("pageCount"));else b.removeAttribute("pageCount");if(a.getAttribute("clipboard")!=null)b.setAttribute("clipboard",a.getAttribute("clipboard"));else b.removeAttribute("clipboard");if(a.getAttribute("loadOnDemand")!=null)b.setAttribute("loadOnDemand",a.getAttribute("loadOnDemand"));else b.removeAttribute("loadOnDemand");if(a.getAttribute("colMove")!=null)b.setAttribute("colMove",a.getAttribute("colMove"));else b.removeAttribute("colMove");if(a.getAttribute("allowGroup")!=null)b.setAttribute("allowGroup",a.getAttribute("allowGroup"));else b.removeAttribute("allowGroup");if(a.getAttribute("sizeHeader")!=null)b.setAttribute("sizeHeader",a.getAttribute("sizeHeader"));else b.removeAttribute("sizeHeader");if(a.getAttribute("showFocusRect")!=null)b.setAttribute("showFocusRect",a.getAttribute("showFocusRect"));else b.removeAttribute("showFocusRect");if(a.getAttribute("FocusBorderColor")!=null)b.setAttribute("FocusBorderColor",a.getAttribute("FocusBorderColor"));else b.removeAttribute("FocusBorderColor");if(a.getAttribute("FocusBorderStyle")!=null)b.setAttribute("FocusBorderStyle",a.getAttribute("FocusBorderStyle"));else b.removeAttribute("FocusBorderStyle");if(a.getAttribute("FpDefaultEditorID")!=null)b.setAttribute("FpDefaultEditorID",a.getAttribute("FpDefaultEditorID"));else b.removeAttribute("FpDefaultEditorID");if(a.getAttribute("hierView")!=null)b.setAttribute("hierView",a.getAttribute("hierView"));else b.removeAttribute("hierView");if(a.getAttribute("IsNewRow")!=null)b.setAttribute("IsNewRow",a.getAttribute("IsNewRow"));else b.removeAttribute("IsNewRow");if(a.getAttribute("cmdTop")!=null)b.setAttribute("cmdTop",a.getAttribute("cmdTop"));else b.removeAttribute("cmdTop");if(a.getAttribute("ProcessTab")!=null)b.setAttribute("ProcessTab",a.getAttribute("ProcessTab"));else b.removeAttribute("ProcessTab");if(a.getAttribute("AcceptFormula")!=null)b.setAttribute("AcceptFormula",a.getAttribute("AcceptFormula"));else b.removeAttribute("AcceptFormula");if(a.getAttribute("EditMode")!=null)b.setAttribute("EditMode",a.getAttribute("EditMode"));else b.removeAttribute("EditMode");if(a.getAttribute("AllowInsert")!=null)b.setAttribute("AllowInsert",a.getAttribute("AllowInsert"));else b.removeAttribute("AllowInsert");if(a.getAttribute("AllowDelete")!=null)b.setAttribute("AllowDelete",a.getAttribute("AllowDelete"));else b.removeAttribute("AllowDelete");if(a.getAttribute("error")!=null)b.setAttribute("error",a.getAttribute("error"));else b.removeAttribute("error");if(a.getAttribute("ajax")!=null)b.setAttribute("ajax",a.getAttribute("ajax"));else b.removeAttribute("ajax");if(a.getAttribute("autoCalc")!=null)b.setAttribute("autoCalc",a.getAttribute("autoCalc"));else b.removeAttribute("autoCalc");if(a.getAttribute("multiRange")!=null)b.setAttribute("multiRange",a.getAttribute("multiRange"));else b.removeAttribute("multiRange");if(a.getAttribute("rowFilter")!=null)b.setAttribute("rowFilter",a.getAttribute("rowFilter"));else b.removeAttribute("rowFilter");if(a.getAttribute("OperationMode")!=null)b.setAttribute("OperationMode",a.getAttribute("OperationMode"));else b.removeAttribute("OperationMode");if(a.getAttribute("selectedForeColor")!=null)b.setAttribute("selectedForeColor",a.getAttribute("selectedForeColor"));else b.removeAttribute("selectedForeColor");if(a.getAttribute("selectedBackColor")!=null)b.setAttribute("selectedBackColor",a.getAttribute("selectedBackColor"));else b.removeAttribute("selectedBackColor");if(a.getAttribute("anchorBackColor")!=null)b.setAttribute("anchorBackColor",a.getAttribute("anchorBackColor"));else b.removeAttribute("anchorBackColor");if(a.getAttribute("tabIndex")!=null)b.setAttribute("tabIndex",a.getAttribute("tabIndex"));else b.removeAttribute("tabIndex");if(a.getAttribute("EnableRowEditTemplate")!=null)b.setAttribute("EnableRowEditTemplate",a.getAttribute("EnableRowEditTemplate"));else b.removeAttribute("EnableRowEditTemplate");if(a.getAttribute("isFiltering")!=null)b.setAttribute("isFiltering",a.getAttribute("isFiltering"));else b.removeAttribute("isFiltering");if(a.getAttribute("isFilteringCancel")!=null)b.setAttribute("isFilteringCancel",a.getAttribute("isFilteringCancel"));else b.removeAttribute("isFilteringCancel");if(a.getAttribute("FilteringString")!=null)b.setAttribute("FilteringString",a.getAttribute("FilteringString"));else b.removeAttribute("FilteringString");if(a.getAttribute("FilteringCol"))b.setAttribute("FilteringCol",a.getAttribute("FilteringCol"));else b.removeAttribute("FilteringCol");if(a.getAttribute("scrollContent")!=null)b.setAttribute("scrollContent",a.getAttribute("scrollContent"));else b.removeAttribute("scrollContent");if(a.getAttribute("scrollContentColumns")!=null)b.setAttribute("scrollContentColumns",a.getAttribute("scrollContentColumns"));else b.removeAttribute("scrollContentColumns");if(a.getAttribute("scrollContentTime")!=null)b.setAttribute("scrollContentTime",a.getAttribute("scrollContentTime"));else b.removeAttribute("scrollContentTime");if(a.getAttribute("scrollContentMaxHeight")!=null)b.setAttribute("scrollContentMaxHeight",a.getAttribute("scrollContentMaxHeight"));else b.removeAttribute("scrollContentMaxHeight");if(a.getAttribute("SelectionPolicy")!=null)b.setAttribute("SelectionPolicy",a.getAttribute("SelectionPolicy"));else b.removeAttribute("SelectionPolicy");if(a.getAttribute("selectionUnit")!=null)b.setAttribute("selectionUnit",a.getAttribute("selectionUnit"));else b.removeAttribute("selectionUnit");if(a.getAttribute("ShowHeaderSelection")!=null)b.setAttribute("ShowHeaderSelection",a.getAttribute("ShowHeaderSelection"));else b.removeAttribute("ShowHeaderSelection");if(a.getAttribute("currentPageIndex")!=null)b.setAttribute("currentPageIndex",a.getAttribute("currentPageIndex"));else b.removeAttribute("currentPageIndex");if(a.getAttribute("virtualPaging")!=null)b.setAttribute("virtualPaging",a.getAttribute("virtualPaging"));else b.removeAttribute("virtualPaging");if(a.getAttribute("semiTransparentSelectedBackColor")!=null)b.setAttribute("semiTransparentSelectedBackColor",a.getAttribute("semiTransparentSelectedBackColor"));else b.removeAttribute("semiTransparentSelectedBackColor");if(a.getAttribute("layoutMode")!=null)b.setAttribute("layoutMode",a.getAttribute("layoutMode"));else b.removeAttribute("layoutMode");if(a.getAttribute("layoutRowCount")!=null)b.setAttribute("layoutRowCount",a.getAttribute("layoutRowCount"));else b.removeAttribute("layoutRowCount");if(b.style!=null&&a.style!=null){if(b.style.width!=a.style.width)b.style.width=a.style.width;if(b.style.border!=a.style.border)b.style.border=a.style.border;if(b.style.height!=a.style.height)b.style.height=a.style.height}if(a.getAttribute("expandedRowKeys")!=null&&a.getAttribute("expandedRowKeys")!="")b.setAttribute("expandedRowKeys",a.getAttribute("expandedRowKeys"));else b.removeAttribute("expandedRowKeys")}function collectData(){for(var h=getForm(),a,c="fpcallback=true&",f=0;f<h.elements.length;f++){a=h.elements[f];var d=a.tagName.toLowerCase();if(d=="input"){var b=a.type;if((b=="hidden"||b=="text"||b=="password"||(b=="checkbox"&&!element.inDesign||b=="radio")&&a.checked)&&!a.isInvalid)c+=a.name+"="+encodeURIComponent(a.value)+"&"}else if(d=="select")for(var g=0;g<a.children.length;g++){var e=a.children[g];if(e.tagName.toLowerCase()=="option"&&e.selected)c+=a.name+"="+encodeURIComponent(e.value)+"&"}else if(d=="textarea")c+=a.name+"="+encodeURIComponent(a.value)+"&"}return c}function collectLightData(){for(var c=getForm(),a,d="fpcallback=true&",b=0;b<c.elements.length;b++){a=c.elements[b];var e=a.tagName.toLowerCase();if(e=="input"){var f=a.type;if(f=="hidden")d+=a.name+"="+encodeURIComponent(a.value)+"&"}}return d}function ShowMessage(e,a,b,d){var c=GetRowCountInternal(),f=GetColCount();if(a==null||b==null||a<0||a>=c||a>=c||b<0||b>=f){a=-1;b=-1}showMessageInner(e,a,b,d)}function HideMessage(b,a){var e=GetRowCountInternal(),d=GetColCount();if(b==null||a==null||b<0||b>=e||a<0||a>=d)msgList&&msgList.centerMsg&&msgList.centerMsg.msgBox.IsVisible&&msgList.centerMsg.msgBox.Hide();var c=getMsgObj(b,a);c&&c.msgBox.IsVisible&&c.msgBox.Hide()}function showMessageInner(f,e,d,b){var a=getMsgObj(e,d);if(a)a.timer&&a.msgBox.Hide();else a=createMsgObj(e,d);var c=a.msgBox;c.Show(f);if(b&&b>0)a.timer=setTimeout(function(){c.Hide()},b);setMsgObj(a)}function getMsgObj(b,c){var a;if(msgList)if(b==-1&&c==-1)a=msgList.centerMsg;else if(b==-2)a=msgList.hScrollMsg;else if(c==-2)a=msgList.vScrollMsg;else if(msgList[b])a=msgList[b][c];return a}function setMsgObj(a){if(!msgList)msgList=[];if(a.row==-1&&a.col==-1)msgList.centerMsg=a;else if(a.row==-2)msgList.hScrollMsg=a;else if(a.col==-2)msgList.vScrollMsg=a;else{if(!msgList[a.row])msgList[a.row]=[];msgList[a.row][a.col]=a}}var scStyle=null;function createMsgObj(f,e){var c=element.document;if(!c.createElement)c=window.document;var a=c.createElement("div"),d={row:f,col:e,msgBox:a},b=null;if(f!=-2&&e!=-2){a.style.border="1px solid black";a.style.background="yellow";a.style.color="red";getMsgStyle();b=msgStyle}else{a.style.border="1px solid #55678e";a.style.fontSize="small";a.style.background="#E6E9ED";a.style.color="#4c5b7f";getScrollingContentStyle();b=scStyle}if(b!=null){if(b.fontFamily!=null)a.style.fontFamily=b.fontFamily;if(b.fontSize!=null)a.style.fontSize=b.fontSize;if(b.fontStyle!=null)a.style.fontStyle=b.fontStyle;if(b.fontVariant!=null)a.style.fontVariant=b.fontVariant;if(b.fontWeight!=null)a.style.fontWeight=b.fontWeight;if(b.backgroundColor!=null)a.style.backgroundColor=b.backgroundColor;if(b.color!=null)a.style.color=b.color}a.style.position="absolute";a.style.display="block";a.style.overflow="hidden";a.style.marginLeft=0;a.style.marginTop=2;a.style.marginRight=0;a.style.marginBottom=0;a.msgObj=d;a.Show=function(m){var f=getTopSpread(element);this.style.visibility="visible";this.style.display="block";if(m){this.style.posLeft=0;this.style.posTop=0;this.style.width="auto";this.innerHTML=m}var j=isXHTML(),c=getMsgPos(this.msgObj.row,this.msgObj.col);if(this.msgObj.row>=0&&this.msgObj.col>=0){var d=getViewPortByRowCol(this.msgObj.row,this.msgObj.col);!this.parentElement&&d!=null&&d.vh&&d.vh.parentElement.insertBefore(a,null);var i=this.offsetWidth;this.style.posLeft=c.left;if(d&&d.vh&&c.left+i>d.vh.offsetWidth)this.style.width=c.cellWidth-2+"px";else if(this.style.width!=i)this.style.width=i-(j?2:0)+"px";if(d!=null&&c.top>=parseInt(d.vh.clientHeight-2))c.top=c.top-c.cellHeight-this.clientHeight-3>0?c.top-c.cellHeight-this.clientHeight-3:0;this.style.posTop=c.top}else{var g=20,p=element.style.position=="relative"||element.style.position=="absolute";f.insertBefore(a,null);var e=c.top,h=c.left,b=element.offsetParent;while((b.tagName=="TD"||b.tagName=="TR"||b.tagName=="TBODY"||b.tagName=="TABLE")&&b.style.position!="relative"&&b.style.position!="absolute")b=b.offsetParent;if(!p&&j&&b){var k=getLocation(element);e+=k.y;h+=k.x;if(b.tagName!="BODY"){var l=getLocation(b);e-=l.y+getBorderWidth(b,0);h-=l.x+getBorderWidth(b,3)}}if(this.offsetWidth+g<f.offsetWidth)h+=(f.offsetWidth-this.offsetWidth-g)/(this.msgObj.row==-2?1:2);else this.style.width=f.offsetWidth-g+"px";if(this.offsetHeight<f.offsetHeight)e+=(f.offsetHeight-this.offsetHeight)/(this.msgObj.col==-2?1:2);if(this.msgObj.col==-2){var o=getColFooter();if(o)e-=o.offsetHeight;var n=getCommandBar();if(n)e-=n.offsetHeight;e-=g}this.style.posTop=e;this.style.posLeft=h}this.IsVisible=true};a.Hide=function(){this.style.visibility="hidden";this.style.display="none";this.IsVisible=false;if(this.msgObj.timer){clearTimeout(this.msgObj.timer);this.msgObj.timer=null}this.innerHTML=""};return d}function getLocation(a){if(a.self||a.nodeType===9)return{x:0,y:0};var b=a.getBoundingClientRect();if(!b)return{x:0,y:0};var d=a.ownerDocument.documentElement,e=b.left-2+d.scrollLeft,f=b.top-2+d.scrollTop;try{var c=a.ownerDocument.parentWindow.frameElement||null;if(c){var g=c.frameBorder==="0"||c.frameBorder==="no"?2:0;e+=g;f+=g}}catch(h){$$.DEBUG.Log(h,"getLocation")}return{x:e,y:f}}var _borderWidthNames=["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth"],_borderStyleNames=["borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle"],_borderThicknesses;function getBorderWidth(b,a){if(!getBorderVisible(b,a))return 0;var c=getCurrentStyle(b,_borderWidthNames[a]);return parseBorderWidth(c)}function getBorderVisible(b,a){return getCurrentStyle(b,_borderStyleNames[a])!="none"}function getCurrentStyle(b,c,d){var a=null;if(b){if(b.currentStyle)a=b.currentStyle[c];else if(document.defaultView&&document.defaultView.getComputedStyle){var e=document.defaultView.getComputedStyle(b,null);if(e)a=e[c]}if(!a&&b.style.getPropertyValue)a=b.style.getPropertyValue(c);else if(!a&&b.style.getAttribute)a=b.style.getAttribute(c)}if(!a||a==""||typeof a==="undefined")if(typeof d!="undefined")a=d;else a=null;return a}function parseBorderWidth(e){if(!_borderThicknesses){var d=window.document,c={},a=d.createElement("div");a.style.visibility="hidden";a.style.position="absolute";a.style.fontSize="1px";d.body.appendChild(a);var b=d.createElement("div");b.style.height="0px";b.style.overflow="hidden";a.appendChild(b);var f=a.offsetHeight;b.style.borderTop="solid black";b.style.borderTopWidth="thin";c.thin=a.offsetHeight-f;b.style.borderTopWidth="medium";c.medium=a.offsetHeight-f;b.style.borderTopWidth="thick";c.thick=a.offsetHeight-f;a.removeChild(b);d.body.removeChild(a);_borderThicknesses=c}if(e){switch(e){case"thin":case"medium":case"thick":return _borderThicknesses[e];case"inherit":return 0}var g=parseUnit(e);if(g.type!="px")throw new Error;return g.size}return 0}function parseUnit(a){if(!a)throw new Error;a=trim(a).toLowerCase();for(var g=a.length,c=-1,f=0;f<g;f++){var b=a.substr(f,1);if((b<"0"||b>"9")&&b!="-"&&b!="."&&b!=",")break;c=f}if(c==-1)throw new Error;var e,d;if(c<g-1)e=trim(a.substring(c+1));else e="px";d=parseFloat(a.substr(0,c+1));if(e=="px")d=Math.floor(d);return{size:d,type:e}}function getMsgPos(c,b){var f=getTopSpread(element);if(c<0||b<0)return{left:0,top:0};else{var a=GetCellByRowCol(c,b),e=a.offsetTop+a.clientHeight,d=a.offsetLeft;return{left:d,top:e,cellHeight:a.clientHeight,cellWidth:a.clientWidth}}}function getViewPortByRowCol(e,d){var b=GetCellByRowCol(e,d),a=null,c=false;if(isChild(b,getViewport()))a=getViewport();else if(isChild(b,getViewport2()))a=getViewport2();else if(isChild(b,getViewport1())){a=getViewport1();c=true}else if(isChild(b,getViewport0())){a=getViewport0();c=true}return{vh:a,frozen:c}}function syncMsgs(){if(!msgList)return;for(i in msgList)if(msgList[i].constructor==Array)for(j in msgList[i])msgList[i][j]&&msgList[i][j].msgBox&&msgList[i][j].msgBox.IsVisible&&msgList[i][j].msgBox.Show()}function TableBuff(c,b){this.table=c.document.createElement("table");this.table.insertRow();this.table.deleteRow(0);if(b!=null){var a=getColGroup(b);a!=null&&a.childNodes.length>0&&this.table.appendChild(a.cloneNode(true))}this.setAt=function(a,b){var c=this.table.tBodies[0];if(a==this.table.rows.length){c.insertBefore(b,null);return}var d=this.table.rows[a];c.insertBefore(b,d);this.table.deleteRow(a+1)};this.getRow=function(a){return this.table.rows[a]}}function initSmartPaint(){element.setAttribute("scrollContentTime",500);var c=element.getViewport(),a=c.rows.length;saveRows(0,a);removeRows(0,a);var b=getRowsPerPage(0);showPage(0,b)}var inshowPage=false;function showPage(a,c){if(current==a&&c==currentCount)return;if(inshowPage)return;inshowPage=true;if(editModePermanent){var e=EndEdit();if(!e)return}var d=vpList.table.rows.length,b=Math.min(c,d-a);if(b<=0){inshowPage=false;return}ignorePaintSelection=true;paintSelections(false);ignorePaintSelection=false;if(current<a&&a<current+currentCount){saveRows(current,a-current);removeRows(current,a-current);if(current+currentCount>a+b){saveRows(a+b,current+currentCount-a-b);removeRows(a+b,current+currentCount-a-b)}else showRows(current+currentCount,a+b-current-currentCount)}else if(a<current&&current<a+b){showRows(a,current-a);if(current+currentCount>a+b){saveRows(a+b,current+currentCount-a-b);removeRows(a+b,current+currentCount-a-b)}else showRows(current+currentCount,a+b-current-currentCount)}else{if(current>=0&&currentCount>0){saveRows(current,currentCount);removeRows(current,currentCount)}showRows(a,b)}current=a;currentCount=b;updateDummyHeight();anchorCell=findAnchorCell();ignorePaintSelection=true;paintSelections(true);ignorePaintSelection=false;inshowPage=false}function updateDummyHeight(){var b=getDummy(),d=0;if(getViewport0()!=null)d=getViewport0().offsetWidth;if(getViewport2()!=null&&getViewport2().offsetWidth>d)d=getViewport2().offsetWidth;if(getFrozColHeader()!=null&&getFrozColHeader().offsetWidth>d)d=getFrozColHeader().offsetWidth;var f=getViewPortSize2(false),a=f.width;if(getViewport1()!=null&&getViewport1().offsetWidth>a)a=getViewport1().offsetWidth;if(smartPaint&&getColHeader()!=null){cg1=getColGroup(getColHeader());if(cg1.children.length>0){var g=getColHeader().offsetWidth-cg1.children[cg1.children.length-1].width;if(a<=1)a=g}}if(frzCols>0&&a>0)b.style.width=d+a-parseInt(getViewport().cellSpacing)+"px";else if(a>0)b.style.width=a+"px";else b.style.width="0px";var e=0;if(getViewport0()!=null)e=getViewport0().offsetHeight;if(getViewport1()!=null&&getViewport1().offsetHeight>e)e=getViewport1().offsetHeight;var c=f.height;if(getViewport2()!=null&&getViewport2().offsetHeight>c)c=getViewport2().offsetHeight;if(frzRows>0&&c>0)b.style.height=e+c-2*parseInt(getViewport().cellSpacing)+"px";else if(c>0)b.style.height=c+"px";else b.style.height="0px"}function showRows(a,b){var c=element.getViewport(),d=element.getViewport2(),e=element.getRowHeader();c!=null&&showRowsImp(c,a,b,vpList);d!=null&&showRowsImp(d,a,b,vp2List);e!=null&&showRowsImp(e,a,b,rhList);setResizingFlag(true);for(r=0;r<b;r++){if(a+r>=c.rows.length)break;EnsureRowHeight(a+r)}setResizingFlag(false);anchorCell=findAnchorCell()}function restartEditing(b){if(b==null)return;StartEdit(b);if(editor!=null){var a=getTextElement(editor);if(a!=null&&editor.__bkLength!=null){if(a.value.length>editor.__bkLength){var c=a.createTextRange();c.move("character",1);c.select()}editor.__bkLength=null}}}function fpCloneNode(b){for(var c=b.cloneNode(true),g=b.getElementsByTagName("select"),e=c.getElementsByTagName("select"),a=0;a<e.length;a++)e[a].selectedIndex=g[a].selectedIndex;for(var d=b.getElementsByTagName("INPUT"),f=c.getElementsByTagName("INPUT"),a=0;a<d.length;a++)if(d[a].type=="checkbox"){f[a].value=d[a].value;f[a].checked=d[a].checked}if(b.synDelt!=null)c.synDelt=b.synDelt;return c}function showRowsImp(c,a,d,f){if(a<0)return;if(a==0){a=1;d=d-1}for(var b=0,b=0;b<d;b++){if(a>=c.rows.length)break;c.deleteRow(a)}for(b=0;b<d;b++){var e=null;if(a+b<c.rows.length)e=c.rows[a+b];c.tBodies[0].insertBefore(fpCloneNode(f.getRow(a+b)),e)}}function saveRows(b,c){if(b<0)return;var a=element.getViewport();saveRowsImp(a,b,c,vpList);a=element.getViewport2();saveRowsImp(a,b,c,vp2List);a=element.getRowHeader();saveRowsImp(a,b,c,rhList)}function saveRowsImp(b,c,f,e){if(c<0)return;var a=0;if(b!=null){var g=b.rows.length;for(a=0;c+a<g&&a<f;a++){var d=c+a;e.setAt(d,fpCloneNode(b.rows[d]));e.getRow(d).viewport=b}}}function removeRows(b,c){if(c==0)return;var a=element.getViewport(),f=0,e=a.rows.length;if(b==0){b=1;c=c-1}var d=Math.min(c,e-b);if(d<=0)return;removeRowsFromViewport(a,b,d,false,vpList);a=element.getViewport2();a!=null&&removeRowsFromViewport(a,b,d,false,vp2List);a=element.getRowHeader();a!=null&&removeRowsFromViewport(a,b,d,true,rhList)}function removeRowsFromViewport(a,c,f,g,h){for(var b=0,b=0;b<f;b++)a.deleteRow(c);var e=null;if(c<a.rows.length)e=a.rows[c];else if(g)e=a.rows[a.rows.length-1];for(b=0;b<f;b++){var d=h.getRow(c+b).cloneNode();a.tBodies[0].insertBefore(d,e);var i=d.insertCell();i.style.borderColor="transparent";d.style.borderColor="transparent";d.rowHolder=1}}function doUpdate(){var a=newTop;while(a>0){var b=rhList.getRow(a),d=vpList.getRow(a),c=vp2List.getRow(a);if((b==null||b.cells.length==rowHeaders)&&(d==null||d.cells.length==GetColCount()-frzCols)&&(c==null||c.cells.length==frzCols))break;a--}var e=getRowsPerPage(a);showPage(a,e+newTop-a)}function getRowsPerPage(a){var f=GetRowCount(),c=0,e=0,d=0;while(e<getViewport().parentNode.clientHeight&&c<f){var b=0;if(vpList.getRow(a)!=null&&a<vpList.table.rows.length)b=getVisibleRowHeight(vpList,a+d);if(vp2List.getRow(a)!=null&&a<vp2List.table.rows.length)b=Math.max(b,getVisibleRowHeight(vp2List,a+d));if(rhList.getRow(a)!=null&&a<rhList.table.rows.length)b=Math.max(b,getVisibleRowHeight(rhList,a+d));e+=b;c++;d++}c=c+5;return Math.min(c,30)}function getVisibleRowHeight(g,f){var c=getScrollvp().scrollTop,a=0,e=g.getRow(f);if(e!=null)a=e.style.posHeight;var b=0,d=getViewport().rows[f];if(d!=null){b=d.offsetTop;a=d.style.posHeight}return c>b&&c<b+a?a-c+b:c>=b+a?0:a}function setXMLNodeAttribute(a,c,b){if(a==null)return null;a.setAttribute(c,b);return b}function getCellInfo(e,d,c){var b=xmlData.selectSingleNode("cellinfo");if(b==null)return null;var a=xmlData.selectSingleNode("cellinfo c[r='"+e+"'][c='"+d+"'][pos='"+c+"']");return a}function addCellInfo(e,d,c){var a=getCellInfo(e,d,parseInt(c));if(a!=null)return a;var b=xmlData.selectSingleNode("cellinfo");if(b==null)return null;a=xmlData.createElement("c");setXMLNodeAttribute(a,"r",e);setXMLNodeAttribute(a,"c",d);setXMLNodeAttribute(a,"pos",c);b.appendChild(a);return a}function setCellAttribute(a,i,e,j,k){if(a==null)return;var d=getRowKeyFromCell(a),f=element.getAttribute("layoutMode")?getColKeyFromCell2(a):getColKeyFromCell(a);if(typeof d=="undefined")return;var c=-1;if(isChild(a,getCorner()))c=0;else if(isChild(a,getRowHeader())||isChild(a,getFrozRowHeader()))c=1;else if(isChild(a,getColHeader())||isChild(a,getFrozColHeader()))c=2;else if(isChild(a,getViewport())||isChild(a,getViewport0())||isChild(a,getViewport1())||isChild(a,getViewport2()))c=3;var h=addCellInfo(d,f,c);setXMLNodeAttribute(h,""+i,e);if(!j){fireDataChangedEvent(a,e,element,d,f);var g=getTopSpread(element);g!=element&&g.fireDataChangedEvent(a,e,element,d,f)}var b=getCmdBtn("Update");b!=null&&b.disabled&&updateCmdBtnState(b,false);b=getCmdBtn("Cancel");b!=null&&b.disabled&&updateCmdBtnState(b,false);dirty=true;k&&updateValues()}function updateCellLocked(b,c){if(b==null)return;var d=b.getAttribute("FpCellType")=="readonly";if(d==c)return;var a=xmlData.firstElementChild(b);while(a!=null){if(typeof a.disabled!="undefined")a.disabled=c;a=xmlData.nextElementSibling(a)}}function Cells(c,b){var a=GetCellByRowCol(c,b);if(a){a.GetValue=function(){return GetValue(c,b)};a.SetValue=function(a){if(typeof a=="undefined")return;if(this.parentNode.getAttribute("previewRow")!=null)return;SetValue(c,b,a)};a.GetBackColor=function(){return this.bgColorBak!=null?this.bgColorBak:this.currentStyle.backgroundColor};a.SetBackColor=function(a){if(typeof a=="undefined")return;this.setAttribute("bgColor",a);this.bgColorBak=a;this.style.backgroundColor=a;setCellAttribute(this,"bc",a)};a.GetForeColor=function(){return this.currentStyle.color};a.SetForeColor=function(a){if(typeof a=="undefined")return;this.style.color=a;setCellAttribute(this,"fc",a)};a.GetTabStop=function(){return this.getAttribute("TabStop")!="false"};a.SetTabStop=function(b){if(typeof b=="undefined")return;var a=new String(b);if(a.toLocaleLowerCase()=="false")this.setAttribute("TabStop","false");else this.removeAttribute("TabStop");setCellAttribute(this,"ts",a.toLocaleLowerCase())};a.GetCellType=function(){var a=getCellType2(this);if(a=="text"||a=="readonly")a=this.getAttribute("CellType2");if(a==null)a="GeneralCellType";return a};a.GetHAlign=function(){return this.currentStyle.textAlign};a.SetHAlign=function(a){if(typeof a=="undefined")return;this.style.textAlign=typeof a=="string"?a:a.Name;setCellAttribute(this,"ha",typeof a=="string"?a:a.Name)};a.GetVAlign=function(){return this.currentStyle.verticalAlign};a.SetVAlign=function(a){if(typeof a=="undefined")return;this.style.verticalAlign=typeof a=="string"?a:a.Name;setCellAttribute(this,"va",typeof a=="string"?a:a.Name)};a.GetLocked=function(){return a.GetCellType()=="ButtonCellType"||a.GetCellType()=="TagCloudCellType"||a.GetCellType()=="HyperLinkCellType"?a.getAttribute("Locked")=="1":getCellType(this)=="readonly"};a.GetFont_Name=function(){return this.currentStyle.fontFamily};a.SetFont_Name=function(a){if(typeof a=="undefined")return;this.style.fontFamily=a;setCellAttribute(this,"fn",a)};a.GetFont_Size=function(){return this.currentStyle.fontSize};a.SetFont_Size=function(a){if(typeof a=="undefined")return;this.style.fontSize=a;setCellAttribute(this,"fs",a);EnsureRowHeight(parseInt(getRowKeyFromCell(this)))};a.GetFont_Bold=function(){return this.currentStyle.fontWeight>=700?true:false};a.SetFont_Bold=function(a){if(typeof a=="undefined")return;this.style.fontWeight=a==true?"bold":"normal";setCellAttribute(this,"fb",new String(a).toLocaleLowerCase())};a.GetFont_Italic=function(){return this.currentStyle.fontStyle=="italic"?true:false};a.SetFont_Italic=function(a){if(typeof a=="undefined")return;this.style.fontStyle=a==true?"italic":"normal";setCellAttribute(this,"fi",new String(a).toLocaleLowerCase())};a.GetFont_Overline=function(){return this.currentStyle.textDecoration.indexOf("overline")>=0?true:false};a.SetFont_Overline=function(b){if(b){var a=new String("overline");if(this.currentStyle.textDecoration.indexOf("line-through")>=0)a+=" line-through";if(this.currentStyle.textDecoration.indexOf("underline")>=0)a+=" underline";this.style.textDecoration=a}else{var a=new String("");if(this.currentStyle.textDecoration.indexOf("line-through")>=0)a+="line-through";if(this.currentStyle.textDecoration.indexOf("underline")>=0)a+=" underline";if(a=="")a="none";this.style.textDecoration=a}setCellAttribute(this,"fo",new String(b).toLocaleLowerCase())};a.GetFont_Strikeout=function(){return this.currentStyle.textDecoration.indexOf("line-through")>=0?true:false};a.SetFont_Strikeout=function(b){if(b){var a=new String("line-through");if(this.currentStyle.textDecoration.indexOf("overline")>=0)a+=" overline";if(this.currentStyle.textDecoration.indexOf("underline")>=0)a+=" underline";this.style.textDecoration=a}else{var a=new String("");if(this.currentStyle.textDecoration.indexOf("overline")>=0)a+="overline";if(this.currentStyle.textDecoration.indexOf("underline")>=0)a+=" underline";if(a=="")a="none";this.style.textDecoration=a}setCellAttribute(this,"fk",new String(b).toLocaleLowerCase())};a.GetFont_Underline=function(){return this.currentStyle.textDecoration.indexOf("underline")>=0?true:false};a.SetFont_Underline=function(b){if(b){var a=new String("underline");if(this.currentStyle.textDecoration.indexOf("overline")>=0)a+=" overline";if(this.style.textDecoration.indexOf("line-through")>=0)a+=" line-through";this.style.textDecoration=a}else{var a=new String("");if(this.currentStyle.textDecoration.indexOf("overline")>=0)a+="overline";if(this.currentStyle.textDecoration.indexOf("line-through")>=0)a+=" line-through";if(a=="")a="none";this.style.textDecoration=a}setCellAttribute(this,"fu",new String(b).toLocaleLowerCase())};return a}return null}function getDomRow(d){if(GetRowCount()==0)return null;var a=GetCellByRowCol(d,0);if(a){var c=a.parentElement.rowIndex;if(c>=0){var b=a.parentElement.parentElement.rows(c);if(getSizable(b))return b}return null}}function setRowInfo_RowAttribute(b,c,f,e){b=parseInt(b);if(b<0)return;var d=addRowInfo(b,false,true);setXMLNodeAttribute(d,""+c,f);var a=getCmdBtn("Update");a!=null&&a.disabled&&updateCmdBtnState(a,false);a=getCmdBtn("Cancel");a!=null&&a.disabled&&updateCmdBtnState(a,false);dirty=true;e&&updateValues()}function Rows(b){var a=getDomRow(parseInt(b));if(a){a.GetHeight=function(){return getRowHeightInternal2(b)};a.SetHeight=function(a){if(typeof a=="undefined")return;setRowHeight2(b,parseInt(a),null,true)};return a}return null}function setColInfo_ColumnAttribute(b,e,f,d){b=parseInt(b);if(b<0)return;var c=addColInfo(b,false);setXMLNodeAttribute(c,""+e,f);var a=getCmdBtn("Update");a!=null&&a.disabled&&updateCmdBtnState(a,false);a=getCmdBtn("Cancel");a!=null&&a.disabled&&updateCmdBtnState(a,false);dirty=true;d&&updateValues()}function Columns(b){var a={colindex:getColByKey(parseInt(b))};if(a){a.GetWidth=function(){return getColWidthFromCol(b)};a.SetWidth=function(a){if(typeof a=="undefined")return;setColWidth(b,parseInt(a),null,true)};return a}return null}function getTitleBar(){try{return element.all(element.id+"_title")==null?null:element.all(element.id+"_title")}catch(a){$$.DEBUG.Log(a,"getTitleBar");return null}}function getSubTitleBar(){try{return element.all(element.id+"_subtitle")==null?null:element.all(element.id+"_subtitle")}catch(a){return null}}function checkTitleInfo(){var a=xmlData.selectSingleNode("titleinfo");return a==null?null:a}function addTitleInfo(){var a=checkTitleInfo();if(a!=null)return a;a=xmlData.createElement("titleinfo");xmlData.firstChild(xmlData.getXMLDoc()).appendChild(a);return a}function setTitleInfo_Attribute(b,e,d){var c=addTitleInfo();setXMLNodeAttribute(c,""+b,e);var a=getCmdBtn("Update");a!=null&&a.disabled&&updateCmdBtnState(a,false);a=getCmdBtn("Cancel");a!=null&&a.disabled&&updateCmdBtnState(a,false);dirty=true;d&&updateValues()}function GetTitleInfo(){var a=getTitleBar();if(a){a.GetHeight=function(){return this.currentStyle.height};a.SetHeight=function(a){this.style.height=parseInt(a)+"px";this.style.posHeight=parseInt(a);setTitleInfo_Attribute("ht",a);sizeSpread()};a.GetVisible=function(){return this.style.display=="none"?false:true;return this.style.visibility};a.SetVisible=function(a){this.style.display=a?"block":"none";this.style.visibility=a?"visible":"hidden";setTitleInfo_Attribute("vs",new String(a).toLocaleLowerCase());sizeSpread()};a.GetValue=function(){return xmlData.textContent(this)};a.SetValue=function(a){xmlData.textContent(this,a);setTitleInfo_Attribute("tx",a)};return a}return null}var strStyle="";function showScrollingContent(x){var v="Row",l="Column",a="",d=getTopSpread(),s=d.getAttribute("scrollContentColumns"),z=d.getAttribute("scrollContentMaxHeight"),J=d.getAttribute("scrollContentTime"),m=d.getViewport(),B=getColGroup(m),r=getScrollvp();if(r==null)r=getParent(m);var p=0;if(element.getAttribute("lcidRow")!=null)v=element.getAttribute("lcidRow");if(element.getAttribute("lcidColumn")!=null)l=element.getAttribute("lcidColumn");if(x){var N=r.scrollLeft,g=d.getColHeader(),f=0,n=null;if(g!=null)n=g.children[0].all;else if(B!=null)n=B.children;else return;for(;f<n.length;f++){var j=n[f];p+=parseInt(j.width,10);if(p>N)break}var o=d.getViewport2();if(o)f+=getColGroup(o).children.length;if(g){var e=g.rows.length-1;if(element.getAttribute("layoutMode")==null)e=g.ColTextIndex?parseInt(g.ColTextIndex):g.rows.length-1;var c=getHeaderCellFromRowCol(e,f,true);if(c)if(c.getAttribute("FpCellType")=="ExtenderCellType"&&c.getElementsByTagName("DIV").length>0){var E=getEditor(c),F=getFunction("ExtenderCellType_getEditorValue");if(E!=null&&F!=null)a="&nbsp;"+l+":&nbsp;"+F(E)+"&nbsp;"}else if(c.getElementsByTagName("SELECT").length>0){var C=c.getElementsByTagName("SELECT")[0];a="&nbsp;"+l+":&nbsp;"+C[C.selectedIndex].text+"&nbsp;"}else a="&nbsp;"+l+":&nbsp;"+xmlData.textContent(c)+"&nbsp;"}if(a.length<=0)a="&nbsp;"+l+":&nbsp;"+(f+1)+"&nbsp;"}else{for(var O=r.scrollTop-d.virtualTop,k=d.getRowHeader(),e=0,h=0,A=2,w=0;w<m.rows.length;w++){var i=m.rows[w];p+=i.offsetHeight;if(p>O){if(i.getAttribute("FpKey")==null&&i.getAttribute("previewRow")!="true")e--;else h=i.offsetHeight;break}if(i.getAttribute("FpKey")!=null||i.getAttribute("previewRow")=="true"){e++;h=i.offsetHeight}}var o=d.getViewport1();if(o)e+=o.rows.length;if(element.getAttribute("layoutMode")==null&&s!=null&&s.length>0){h=h>z?z:h;for(var D=s.split(","),u=false,y=0;y<D.length;y++){var j=parseInt(D[y]);if(j==null||j>=GetColCount())continue;var b=GetCellByRowCol(e,j);if(!b||b.getAttribute("col")!=null&&parseInt(b.getAttribute("col"))!=j)continue;var q=b.getAttribute("group")==1,H=b.parentNode.getAttribute("previewRow")!=null,G=b.getAttribute("RowEditTemplate")!=null,K=isXHTML();if(!K&&strStyle==""){getScrollingContentStyle();if(scStyle!=null){if(scStyle.fontFamily!=null&&scStyle.fontFamily!="")strStyle+="fontFamily:"+scStyle.fontFamily+";";if(scStyle.fontSize!=null&&scStyle.fontSize!="")strStyle+="fontSize:"+scStyle.fontSize+";";if(scStyle.fontStyle!=null&&scStyle.fontStyle!="")strStyle+="fontStyle:"+scStyle.fontStyle+";";if(scStyle.fontVariant!=null&&scStyle.fontVariant!="")strStyle+="fontVariant:"+scStyle.fontVariant+";";if(scStyle.fontWeight!=null&&scStyle.fontWeight!="")strStyle+="fontWeight:"+scStyle.fontWeight+";";if(scStyle.backgroundColor!=null&&scStyle.backgroundColor!="")strStyle+="backgroundColor:"+scStyle.backgroundColor+";";if(scStyle.color!=null&&scStyle.color!="")strStyle+="color:"+scStyle.color}}if(!u)a+="<div style='overflow:hidden; height:"+h+"px; ScrollingContentWidth'><table cellPadding='0' cellSpacing='0' style='height:"+h+"px;"+(q?"":"table-layout:auto;")+strStyle+"'><tr>";a+="<td style='width:"+(q?0:b.offsetWidth)+"px;'>";A+=b.offsetWidth;if(q)a+="&nbsp;<i>GroupBar:</i>&nbsp;"+b.innerText+"&nbsp;";else if(H)a+="&nbsp;<i>PreviewRow:</i>&nbsp;"+b.innerText+"&nbsp;";else if(G){var I=parseCell(b);a+="&nbsp;<i>RowEditTemplate:</i>&nbsp;"+I+"&nbsp;"}else if(b.getAttribute("FpCellType")=="MultiColumnComboBoxCellType"&&b.children[0].MccbId)a+=GetValue(e,j);else if(b.getAttribute("FpCellType")=="RadioButtonListCellType"||b.getAttribute("FpCellType")=="ExtenderCellType"||b.getAttribute("FpEditorID")!=null){var t=parseCell(b);if(b.getAttribute("CellType2")!=null&&b.getAttribute("CellType2")=="MutuallyExclusiveCheckBoxCellType")t=t.replace("OVERFLOW: hidden;","");a+=t}else a+=b.innerHTML;a+="</td>";u=true;if(q||H||G)break}if(u){a=a.replace("ScrollingContentWidth"," width:"+A+"px; ");a+="</tr></table></div>"}}if(a.length<=0&&k){var f=getColGroup(k).children.length-1;if(element.getAttribute("layoutMode")==null)f=k.getAttribute("RowTextIndex")?parseInt(k.getAttribute("RowTextIndex")):getColGroup(k).children.length-1;var L=GetDisplayIndex(e),c=getHeaderCellFromRowCol(L,f,false);if(c==null)return;a="&nbsp;"+v+":&nbsp;"+xmlData.textContent(c)+"&nbsp;"}if(a.length<=0){var M=element.getAttribute("layoutRowCount")!=null?parseInt(element.getAttribute("layoutRowCount")):1;a="&nbsp;"+v+":&nbsp;"+(parseInt(e/M)+1)+"&nbsp;"}}if(d.getAttribute("virtualPaging")=="true"&&c!=null&&xmlData.textContent(c)=="")return;showMessageInner(a,x?-1:-2,x?-2:-1,J)}function parseCell(d){var a=d.innerHTML,c=getTopSpread(element),b=c.id;if(a.length>0){a=a.replace(new RegExp("id="+b,"g"),"id="+b+"src");a=a.replace(new RegExp("name="+b,"g"),"name="+b+"src")}return a}function getScrollingContentStyle(){if(scStyle!=null)return;var a=element.document;if(!a.styleSheets)a=window.document;for(var f=a.styleSheets.length,b=0;b<f;b++){for(var d=a.styleSheets[b],c=0;c<d.rules.length;c++){var e=d.rules[c];if(e.selectorText=="."+element.id+"scrollContentStyle"){scStyle=e.style;break}}if(scStyle!=null)break}}function IntegerCellType_getValue(b){var a=b.innerText,i=getCell(b,true);if(a==" "||trim(b.innerHTML)=="&nbsp;")return i.getAttribute("whiteSpace")==null?"":" ";b=i;var h=b.getAttribute("FpRef");if(b.getAttribute("FpRef")!=null)b=b.document.getElementById(h);if(b==null){var d=element.document;if(!d.getElementById)d=window.document;b=d.getElementById(h)}var c=b.getAttribute("groupchar");if(c!=null&&c!=" "){var f=b.document.createElement("SPAN");f.innerHTML=c;c=f.innerHTML}if(c=="&nbsp;")c=" ";if(c==null)c=",";var g=a.length;while(true){a=a.replace(c,"");if(a.length==g)break;g=a.length}if(a.charAt(0)=="("&&a.charAt(a.length-1)==")"){var e=b.getAttribute("negsign");if(e==null)e="-";a=e+a.substring(1,a.length-1)}return a}function IntegerCellType_isValid(f,a){if(a==null||a.length==0)return"";a=trim(a);if(a.length==0)return"";var b=f,h=f.getAttribute("FpRef");if(f.getAttribute("FpRef")!=null)b=f.document.getElementById(h);if(b==null){var g=element.document;if(!g.getElementById)g=window.document;b=g.getElementById(h)}var i=b.getAttribute("negsign"),k=b.getAttribute("possign");if(i!=null)a=a.replace(i,"-");if(k!=null)a=a.replace(k,"+");if(a.charAt(a.length-1)=="-")a="-"+a.substring(0,a.length-1);var l=new RegExp("^\\s*[-\\+]?\\d+\\s*$"),c=a.match(l)!=null;if(c)c=!isNaN(a);if(c){var e=b.getAttribute("MinimumValue"),d=b.getAttribute("MaximumValue"),j=parseInt(a);if(e!=null){e=parseInt(e);c=!isNaN(e)&&j>=e}if(c&&d!=null){d=parseInt(d);c=!isNaN(d)&&j<=d}}return!c?b.getAttribute("error")!=null?b.getAttribute("error"):"Integer":""}function IntegerCellType_setValue(c,b){var a=getCell(c,true);if(a.getAttribute("negativeRed"))if(b<0){if(a.style.color!="red"){a.setAttribute("savedColor",a.style.color);a.style.color="red"}}else if(a.getAttribute("savedColor")!=a.style.color)a.style.color=a.getAttribute("savedColor")==null?"":a.getAttribute("savedColor");if(b!=null&&b!="")xmlData.textContent(c,b);else c.innerHTML="&nbsp;"}function DoubleCellType_isValid(e,a){if(a==null||a.length==0)return"";var b=e,j=e.getAttribute("FpRef");if(e.getAttribute("FpRef")!=null)b=e.document.getElementById(j);if(b==null){var h=element.document;if(!h.getElementById)h=window.document;b=h.getElementById(j)}var f=b.getAttribute("decimalchar");if(f==null)f=".";var d=b.getAttribute("groupchar");if(d==null)d=",";a=trim(a);var c=true;c=a.length==0||a.charAt(0)!=d;if(c){var g=a.indexOf(f);if(g>=0){g=a.indexOf(d,g);c=g<0}}if(c){var i=a.length;while(true){a=a.replace(d,"");if(a.length==i)break;i=a.length}}if(a.length==0)c=false;else if(c){var m=b.getAttribute("negsign"),n=b.getAttribute("possign"),l=b.getAttribute("MinimumValue"),k=b.getAttribute("MaximumValue");c=isDouble(a,f,m,n,l,k)}return!c?b.getAttribute("error")!=null?b.getAttribute("error"):"Double":""}function DoubleCellType_getValue(b){var a=b.innerText,h=getCell(b,true);if(a==" "||trim(b.innerHTML)=="&nbsp;")return h.getAttribute("whiteSpace")==null?"":" ";b=h;var g=b.getAttribute("FpRef");if(b.getAttribute("FpRef")!=null)b=b.document.getElementById(g);if(b==null){var c=element.document;if(!c.getElementById)c=window.document;c.getElementById(g)}var e=b.getAttribute("groupchar");if(e==null)e=",";var f=a.length;while(true){a=a.replace(e,"");if(a.length==f)break;f=a.length}if(a.charAt(0)=="("&&a.charAt(a.length-1)==")"){var d=b.getAttribute("negsign");if(d==null)d="-";a=d+a.substring(1,a.length-1)}return a}function DoubleCellType_setValue(c,b){var a=getCell(c,true);if(a.getAttribute("negativeRed"))if(b<0){if(a.style.color!="red"){a.setAttribute("savedColor",a.style.color);a.style.color="red"}}else if(a.getAttribute("savedColor")!=a.style.color)a.style.color=a.getAttribute("savedColor")==null?"":a.getAttribute("savedColor");if(b!=null&&b!="")xmlData.textContent(c,b);else c.innerHTML="&nbsp;"}function CurrencyCellType_isValid(f,a){if(a!=null&&a.length>0){var b=f,k=f.getAttribute("FpRef");if(f.getAttribute("FpRef")!=null)b=f.document.getElementById(k);if(b==null){var i=element.document;if(!i.getElementById)i=window.document;b=i.getElementById(k)}var g=b.getAttribute("currencychar");if(g==null)g="$";a=a.replace(g,"");var e=b.getAttribute("groupchar");if(e==null)e=",";var d=b.getAttribute("decimalchar");if(d==null)d=".";a=trim(a);var c=true;c=a.length==0||a.charAt(0)!=e;if(c){var h=a.indexOf(d);if(h>=0){h=a.indexOf(e,h);c=h<0}}if(c){var j=a.length;while(true){a=a.replace(e,"");if(a.length==j)break;j=a.length}}if(a.length==0)c=false;else if(c){var n=b.getAttribute("negsign"),o=b.getAttribute("possign"),m=b.getAttribute("MinimumValue"),l=b.getAttribute("MaximumValue");c=isDouble(a,d,n,o,m,l)}if(!c)return b.getAttribute("error")!=null?b.getAttribute("error"):"Currency ("+g+"100"+d+"10) "}return""}function isDouble(b,k,g,h,f,e){if(b==null||b.length==0)return true;b=trim(b);if(b.length==0)return true;if(g!=null)b=b.replace(g,"-");if(h!=null)b=b.replace(h,"+");if(b.charAt(b.length-1)=="-")b="-"+b.substring(0,b.length-1);var l=new RegExp("^\\s*([-\\+])?(\\d+)?(\\"+k+"(\\d+))?([eE]([-\\+])?(\\d+))?\\s*$"),a=b.match(l);if(a==null)return false;if((a[2]==null||a[2].length==0)&&(a[4]==null||a[4].length==0))return false;var c="";if(a[1]!=null&&a[1].length>0)c=a[1];if(a[2]!=null&&a[2].length>0)c+=a[2];else c+="0";if(a[4]!=null&&a[4].length>0)c+="."+a[4];if(a[6]!=null&&a[6].length>0){c+="E"+a[6];if(a[7]!=null)c+=a[7];else c+="0"}num=parseFloat(c);if(isNaN(num))return false;var d=true;if(f!=null){var j=parseFloat(f);d=!isNaN(j)&&num>=j}if(d&&e!=null){var i=parseFloat(e);d=!isNaN(i)&&num<=i}return d}function CurrencyCellType_getValue(b){var a=b.innerText,j=getCell(b,true);if(a==" "||trim(b.innerHTML)=="&nbsp;")return j.getAttribute("whiteSpace")==null?"":" ";b=j;var i=b.getAttribute("FpRef");if(b.getAttribute("FpRef")!=null)b=b.document.getElementById(i);if(b==null){var d=element.document;if(!d.getElementById)d=window.document;b=d.getElementById(i)}var c=b.getAttribute("currencychar");if(c!=null){var g=b.document.createElement("SPAN");g.innerHTML=c;c=g.innerHTML}if(c==null)c="$";var f=b.getAttribute("groupchar");if(f==null)f=",";a=a.replace(c,"");var h=a.length;while(true){a=a.replace(f,"");if(a.length==h)break;h=a.length}var e=b.getAttribute("negsign");if(e==null)e="-";if(a.charAt(0)=="("&&a.charAt(a.length-1)==")")a=e+a.substring(1,a.length-1);return a}function CurrencyCellType_setValue(c,b){var a=getCell(c,true);if(a.getAttribute("negativeRed"))if(b<0){if(a.style.color!="red"){a.setAttribute("savedColor",a.style.color);a.style.color="red"}}else if(a.getAttribute("savedColor")!=a.style.color)a.style.color=a.getAttribute("savedColor")==null?"":a.getAttribute("savedColor");if(b!=null&&b!=""){b=b.replace(" ","");c.innerHTML=b}else c.innerHTML="&nbsp;"}function TextCellType_getValue(a){var b=getCell(a,false);if(b==null)return"";if(b.getAttribute("password")!=null)return b!=null&&b.getAttribute("value")!=null?b.getAttribute("value"):"";else{if(xmlData.firstElementChild(a)!=null&&xmlData.firstElementChild(a).tagName=="NOBR")a=xmlData.firstElementChild(a);if(a.innerText==" "||trim(a.innerHTML)=="&nbsp;")return b.getAttribute("whiteSpace")==null?"":" ";var c=$$.utils.htmlDecode(a.innerHTML);if(c.length>1)c=c.replace(/\n\n$/g,"\n");return c}}function TextCellType_setValue(b,a){var d=getCell(b,true);if(d==null)return;var c=null;if(b.children)c=b.children;else c=b.childNodes;if(c.length>0&&c[0].tagName&&c[0].tagName.toUpperCase()=="NOBR"){var e=b;b=c[0];if(e.style.removeAttribute)e.style.removeAttribute("display");else e.style.removeProperty("display")}if(d.getAttribute("password")!=null)if(a!=null&&a!=""){b.innerHTML="";for(var f=0;f<a.length;f++)b.innerHTML+="*";d.setAttribute("value",a)}else{b.innerHTML="&nbsp;";d.setAttribute("value","")}else if(b.tagName=="INPUT"||b.tagName=="TEXTAREA"){if(a==null)a="";if(typeof b.maxLength!="undefined"&&b.maxLength>0)a=a.substring(0,b.maxLength);b.value=a}else if(a!=null&&a!=""){a=$$.utils.htmlEncode(a);if(a.length>3)a=a.replace(/<br>$/g,"<br><br>");b.innerHTML=a}else b.innerHTML="&nbsp;"}function TextCellType_isValid(c,d){var e=getCellEditorID(c);if(e==null)return;var b=c.document.getElementById(e),a=-1;if(b!=null&&typeof b.maxLength!="undefined")a=parseInt(b.maxLength);return a>0&&d!=null&&d.length>a?typeof element.getAttribute("lcidError")!=null?element.getAttribute("lcidError"):"error":""}function GeneralCellType_getValue(a){var c=getCell(a);if(c==null)return"";if(xmlData.firstElementChild(a)!=null&&xmlData.firstElementChild(a).tagName=="NOBR")a=xmlData.firstElementChild(a);if(trim(a.innerHTML)=="&nbsp;")return c.getAttribute("whiteSpace")==null?"":" ";var b=a.value;if(a.tagName=="NOBR")b=c.value;if(typeof b=="undefined")if(isHeaderCell(c))b=trim(a.innerText);else b=$$.utils.htmlDecode(a.innerHTML);return b}function GeneralCellType_setValue(b,d){var a=getCell(b,true);if(a.getAttribute("negativeRed"))if(d<0){if(a.style.color!="red"){a.setAttribute("savedColor",a.style.color);a.style.color="red"}}else if(a.getAttribute("savedColor")!=a.style.color)a.style.color=a.getAttribute("savedColor")==null?"":a.getAttribute("savedColor");var c=null;if(b.children)c=b.children;else c=b.childNodes;if(c.length>0&&c[0].tagName&&c[0].tagName.toUpperCase()=="NOBR"){var e=b;b=c[0];if(e.style.removeAttribute)e.style.removeAttribute("display");else e.style.removeProperty("display")}if(d!=null&&d!=""){d=$$.utils.htmlEncode(d);b.innerHTML=d}else b.innerHTML="&nbsp;"}function EmptyCellType_getValue(a){return GeneralCellType_getValue(a)}function EmptyCellType_setValue(b,a){GeneralCellType_setValue(b,a)}function RegExpCellType_isValid(a,c){if(c==null||a==null)return"";if(trim(c).length==0)return"";var b=a,f=a.getAttribute("FpRef");if(a.getAttribute("FpRef")!=null)b=a.document.getElementById(f);if(b==null){var d=element.document;if(!d.getElementById)d=window.document;b=d.getElementById(f)}var e=b.getAttribute("fpexpression");if(e==null||e.length==0)return"";var h=new RegExp(e),g=c.match(h);return g!=null&&c==g[0]?"":b.getAttribute("error")}function ComboBoxCellType_setValue(b,d,i){var g=getCell(b,true);if(g==null)return;var f=g.getElementsByTagName("SELECT");if(f!=null&&f.length>0){f(0).value=d;return}var e=i.getCellEditorID(g),a=null;if(e!=null&&typeof e!="undefined"){a=i.getCellEditor(e,false);if(a!=null){a.value=d;if(a.selectedIndex>=0&&a.selectedIndex<a.options.length)d=a.options(a.selectedIndex).text;var c=null;if(b.children)c=b.children;else c=b.childNodes;if(c.length>0&&c[0].tagName&&c[0].tagName.toUpperCase()=="NOBR"){var h=b;b=c[0];if(h.style.removeAttribute)h.style.removeAttribute("display");else h.style.removeProperty("display")}if(d!=null&&d!="")xmlData.textContent(b,d);else b.innerHTML="&nbsp;"}}}function ComboBoxCellType_getValue(h,i){var b=h.innerText,c=getCell(h,false);if(c==null)return null;var g=$$.utils.stringEquals;if(g(b," ")&&c.getAttribute("specialValue")!=null)b="";var f=c.getElementsByTagName("SELECT");if(f!=null&&f.length>0)return f(0).value;var e=i.getCellEditorID(c),a=null;if(e!=null&&typeof e!="undefined"){a=i.getCellEditor(e,false);if(a!=null&&a.options!=null)for(var j=a.options.length,d=0;d<j;d++)if(g(a.options(d).text,b))return a.options(d).value;return null}return b}function CheckBoxCellType_setFocus(b){var a=b.getElementsByTagName("INPUT");a!=null&&a.length>0&&a[0].type=="checkbox"&&a[0].focus()}function CheckBoxCellType_getCheckBoxEditor(b){if(b==null)return null;var a=b.getElementsByTagName("INPUT");return a!=null&&a.length>0&&a[0].type=="checkbox"?a[0]:null}function CheckBoxCellType_isValid(b,a){if(a==null)return"";a=trim(a);return a==""?"":a.toLowerCase()=="true"||a.toLowerCase()=="false"?"":"invalid value"}function CheckBoxCellType_getValue(a,b){return CheckBoxCellType_getEditorValue(a,b)}function CheckBoxCellType_getEditorValue(c){var b=getCell(c,true),a=CheckBoxCellType_getCheckBoxEditor(b);return a!=null&&a.checked?"true":"false"}function CheckBoxCellType_setValue(d,b){var c=getCell(d,true),a=CheckBoxCellType_getCheckBoxEditor(c);if(a!=null){a.checked=b!=null&&b.toLowerCase()=="true";return}}function ListBoxCellType_setEditorValue(a,c){if(a==null||c==null||c=="")return;for(var b=0;b<a.options.length;b++)if($$.utils.stringEquals(trim(a.options[b].value),trim(c))){a.options[b].selected=true;return}}function ListBoxCellType_setValue(c,b){var a=getCell(c,true);if(a==null)return;if(b!=null)b=trim(b);for(var e=a.children(0).children,d=0;d<e.length;d++)if(e[d].tagName=="TABLE")for(var g=e[d].rows,f=0;f<g.length;f++){var a=g(f).cells(0),h=trim(a.innerText);if(b!=null&&$$.utils.stringEquals(b,h)){a.setAttribute("selected","true");if(typeof c.getAttribute("SelectedBackColor")!="undefined")a.style.background=c.getAttribute("SelectedBackColor");if(typeof c.getAttribute("SelectedForeColor")!="undefined")a.style.color=c.getAttribute("SelectedForeColor")}else{a.style.background="";a.style.color="";a.removeAttribute("selected")}}}function ListBoxCellType_getValue(g){var f=getCell(g,true);if(f==null)return null;for(var b=f.children(0).children,a=0;a<b.length;a++)if(b[a].tagName=="TABLE")for(var e=b[a].rows,c=0;c<e.length;c++){var d=e(c).cells(0);if(d.getAttribute("selected")=="true")return trim(d.innerText)}return null}function RadioButtonListCellType_getValue(d){for(var c=getCell(d),b=c.getElementsByTagName("INPUT"),a=0;a<b.length;a++)if(b(a).tagName=="INPUT"&&b(a).checked)return b(a).value;return null}function RadioButtonListCellType_getEditorValue(a,b){return RadioButtonListCellType_getValue(a,b)}function RadioButtonListCellType_setValue(e,c){if(c!=null)c=trim(c);for(var d=getCell(e),b=d.getElementsByTagName("INPUT"),a=0;a<b.length;a++)if(b(a).tagName=="INPUT"&&c==trim(b(a).value)){b(a).checked=true;break}else if(b(a).checked)b(a).checked=false}function RadioButtonListCellType_setFocus(d){var c=getCell(d),b=c.getElementsByTagName("INPUT");if(b==null)return;for(var a=0;a<b.length;a++)if(b[a].type=="radio"&&b[a].checked){b[a].focus();return}for(var a=0;a<b.length;a++)if(b[a].type=="radio"){b[a].focus();return}}function HyperLinkCellType_getValue(b){var a=b.innerText;if(typeof a!="undefined"&&a!=null&&a.length>0){a=$$.utils.replaceAll(a,"\n","");a=trim(a)}else a="";return a}function ButtonCellType_getValue(b){var a=b.innerText;if(typeof a!="undefined"&&a!=null&&a.length>0){a=$$.utils.replaceAll(a,"\n","");a=trim(a)}else a="";return a}function TagCloudCellType_getValue(b){var a=b.innerText;if(typeof a!="undefined"&&a!=null&&a.length>0)a=$$.utils.htmlDecode(a);else a="";return a}function PercentCellType_getValue(m){var c=getCell(m),a=trim(c.innerText);if(a==null)return a;var b=c,h=c.getAttribute("FpRef");if(c.getAttribute("FpRef")!=null)b=c.document.getElementById(h);if(b==null){var d=element.document;if(!d.getElementById)d=window.document;b=d.getElementById(h)}var f=b.getAttribute("percentchar");if(f==null)f="%";a=a.replace(f,"");var i=b.getAttribute("negsign"),j=b.getAttribute("possign"),e=b.getAttribute("groupchar");if(e==null)e=",";var g=a.length;while(true){a=a.replace(e,"");if(a.length==g)break;g=a.length}var l=a;if(i!=null)a=a.replace(i,"-");if(j!=null)a=a.replace(j,"+");var k=b.getAttribute("decimalchar");if(k!=null)a=a.replace(k,".");return!isNaN(a)?l:trim(c.innerText)}function PercentCellType_setValue(e,a){if(a!=null)a=trim(a);var b=getCell(e,true);if(b.getAttribute("negativeRed"))if(a<0){if(b.style.color!="red"){b.setAttribute("savedColor",b.style.color);b.style.color="red"}}else if(b.getAttribute("savedColor")!=b.style.color)b.style.color=b.getAttribute("savedColor")==null?"":b.getAttribute("savedColor");if(a!=null&&a!=""){var c=getCell(e);if(c.getAttribute("FpRef")!=null)c=c.document.getElementById(c.getAttribute("FpRef"));var d=c.getAttribute("percentchar");if(d==null)d="%";a=a.replace(" ","");a=a.replace(d,"");xmlData.textContent(e,a+d)}else e.innerHTML="&nbsp;"}function PercentCellType_isValid(q,a){if(a!=null){var b=getCell(q),m=b.getAttribute("FpRef");if(b.getAttribute("FpRef")!=null)b=b.document.getElementById(m);if(b==null){var f=element.document;if(!f.getElementById)f=window.document;b=f.getElementById(m)}var e=b.getAttribute("percentchar");if(e==null)e="%";a=a.replace(e,"");var i=b.getAttribute("groupchar");if(i==null)i=",";var l=a.length;while(true){a=a.replace(i,"");if(a.length==l)break;l=a.length}var p=a,g=b.getAttribute("negsign"),h=b.getAttribute("possign");if(g!=null)a=a.replace(g,"-");if(h!=null)a=a.replace(h,"+");var d=b.getAttribute("decimalchar");if(d!=null)a=a.replace(d,".");var c=!isNaN(a);if(c){var k=b.getAttribute("MinimumValue"),j=b.getAttribute("MaximumValue");if(k!=null||j!=null){var o=parseFloat(k),n=parseFloat(j);c=!isNaN(o)&&!isNaN(n);if(c){if(d==null)d=".";c=isDouble(p,d,g,h,o*100,n*100)}}}if(!c)return b.getAttribute("error")!=null?b.getAttribute("error"):"Percent: (ex, 10"+e+")"}return""}function MultiColumnComboBoxCellType_setValue(rd,val,ss){var cell=getCell(rd,true);if(cell==null)return;var mccbId=getMccbID(cell,ss);if(mccbId!=null){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval(mccbId+"_Obj");if(editorObj!=null){if(editorObj.GetUseValue()==1)editorObj.SetValueToDataColumn(val);else editorObj.SetValueToTextColumn(val);if(editorObj.GetShowButton()!=1){var text=val;if(val!=null)text=editorObj.GetCurrentText(cell);if(text!=null&&text!="")rd.innerHTML=$$.utils.htmlEncode(text);else rd.innerHTML="&nbsp;"}}}}function getMccbID(d,e){var b=e.getCellEditorID(d);if(b!=null&&typeof b!="undefined"){var c=e.getCellEditor(b,true);if(c!=null&&c.getAttribute("MccbId")!=null)return c.getAttribute("MccbId")}var a=d.getElementsByTagName("DIV");if(a!=null&&a.length>0)if(a[0].getAttribute("MccbId")!=null)return a[0].getAttribute("MccbId");return null}function MultiColumnComboBoxCellType_getValue(rd,ss){var cl=getCell(rd,true);if(cl==null)return null;var mccbId=getMccbID(cl,ss);if(mccbId!=null){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval(mccbId+"_Obj");if(editorObj!=null){editorObj.Value=null;return editorObj.GetCurrentValue(cl)}}return null}function MultiColumnComboBoxCellType_getEditorValue(d){var c=getCell(d,true);if(c==null)return;var a=c.getElementsByTagName("INPUT");if(a!=null&&a.length>0){var b=a[0];return b.getAttribute("UseValue")==1?b.getAttribute("DataValue"):b.value}return null}function MultiColumnComboBoxCellType_setFocus(rd){var cell=getCell(rd);if(cell==null)return;var divs=cell.getElementsByTagName("DIV");if(divs!=null&&divs.length>0)if(divs[0].getAttribute("MccbId"))try{var editorObj=eval(divs[0].getAttribute("MccbId")+"_Obj");editorObj!=null&&editorObj.FocusForEdit!=null&&editorObj.FocusForEdit()}catch(ex){$$.DEBUG.Log(ex,"MultiColumnComboBoxCellType_setFocus")}}function MultiColumnComboBoxCellType_setEditorValue(rd,editorValue,ss){var cell=getCell(rd,true);if(cell==null)return;var editorID=ss.getCellEditorID(cell),editor=null;if(editorID!=null&&typeof editorID!="undefined"){editor=ss.getCellEditor(editorID,true);if(editor!=null&&editor.getAttribute("MccbId")){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(editor.getAttribute("MccbId"));var editorObj=eval(editor.getAttribute("MccbId")+"_Obj");if(editorObj!=null&&editorObj.SetValueToDataColumn!=null)if(editorObj.GetUseValue()==1)editorObj.SetValueToDataColumn(editorValue);else editorObj.SetValueToTextColumn(editorValue)}}}function inactiveAllChart(a){activeChartObj=a.GetActiveChartObj();if(activeChartObj!=null){activeChartObj.normalChart();activeChartObj.inactiveChart();activeChartObj=null}}function RefreshChart(){if(editing)return;saveData();var a=element.getAttribute("ajax")!="false";a&&syncData(element.getAttribute("name"),"RefreshChart,"+activeChartObj.chartID)}function GetActiveChartObj(){return activeChartObj}function GetActiveChart(){return activeChartObj!=null?activeChartObj.container:null}function SetActiveChartObj(a){activeChartObj=a;fireSelectionChangedEvent(element)}function SetActiveChart(id){var chartContainerID=getChartByChartId(id);if(chartContainerID==null)return;var chartObj=null;try{chartObj=eval(chartContainerID+"_Obj")}catch(ex){$$.DEBUG.Log(ex,"SetActiveChartObj")}if(chartObj!=null)if(!chartObj.isActived){editing&&EndEdit();ClearSelection();chartObj.inactiveChart();chartObj.activeChart();var btn=getCmdBtn("Update");btn!=null&&updateCmdBtnState(btn,false);btn=getCmdBtn("Copy");btn!=null&&updateCmdBtnState(btn,true);btn=getCmdBtn("Paste");btn!=null&&updateCmdBtnState(btn,true);btn=getCmdBtn("Clear");btn!=null&&updateCmdBtnState(btn,true);dirty=true;RemoveSelection(-1,-1,-1,-1)}}function getChartByChartId(d){for(var c=element.getElementsByTagName("DIV"),b=0;b<c.length;b++){var a=c[b];if(a.id.indexOf("_chartContainer")>0&&a.getAttribute("serverID")==d)return a.id}return null}function updateChartURL(a){if(activeChartObj!=null)activeChartObj.getChart().src=a.src+"#"+Math.random()}function updateChartAllImg(){for(var items=element.getElementsByTagName("DIV"),i=0;i<items.length;i++){var item=items[i];if(item.id.indexOf("_chartContainer")>0)if(item.getAttribute("selectChart")!="false"){var chartObj=eval(item.id+"_Obj");chartObj.init();chartObj.updateChartImgitem()}}}function initChartObj(){for(var items=element.getElementsByTagName("DIV"),sufix="_chartContainer",initScripts=[],i=0;i<items.length;i++){var item=items[i];if(item.id.indexOf("_chartContainer")>0){var js=item.id+'_Obj = new FarPoint.Web.Spread.SpreadChart(element.document.getElementById("'+element.id+'"),element.document.getElementById("'+item.id+'"));'+item.id+"_Obj.init();";initScripts.push(js)}}for(var i=0;i<initScripts.length;i++){var spread=getTopSpread(element);spread.resizing=true;eval(initScripts[i]);spread.resizing=false}}function chartDispose(){for(var items=element.getElementsByTagName("DIV"),i=0;i<items.length;i++){var item=items[i];if(item.id.indexOf("_chartContainer")>0)if(item.getAttribute("selectChart")!="false"){var chartObj=eval(item.id+"_Obj");chartObj.dispose()}}activeChartObj=null}function GetCurrentPageIndex(){var a=parseInt(element.getAttribute("currentPageIndex"));return a!=NaN?a:0}function cloneArray(b){for(var c=[],a=0;a<b.length;a++)if($$(b[a]).isClass("Array"))c.push(cloneArray(b[a]));else c.push(b[a]);return c}function findCrossedSpanCells(f,g,e,c,d){var b=[],a=[];c&&this.colSpanCells&&this.colSpanCells.length>0&&a.splice(a.length,0,cloneArray(this.colSpanCells));d&&this.rowSpanCells&&this.rowSpanCells.length>0&&a.splice(a.length,0,cloneArray(this.rowSpanCells));e&&this.spanCells&&this.spanCells.length>0&&a.splice(a.length,0,cloneArray(this.spanCells));$$.utils.cleanArray(a);_findCrossedSpanCellsInternal(a,f,g,b);return b}function _findCrossedSpanCellsInternal(a,d,e,j){for(var g=d,f=e,i=a.length-1;i>=0;i--){for(var c=a[i],h=c.length-1;h>=0;h--){var b=c[h],k=b.row+b.rowCount-1;if(b.row<=e&&k>=d){j.push(b);c.splice(h,1);if(g>b.row)g=b.row;if(f<k)f=k}}c.length==0&&a.splice(i,1)}a.length>0&&g<d&&_findCrossedSpanCellsInternal(a,g,d-1,j);a.length>0&&f>e&&_findCrossedSpanCellsInternal(a,e+1,f,j)}function getRowRange(a){var c=Number.MAX_VALUE,b=0;if(a&&a.length>0){for(var e=0,f=a.length;e<f;e++){var d=a[e];c=Math.min(c,d.row);b=Math.max(b,d.row+d.rowCount-1)}return{startRow:c,endRow:b}}else return null}function getViewportFrozenRowCount(){var a=getFrozRowHeader();if(a!=null)return a.rows.length;if(frzCols>0){var a=getViewport0();if(a!=null)return a.rows.length}var a=getViewport1();return a!=null?a.rows.length:0}function callback_preProcessSyncrhonzing(){if(element.getAttribute("virtualPaging")=="true"){var b=getViewport().parentElement,c=b.offsetHeight+"px",a=b.all(element.id+"__preventScrollDiv");if(a==null){a=document.createElement("DIV");a.id=element.id+"__preventScrollDiv";a.style.position="relative";a.style.width="1px";b.insertBefore(a)}a.style.height=c;a.style.display="block"}}function callback_afterProcessSyncrhonzing(){if(element.getAttribute("virtualPaging")=="true"){var b=getViewport().parentElement,a=b.all(element.id+"__preventScrollDiv");if(a!=null){a.style.height="0px";a.style.display="none"}}}function findChildViewsByLevel(a,c){if(c<=0)return a;if(!$$(a).isClass("Array"))return findChildViewsByLevel([a],c);var b;do{c--;b=[];for(var d=0,g=a.length;d<g;d++)for(var f=FpSpreadJS.getChildViews(a[d]),e=0,h=f.length;e<h;e++)b.push(f[e]);a=b}while(c>0);return b}function syncChildViewColumnRange(o,i,j,q){var f=fpSpreadJS.childViewIndexes.length;if(f>0){var c=FpSpreadJS.getChildViews(o),h=c[0].GetColCount();if(i<0)i=0;if(j<0)j=h-1;if(i>j)return;if(q)for(var a=0;a<f;a++)syncChildViewColumnRange(c[a],-1,-1);var p=0,k=o.getParentSpread();while(k!=null){p++;k=k.getParentSpread()}c=findChildViewsByLevel(getTopSpread(),p+1);f=c.length;for(var g=[],a=0;a<h;a++)g.push(0);for(var d=0;d<f;d++){var b=c[d];b.__columnWidths=[];for(var a=0;a<h;a++){var m=b.getColHeader(),e=0;if(m!=null){var l=getRealColWidth(m,a);e=l}var r=b.getViewport(),l=getRealColWidth(r,a);if(e<l)e=l;if(g[a]<e)g[a]=e;b.__columnWidths.push(e)}}for(var d=0;d<f;d++){for(var b=c[d],n=b.__columnWidths,a=0;a<h;a++)n[a]<g[a]&&b.setColWidth(a,g[a],n[a]);b.__columnWidths=null}}}function syncRowRangeSafeMode(c,d,b,a){syncRowRange(c,d,b,a,callback_preProcessSyncrhonzing,callback_afterProcessSyncrhonzing)}function syncRowRange(a,b,f,i,n,o){typeof n!="undefined"&&n!=null&&n();if(a==b&&a==-1){if(f){var A=getFrozColHeader()||getColHeader();b=A!=null?A.rows.length-1:-1}else if(i){var z=getFrozColFooter()||getColFooter();b=z!=null?z.rows.length-1:-1}else{var B=getViewport2()||getViewport();b=B!=null?B.rows.length-1+frzRows:frzRows-1}a=0}else if(a<0||b<0||a>b||!f&&a>=this.GetRowCountInternal())return;var y=GetRowCountInternal();if(b>=y)b=y-1;if(!f&&!i&&a<frzRows&&b>=frzRows){syncRowRange(a,frzRows-1,false);syncRowRange(frzRows,b,false);return}var p=getCorner()!=null&&getCorner().getAttribute("allowTableCorner");if(f&&p){a=0;b=frzCols>0?getFrozColHeader().rows.length-1:getColHeader()!=null?getColHeader().rows.length-1:-1}else if(i){a=0;b=frzCols>0?getFrozColFooter()!=null?getFrozColFooter().rows.length-1:-1:getColFooter()!=null?getColFooter().rows.length-1:-1}else{var q=findCrossedSpanCells(a,b,!f,f,!f);if(q!=null&&q.length>0){var E=getRowRange(q);a=Math.min(a,E.startRow);b=Math.max(b,E.endRow)}}if(b>=a){var m=getViewportFrozenRowCount(),F=!i&&!f&&a<m;if(!F&&!i&&!f){a-=m;b-=m}var g;if(f){g=[getFrozColHeader(),getColHeader()];p&&g.push(getCorner())}else if(i)g=[getFrozColFooter(),getColFooter()];else g=F?[getFrozRowHeader(),getViewport0(),getViewport1()]:[getRowHeader(),getViewport2(),getViewport()];$$.utils.cleanArray(g);for(var j=g.length,d=0;d<j;d++)g[d].style.height="";if(f&&!p&&getCorner()!=null){var D=getCorner().rows[0];if(D!=null)D.style.height=""}for(var r=false,d=0;d<j;d++){var G=g[d];r|=Number(G.cellSpacing)>0;for(var e=G.rows,c=a;c<=b;c++){var h=e[c];if(h.synDelt!=null){h.style.height=Math.max(h.style.posHeight-h.synDelt,0)+"px";h.synDelt=null}var w=getFirstNonSpanCell(h);if(w!=null){w.style.height="";if(w!=h.cells[0])h.cells[0].style.height=""}}}for(var k=[],C=[],s=0,t=$$.browser.quirksMode,c=a;c<=b;c++)k.push(0);for(var d=0;d<j;d++){var e=g[d].rows;if((t||r||a==0)&&e.length>0){var x=e[0].offsetTop;C.push(x);if(s<x)s=x}for(var c=a;c<=b;c++)if(k[c-a]<e[c].offsetHeight)k[c-a]=e[c].offsetHeight}for(var u=getViewport(),H=u!=null&&fpSpreadJS.childViewIndexes.length>0,d=0;d<j;d++){for(var e=g[d].rows,c=a;c<=b;c++){var l=1;if(H&&!t){var J=FpSpreadJS.isChildSpreadRow(u,c);if(J){var I=u.rows[c].cells[0].children[0];if(getPagers(I).length==0)l=0}}e[c].style.height=k[c-a]+l+"px";e[c].synDelt=l==0?null:l}if((t||r||a==0)&&a==0){var v=s-C[d];e[0].style.posHeight=e[0].style.posHeight+v;e[0].synDelt=e[0].synDelt==null?v:e[0].synDelt+v}}}typeof o!="undefined"&&o!=null&&o()}</script>