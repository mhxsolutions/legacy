//
//	  Copyright (C) 2003-2010 GrapeCity Inc.	All rights reserved.
//

var the_fpSpread=new Fpoint_FPSpread;Function.prototype.CreateDelegate=function(a,b){return function(){return b.apply(a,arguments)}};Function.prototype.CreateCallback=function(b,a){return function(){var e=arguments.length;if(e>0){for(var d=[],c=0;c<e;c++)d[c]=arguments[c];d[e]=a;return b.apply(this,d)}return b.call(this,a)}};var SelectionBlockOptions=new function(){this.None=0;this.Cells=1;this.Rows=2;this.Columns=4;this.Sheet=8};function FpSpread_EventHandlers(){var a=the_fpSpread;this.TranslateKeyUp=function(b){a.TranslateKeyUp(b)};this.TranslateKeyPress=function(b){a.TranslateKeyPress(b)};this.TranslateKey=function(b){a.TranslateKey(b)};this.SetActiveSpread=function(b){a.SetActiveSpread(b)};this.MouseDown=function(b){a.MouseDown(b)};this.MouseUp=function(b){a.MouseUp(b)};this.__MouseUp=function(b){a.__MouseUp(b)};this.MouseMove=function(b){a.MouseMove(b)};this.MouseWheel=function(b){a.MouseWheel(b)};this.DblClick=function(b){a.DblClick(b)};this.DoPropertyChange=function(b){a.DoPropertyChange(b)};this.CmdbarMouseOver=function(b){a.CmdbarMouseOver(b)};this.CmdbarMouseOut=function(b){a.CmdbarMouseOut(b)};this.ScrollViewport=function(b){a.ScrollViewport(b)};this.Focus=function(d){var b=d.target;if(typeof b.tabIndex!="undefined"&&b.tabIndex<0){var c=document.getElementById(b.id+"_textBox");if(c!=null)b.tabIndex=c.tabIndex;return}a.Focus(b,d)};this.docLoad=function(){if(a.spreads==null||a.spreads.length==0)return;for(var f=a.spreads.length,c=0;c<f;c++){var b=a.spreads[c],d=a.GetRowCount(b);if(d>0){a.BackUpStyleSetting(b);var e=a.GetRowHeightInternal(b,0);a.RestoreStyleSetting(b);a.SetRowHeight2(b,0,e,false)}}};this.hideSelectionBlock=function(d){var b=a.GetPageActiveSpread(),c=a.GetTarget(d);if(b==null||a.GetSpread(c)==b||a.IsChild(c,b))return;a.hideSelectionBlock(b)};a.AttachEvent(document,"keypress",this.TranslateKeyPress,true);a.AttachEvent(document,"keydown",this.TranslateKey,true);a.AttachEvent(document,"keyup",this.TranslateKeyUp,true);a.AttachEvent(document,"mouseup",this.MouseUp,false);a.DetachEvent(document,"mousedown",this.SetActiveSpread,false);a.AttachEvent(document,"mousedown",this.SetActiveSpread,false);a.AttachEvent(document,"focus",this.hideSelectionBlock,true);a.AttachEvent(window,"resize",a.DoResize,false);a.AttachEvent(window,"load",this.docLoad,false);this.AttachEvents=function(b){a.AttachEvent(b,"mousedown",this.MouseDown,false);a.AttachEvent(b,"mouseup",this.__MouseUp,false);a.AttachEvent(b,"mousemove",this.MouseMove,false);a.AttachEvent(b,"dblclick",this.DblClick,false);a.AttachEvent(b,"focus",this.Focus,false);var f=a.GetViewport(b);if(f!=null){a.AttachEvent(a.GetViewport(b).parentNode,"DOMAttrModified",this.DoPropertyChange,true);a.AttachEvent(a.GetViewport(b).parentNode,"scroll",this.ScrollViewport);f.parentNode!=null&&f.parentNode.addEventListener("DOMMouseScroll",this.MouseWheel,false)}var e=a.GetCommandBar(b);if(e!=null){a.AttachEvent(e,"mouseover",this.CmdbarMouseOver,false);a.AttachEvent(e,"mouseout",this.CmdbarMouseOut,false)}var c=a.GetPager1(b);if(c!=null){a.AttachEvent(c,"mouseover",this.CmdbarMouseOver,false);a.AttachEvent(c,"mouseout",this.CmdbarMouseOut,false)}var d=a.GetPager2(b);if(d!=null){a.AttachEvent(d,"mouseover",this.CmdbarMouseOver,false);a.AttachEvent(d,"mouseout",this.CmdbarMouseOut,false)}};this.DetachEvents=function(b){a.DetachEvent(b,"mousedown",this.MouseDown,false);a.DetachEvent(b,"mouseup",this.__MouseUp,false);a.DetachEvent(b,"mousemove",this.MouseMove,false);a.DetachEvent(b,"dblclick",this.DblClick,false);a.DetachEvent(b,"focus",this.Focus,false);var f=a.GetViewport(b);if(f!=null){a.DetachEvent(a.GetViewport(b).parentNode,"DOMAttrModified",this.DoPropertyChange,true);a.DetachEvent(a.GetViewport(b).parentNode,"scroll",this.ScrollViewport);f.parentNode!=null&&f.parentNode.removeEventListener("DOMMouseScroll",this.MouseWheel,false)}var e=a.GetCommandBar(b);if(e!=null){a.DetachEvent(e,"mouseover",this.CmdbarMouseOver,false);a.DetachEvent(e,"mouseout",this.CmdbarMouseOut,false)}var c=a.GetPager1(b);if(c!=null){a.DetachEvent(c,"mouseover",this.CmdbarMouseOver,false);a.DetachEvent(c,"mouseout",this.CmdbarMouseOut,false)}var d=a.GetPager2(b);if(d!=null){a.DetachEvent(d,"mouseover",this.CmdbarMouseOver,false);a.DetachEvent(d,"mouseout",this.CmdbarMouseOut,false)}}}function Fpoint_FPSpread(){this.working=false;this.editing=false;this.editor=null;this.editingValue=null;this.editorSelectedIndex=-1;this.editingFormula=null;this.renderAsEditor=-1;this.validationMsg=null;this.editorMargin=null;this.sizeColumn=null;this.sizeRow=null;this.activeX=-1;this.activeY=-1;this.activeElement=null;this.clipboardData=null;this.editorList=[];this.error=false;this.activeChartObj=null;this.preventScrollView=false;this.InitFields=function(a){if(this.editorMargin==null)this.editorMargin=new this.Margin;a.hierBar=null;a.groupBar=null;a.pager1=null;a.pager2=null;a.anchorCell=null;a.leadingCell=null;a.leadingCellRow=null;a.leadingCellCol=null;a.selectStartRow=null;a.selectStartCol=null;a.selectType="";a.dataBuff=null;a.dirty=false;a.slideLeft=0;a.slideRight=0;a.setAttribute("rowCount",0);a.setAttribute("colCount",0);a.spanCells=[];a.rowSpanCells=[];a.colSpanCells=[];this.activePager=null;this.dragSlideBar=false;a.allowColMove=a.getAttribute("colMove")=="true";a.allowGroup=a.getAttribute("allowGroup")=="true";a.selectionBlockOptions=SelectionBlockOptions.Cells|SelectionBlockOptions.Rows|SelectionBlockOptions.Columns|SelectionBlockOptions.Sheet;a.selectedCols=[];a.msgList=[];a.mouseY=null;a.copymulticol=false;a.loadedScrollbarState=false};this.RegisterSpread=function(a){var d=this.GetTopSpread(a);if(d!=a)return;if(this.spreads==null)this.spreads=[];for(var c=this.spreads.length,b=0;b<c;b++)if(this.spreads[b]==a)return;this.spreads.length=c+1;this.spreads[c]=a};this.Init=function(a,u){a==null&&alert("spread is not defined!");var b=new Fpoint_FPSpread;b.getViewport0=function(){return the_fpSpread.GetViewport0(a)};b.getViewport1=function(){return the_fpSpread.GetViewport1(a)};b.getViewport2=function(){return the_fpSpread.GetViewport2(a)};b.getViewport=function(){return the_fpSpread.GetViewport(a)};b.GetRowCountInternal=function(){return the_fpSpread.GetRowCountInternal(a)};b.getRowKeyFromRow=function(b){return the_fpSpread.GetRowKeyFromRow(a,b)};b.getColKeyFromCol=function(b){return the_fpSpread.GetColKeyFromCol(a,b)};b.IsChildSpreadRow=function(b,c){return the_fpSpread.IsChildSpreadRow(a,b,c)};b.frzRowCount=function(){return a.frzRows};b.frzColCount=function(){return a.frzCols};b.getRowKeyFromCell=function(b){return the_fpSpread.GetRowKeyFromCell(a,b)};b.getColFromCell=function(b){return the_fpSpread.GetColFromCell(a,b)};b.getColGroup=function(a){return the_fpSpread.GetColGroup(a)};b.GetSelectedRanges=function(){return the_fpSpread.GetSelectedRanges(a)};b.getSelection=function(){return the_fpSpread.GetSelection(a)};b.getData=function(){return the_fpSpread.GetData(a)};b.updateSelectionViewIndexes=function(b){return the_fpSpread.updateSelectionViewIndexes(a,b)};b.getAttributeInternal=function(b){return a.getAttribute(b)};b.getRowFromCell=function(b){return the_fpSpread.GetRowFromCell(a,b)};b.getViewportFromCell=function(b){return the_fpSpread.GetViewportFromCell(a,b)};b.getCellFromRowCol=function(c,b){return the_fpSpread.GetCellFromRowCol(a,c,b)};b.getLeadingCellRow=function(){return a.leadingCellRow};b.getLeadingCellCol=function(){return a.leadingCellCol};a.fpSpreadJS=new FpSpreadJS(a,b,a.fpSpreadJS);a.getSpreadJS=function(){return a.fpSpreadJS};a.initialized=false;a.isactive=this.GetPageActiveSheetView()==a;a.ignoreVirtualPaging=true;this.validationMsg=null;this.editorList=[];this.RegisterSpread(a);this.InitFields(a);this.InitMethods(a);a.selectionBlockOptions=parseInt(a.getAttribute("selectionBlockOptions"));a.retainSelectionBlock=true;a.editModePermanent=false;a.ignoreEditModePermanent=false;a.ignorePaintSelection=false;a.scrollLeftInner=0;a.scrollTopInner=0;var q=a.getAttribute("RetainSelectionBlock");if(q!=null&&q=="false")a.retainSelectionBlock=false;var v=a.getAttribute("EditModePermanent");if(v)a.editModePermanent=true;a.bSuspendLayout=null;a.tableData=document.getElementById(a.id+"_XMLDATA");if(a.tableData==null){a.tableData=document.createElement("XML");a.tableData.id=a.id+"_XMLDATA";a.tableData.style.display="none";document.body.insertBefore(a.tableData,null)}var f=document.getElementById(a.id+"_data");if(f!=null&&f.getAttribute("data")!=null){a.tableData.innerHTML=f.getAttribute("data");f.value=""}this.SaveData(a);a.viewport=document.getElementById(a.id+"_viewport");if(a.viewport!=null)a.tableView=a.viewport.parentNode;a.frozColHeader=document.getElementById(a.id+"_frozColHeader");a.frozRowHeader=document.getElementById(a.id+"_frozRowHeader");a.viewport0=document.getElementById(a.id+"_viewport0");a.viewport1=document.getElementById(a.id+"_viewport1");a.viewport2=document.getElementById(a.id+"_viewport2");a.virtualPaging=a.getAttribute("virtualPaging");if(a.virtualPaging=="true"){var m=document.getElementById(a.id+"_VirtualPaging_Top");if(m==null)a.virtualPagingTop=a.virtualTop=0;else a.virtualPagingTop=a.virtualTop=parseInt(m.style.height)}else a.virtualPagingTop=a.virtualTop=0;a.startVirtualPaging=function(a){a.ignoreVirtualPaging=false};a.stopVirtualPaging=function(a){a.ignoreVirtualPaging=true};a.preventScrollView=a.preventScrollView||false;a.corner=document.getElementById(a.id+"_corner");if(a.corner!=null&&a.corner.childNodes.length>0)a.corner=a.corner.getElementsByTagName("TABLE")[0];a.frzRows=a.frzCols=0;if(a.viewport1!=null)a.frzRows=a.viewport1.rows.length;if(a.viewport0!=null){var h=this.GetColGroup(a.viewport0);if(h!=null)a.frzCols=h.childNodes.length}else if(a.viewport2!=null){var h=this.GetColGroup(a.viewport2);if(h!=null)a.frzCols=h.childNodes.length}a.rowHeader=document.getElementById(a.id+"_rowHeader");if(a.rowHeader!=null)a.rowHeader=a.rowHeader.getElementsByTagName("TABLE")[0];a.colHeader=document.getElementById(a.id+"_colHeader");if(a.colHeader!=null)a.colHeader=a.colHeader.getElementsByTagName("TABLE")[0];a.frozColFooter=document.getElementById(a.id+"_frozColFooter");a.colFooter=document.getElementById(a.id+"_colFooter");if(a.colFooter!=null)a.colFooter=a.colFooter.getElementsByTagName("TABLE")[0];a.footerCorner=document.getElementById(a.id+"_footerCorner");if(a.footerCorner!=null&&a.footerCorner.childNodes.length>0)a.footerCorner=a.footerCorner.getElementsByTagName("TABLE")[0];if(a.frozColFooter!=null)a.frozColFooter=a.frozColFooter.getElementsByTagName("TABLE")[0];var d=a.commandBar=document.getElementById(a.id+"_commandBar");if(a.frozRowHeader!=null)a.frozRowHeader=a.frozRowHeader.getElementsByTagName("TABLE")[0];if(a.frozColHeader!=null)a.frozColHeader=a.frozColHeader.getElementsByTagName("TABLE")[0];var i=this.GetViewport(a);if(i!=null){a.setAttribute("rowCount",i.rows.length);i.rows.length==1&&a.setAttribute("rowCount",0);a.setAttribute("colCount",i.getAttribute("cols"))}var g=a.spanCells,n=a.colSpanCells,o=a.rowSpanCells;this.InitSpan(a,this.GetViewport0(a),g);this.InitSpan(a,this.GetViewport1(a),g);this.InitSpan(a,this.GetViewport2(a),g);this.InitSpan(a,this.GetViewport(a),g);this.InitSpan(a,this.GetColHeader(a),n);this.InitSpan(a,this.GetFrozColHeader(a),n);this.InitSpan(a,this.GetRowHeader(a),o);this.InitSpan(a,this.GetFrozRowHeader(a),o);if(a.frzRows!=0||a.frzCols!=0){var k=0;if(this.GetViewport1(a)!=null)k+=this.GetViewport1(a).rows.length;if(this.GetViewport(a)!=null)k+=this.GetViewport(a).rows.length;a.setAttribute("rowCount",k)}a.getViewport=function(){return this.viewport};a.getViewport0=function(){return this.viewport0};a.getViewport1=function(){return this.viewport1};a.getViewport2=function(){return this.viewport2};a.getRowHeader=function(){return this.rowHeader};the_fpSpread.initChartObj(a);a.fpSpreadJS.countChildViews();this.InitLayout(a);a.dirty=true;if(this.GetPageActiveSpread()==a&&(a.getAttribute("AllowInsert")=="false"||a.getAttribute("IsNewRow")=="true")){var e=this.GetCmdBtn(a,"Insert");this.UpdateCmdBtnState(e,true);e=this.GetCmdBtn(a,"Add");this.UpdateCmdBtnState(e,true)}this.CreateTextbox(a);if(a.tabIndex==-1){var p=document.getElementById(a.id+"_view");if(p!=null)p.tabIndex=a.tabIndex}this.CreateFocusBorder(a);if(a.activeChartObj==null){this.InitSelection(a);var e=this.GetCmdBtn(a,"Update");e!=null&&this.UpdateCmdBtnState(e,true)}a.initialized=true;if(this.GetPageActiveSpread()==a&&u!="LoadOnDemand"){var j=this.GetTopSpread(a),r=j.retainSelectionBlock;j.retainSelectionBlock=true;try{this.Focus(a)}catch(w){}finally{j.retainSelectionBlock=r}}if(this.GetPageActiveSpread()==a&&this.GetEnableRowEditTemplate(a)!="true")if(a.anchorCell!=null){var c=this.GetEditor(a.anchorCell);if(c!=null){this.editing=true;this.editor=c;this.renderAsEditor=1;this.editingValue=this.GetEditorValue(c,a);(c.focus||c.getAttribute("fpeditor")=="MultiColumnComboBoxCellType")&&this.SetEditorFocus(c)}}this.SaveData(a);if(this.handlers==null)this.handlers=new FpSpread_EventHandlers;this.handlers.DetachEvents(a);this.handlers.AttachEvents(a);if(d!=null&&a.style.position==""){d.parentNode.style.backgroundColor=d.style.backgroundColor;d.parentNode.style.borderTop=d.style.borderTop}this.CreateSizebar(a);this.SyncColSelection(a);a.getAttribute("ajax")=="false"&&this.fireOperationEndEvent(a);a.style.overflow="hidden";if(this.GetParentSpread(a)==null){this.LoadScrollbarState(a);var s=this.GetData(a),t=s.getElementsByTagName("root")[0],l=t.getElementsByTagName("activespread")[0];l!=null&&l.innerHTML!=""&&this.SetPageActiveSpread(document.getElementById(this.Trim(l.innerHTML)))}a.ignoreVirtualPaging=false;this.doIgnoreVirtualPaging(a)};this.Dispose=function(a){if(this.handlers==null)this.handlers=new FpSpread_EventHandlers;this.handlers.DetachEvents(a);this.chartDispose(a)};this.fireOperationEndEvent=function(a){this.FireAutoFilterColumnCompleted(a)};this.FireAutoFilterColumnCompleted=function(a,c){if(a.getAttribute("isFiltering")=="true"&&(c==null||c==a.getAttribute("FilteringString")))if(a.getAttribute("isFilteringCancel")!="true"){var b=this.CreateEvent("AutoFilteredColumn");b.col=a.getAttribute("FilteringCol");b.spread=a;b.filterString=a.getAttribute("FilteringString");this.FireEvent(a,b)}};this.CmdbarMouseOver=function(b){var a=this.GetTarget(b);if(a!=null&&a.tagName=="IMG"&&a.getAttribute("disabled")!="true"&&a.getAttribute("disabled")!="disabled"&&a.className!="aspNetDisabled"){a.style.backgroundColor="cyan";this.SetImageButtonSrc(a,"hover")}};this.CmdbarMouseOut=function(b){var a=this.GetTarget(b);if(a!=null&&a.tagName=="IMG"&&a.getAttribute("disabled")!="true"&&a.getAttribute("disabled")!="disabled"&&a.className!="aspNetDisabled"){a.style.backgroundColor="";this.SetImageButtonSrc(a,"enable")}};this.DoPropertyChange=function(a){if(a.attrName=="curpos")this.ScrollViewport(a);else if(this.sizeColumn==null&&this.sizeRow==null&&a.attrName=="pageincrement"&&a.ctrlKey){var b=this.GetSpread(this.GetTarget(a));b!=null&&this.SizeAll(this.GetTopSpread(b))}};this.IsXHTML=function(b){var c=this.GetTopSpread(b),a=c.getAttribute("strictMode");return a!=null&&a=="true"};this.GetData=function(a){return a.tableData};this.GetDataElement=function(d,a){var b=this.GetData(d),c=b.getElementsByTagName("root")[0];return c.getElementsByTagName(a)[0]};this.GetActiveChildSpread=function(a){return this.GetDataElement(a,"activechild")};this.AttachEvent=function(a,c,b,d){if(a.addEventListener!=null)a.addEventListener(c,b,d);else a.attachEvent!=null&&a.attachEvent("on"+c,b)};this.DetachEvent=function(a,c,b,d){if(a.removeEventListener!=null)a.removeEventListener(c,b,d);else a.detachEvent!=null&&a.detachEvent("on"+c,b)};this.CancelDefault=function(a){if(a.preventDefault!=null){a.preventDefault();a.stopPropagation()}else{a.cancelBubble=false;a.returnValue=false}return false};this.CreateEvent=function(b){var a=document.createEvent("Events");a.initEvent(b,true,true);return a};this.Refresh=function(a){var b=a.style.display;a.style.display="none";a.style.display=b};this.InitMethods=function(ss){var gso=this;ss.Edit=function(){gso.Edit(this)};ss.Update=function(){gso.Update(this)};ss.Cancel=function(){gso.Cancel(this)};ss.Clear=function(){gso.Clear(this)};ss.Copy=function(){gso.Copy(this)};ss.Paste=function(){gso.Paste(this)};ss.Prev=function(){gso.Prev(this)};ss.Next=function(){gso.Next(this)};ss.Add=function(){gso.Add(this)};ss.Insert=function(){gso.Insert(this)};ss.Delete=function(){gso.Delete(this)};ss.Print=function(){gso.Print(this)};ss.PrintPDF=function(){gso.PrintPDF(this)};ss.StartEdit=function(a){gso.StartEdit(this,a)};ss.EndEdit=function(){gso.EndEdit(this)};ss.IsValid=function(){return ss.valid!=null?ss.valid:true};ss.ClearSelection=function(){gso.ClearSelection(this)};ss.GetSelectedRange=function(){return gso.GetSelectedRange(this)};ss.SetSelectedRange=function(e,d,c,b,a){gso.SetSelectedRange(this,e,d,c,b,a)};ss.GetSelectedRanges=function(){return gso.GetSelectedRanges(this)};ss.AddSelection=function(e,d,c,b,a){gso.AddSelection(this,e,d,c,b,a)};ss.AddSpan=function(e,d,c,b,a){gso.AddSpan(this,e,d,c,b,a)};ss.RemoveSpan=function(c,b,a){gso.RemoveSpan(this,c,b,a)};ss.GetCurrentPageIndex=function(){return gso.GetCurrentPageIndex(this)};ss.GetActiveRow=function(){var a=gso.GetRowFromCell(this,this.anchorCell);return a<0?a:gso.GetSheetIndex(this,a)};ss.GetActiveCol=function(){return gso.GetColFromCell(this,this.anchorCell)};ss.SetActiveCell=function(b,a){gso.SetActiveCell(this,b,a)};ss.GetCellByRowCol=function(b,a){return gso.GetCellByRowCol(this,b,a)};ss.GetValue=function(b,a){return gso.GetValue(this,b,a)};ss.SetValue=function(d,c,e,a,b){gso.SetValue(this,d,c,e,a,b)};ss.GetFormula=function(b,a){return gso.GetFormula(this,b,a)};ss.SetFormula=function(e,c,d,b,a){gso.SetFormula(this,e,c,d,b,a)};ss.GetHiddenValue=function(b,a){return gso.GetHiddenValue(this,b,a)};ss.GetSheetRowIndex=function(a){return gso.GetSheetRowIndex(this,a)};ss.GetSheetColIndex=function(b,a){return gso.GetSheetColIndex(this,b,a)};ss.GetRowCount=function(){return gso.GetRowCount(this)};ss.GetColCount=function(){return gso.GetColCount(this)};ss.GetRowByKey=function(a){return gso.GetRowByKey(this,a,-1)};ss.GetColByKey=function(a){return gso.GetColByKey(this,a,-1)};ss.GetRowKeyFromRow=function(b){var a=gso.GetRowKeyFromRow(this,b);return a==null?-1:a};ss.GetColKeyFromCol=function(b){var a=gso.GetColKeyFromCol(this,b);return a==null?-1:a};ss.GetTotalRowCount=function(){return gso.GetTotalRowCount(this)};ss.GetPageCount=function(){return gso.GetPageCount(this)};ss.GetParentSpread=function(){return gso.GetParentSpread(this)};ss.GetChildSpread=function(b,a){return gso.GetChildSpread(this,b,a)};ss.GetChildSpreads=function(){return gso.GetChildSpreads(this)};ss.GetChildSpreadOffsetWidth=function(){return gso.GetChildSpreadOffsetWidth(this)};ss.GetParentRowIndex=function(){return gso.GetParentRowIndex(this)};ss.GetActiveChildSheetView=function(){return gso.GetActiveChildSheetView(this)};ss.GetSpread=function(a){return gso.GetSpread(a)};ss.UpdatePostbackData=function(){gso.UpdatePostbackData(this)};ss.SizeToFit=function(a){gso.SizeToFit(this,a)};ss.SetColWidth=function(a,b){gso.SetColWidth(this,a,b)};ss.GetPreferredRowHeight=function(a){return gso.GetPreferredRowHeight(this,a)};ss.SetRowHeight2=function(b,a){gso.SetRowHeight2(this,b,a)};ss.CallBack=function(b,a){gso.SyncData(this.getAttribute("name"),b,this,a)};ss.LoadData=function(a){gso.LoadData(this,a)};ss.AddKeyMap=function(a,d,c,e,b){gso.AddKeyMap(this,a,d,c,e,b)};ss.RemoveKeyMap=function(a,c,b,d){gso.RemoveKeyMap(this,a,c,b,d)};ss.MoveToPrevCell=function(a){gso.MoveToPrevCell(this,a)};ss.MoveToNextCell=function(a){gso.MoveToNextCell(this,a)};ss.MoveToNextRow=function(a){gso.MoveToNextRow(this,a)};ss.MoveToPrevRow=function(a){gso.MoveToPrevRow(this,a)};ss.MoveToFirstColumn=function(){gso.MoveToFirstColumn(this)};ss.MoveToLastColumn=function(){gso.MoveToLastColumn(this)};ss.ScrollTo=function(b,a){gso.ScrollTo(this,b,a)};ss.focus=function(){gso.Focus(this)};ss.SizeAll=function(){gso.SizeAll(this)};ss.GetTopRowIndex=function(){return gso.GetTopRowIndex(this)};ss.GetLeftColIndex=function(){return gso.GetLeftColIndex(this)};ss.ShowMessage=function(b,d,c,a){return gso.ShowMessage(this,b,d,c,a)};ss.HideMessage=function(b,a){return gso.HideMessage(this,b,a)};ss.SetActiveChart=function(a){gso.SetActiveChart(this,a)};ss.GetActiveChart=function(){return gso.GetActiveChart(this)};ss.ProcessKeyMap=function(event){if(this.keyMap!=null)for(var n=this.keyMap.length,i=0;i<n;i++){var ka=this.keyMap[i];if(event.keyCode==ka.key&&event.ctrlKey==ka.ctrl&&event.shiftKey==ka.shift&&event.altKey==ka.alt){var ret=false;if(typeof ka.action=="function")ret=ka.action();else ret=eval(ka.action);return ret}}return true};ss.Cells=function(b,a){return gso.Cells(this,b,a)};ss.Rows=function(b,a){return gso.Rows(this,b,a)};ss.Columns=function(b,a){return gso.Columns(this,b,a)};ss.GetTitleInfo=function(b,a){return gso.GetTitleInfo(this,b,a)};ss.SizeSpread=function(a){return gso.SizeSpread(a)};ss.SortColumn=function(a){return gso.SortColumn(this,a)};ss.ExpandRow=function(a){return gso.ExpandRow(this,a)};ss.SuspendLayout=function(){gso.SuspendLayout(this)};ss.ResumeLayout=function(a){gso.ResumeLayout(this,a)};ss.rowEditTemplateContainer_keyDown=function(a){return gso.rowEditTemplateContainer_keyDown(a)};ss.rowEditTemplateContainer_textBoxFocus=function(a){return gso.rowEditTemplateContainer_textBoxFocus(a)};ss.isEditing=function(){return gso.editing}};this.FindContentTag=function(a){if(a){if(a.attributes!=null&&a.getAttribute("content"))return a;for(var b=0;b<a.childNodes.length;b++){var c=this.FindContentTag(a.childNodes[b]);if(c)return c}}return null};this.CreateTextbox=function(b){var c=this,d=this.GetTopSpread(b),a=document.getElementById(d.id+"_textBox");if(a==null){a=document.createElement("INPUT");a.type="text";a.setAttribute("autocomplete","off");a.style.position="absolute";a.style.borderWidth=0;a.style.top=""+(b.clientHeight-20)+"px";a.style.left="-100px";if(b.style.position!="absolute"&&b.style.position!="relative"){var e=this.GetOffsetTop(b,b,document)+b.clientHeight;a.style.top=e+"px"}a.style.width="0px";a.style.height="1px";a.style.textIndent="-5px";a.style.backgroundColor="transparent";if(b.tabIndex!=null)a.tabIndex=b.tabIndex;a.id=b.id+"_textBox";a.onfocus=function(){return c.Focus(b)};b.insertBefore(a,b.firstChild)}else if(b.tabIndex!=null)b.tabIndex=-1};this.ProcessEditMode=function(b,e,d,f){if(!e){this.Focus(b);b.editModePermanent&&b.ignoreEditModePermanent==false&&this.StartEdit(b,b.anchorCell,f)}else{var a=this.GetEditor(b.anchorCell);if(a!=null){a.type=="submit"&&this.SaveData(b);this.editing=a.type!="button"&&a.type!="submit";this.editor=a;this.renderAsEditor=1;this.editingValue=this.GetEditorValue(a,b);if(d&&(a.focus||a.getAttribute("fpeditor")=="MultiColumnComboBoxCellType")){var c=b.fpSpreadJS.getExtender(this.editor);(c==null||c.indexOf("ComboBox")==-1)&&this.SetEditorFocus(a)}}}};this.DoGetFocus=function(a,d){var e=this.GetTopSpread(a),c=this.GetActiveChildSpread(e);if(c!=null&&c.innerHTML!=""){var b=document.getElementById(c.innerHTML);if(b!=null&&b!=a){this.Focus(b);return}}a.isactive=true;this.ProcessEditMode(a,false,null,d)};this.HideFocusBorder=function(c){var a=document.getElementById(c.id+"_focusRectT");if(a==null)return;a.style.left="-1000px";a.style.width="0px";var b=c.id;a=document.getElementById(b+"_focusRectB");a.style.left="-1000px";a.style.width="0px";a=document.getElementById(b+"_focusRectL");a.style.left="-1000px";a.style.width="0px";a=document.getElementById(b+"_focusRectR");a.style.left="-1000px";a.style.width="0px"};this.CreateSizebar=function(a){a.sizeBar=document.getElementById(a.id+"_sizeBar");if(a.sizeBar==null&&(a.frzRows>0||a.frzCols>0)){a.sizeBar=document.createElement("img");a.sizeBar.style.position="absolute";a.sizeBar.style.borderWidth=1;a.sizeBar.style.top="0px";a.sizeBar.style.left="-400px";a.sizeBar.style.width="2px";a.sizeBar.style.height="400px";a.sizeBar.style.background="black";a.sizeBar.id=a.id+"_sizeBar";a.appendChild(a.sizeBar)}};this.CreateLineBorder=function(b,c){var a=document.getElementById(c);if(a==null){a=document.createElement("div");a.style.position="absolute";a.style.left="-1000px";a.style.top="0px";a.style.overflow="hidden";a.style.border="1px solid black";if(b.getAttribute("FocusBorderColor")!=null)a.style.borderColor=b.getAttribute("FocusBorderColor");if(b.getAttribute("FocusBorderStyle")!=null)a.style.borderStyle=b.getAttribute("FocusBorderStyle");a.id=c;var d=this.GetViewport(b).parentNode;d.insertBefore(a,null)}return a};this.CreateFocusBorder=function(a){if(a.frzRows>0||a.frzCols>0)return;if(this.GetTopSpread(a).getAttribute("hierView")=="true")return;if(this.GetTopSpread(a).getAttribute("showFocusRect")=="false")return;if(this.GetViewport(a)==null)return;var b=this.CreateLineBorder(a,a.id+"_focusRectT");b.style.height=0;b=this.CreateLineBorder(a,a.id+"_focusRectB");b.style.height=0;b=this.CreateLineBorder(a,a.id+"_focusRectL");b.style.width=0;b=this.CreateLineBorder(a,a.id+"_focusRectR");b.style.width=0};this.GetPosIndicator=function(b){var a=b.posIndicator;if(a==null)a=this.CreatePosIndicator(b);else a.parentNode!=b&&b.insertBefore(a,null);return a};this.CreatePosIndicator=function(b){var a=document.createElement("img");a.style.position="absolute";a.style.top="0px";a.style.left="-400px";a.style.width="10px";a.style.height="10px";a.style.zIndex=1e3;a.id=b.id+"_posIndicator";if(b.getAttribute("clienturl")!=null)a.src=b.getAttribute("clienturl")+"down.gif";else a.src=b.getAttribute("clienturlres");b.insertBefore(a,null);b.posIndicator=a;return a};this.InitSpan=function(b,c,j){if(c!=null){var e=0;if(c==this.GetViewport(b))e=c.rows.length;for(var h=c.rows,k=this.GetColCount(b),d=0;d<h.length;d++)if(this.IsChildSpreadRow(b,c,d)){if(c==this.GetViewport(b))e--}else for(var g=h[d].cells,f=0;f<g.length;f++){var a=g[f];if(a!=null&&(a.rowSpan!=null&&a.rowSpan>1||a.colSpan!=null&&a.colSpan>1)){var l=this.GetRowFromCell(b,a),i=parseInt(a.getAttribute("scol"));i<k&&this.AddSpan(b,l,i,a.rowSpan,a.colSpan,j)}}c==this.GetViewport(b)&&b.setAttribute("rowCount",e)}};this.GetColWithSpan=function(g,e,a,d){var f=0,c=0;if(d==0)while(this.IsCovered(g,e,c,a))c++;for(var b=0;b<a.length;b++)if(a[b].rowCount>1&&(a[b].col<=d||d==0&&a[b].col<c)&&e>=a[b].row&&e<a[b].row+a[b].rowCount)f+=a[b].colCount;return f};this.AddSpan=function(c,g,f,e,d,a){if(a==null)a=c.spanCells;var b=new this.Range;this.SetRange(b,"Cell",g,f,e,d);a.push(b);this.PaintFocusRect(c)};this.RemoveSpan=function(e,h,g,a){if(a==null)a=e.spanCells;for(var b=0;b<a.length;b++){var d=a[b];if(d.row==h&&d.col==g){for(var f=a.length-1,c=b;c<f;c++)a[c]=a[c+1];a.length=a.length-1;break}}this.PaintFocusRect(e)};this.selectAllText=function(b){if(b.anchorCell==null)return;var a=this.GetEditor(b.anchorCell);if(a!=null&&a.select){var c=a.getValue?a.getValue():a.value;if(a.setValue){a.setValue("");a.setValue(c)}else{a.value="";a.value=c}a.select()}};this.isEditModeReplace=function(c,b){var a=this.GetCellType(b);return a=="ExtenderCellType"?false:c.getAttribute("EditMode")=="replace"};this.Focus=function(a,d,m){var l=this.GetTopSpread(a),f=this.GetActiveChildSpread(l);if(f!=null&&f.innerHTML!=""){var c=document.getElementById(f.innerHTML);if(c!=null&&c!=a){this.Focus(c,d);return}}this.ClearSelection(a,null,a);var g=a!=null&&this.isEditModeReplace(a,a.anchorCell);if(this.editing&&g){this.selectAllText(a);g=false;d&&this.CancelDefault(d)}if(this.editing)return;if(a.activeChartObj!=null){a.ClearSelection();a.activeChartObj.container.focus();return}var c=this.GetPageActiveSpread();if(c==null||this.GetTopSpread(c)!=this.GetTopSpread(a)){if(c!=null)c.isactive=false;this.SetPageActiveSpread(a)}var e=this.GetActiveChildSpread(a).innerHTML;if(e!=""&&a.id!=e){a=document.getElementById(e);var o=this.GetTopSpread(a);this.SetActiveSpreadID(o,a.id,"",true);this.SetPageActiveSpread(a)}var k=this.GetOperationMode(a);if(a.anchorCell==null&&k!="MultiSelect"&&k!="ExtendedSelect"&&a.GetRowCount()>0&&a.GetColCount()>0){this.tryToSetAnchorCell(a);var h=this.GetCmdBtn(a,"Update");h!=null&&h.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(h,false)}var l=this.GetTopSpread(a),b=document.getElementById(l.id+"_textBox"),q=b.style.top,p=b.style.left;if(this.IsStaticPos(a)){b.style.top=""+(Math.max(document.documentElement.scrollTop,document.body.scrollTop)+10)+"px";b.style.left=""+(Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)+10)+"px"}else{b.style.top=""+(Math.max(document.documentElement.scrollTop,document.body.scrollTop)-this.GetOffsetTop(a,a,document.body)+10)+"px";b.style.left=""+(Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)-this.GetOffsetLeft(a,a,document.body)+10)+"px"}if(a.anchorCell!=null){var n=this.GetCellType(a.anchorCell)=="ExtenderCellType",j=this.GetEditor(a.anchorCell);if(n||j==null){if(b!=null)if(document.activeElement!=b)try{b.focus();b.value=""}catch(r){}}else!a.isOverScrollbar&&this.SetEditorFocus(j)}else if(b!=null)try{b.focus();b.value=""}catch(r){}var i=false;if(!a.ignorePaintSelection){a.ignorePaintSelection=true;i=true}if(d!=null){a.ignoreEditModePermanent=true;this.DoGetFocus(a);a.ignoreEditModePermanent=false}if((a.retainSelectionBlock||this.GetPageActiveSpread()===a)&&this.GetPageActiveSpread()!=null){this.PaintAnchorCell(a);this.PaintSelections(a,true,m)}if(i)a.ignorePaintSelection=false;g&&this.selectAllText(a);if($$.browser.version<4){b.style.top=q;b.style.left=p}this.EnableButtons(a)};this.GetTotalRowCount=function(b){var a=parseInt(b.getAttribute("totalRowCount"));if(isNaN(a))a=0;return a};this.GetPageCount=function(b){var a=parseInt(b.getAttribute("pageCount"));if(isNaN(a))a=0;return a};this.GetColCount=function(b){var a=parseInt(b.getAttribute("colCount"));if(isNaN(a))a=0;return b.frzCols+a};this.GetRowCount=function(b){var a=parseInt(b.getAttribute("rowCount"));if(isNaN(a))a=0;return a};this.GetRowCountInternal=function(b){var a=parseInt(this.GetViewport(b).rows.length);if(isNaN(a))a=0;return b.frzRows+a};this.IsChildSpreadRow=function(c,a,b){return FpSpreadJS.isChildSpreadRow(a,b)};this.GetChildSpread=function(e,f,d){var b=this.GetViewport(e);if(b!=null){var a=this.GetDisplayIndex(e,f)+1;if(typeof d=="number")a+=d;if(a>=1&&a<b.rows.length)if(b.rows[a].cells.length>0&&b.rows[a].cells[0]!=null&&b.rows[a].cells[0].firstChild!=null){var c=b.rows[a].cells[0].firstChild;if(c.nodeName!="#text"&&c.getAttribute("FpSpread")=="Spread")return c}}return null};this.GetChildSpreads=function(c,a){var b=a==null?c:document.getElementById(a);return b==null?null:FpSpreadJS.getChildViews(b)};this.GetDisplayIndex=function(b,a){return b.fpSpreadJS.getDisplayIndex(a)};this.GetSheetIndex=function(c,b,a){return a!=null&&a!=this.GetViewport(c)?this.GetSpread(a,true).fpSpreadJS.getSheetIndex(b):c.fpSpreadJS.getSheetIndex(b)};this.GetParentRowIndex=function(d){var a=this.GetParentSpread(d);if(a==null)return-1;var c=this.GetViewport(a);if(c==null)return-1;for(var e=d.parentNode.parentNode,b=e.rowIndex-1;b>0;b--)if(this.IsChildSpreadRow(a,c,b))continue;else break;return this.GetSheetIndex(a,b,c)};this.CreateTestBox=function(b){var a=document.getElementById(b.id+"_testBox");if(a==null){a=document.createElement("span");a.style.position="absolute";a.style.borderWidth=0;a.style.top="-500px";a.style.left="-100px";a.id=b.id+"_testBox";b.insertBefore(a,b.firstChild)}return a};this.SizeToFit=function(a,b){if(b==null||b<0)b=0;var e=this.GetViewport(a);if(e!=null){for(var h=this.CreateTestBox(a),i=e.rows,d=0,c=0;c<i.length;c++)if(!this.IsChildSpreadRow(a,e,c)){var f=this.GetCellFromRowCol(a,c,b);if(f.colSpan>1)continue;var g=this.GetPreferredCellWidth(a,f,h);if(g>d)d=g}this.SetColWidth(a,b,d)}};this.GetPreferredCellWidth=function(d,a,b){if(b==null)b=this.CreateTestBox(d);var c=this.GetRender(d,a),h=this.GetCellType(a),g=this.GetEditor(a);if(c!=null){b.style.fontFamily=c.style.fontFamily;b.style.fontSize=c.style.fontSize;b.style.fontWeight=c.style.fontWeight;b.style.fontStyle=c.style.fontStyle}if(c!=null&&h=="MultiColumnComboBoxCellType"){var f=a.getElementsByTagName("Table")[0];if(f!=null)b.innerHTML=this.GetEditorValue(g,d)+"1"}else b.innerHTML=a.innerHTML;var e=b.offsetWidth+8;if(a.style.paddingLeft!=null&&a.style.paddingLeft.length>0)e+=parseInt(a.style.paddingLeft);if(a.style.paddingRight!=null&&a.style.paddingRight.length>0)e+=parseInt(a.style.paddingRight);return e};this.GetHierBar=function(a){if(a.hierBar==null)a.hierBar=document.getElementById(a.id+"_hierBar");return a.hierBar};this.GetGroupBar=function(a){if(a.groupBar==null)a.groupBar=document.getElementById(a.id+"_groupBar");return a.groupBar};this.GetPager1=function(a){if(a.pager1==null)a.pager1=document.getElementById(a.id+"_pager1");return a.pager1};this.GetPager2=function(a){if(a.pager2==null)a.pager2=document.getElementById(a.id+"_pager2");return a.pager2};this.SynRowHeight=function(g,c,b,a,m,n){if(c==null||b==null)return;var o=c.rows[a],p=b.rows[a],d=c.rows[a].offsetHeight,f=b.rows[a].offsetHeight;if(b.rows[a].cells.length>0){var k=parseFloat(document.defaultView.getComputedStyle(b.rows[a].cells[0],"").getPropertyValue("height"));if(Math.round(k)!=k)f=b.rows[a].offsetHeight+1}if($$.browser.version>=4){var e=Math.max(d,f);o.style.height=""+e+"px";p.style.height=""+e+"px"}else{if(d==f&&a>0)return;var i=this.IsXHTML(g);if(a==0)if(!i){d+=c.rows[a].offsetTop;f+=b.rows[a].offsetTop}else d-=b.rows[a].offsetTop-c.rows[a].offsetTop;if(i)b.rows[a].style.height="";else{for(var j=false,h=0;h<b.rows[a].cells.length;h++)if(b.rows[a].cells[h]!=null&&b.rows[a].cells[h].firstChild!=null&&b.rows[a].cells[h].firstChild.tagName=="INPUT"){j=true;break}if(j)b.rows[a].style.height=""}var e=Math.max(d,f);if(c.rows[a].style.height=="")c.rows[a].style.height=""+d+"px";if(b.rows[a].style.height=="")b.rows[a].style.height=""+f+"px";if(this.IsChildSpreadRow(g,b,a)){c.rows[a].style.height=e;return}if(e>0)if(i)if(e==d)b.rows[a].style.height=""+(parseInt(b.rows[a].style.height)+(e-f))+"px";else c.rows[a].style.height=""+(parseInt(c.rows[a].style.height)+(e-d))+"px";else if(n&&b.rows.length>=2&&b.cellSpacing=="0")if(a==0)if(e==d)b.rows[a].style.height=""+(parseInt(b.rows[a].style.height)+(e-f))+"px";else c.rows[a].style.height=""+(parseInt(c.rows[a].style.height)+(e-d))+"px";else if(g.frzRows>0&&a==g.frzRows-1&&c==this.GetFrozRowHeader(g)){d+=this.GetRowHeader(g).rows[0].offsetTop;f+=this.GetViewport(g).rows[0].offsetTop;c.rows[a].style.height=""+(parseInt(c.rows[a].style.height)+(Math.max(d,f)-d))+"px"}else{c.rows[a].style.height=""+e+"px";b.rows[a].style.height=""+e+"px"}else if(e==d)b.rows[a].style.height=""+(parseInt(b.rows[a].style.height)+(e-f))+"px";else c.rows[a].style.height=""+(parseInt(c.rows[a].style.height)+(e-d))+"px"}if(m){var l=this.GetParentSpread(g);l!=null&&this.UpdateRowHeight(l,g)}};this.SizeAll=function(a){var b=this.GetChildSpreads(a);if(b!=null&&b.length>0)for(var c=0;c<b.length;c++)this.SizeAll(b[c]);this.SizeSpread(a);this.SizeSpread(a);this.GetParentSpread(a)!=null&&this.Refresh(a)};this.EnsureAllRowHeights=function(a){if(this.GetFrozColHeader(a)!=null&&this.GetColHeader(a)!=null)for(var b=0;b<this.GetFrozColHeader(a).rows.length;b++)this.SynRowHeight(a,this.GetFrozColHeader(a),this.GetColHeader(a),b,false,false);if(this.GetFrozColFooter(a)!=null&&this.GetColFooter(a)!=null)for(var b=0;b<this.GetFrozColFooter(a).rows.length;b++)this.SynRowHeight(a,this.GetFrozColFooter(a),this.GetColFooter(a),b,false,false);if(this.GetViewport0(a)!=null&&this.GetViewport1(a)!=null)for(var b=0;b<this.GetViewport1(a).rows.length;b++){this.SynRowHeight(a,this.GetViewport0(a),this.GetViewport1(a),b,false,false);this.SynRowHeight(a,this.GetViewport0(a),this.GetViewport1(a),b,false,false)}if(this.GetViewport(a)!=null&&this.GetViewport2(a)!=null)for(var b=0;b<this.GetViewport(a).rows.length;b++){this.SynRowHeight(a,this.GetViewport2(a),this.GetViewport(a),b,false,false);this.SynRowHeight(a,this.GetViewport2(a),this.GetViewport(a),b,false,false)}if(this.GetFrozRowHeader(a)!=null)for(var b=0;b<this.GetViewport1(a).rows.length;b++){this.SynRowHeight(a,this.GetFrozRowHeader(a),this.GetViewport1(a),b,false,true);this.SynRowHeight(a,this.GetFrozRowHeader(a),this.GetViewport0(a),b,false,true)}if(this.GetRowHeader(a)!=null)for(var b=0;b<this.GetViewport(a).rows.length;b++){this.SynRowHeight(a,this.GetRowHeader(a),this.GetViewport(a),b,false,true);this.SynRowHeight(a,this.GetRowHeader(a),this.GetViewport2(a),b,false,true)}if(this.GetFrozColHeader(a)!=null&&this.GetColHeader(a)!=null)for(var b=0;b<this.GetFrozColHeader(a).rows.length;b++)this.SynRowHeight(a,this.GetFrozColHeader(a),this.GetColHeader(a),b,false,false);if(this.GetViewport0(a)!=null&&this.GetViewport1(a)!=null)for(var b=0;b<this.GetViewport1(a).rows.length;b++){this.SynRowHeight(a,this.GetViewport0(a),this.GetViewport1(a),b,false,false);this.SynRowHeight(a,this.GetViewport0(a),this.GetViewport1(a),b,false,false)}if(this.GetViewport(a)!=null&&this.GetViewport2(a)!=null)for(var b=0;b<this.GetViewport(a).rows.length;b++){this.SynRowHeight(a,this.GetViewport2(a),this.GetViewport(a),b,false,false);this.SynRowHeight(a,this.GetViewport2(a),this.GetViewport(a),b,false,false)}if(this.GetFrozRowHeader(a)!=null)for(var b=0;b<this.GetViewport1(a).rows.length;b++){this.SynRowHeight(a,this.GetFrozRowHeader(a),this.GetViewport1(a),b,false,true);this.SynRowHeight(a,this.GetFrozRowHeader(a),this.GetViewport0(a),b,false,true)}if(this.GetRowHeader(a)!=null)for(var b=0;b<this.GetViewport(a).rows.length;b++){this.SynRowHeight(a,this.GetRowHeader(a),this.GetViewport(a),b,false,true);this.SynRowHeight(a,this.GetRowHeader(a),this.GetViewport2(a),b,false,true)}if(this.GetCorner(a)!=null)if(this.GetCorner(a).getAttribute("allowTableCorner")!=null){if(this.GetCorner(a)!=null&&this.GetColHeader(a)!=null)for(var b=0;b<this.GetCorner(a).rows.length;b++)this.SynRowHeight(a,this.GetCorner(a),this.GetColHeader(a),b,false,false);if(this.GetFrozColHeader(a)!=null&&this.GetCorner(a)!=null)for(var b=0;b<this.GetCorner(a).rows.length;b++)this.SynRowHeight(a,this.GetCorner(a),this.GetFrozColHeader(a),b,false,false);if(this.GetCorner(a)!=null&&this.GetColHeader(a)!=null)for(var b=0;b<this.GetCorner(a).rows.length;b++)this.SynRowHeight(a,this.GetCorner(a),this.GetColHeader(a),b,false,false);if(this.GetFrozColHeader(a)!=null&&this.GetCorner(a)!=null)for(var b=0;b<this.GetCorner(a).rows.length;b++)this.SynRowHeight(a,this.GetCorner(a),this.GetFrozColHeader(a),b,false,false)}};this.SuspendLayout=function(a){a.bSuspendLayout=true};this.ResumeLayout=function(a,b){a.bSuspendLayout=false;b&&this.SizeSpread(a)};this.GetChildSpreadOffsetWidth=function(j,a){if(typeof a=="undefined"||a==null)return 0;var f=0,g=0,b=document.getElementById(a.id+"_corner");if(b!=null)f=parseInt(b.offsetWidth);else{b=document.getElementById(a.id+"_rowHeader");if(b!=null)f=parseInt(b.offsetWidth)}var c=document.getElementById(a.id+"_colHeader");if(c!=null)g=parseInt(c.offsetWidth);else{c=document.getElementById(a.id+"_viewport");if(c!=null)g=parseInt(c.offsetWidth)}var d=0,e=this.GetChildSpreads(j,a.id);if(e!=null&&e.length>0)for(var i=0,h=0,i=0;i<e.length;i++){h=this.GetChildSpreadOffsetWidth(j,e[i]);if(h>d)d=h}return g>d?f+g:f+d};this.syncRowHeaderWidth=function(a){if(a.getAttribute("mcctCellType")==null&&this.GetRowHeader(a)!=null){var l=this.GetRowHeader(a).parentNode.getAttribute("rhVisible")!="false";if(l){var n=a.firstChild,j=this.GetColGroup(n),f=[this.GetCorner(a),this.GetFrozRowHeader(a),this.GetRowHeader(a),this.GetFooterCorner(a)];$$.utils.cleanArray(f);for(var h=0,i=Number.MAX_VALUE,b=0;b<f.length;b++){h=Math.max(h,f[b].offsetWidth);i=Math.min(i,parseInt(f[b].cellSpacing))}if(j!=null&&j.childNodes.length>0)j.childNodes[0].width=h-i+"px";for(var b=0,o=f.length;b<o;b++)f[b].parentNode.style.width=h+"px";var e=this.GetCorner(a);if(e!=null&&e.getAttribute("allowTableCorner")==null){var c=this.GetColGroup(e);if(c==null){c=document.createElement("COLGROUP");var m=document.createElement("COL");c.appendChild(m);var g=e.getElementsByTagName("TBODY");if(g!=null){g=g[0];e.insertBefore(c,g)}else e.insertBefore(c)}if(c!=null){var d=null;if(this.GetRowHeader(a)!=null)d=this.GetColGroup(this.GetRowHeader(a));if(d==null&&this.GetFrozRowHeader(a)!=null)d=this.GetColGroup(this.GetFrozRowHeader(a));if(d!=null){for(var k=0,b=0;b<d.childNodes.length;b++)k+=parseInt(d.childNodes[b].width);c.childNodes[0].width=k}}}}}};this.SizeSpread=function(a,T){if(a.getAttribute("ignoreSizeSpread")=="true")return;if(a.bSuspendLayout)return;this.BackUpStyleSetting(a);if(a.clientHeight==0||a.clientWidth==0)return;var A=this.IsXHTML(a),b=this.GetViewport(a);if(b==null)return;T==null&&this.EnsureAllRowHeights(a);var g=this.GetColHeader(a),p=this.GetColGroup(b),H=this.GetColGroup(g);if(p!=null&&p.childNodes.length>0&&H!=null&&H.childNodes.length>0){var K=-1;if(this.sizeColumn!=null)K=parseInt(this.sizeColumn.getAttribute("index"));if((this.sizeColumn==null||K==a.frzCols)&&a.frzCols>=0)H.childNodes[0].width=p.childNodes[0].offsetLeft+p.childNodes[0].offsetWidth-H.childNodes[0].offsetLeft+"px"}var z=this.GetFrozColHeader(a),eb=this.GetViewport2(a),v=this.GetColGroup(eb),G=this.GetColGroup(z);if(v!=null&&v.childNodes.length>0&&G!=null&&G.childNodes.length>0){var K=-1;if(this.sizeColumn!=null)K=parseInt(this.sizeColumn.getAttribute("index"));if((this.sizeColumn==null||K==0)&&a.frzCols>=0)G.childNodes[0].width=v.childNodes[0].offsetLeft+v.childNodes[0].offsetWidth-G.childNodes[0].offsetLeft+"px"}if(p!=null&&z!=null){for(var L=0,l=0;l<v.childNodes.length;l++)L+=v.childNodes[l].offsetWidth+parseInt(z.cellSpacing);if(p.childNodes.length>0)z.parentNode.parentNode.style.width=""+(L+p.childNodes[0].offsetLeft)+"Px";var fb=a.firstChild,S=this.GetColGroup(fb);if(S!=null&&z.offsetWidth>0)if(a.getRowHeader()==null)S.childNodes[0].width=L+"px";else S.childNodes[1].width=L+"px"}this.SyncMsgs(a);if(a.frzCols>0){var J=this.GetFrozColHeader(a);if(J!=null){var db=parseInt(J.parentNode.parentNode.style.width);if(J!=null)J.parentNode.style.width=""+db+"px";var bb=this.GetFrozColFooter(a);if(bb!=null)bb.parentNode.style.width=""+db+"px"}}var g=this.GetColHeader(a);if(g!=null&&g.rows.length>0)for(var l=0;l<g.rows.length;l++){var cb=g.rows[l];cb.style.height=""+cb.offsetHeight+"px"}T==null&&this.EnsureAllRowHeights(a);var n=this.GetRowHeader(a),g=this.GetColHeader(a),m=this.GetColFooter(a),U=a.getAttribute("ClientAutoSize")=="True";if(U){var h=0;if(this.GetTitleBar(a)!=null)h+=this.GetTitleBar(a).offsetHeight;if(this.GetSubTitleBar(a)!=null)h+=this.GetSubTitleBar(a).offsetHeight;if(this.GetCommandBar(a)!=null)h+=this.GetCommandBar(a).offsetHeight;if(this.GetColHeader(a)!=null)h+=this.GetColHeader(a).offsetHeight;if(this.GetColFooter(a)!=null)h+=this.GetColFooter(a).offsetHeight;if(this.GetViewport1(a)!=null)h+=this.GetViewport1(a).offsetHeight;var s=getViewPortSize(a,U);if(!isNaN(s.height))h+=s.height;else if(this.GetViewport(a)!=null)h+=this.GetViewport(a).offsetHeight;if(this.GetPager1(a)!=null)h+=this.GetPager1(a).offsetHeight;if(this.GetPager2(a)!=null)h+=this.GetPager2(a).offsetHeight;if(this.GetHierBar(a)!=null)h+=this.GetHierBar(a).offsetHeight;if(this.GetGroupBar(a)!=null)h+=this.GetGroupBar(a).offsetHeight;a.style.height=""+h+"px";var r=0;if(this.GetRowHeader(a)!=null)r+=this.GetRowHeader(a).offsetWidth;if(this.GetViewport2(a)!=null)r+=this.GetViewport2(a).offsetWidth;if(!isNaN(s.width)){var D=this.GetChildSpreads(a);if(D!=null&&D.length>0){var C=0,O=2;for(l=0;l<D.length;l++){O=this.GetChildSpreadOffsetWidth(a,D[l])+2;if(O>C)C=O}if(C>s.width)r+=C;else r+=s.width}else r+=s.width}else if(this.GetViewport(a)!=null)r+=this.GetViewport(a).offsetWidth;a.style.width=""+r+"px";var P=this.GetParent(b);if(P!=null){P.scrollTop=0;P.scrollLeft=0}var R=this.GetParent(this.GetRowHeader(a));if(R!=null){R.scrollTop=0;R.scrollLeft=0}var Q=this.GetParent(this.GetColHeader(a));if(Q!=null){Q.scrollTop=0;Q.scrollLeft=0}this.GetViewport(a).parentNode.style.overflow="hidden"}var Z=this.GetParentSpread(a);Z!=null&&this.UpdateRowHeight(Z,a);var d=a.clientHeight,t=this.IsStaticPos(a),c=this.GetCommandBar(a);if(c!=null){c.style.width=""+a.clientWidth+"px";if(t){c.parentNode.style.borderTop="1px solid white";c.parentNode.style.backgroundColor=c.style.backgroundColor}var j=this.GetElementById(c,a.id+"_cmdTable");if(j!=null){if(t&&(j.style.height==""||parseInt(j.style.height)<27))j.style.height=""+(j.offsetHeight+3)+"px";if(!A&&parseInt(b.cellSpacing)>0)j.parentNode.style.height=""+(j.offsetHeight+3)+"px";d-=j.parentNode.offsetHeight}if(j.offsetHeight>j.parentNode.offsetHeight)d+=2;if(t)c.style.position=""}var g=this.GetColHeader(a);if(g!=null){g.parentNode.style.height=""+(g.offsetHeight-parseInt(g.cellSpacing))+"px";d-=g.parentNode.offsetHeight}var m=this.GetColFooter(a);if(m!=null){d-=m.offsetHeight;m.parentNode.style.height=""+m.offsetHeight+"px"}var W=this.GetHierBar(a);if(W!=null)d-=W.offsetHeight;var V=this.GetGroupBar(a);if(V!=null)d-=V.offsetHeight;var F=this.GetPager1(a);if(F!=null)d-=F.offsetHeight;if(!A&&a.frzRows>0&&n&&this.GetViewport(a).rows.length>0){var jb=n.rows[0].offsetTop,kb=this.GetViewport(a).rows[0].offsetTop;d-=kb-jb}var X=a.getAttribute("cmdTop")=="true",e=this.GetPager2(a);if(e!=null){e.style.width=""+(a.clientWidth-10)+"px";d-=Math.max(e.offsetHeight,28)}var w=null;if(n!=null)w=n.parentNode;var q=null;if(g!=null)q=g.parentNode;var I=null;if(m!=null)I=m.parentNode;var y=this.GetFooterCorner(a);if(I!=null){I.style.height=""+m.offsetHeight-parseInt(b.cellSpacing)+"px";if(y!=null)y.parentNode.style.height=I.style.height}if(y!=null&&!A)y.width=""+(y.parentNode.offsetWidth+parseInt(b.cellSpacing))+"px";var u=this.GetCorner(a);if(q!=null){if(!a.initialized)q.style.height=""+g.offsetHeight-parseInt(b.cellSpacing)+"px";if(u!=null){var gb=this.GetBorderWidth(g,2)-this.GetBorderWidth(u,2);u.parentNode.style.height=""+(parseInt(q.style.height)-gb)+"px"}}if(u!=null&&!A)u.width=""+(u.parentNode.offsetWidth+parseInt(b.cellSpacing))+"px";var E=0;if(this.GetColFooter(a))E=this.GetColFooter(a).offsetHeight;if(c!=null&&!X)if(e!=null)if(!t){c.style.position="absolute";c.style.top=""+(a.clientHeight-Math.max(e.offsetHeight,28)-c.offsetHeight)+"px"}else c.style.top=""+(b.parentNode.offsetTop+E+b.parentNode.offsetHeight)+"px";else if(!t){c.style.position="absolute";c.style.top=""+(a.clientHeight-c.offsetHeight)+"px"}else if(e!=null)c.style.top=""+(this.GetOffsetTop(a,a,document.body)+a.clientHeight-Math.max(e.offsetHeight,28)-c.offsetHeight)+"px";else c.style.top=""+(this.GetOffsetTop(a,a,document.body)+a.clientHeight-c.offsetHeight+1)+"px";if(e!=null)if(!t){e.style.position="absolute";e.style.top=""+(a.clientHeight-Math.max(e.offsetHeight,28))+"px"}else if(c!=null&&!X)e.style.top=""+(b.parentNode.offsetTop+b.parentNode.offsetHeight+c.offsetHeight+E)+"px";else e.style.top=""+(b.parentNode.offsetTop+b.parentNode.offsetHeight+E)+"px";var f=this.GetViewport0(a),i=this.GetViewport1(a),k=this.GetViewport2(a);if(i!=null){i.parentNode.style.width=""+b.parentNode.clientWidth+"px";var o=this.getNoRowPanel(a);if(o!=null)o.style.width=""+i.offsetWidth+"px"}if(k!=null){k.parentNode.style.height=""+b.parentNode.clientHeight+"px";var Y=this.getNoRowPanel(a,2);if(Y!=null&&f!=null)Y.style.width=""+f.offsetWidth+"px"}var N=this.GetFrozColHeader(a);if(N!=null){var o=this.getNoRowPanel(a,0);if(o!=null)o.style.width=""+N.parentNode.offsetWidth+"px";o=this.getNoRowPanel(a,2);if(o!=null)o.style.width=""+N.parentNode.offsetWidth+"px"}if(i!=null){var ib=Math.min(d,i.offsetHeight-i.cellSpacing+1);i.parentNode.style.height=""+Math.max(0,ib)+"px";if(f!=null&&f.rows.length>0){f.parentNode.style.height=i.parentNode.style.height;f.parentNode.style.width=""+(f.offsetWidth-f.cellSpacing)+"px"}}if(k!=null)k.parentNode.style.width=""+(k.offsetWidth-k.cellSpacing)+"px";var B=this.GetFrozRowHeader(a);if(B!=null){B.parentNode.style.overflow="hidden";var hb=Math.min(d,B.offsetHeight-B.cellSpacing+1);B.parentNode.style.height=""+Math.max(0,hb)+"px"}var x=a.clientWidth;if(n!=null)x-=n.parentNode.offsetWidth;if(k!=null)if(f!=null)x-=Math.max(f.parentNode.offsetWidth,k.parentNode.offsetWidth);else x-=k.parentNode.offsetWidth;else if(f!=null)x-=f.parentNode.offsetWidth;if(f!=null)d-=f.offsetHeight;else if(i!=null)d-=i.offsetHeight;if(a.frzRows>0)d+=parseInt(b.cellSpacing);if(!A)d+=parseInt(b.cellSpacing);var ab=document.getElementById(a.id+"_titleBar");if(ab)d-=ab.parentNode.parentNode.offsetHeight;b.parentNode.style.height=""+Math.max(d,1)+"px";b.parentNode.parentNode.style.height=b.parentNode.style.height;if(a.frzCols>0)x+=parseInt(b.cellSpacing);b.parentNode.style.width=""+(x+parseInt(b.cellSpacing))+"px";if(w!=null)w.style.height=""+Math.max(b.parentNode.offsetHeight,1)+"px";if(this.GetParentSpread(a)==null&&q!=null&&w!=null&&a.frzCols==0){var M=0;if(w!=null)M=Math.max(a.clientWidth-w.offsetWidth,1);else M=Math.max(a.clientWidth,1);q.style.width=M;q.parentNode.style.width=M}F!=null&&this.InitSlideBar(a,F);e!=null&&this.InitSlideBar(a,e);($$.browser.version<4||a.loadedScrollbarState)&&this.ScrollView(a);(this.GetPageActiveSpread()==a||a.retainSelectionBlock)&&this.PaintFocusRect(a);if(b&&!n&&!f&&!i&&!k)b.parentNode.parentNode.parentNode.style.height=""+b.parentNode.offsetHeight+"px";this.RestoreStyleSetting(a)};this.BackUpStyleSetting=function(b){var a=b;while(a!=null&&a!=document&&a!=document.body){if(a.style.display=="none"){a.setAttribute("displaySetting",a.style.display);a.style.display=""}else if(document.defaultView.getComputedStyle(a,"").getPropertyValue("display")=="none"){a.setAttribute("displaySetting","");a.style.display="block"}a=a.parentNode}};this.RestoreStyleSetting=function(b){var a=b;while(a!=null&&a!=document&&a!=document.body){if(a.getAttribute("displaySetting")!=null&&a.getAttribute("displaySetting")!="null"){a.style.display=a.getAttribute("displaySetting");a.removeAttribute("displaySetting")}a=a.parentNode}};this.IsStaticPos=function(b){var a=b.style.position!="absolute"&&b.style.position!="relative";if(a&&document.defaultView!=null&&document.defaultView.getComputedStyle!=null){var c=document.defaultView.getComputedStyle(b,"").getPropertyValue("position");a=c!="absolute"&&c!="relative"}return a};this.InitSlideBar=function(a,b){var c=this.GetElementById(b,a.id+"_slideBar");if(c!=null){var m=this.IsXHTML(a);if(m)c.style.height=Math.max(b.offsetHeight,28)+"px";else c.style.height=b.offsetHeight-2+"px";var g=b.getElementsByTagName("TABLE");if(g!=null&&g.length>0){var k=g[0].rows[0],d=k.cells[0],e=k.cells[2];a.slideLeft=Math.max(107,d.offsetWidth+1);if(d.style.paddingRight!="")a.slideLeft+=parseInt(d.style.paddingRight);a.slideRight=b.offsetWidth-e.offsetWidth-c.offsetWidth-3;if(e.style.paddingRight!="")a.slideRight-=parseInt(e.style.paddingLeft);var n=parseInt(b.getAttribute("curPage")),f=parseInt(b.getAttribute("totalPage"))-1;if(f==0)f=1;var i=false,l=Math.max(107,a.slideLeft)+n/f*(a.slideRight-a.slideLeft);if(b.id.indexOf("pager1")>=0&&a.style.position!="absolute"&&a.style.position!="relative"){l+=this.GetOffsetLeft(a,b,document);var h=this.GetOffsetTop(a,d,b)+this.GetOffsetTop(a,b,document);c.style.top=h+"px";i=true}else if(b.id.indexOf("pager2")>=0&&a.style.position!="absolute"&&a.style.position!="relative"){var h=this.GetOffsetTop(a,d,b)+this.GetOffsetTop(a,b,document);c.style.top=h+"px"}var j=document.getElementById(a.id+"_titleBar");if(b.id.indexOf("pager1")>=0&&!i&&j!=null){var h=j.parentNode.parentNode.offsetHeight;c.style.top=h+"px"}c.style.left=l+"px"}}};this.InitLayout=function(a){this.SizeSpread(a);this.SizeSpread(a);if($$.browser.version>=4&&!a.loadedScrollbarState){this.LoadScrollbarState(a);this.ScrollView(a)}};this.GetTopRowIndex=function(c){var d=this.GetViewport(c);if(d.rows.length==0)return c.frzRows-1;var a=d.parentNode.scrollTop;if(c.virtualPaging=="true"){var g=this.GetParent(d),e=document.getElementById(c.id+"_VirtualPaging_Top").style.height;e=parseInt(e);a=a-e;if(a<0)a=0}for(var f=0,b=0,b=0;b<d.rows.length;b++){f+=d.rows[b].offsetHeight;if(f>a)break}return f>a?c.frzRows+b:b-1};this.GetLeftColIndex=function(b){for(var e=this.GetViewport(b),d=e.parentNode.scrollLeft,c=0,a=0,a=0;a<this.GetColCount(b);a++){c+=this.GetColWidthFromCol(b,b.frzCols+a);if(c>d)break}return c>d?b.frzCols+a:a-1};this.GetRowByKey=function(c,b,a){return c.fpSpreadJS.getRowByKey(b,a)};this.GetColByKey=function(d,f,g){if(f=="-1")return-1;var b=null,e=this.GetViewport0(d);if(e==null)e=this.GetViewport2(d);if(e!=null){b=this.GetColGroup(e);if(b!=null)for(var a=0;a<b.childNodes.length;a++){var h=b.childNodes[a];if(h.getAttribute("FpCol")==f)return a}}var i=this.GetViewport(d),c=this.GetColGroup(i);if(c==null||c.childNodes.length==0)c=this.GetColGroup(this.GetColHeader(d));if(c!=null)for(var a=0;a<c.childNodes.length;a++){var h=c.childNodes[a];if(h.getAttribute("FpCol")==f){if(b!=null)a+=b.childNodes.length;return a}}return g?g:0};this.IsRowSelected=function(b,g){var f=this.GetSelection(b);if(f!=null){var a=f.firstChild;while(a!=null){var d,e,c=this.GetOperationMode(b);if(b.getAttribute("LayoutMode")&&(c=="ExtendedSelect"||c=="MultiSelect")){var h=parseInt(a.getAttribute("row"));d=this.GetFirstRowFromKey(b,h)}else d=parseInt(a.getAttribute("rowIndex"));if(b.getAttribute("LayoutMode")&&(c=="ExtendedSelect"||c=="MultiSelect"))e=parseInt(b.getAttribute("layoutrowcount"));else e=parseInt(a.getAttribute("rowcount"));if(d<=g&&g<d+e)return true;a=a.nextSibling}}};this.InitSelection=function(a){a.anchorCell=this.findAnchorCell(a);var q=this.GetData(a),l=this.getSingleNode(q,"root"),j=this.getSingleNode(l,"state"),i=this.getSingleNode(j,"selection"),o=this.getSingleNode(j,"activerow"),n=this.getSingleNode(j,"activecolumn"),s=o!=null?parseInt(o.innerHTML):-1,r=n!=null?parseInt(n.innerHTML):-1,d=Math.max(s,0),c=Math.max(r,0);if(a.getAttribute("LayoutMode")){var k=this.GetCellByRowCol2(a,d,c);if(k){d=this.GetRowFromCell(a,k);c=this.GetColFromCell(a,k)}}else{d=this.GetRowByKey(a,d);c=this.GetColByKey(a,c)}a.leadingCellRow=d;a.leadingCellCol=c;if(s>-1&&r>-1){var m=q;if(this.GetParentSpread(a)!=null){var p=this.GetTopSpread(a);if(p.initialized)m=this.GetData(p);l=this.getSingleNode(m,"root")}var e=this.getSingleNode(l,"activechild");if(this.GetParentSpread(a)==null&&(e==null||e.innerHTML=="")||e!=null&&a.id==this.Trim(e.innerHTML)){var t=a.retainSelectionBlock||this.GetPageActiveSheetView()!=null&&this.GetPageActiveSheetView().id==a.id;this.UpdateAnchorCell(a,d,c,t)}}var b=i.firstChild;while(b!=null){this.updateSelectionViewIndexes(a,b);b=b.nextSibling}b=i.lastChild;if(a.getAttribute("LayoutMode")&&a.anchorCell!=null&&b!=null&&b.getAttribute("col")!="-1"&&b.getAttribute("row")=="-1"&&b.getAttribute("rowcount")=="-1")a.copymulticol=true;var g=this.GetPageActiveSheetView();if(g!=null&&g!=a&&this.GetTopSpread(g)==this.GetTopSpread(a))return;if(!a.retainSelectionBlock)return;var f=this.GetParentSpread(a),h=this.findAnchorCell(a);if(i.firstChild!=null){if(h!=null)a.activeCell=h;this.PaintSelections(a,true);if(h!=null)while(f!=null){the_fpSpread.PaintAnchorCell(f,false);f=this.GetSpread(f.parentNode)}}this.PaintFocusRect(a)};this.PaintSelections=function(b,e,k){!k&&b.fpSpreadJS.updateSelectionRangeFromCell(b.anchorCell);(e==null||e)&&this.PaintSelections(b,false);var n=this.GetData(b),o=n.getElementsByTagName("root")[0],p=o.getElementsByTagName("state")[0],i=p.getElementsByTagName("selection")[0],a=i.firstChild;if(a==null){e&&b.anchorCell!=null&&this.PaintAnchorCell(b);return}while(a!=null){var c=a.getAttribute("row"),d=parseInt(a.getAttribute("col"));if(a.getAttribute("rowIndex")==null||a.getAttribute("rowIndex")=="-1"){if(c=="newRow"||parseInt(c)>-1)c=this.GetRowByKey(b,c,0)}else c=parseInt(a.getAttribute("rowIndex"));if(a.getAttribute("colIndex")==null||a.getAttribute("colIndex")=="-1"){if(d>-1){if(b.getAttribute("LayoutMode")){var m=this.GetRowKeyFromRow(b,c==-1?0:c),f=this.GetCellByRowCol2(b,m,d);if(f){c=this.GetRowFromCell(b,f);d=this.GetColFromCell(b,f)}}if(b.getAttribute("LayoutMode")==null)d=this.GetColByKey(b,d,0)}}else d=parseInt(a.getAttribute("colIndex"));var g=parseInt(a.getAttribute("rowcount")),h=parseInt(a.getAttribute("colcount"));a.setAttribute("rowIndex",c);a.setAttribute("colIndex",d);var l=this.GetRowCountInternal(b);if(l==0&&b.ignorePaintSelection&&!(g==-1&&h==-1))return;if(b.getAttribute("LayoutMode")&&a.getAttribute("col")>=0&&a.getAttribute("row")>=0&&(a.getAttribute("rowcount")>=1||a.getAttribute("colcount")>=1)){var j=a.nextSibling;if(j!=null){if(typeof activeRow!="undefined"&&activeRow!=null&&typeof activeCol!="undefined"&&activeCol!=null)(parseInt(a.getAttribute("row"))!=parseInt(activeRow.innerHTML)||parseInt(a.getAttribute("col"))!=parseInt(activeCol.innerHTML))&&i.removeChild(a);a=j;continue}}if(b.getAttribute("LayoutMode")&&a.getAttribute("col")=="-1"&&a.getAttribute("colcount")=="-1"&&a.getAttribute("row")!=-1)g=parseInt(b.getAttribute("layoutrowcount"));if(b.getAttribute("LayoutMode")&&a.getAttribute("col")!="-1"&&a.getAttribute("row")=="-1"&&a.getAttribute("rowcount")=="-1"){var f=this.getFirstCellFromCol(b,a.getAttribute("col"));if(f){c=parseInt(f.parentNode.getAttribute("row"));d=this.GetColFromCell(b,f)}this.PaintMultipleRowSelection(b,c,d,1,1,e)}else if(this.GetOperationMode(b)=="Normal"&&this.GetSelectionPolicy(b)=="MultiRange")this.paintSelection2(b,c,d,g,h,e);else this.PaintSelection(b,c,d,g,h,e);a=a.nextSibling}};this.TranslateKeyUp=function(a){var b=this.GetPageActiveSpread();if(b!=null&&b.__delaySetEditorFocus&&(a.keyCode==27||a.keyCode==a.DOM_VK_TAB)){b.__delaySetEditorFocus=null;this.SetEditorFocus(this.GetEditor(b.anchorCell));this.CancelDefault(a)}};this.TranslateKeyPress=function(a){if(a.ctrlKey&&!a.altKey){var d=window.navigator.userAgent,e=d.indexOf("Firefox/2.")>=0;if(e)(a.charCode==67||a.charCode==86||a.charCode==88)&&this.TranslateKey(a);else(a.charCode==99||a.charCode==118||a.charCode==120)&&this.TranslateKey(a)}var b=this.GetPageActiveSpread();if(b==null)return;if(b!=null){var c=this.GetOperationMode(b)=="RowMode"&&this.GetEnableRowEditTemplate(b)=="true"&&this.IsInRowEditTemplate(b,a.target);!this.editing&&a.keyCode==a.DOM_VK_RETURN&&!c&&this.CancelDefault(a)}};this.TranslateKey=function(a){a=this.GetEvent(a);var d=this.GetTarget(a);try{if(document.readyState!=null&&document.readyState!="complete")return;var b=this.GetPageActiveSpread();if(b==null)return;b.preventPopUp=false;if(typeof b.getAttribute("mcctCellType")!="undefined"&&b.getAttribute("mcctCellType")=="true")return;if(this.GetOperationMode(b)=="RowMode"&&this.GetEnableRowEditTemplate(b)=="true"&&this.IsInRowEditTemplate(b,d))return;if(b!=null){if(a.keyCode==229&&!this.editing){if(b.anchorCell==null)return;var f=this.GetEditor(b.anchorCell);if(f==null){var c=this.GetCellEditorID(b,b.anchorCell);if(c!=null&&c.length>0)f=this.GetCellEditor(b,c,true)}if(!this.imeStat){this.imeStat=true;var i=function(){var c=arguments[arguments.length-1],b=document.createEvent("MouseEvent");b.initMouseEvent("dblclick",true,true,a.view,2,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrKey,a.altKey,a.shiftKey,a.metaKey,0,null);c.anchorCell.dispatchEvent(b)},h=Function.CreateCallback(i,b);setTimeout(h,100);return}}if(d.tagName!="HTML"&&!this.IsChild(d,this.GetTopSpread(b)))return;this.KeyDown(b,a);var e=false;if(a.keyCode==a.DOM_VK_TAB){var g=this.GetProcessTab(b);e=g=="true"||g=="True"}e&&this.CancelDefault(a)}}catch(j){}};var rowEditTemplateContainer_keyDownEvent=null,rowEditTemplateContainer_textBoxFocusing=false;this.rowEditTemplateContainer_textBoxFocus=function(){if(rowEditTemplateContainer_keyDownEvent&&rowEditTemplateContainer_keyDownEvent.keyCode==rowEditTemplateContainer_keyDownEvent.DOM_VK_TAB){rowEditTemplateContainer_textBoxFocusing=true;rowEditTemplateContainer_keyDownEvent.sourceElement.dispatchEvent(rowEditTemplateContainer_keyDownEvent)}};this.rowEditTemplateContainer_keyDown=function(a){if(a.keyCode==a.DOM_VK_TAB)if(!rowEditTemplateContainer_textBoxFocusing){var b=document.createEvent("KeyboardEvent");b.initKeyEvent(a.type,a.bubbles,a.cancelable,a.view,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.keyCode,a.charCode);b.sourceElement=a.target;rowEditTemplateContainer_keyDownEvent=b}else{rowEditTemplateContainer_textBoxFocusing=false;var c=this.GetPageActiveSpread();this.KeyDown(c,a)}else rowEditTemplateContainer_keyDownEvent=null;if(a.preventDefault==null){a.cancelBubble=true;a.returnValue=true}return true};this.IsInRowEditTemplate=function(b,a){while(a&&a.parentNode){a=a.parentNode;if(a.tagName=="DIV"&&a.id==b.id+"_RowEditTemplateContainer")return true}return false};this.KeyAction=function(e,c,b,d,a){this.key=e;this.ctrl=c;this.shift=b;this.alt=d;this.action=a};this.RemoveKeyMap=function(a,f,h,g,i){if(a.keyMap==null)a.keyMap=[];for(var e=a.keyMap.length,c=0;c<e;c++){var b=a.keyMap[c];if(b!=null&&b.key==f&&b.ctrl==h&&b.shift==g&&b.alt==i){for(var d=c+1;d<e;d++)a.keyMap[d-1]=a.keyMap[d];a.keyMap.length=a.keyMap.length-1;break}}};this.AddKeyMap=function(a,b,e,d,f,c){if(a.keyMap==null)a.keyMap=[];var g=this.GetKeyAction(a,b,e,d,f);if(g!=null)g.action=c;else{var h=a.keyMap.length;a.keyMap.length=h+1;a.keyMap[h]=new this.KeyAction(b,e,d,f,c)}};this.GetKeyAction=function(b,d,f,e,g){if(b.keyMap==null)b.keyMap=[];for(var h=b.keyMap.length,c=0;c<h;c++){var a=b.keyMap[c];if(a!=null&&a.key==d&&a.ctrl==f&&a.shift==e&&a.alt==g)return a}return null};this.MoveToPrevCell=function(a,g){var k=this.EndEdit(a);if(!k)return;this.doIgnoreVirtualPaging(a);var h=a.anchorCell,f=a.leadingCellRow,e=a.leadingCellCol;if(this.GetCellFromRowCol(a,f,e)!=a.anchorCell){f=this.GetRowFromCell(a,a.anchorCell);e=this.GetColFromCell(a,a.anchorCell)}var j=typeof g=="undefined"?false:g;this.MoveLeft(a,f,e,j);if(h!=a.anchorCell){var l=this.GetOperationMode(a);if(l=="Normal"){var o=this.CreateEvent("SelectionChanged");this.FireEvent(a,o)}var n=this.GetSheetIndex(a,this.GetRowFromCell(a,a.anchorCell)),m=this.GetColFromCell(a,a.anchorCell),i=a.getAttribute("LayoutMode")?a.anchorCell.parentNode.getAttribute("row"):null;this.FireActiveCellChangedEvent(a,n,m,i)}var c=this.GetParent(this.GetViewport(a)),b=this.GetCellFromRowCol(a,a.leadingCellRow,a.leadingCellCol);if(b.offsetLeft<c.scrollLeft)if(b.cellIndex>0)c.scrollLeft=a.anchorCell.offsetLeft;else c.scrollLeft=0;else if(b.cellIndex==0)c.scrollLeft=0;if(b.parentNode.rowIndex==1&&a.virtualTop==0)c.scrollTop=0;var d=this.GetParent(this.GetViewport(a));c=this.GetParent(this.GetViewport(a));if(b!=null&&b.offsetWidth<c.clientWidth)if((this.IsChild(b,c)||this.IsChild(b,this.GetViewport1(a)))&&b.offsetLeft+b.offsetWidth>c.scrollLeft+c.clientWidth)d.scrollLeft=b.offsetLeft+b.offsetWidth-c.clientWidth;if((this.IsChild(b,c)||this.IsChild(b,this.GetViewport1(a)))&&b.offsetTop+b.offsetHeight>c.scrollTop+c.clientHeight&&b.offsetHeight<c.clientHeight-a.virtualTop)d.scrollTop=b.offsetTop+b.offsetHeight-c.clientHeight;if(b.offsetTop<c.scrollTop-a.virtualTop)d.scrollTop=b.offsetTop==0?a.virtualTop:b.offsetTop};this.MoveToNextCell=function(a,g){var k=this.EndEdit(a);if(!k)return;this.doIgnoreVirtualPaging(a);var h=a.anchorCell,f=a.leadingCellRow,e=a.leadingCellCol;if(this.GetCellFromRowCol(a,f,e)!=a.anchorCell){f=this.GetRowFromCell(a,a.anchorCell);e=this.GetColFromCell(a,a.anchorCell)}var j=typeof g=="undefined"?false:g;this.MoveRight(a,f,e,j);if(h!=a.anchorCell){var l=this.GetOperationMode(a);if(l=="Normal"){var o=this.CreateEvent("SelectionChanged");this.FireEvent(a,o)}var n=this.GetSheetIndex(a,this.GetRowFromCell(a,a.anchorCell)),m=this.GetColFromCell(a,a.anchorCell),i=a.getAttribute("LayoutMode")?a.anchorCell.parentNode.getAttribute("row"):null;this.FireActiveCellChangedEvent(a,n,m,i)}var c=this.GetParent(this.GetViewport(a)),b=this.GetCellFromRowCol(a,a.leadingCellRow,a.leadingCellCol);if(b.cellIndex==0)c.scrollLeft=0;if(b.offsetLeft+b.offsetWidth>c.scrollLeft+c.offsetWidth-10)c.scrollLeft+=b.offsetWidth;else if(b.cellIndex>=0)if(a.anchorCell.offsetLeft>c.offsetWidth)c.scrollLeft=a.anchorCell.offsetLeft-c.offsetWidth;else c.scrollLeft=0;if(b.parentNode.rowIndex==1&&a.virtualTop==0)c.scrollTop=0;var d=this.GetParent(this.GetViewport(a));c=this.GetParent(this.GetViewport(a));if(b!=null&&b.offsetWidth<c.clientWidth)if((this.IsChild(b,c)||this.IsChild(b,this.GetViewport1(a)))&&b.offsetLeft+b.offsetWidth>c.scrollLeft+c.clientWidth)d.scrollLeft=b.offsetLeft+b.offsetWidth-c.clientWidth;if((this.IsChild(b,c)||this.IsChild(b,this.GetViewport1(a)))&&b.offsetTop+b.offsetHeight>c.scrollTop+c.clientHeight&&b.offsetHeight<c.clientHeight-a.virtualTop)d.scrollTop=b.offsetTop+b.offsetHeight-c.clientHeight;if(b.offsetTop<c.scrollTop-a.virtualTop)d.scrollTop=b.offsetTop==0?a.virtualTop:b.offsetTop};this.MoveToNextRow=function(b,h){var f=this.EndEdit(b);if(!f)return;this.doIgnoreVirtualPaging(b);var k=b.leadingCellRow,j=b.leadingCellCol,e=b.anchorCell;this.MoveDown(b,k,j,h,false,true);if(e!=b.anchorCell){var g=this.GetOperationMode(b);if(g=="Normal"){var i=this.CreateEvent("SelectionChanged");this.FireEvent(b,i)}this.FireActiveCellChangedEvent(b,b.leadingCellRow,b.leadingCellCol)}var c=this.GetParent(this.GetViewport(b)),a=this.GetCellFromRowCol(b,b.leadingCellRow,b.leadingCellCol);if(a.cellIndex==0)c.scrollLeft=0;else if(a.offsetLeft<c.scrollLeft)c.scrollLeft=a.offsetLeft;if(a.parentNode.rowIndex==1&&b.virtualTop==0)c.scrollTop=0;var d=this.GetParent(this.GetViewport(b));c=this.GetParent(this.GetViewport(b));if((this.IsChild(a,c)||this.IsChild(a,this.GetViewport2(b)))&&a.offsetTop+a.offsetHeight>c.scrollTop+c.clientHeight-b.virtualTop)d.scrollTop+=a.offsetHeight;if(a!=null&&a.offsetWidth<c.clientWidth)if((this.IsChild(a,c)||this.IsChild(a,this.GetViewport1(b)))&&a.offsetLeft+a.offsetWidth>c.scrollLeft+c.clientWidth)d.scrollLeft=a.offsetLeft+a.offsetWidth-c.clientWidth;if((this.IsChild(a,c)||this.IsChild(a,this.GetViewport1(b)))&&a.offsetTop+a.offsetHeight>c.scrollTop+c.clientHeight&&a.offsetHeight<c.clientHeight-b.virtualTop)d.scrollTop=a.offsetTop+a.offsetHeight-c.clientHeight;if(a.offsetTop<c.scrollTop-b.virtualTop)d.scrollTop=a.offsetTop==0?b.virtualTop:a.offsetTop;this.ScrollView(b)};this.MoveToPrevRow=function(a,i){var g=this.EndEdit(a);if(!g)return;this.doIgnoreVirtualPaging(a);var e=a.leadingCellRow,k=a.leadingCellCol;if(e>=0){var f=a.anchorCell;this.MoveUp(a,e,k,i,false,true);if(f!=a.anchorCell){var h=this.GetOperationMode(a);if(h=="Normal"){var j=this.CreateEvent("SelectionChanged");this.FireEvent(a,j)}this.FireActiveCellChangedEvent(a,a.leadingCellRow,a.leadingCellCol)}var c=this.GetParent(this.GetViewport(a)),b=this.GetCellFromRowCol(a,a.leadingCellRow,a.leadingCellCol);if(b.cellIndex==0)c.scrollLeft=0;if(b.parentNode.offsetTop<c.scrollTop)if(b.parentNode.rowIndex>1)c.scrollTop=b.parentNode.offsetTop>a.virtualTop?b.parentNode.offsetTop:a.virtualTop;else c.scrollTop=a.virtualTop;else if(b.parentNode.rowIndex==1&&a.virtualTop==0)c.scrollTop=0;if(b.offsetLeft<c.scrollLeft)c.scrollLeft=b.offsetLeft;var d=this.GetParent(this.GetViewport(a));c=this.GetParent(this.GetViewport(a));if(b!=null&&b.offsetWidth<c.clientWidth)if((this.IsChild(b,c)||this.IsChild(b,this.GetViewport1(a)))&&b.offsetLeft+b.offsetWidth>c.scrollLeft+c.clientWidth)d.scrollLeft=b.offsetLeft+b.offsetWidth-c.clientWidth;if((this.IsChild(b,c)||this.IsChild(b,this.GetViewport1(a)))&&b.offsetTop+b.offsetHeight>c.scrollTop+c.clientHeight&&b.offsetHeight<c.clientHeight-a.virtualTop)d.scrollTop=b.offsetTop+b.offsetHeight-c.clientHeight;if(b.offsetTop<c.scrollTop-a.virtualTop)d.scrollTop=b.offsetTop==0?a.virtualTop:b.offsetTop}};this.MoveToFirstColumn=function(a){var d=this.EndEdit(a);if(!d)return;var g=a.GetActiveRow();if(a.anchorCell.parentNode.rowIndex>=0){var c=a.anchorCell;this.UpdateLeadingCell(a,g,0);if(c!=a.anchorCell){var e=this.GetOperationMode(a);if(e=="Normal"){var f=this.CreateEvent("SelectionChanged");this.FireEvent(a,f)}this.FireActiveCellChangedEvent(a,a.leadingCellRow,a.leadingCellCol)}}var b=this.GetParent(this.GetViewport(a));if(b!=null)b.scrollLeft=0};this.MoveToLastColumn=function(a){var g=this.EndEdit(a);if(!g)return;var e=a.GetActiveRow();if(a.anchorCell.parentNode.rowIndex>=0){c=this.GetColCount(a)-1;var f=a.anchorCell;this.UpdateLeadingCell(a,e,c);if(f!=a.anchorCell){var h=this.GetOperationMode(a);if(h=="Normal"){var i=this.CreateEvent("SelectionChanged");this.FireEvent(a,i)}this.FireActiveCellChangedEvent(a,a.leadingCellRow,a.leadingCellCol)}}var d=this.GetCellFromRowCol(a,e,c),b=this.GetParent(this.GetViewport(a));if(b!=null&&d!=null)b.scrollLeft=d.offsetLeft};this.UpdatePostbackData=function(a){this.SaveData(a)};this.PrepareData=function(a){var b="";if(a!=null)if(a.nodeName=="#text")b=a.nodeValue;else{b=this.GetBeginData(a);var c=a.firstChild;while(c!=null){var d=this.PrepareData(c);if(d!="")b+=d;c=c.nextSibling}b+=this.GetEndData(a)}return b};this.GetBeginData=function(b){var c="<"+b.nodeName.toLowerCase();if(b.attributes!=null)for(var d=0;d<b.attributes.length;d++){var a=b.attributes[d];if(a.nodeName!=null&&a.nodeName!=""&&a.nodeName!="style"&&a.nodeValue!=null&&a.nodeValue!="")c+=" "+a.nodeName+'="'+a.nodeValue+'"'}c+=">";return c};this.GetEndData=function(a){return"</"+a.nodeName.toLowerCase()+">"};this.SaveData=function(b){if(b==null)return;try{for(var a=this.GetSelection(b),c=0;c<a.childNodes.length;c++)if(a.childNodes[c].getAttribute("anchor")!=null){a.removeChild(a.childNodes[c]);break}var e=this.GetData(b),d=e.getElementsByTagName("root")[0],h=d.getElementsByTagName("activecolumn")[0],g=this.PrepareData(d),f=document.getElementById(b.id+"_data");f.value=encodeURIComponent(g)}catch(i){alert("e "+i)}};this.SetActiveSpread=function(a){a=this.GetEvent(a);var b=this.GetTarget(a);this.__SetActiveSpread(b)};this.__SetActiveSpread=function(c){try{if(this.editing&&c!=null&&c.tagName=="HTML")return;if(this.isExtenderPopupControl(c))return;var b=this.GetSpread(c,false),a=this.GetPageActiveSpread();if(this.editing&&(b==null||b!=a&&b.getAttribute("mcctCellType")!="true"&&a.getAttribute("mcctCellType")!="true")){if(c!=this.editor&&this.editor!=null)this.editor.blur!=null&&this.editor.blur();var l=this.EndEdit();if(!l)return}var f=false;if(b==null){b=this.GetSpread(c,true);f=b!=null}if(b!=null&&(f||c==this.GetTopSpread(b).viewport.parentNode)){var j=this.getLastActiveSpread(b);if(j!=null)b=j}(b==null||a!=null&&this.GetTopSpread(a)!=this.GetTopSpread(b))&&this.hideSelectionBlock(a);var m=this.GetCell(c,true);if(m==null&&a!=null&&a.dirty){this.SaveData(a);a.dirty=false}if(a!=null&&a.dirty&&(b!=a||b==null||f)){this.SaveData(a);a.dirty=false}if(a!=null&&a.dirty&&b==a&&c.tagName=="INPUT"&&(c.type=="submit"||c.type=="button"||c.type=="image")){this.SaveData(a);a.dirty=false}if(b!=null&&this.GetOperationMode(b)=="ReadOnly")return;var d=null;if(b==null){if(a==null)return;d=this.GetTopSpread(a);this.SetActiveSpreadID(d,"",null,false);this.SetPageActiveSpread(null)}else if(b!=a){if(a!=null){d=this.GetTopSpread(a);this.SetActiveSpreadID(d,"",null,false)}d=this.GetTopSpread(b);var g=FpSpreadJS.getTableRow(c);if(f||c==this.GetParent(this.GetViewport(d))||c==this.GetParent(this.GetViewport1(d))||c==this.GetParent(this.GetViewport2(d))||c.getAttribute("ControlType")=="chgrayarea"||c.getAttribute("FpSpread")=="rowpadding"||this.sizeRow!=null||this.sizeColumn!=null||g!=null&&FpSpreadJS.getTable(g)==this.GetRowHeader(b)&&FpSpreadJS.isChildSpreadRow(this.GetViewport(b),g.rowIndex)){var n=this.GetTopSpread(a);if(d!=n){var e=this.GetActiveChildSpread(d).innerHTML;if(e==""){for(var k=FpSpreadJS.getAllSpreads(d),i=0;i<k.length;i++){var h=k[i];if(h.anchorCell!=null&&h.anchorCell.getAttribute("paintSelected")!=null){b=h;break}}e=b.id}this.SetActiveSpreadID(d,e,e);this.SetPageActiveSpread(document.getElementById(e))}else{this.SetActiveSpreadID(d,a.id,a.id,true);this.SetPageActiveSpread(a)}}else{d=this.GetTopSpread(b);this.SetPageActiveSpread(b);this.SetActiveSpreadID(d,b.id,b.id,false)}}}catch(o){}};this.hideSelectionBlock=function(a){if(a==null)return;var b=this.GetTopSpread(a);if(!b.retainSelectionBlock){a.isactive=false;this.PaintAnchorCell(a);this.PaintSelections(a,false);this.PaintAnchorCellHeader(a,false);this.HideFocusBorder(a);this.GetPageActiveSpread()==a&&this.SetPageActiveSpread(null)}};this.isExtenderPopupControl=function(a){return a.id.indexOf("CalendarExtender")!=-1};this.SetActiveSpreadID=function(c,h,d,f){var g=this.GetData(c),e=g.getElementsByTagName("root")[0],b=e.getElementsByTagName("activespread")[0],a=e.getElementsByTagName("activechild")[0];if(b==null)return;if(f&&a!=null&&a.nodeValue!="")b.innerHTML=a.innerHTML;else{b.innerHTML=h;if(d!=null&&a!=null)a.innerHTML=d}this.SaveData(c);c.dirty=false};this.GetSpread=function(d,e){var a=d;while(a!=null&&a.tagName!="BODY"){if(typeof a.getAttribute!="function")break;var c=a.getAttribute("FpSpread");if(c==null)c=a.FpSpread;if(c=="Spread"){if(!e){var b=d;while(b!=null&&b!=a){if(b.id==a.id+"_commandBar"||b.id==a.id+"_pager1"||b.id==a.id+"_pager2")return null;b=b.parentNode}}return a}a=a.parentNode}return null};this.GetActiveChildSheetView=function(d){var a=this.GetPageActiveSheetView();if(typeof a=="undefined")return null;var c=this.GetTopSpread(d),b=this.GetTopSpread(a);return b!=c?null:a==b?null:a};this.ScrollViewport=function(b){var c=this.GetTarget(b),a=this.GetTopSpread(c);a!=null&&this.ScrollView(a)};this.ScrollTo=function(c,e,d){var a=this.GetCellByRowCol(c,e,d);if(a==null)return;var b=this.GetViewport(c).parentNode;if(b==null)return;b.scrollTop=a.offsetTop;b.scrollLeft=a.offsetLeft};this.DoVirtualPaging=function(a){a=this;var e=the_fpSpread.GetViewport(a),d=the_fpSpread.GetParent(e);if(e==null||d==null)return;var b=d.scrollTop;if(a.virtualPagingCurrentScroll!=null&&b==a.virtualPagingCurrentScroll){var g=the_fpSpread.GetCurrentPageIndex(a),c=the_fpSpread.canMoveToPage(a);if(c.canMove)if(a.getAttribute("IgnoreHiddenRowsWhenPaging")=="True"){var f=Math.abs(c.scrollValue-b);the_fpSpread.ScrollToPage(a,f,a.isScrollUp,true)}else the_fpSpread.GotoPage(a,c.ToPage,true);a.virtualPagingProcessing=false}else{a.virtualPagingCurrentScroll=b;setTimeout(Function.CreateDelegate(a,the_fpSpread.DoVirtualPaging),500)}};this.canMoveToPage=function(a){var e=this.GetViewport(a),c=this.GetParent(e);if(e==null||c==null)return false;var h=c.scrollTop,d=getViewPortSize(a,false),f=this.GetCurrentPageIndex(a),g=this.GetPageCount(a),b={canMove:false,scrollValue:-1};if(a.getAttribute("IgnoreHiddenRowsWhenPaging")=="False"){var j=parseInt(a.getAttribute("__defaultPageHeight")),q=document.getElementById(a.id+"_VirtualPaging_Bottom"),n=document.getElementById(a.id+"_VirtualPaging_Top"),l=e.getBoundingClientRect(),i=c.getBoundingClientRect(),m=a.isScrollUp&&n.getBoundingClientRect().bottom>i.top,o=!a.isScrollUps&&(e.offsetHeight>c.clientHeight?l.bottom<i.bottom-(c.offsetHeight-c.clientHeight):true);b.canMove=m&&f>0||o&&f<g-1;if(b.canMove)if(m)b.ToPage=Math.floor(h/j);else{var k=i.bottom-l.bottom;if(e.offsetHeight<c.clientHeight)k-=c.clientHeight-e.offsetHeight;b.ToPage=f+Math.ceil(k/j);if(b.ToPage>=g)b.ToPage=g-1}}else if(a.isScrollUp&&h<d.top&&f!=0){b.canMove=true;b.scrollValue=d.top}else if(!a.isScrollUp&&d.height+d.top-h<c.offsetHeight&&f!=g-1){b.canMove=true;var p=d.height>c.offsetHeight?d.height-c.offsetHeight:0;b.scrollValue=a.virtualTop+p}return b};this.bug99920015=function(f){var b=$$.browser,e=b.windowOS&&(b.OSMajorVersion==6&&b.OSMinorVersion==0||b.OSMajorVersion==5&&b.OSMinorVersion==2);if(e){var c=this.GetTopSpread(f);if(c==null)return;var a=this.GetParent(this.GetViewport(c));if(a==null)return;var d=a.scrollTop;a.scrollTop=a.scrollTop+1;if(a.scrollTop!=d)a.scrollTop=a.scrollTop-1;else{a.scrollTop=a.scrollTop-1;if(a.scrollTop!=d)a.scrollTop=a.scrollTop+1}}};this.ScrollView=function(a,f){var c=this.GetTopSpread(a),j=this.GetParent(this.GetRowHeader(c)),i=this.GetParent(this.GetColHeader(c)),h=this.GetParent(this.GetColFooter(c)),b=this.GetParent(this.GetViewport(c));if(b==null)return;if(a.scrollTopInner==b.scrollTop&&a.scrollLeftInner==b.scrollLeft&&!f)return;var m=a.scrollTopInner!=b.scrollTop,d=a.scrollLeftInner!=b.scrollLeft;if(j!=null)j.scrollTop=b.scrollTop;if(i!=null){i.scrollLeft=b.scrollLeft;this.bug99920015(a)}if(h!=null)h.scrollLeft=b.scrollLeft;var p=this.GetViewport0(a),k=this.GetViewport1(a),l=this.GetViewport2(a);if(l!=null)l.parentNode.scrollTop=b.scrollTop;if(f)return;if(k!=null){k.parentNode.scrollLeft=b.scrollLeft;this.bug99920015(a)}var n=b.scrollTop;this.SetValidatorPos(a);this.GetParentSpread(a)==null&&this.SaveScrollbarState(a,b.scrollTop,b.scrollLeft);if(m||d){var e=this.CreateEvent("Scroll");e.vertical=m;e.horizontal=d;this.FireEvent(a,e);(a.frzRows!=0||a.frzCols!=0)&&this.SyncMsgs(a)}var g=a.scrollTopInner!=null&&a.scrollTopInner>n;a.scrollLeftInner=b.scrollLeft;a.scrollTopInner=b.scrollTop;if(!g&&a.getAttribute("AllRowsLoaded")==null&&b.scrollTop>0&&b.scrollTop+b.offsetHeight>=this.GetViewport(c).offsetHeight)if(a.initialized&&!this.editing&&a.getAttribute("loadOnDemand")=="true"){if(a.LoadState!=null)return;a.LoadState=true;this.SaveData(a);setTimeout(function(){a.CallBack("LoadOnDemand",true)},0)}var o=this.GetViewport(c);if(a.virtualPaging=="true"&&!a.ignoreVirtualPaging&&!d&&!a.virtualPagingProcessing&&a.getAttribute("loadOnDemand")!="true"&&this.IsChild(o,b)){a.isScrollUp=g;if(this.canMoveToPage(a).canMove){a.virtualPagingProcessing=true;setTimeout(Function.CreateDelegate(a,the_fpSpread.DoVirtualPaging),0)}}};this.LoadData=function(a,b){if(a.initialized&&!this.editing&&a.getAttribute("loadOnDemand")=="true"){if(a.LoadState!=null)return;a.LoadState=true;this.SaveData(a);a.CallBack("LoadOnDemand",b)}};this.SaveScrollbarState=function(b,d,e){if(this.GetParentSpread(b)!=null)return;var g=this.GetData(b),f=g.getElementsByTagName("root")[0],a=f.getElementsByTagName("scrollTop")[0],c=f.getElementsByTagName("scrollLeft")[0];if(b.getAttribute("scrollContent"))if(a!=null&&c!=null)(a.innerHTML!=d||c.innerHTML!=e)&&this.ShowScrollingContent(b,a.innerHTML==d);if(a!=null)a.innerHTML=d;if(c!=null)c.innerHTML=e;b.dirty=true};this.LoadScrollbarState=function(a){if(this.GetParentSpread(a)!=null)return;if(a.getAttribute("ClientAutoSize")=="True")return;a.loadedScrollbarState=true;var o=this.GetData(a),n=o.getElementsByTagName("root")[0],i=n.getElementsByTagName("scrollTop")[0],h=n.getElementsByTagName("scrollLeft")[0],c=0;if(i!=null&&i.innerHTML!="")c=parseInt(i.innerHTML);else c=0;a.virtualPagingProcessing=false;a.isScrollUp=false;c=c>0&&c>=a.virtualTop?c:c+a.virtualTop;var d=0;if(h!=null&&h.innerHTML!="")d=parseInt(h.innerHTML);else d=0;a.virtualPaging=a.getAttribute("virtualPaging");if(a.virtualPaging=="true"){var b=this.GetViewport(a);if(b!=null&&b.isBuild==null){var e=document.getElementById(a.id+"_VirtualPaging_Bottom"),j=parseInt(e.style.height),f=b.parentNode.clientHeight-b.offsetHeight;if(f>0)e.style.height=f+j+"px";b.isBuild=true}var g=this.GetViewport2(a);if(g!=null&&this.getNoRowPanel(a,2)==null){var e=document.getElementById(a.id+"_VirtualPaging_Bottom2"),j=parseInt(e.style.height),f=g.parentNode.clientHeight-g.offsetHeight;if(f>0)e.style.height=f+j+"px";g.isBuild=true}}var b=this.GetParent(this.GetViewport(a));if(b!=null){if(!isNaN(c))b.scrollTop=c;if(!isNaN(d))b.scrollLeft=d;var m=this.GetParent(this.GetRowHeader(a)),l=this.GetParent(this.GetColHeader(a)),k=this.GetParent(this.GetColFooter(a));if(k!=null)k.scrollLeft=b.scrollLeft;if(m!=null)m.scrollTop=b.scrollTop;if(l!=null)l.scrollLeft=b.scrollLeft}};this.GetParent=function(a){return a==null?null:a.parentNode};this.GetViewport=function(a){return a.viewport};this.GetFrozColHeader=function(a){return a.frozColHeader};this.GetColFooter=function(a){return a.colFooter};this.GetFrozColFooter=function(a){return a.frozColFooter};this.GetTopTable=function(a){return a.getElementsByTagName("TABLE")[0]};this.GetFrozRowHeader=function(a){return a.frozRowHeader};this.GetViewport0=function(a){return a.viewport0};this.GetViewport1=function(a){return a.viewport1};this.GetViewport2=function(a){return a.viewport2};this.GetCommandBar=function(a){return a.commandBar};this.GetRowHeader=function(a){return a.rowHeader};this.GetColHeader=function(a){return a.colHeader};this.GetCmdBtn=function(d,c){var a=this.GetTopSpread(d),b=this.GetCommandBar(a);return b!=null?this.GetElementById(b,a.id+"_"+c):null};this.Range=function(){this.type="Cell";this.row=-1;this.col=-1;this.rowCount=0;this.colCount=0;this.innerRow=0};this.SetRange=function(a,b,e,d,g,f,c){a.type=b;a.row=e;a.col=d;a.rowCount=g;a.colCount=f;a.innerRow=c;if(b=="Row")a.col=a.colCount=-1;else if(b=="Column")a.row=a.rowCount=-1;else if(b=="Table"){a.col=a.colCount=-1;a.row=a.rowCount=-1}};this.Margin=function(){this.left;this.top;this.right;this.bottom};this.GetRender=function(b){var a=b;if(a.firstChild!=null&&a.firstChild.tagName!=null&&a.firstChild.tagName!="BR")return a.firstChild;if(a.firstChild!=null&&a.firstChild.value!=null)a=a.firstChild;return a};this.GetPreferredRowHeight=function(c,d){var b=this.CreateTestBox(c);d=this.GetDisplayIndex(c,d);for(var e=this.GetViewport(c),f=0,h=e.rows[d].offsetHeight,n=e.rows[d].cells.length,j=0;j<n;j++){var g=e.rows[d].cells[j],a=this.GetRender(g);if(a!=null){b.style.fontFamily=a.style.fontFamily;b.style.fontSize=a.style.fontSize;b.style.fontWeight=a.style.fontWeight;b.style.fontStyle=a.style.fontStyle}var m=this.GetColFromCell(c,g);b.style.posWidth=this.GetColWidthFromCol(c,m);if(a!=null&&a.tagName=="SELECT"){for(var l="",k=0;k<a.childNodes.length;k++){var i=a.childNodes[k];if(i.text!=null&&i.text.length>l.length)l=i.text}b.innerHTML=l}else if(a!=null&&a.tagName=="INPUT")b.innerHTML=a.value;else b.innerHTML=g.innerHTML;h=b.offsetHeight;if(h>f)f=h}return Math.max(0,f)+3};this.SetRowHeight2=function(c,d,e,f){if(e<1)e=1;d=this.GetDisplayIndex(c,d);var a=null,i=false;if(d<c.frzRows){i=true;if(this.GetFrozRowHeader(c)!=null)a=this.GetFrozRowHeader(c).rows[d]}else{d-=c.frzRows;if(this.GetRowHeader(c)!=null)a=this.GetRowHeader(c).rows[d]}if(a!=null)a.style.height=""+e+"px";if(i){var b=this.GetViewport0(c);if(b!=null)if(a!=null)b.rows[a.rowIndex].style.height=""+(a.offsetHeight-b.rows[0].offsetTop)+"px";else{b.rows[d].style.height=""+e+"px";a=b.rows[d]}b=this.GetViewport1(c);if(b!=null)if(a!=null)b.rows[a.rowIndex].style.height=""+(a.offsetHeight-b.rows[0].offsetTop)+"px";else{b.rows[d].style.height=""+e+"px";a=b.rows[d]}}else{var b=this.GetViewport(c);if(b!=null)if(a!=null)b.rows[a.rowIndex].style.height=a.style.height;else{b.rows[d].style.height=""+e+"px";a=b.rows[d]}b=this.GetViewport2(c);if(b!=null)if(a!=null)b.rows[a.rowIndex].style.height=a.style.height;else{b.rows[d].style.height=""+e+"px";a=b.rows[d]}}if(f==null||f){var g=this.AddRowInfo(c,a.getAttribute("FpKey"));if(g!=null){if(typeof a.style.posHeight=="undefined")a.style.posHeight=e;this.SetRowHeight(c,g,a.style.posHeight)}}var h=this.GetParentSpread(c);h!=null&&this.UpdateRowHeight(h,c);this.SizeSpread(c)};this.GetRowHeightInternal=function(a,c){var b=null;if(c<a.frzRows){if(this.GetFrozRowHeader(a)!=null)b=this.GetFrozRowHeader(a).rows[c];else if(this.GetViewport1(a)!=null)b=this.GetViewport1(a).rows[c]}else{c-=a.frzRows;if(this.GetRowHeader(a)!=null)b=this.GetRowHeader(a).rows[c];else if(this.GetViewport(a)!=null)b=this.GetViewport(a).rows[c]}return b!=null?b.offsetHeight:0};this.GetCell=function(c,b){var a=c;while(a!=null){if(b){if((a.tagName=="TD"||a.tagName=="TH")&&a.parentNode.getAttribute("FpSpread")=="r")return a}else if((a.tagName=="TD"||a.tagName=="TH")&&(a.parentNode.getAttribute("FpSpread")=="r"||a.parentNode.getAttribute("FpSpread")=="ch"||a.parentNode.getAttribute("FpSpread")=="rh"))return a;a=a.parentNode}return null};this.InRowHeader=function(b,a){return this.IsChild(a,this.GetFrozRowHeader(b))||this.IsChild(a,this.GetRowHeader(b))};this.InColHeader=function(b,a){return this.IsChild(a,this.GetFrozColHeader(b))||this.IsChild(a,this.GetColHeader(b))};this.InColFooter=function(b,a){return this.IsChild(a,this.GetFrozColFooter(b))||this.IsChild(a,this.GetColFooter(b))};this.IsHeaderCell=function(b,a){return a!=null&&(a.tagName=="TD"||a.tagName=="TH")&&(a.parentNode.getAttribute("FpSpread")=="ch"||a.parentNode.getAttribute("FpSpread")=="rh")};this.InFrozCols=function(b,a){return this.IsChild(a,this.GetFrozColHeader(b))||this.IsChild(a,this.GetViewport0(b))||this.IsChild(a,this.GetViewport2(b))};this.InFrozRows=function(b,a){this.IsChild(a,this.GetFrozRowHeader(b))||this.IsChild(a,this.GetViewport0(b))||this.IsChild(a,this.GetViewport1(b))};this.GetSizeColumn=function(a,n,g){if(n.tagName!="TD"||this.GetColHeader(a)==null)return null;var b=-1,c=n;while(c!=null&&c.parentNode!=null&&c.parentNode!=document.documentElement){if(c.parentNode.getAttribute("FpSpread")=="ch"){var k=$$(c).offset().left,o=k+c.offsetWidth;if(g.pageX<k+3)b=this.GetColFromCell(a,c)-1;else if(g.pageX>o-4){b=this.GetColFromCell(a,c);var e=this.GetSpanCell(c.parentNode.rowIndex,b,a.colSpanCells);if(e!=null)b=e.col+e.colCount-1}else{b=this.GetColFromCell(a,c);var e=this.GetSpanCell(c.parentNode.rowIndex,b,a.colSpanCells);if(e!=null){var i=k;b=-1;for(var f=e.col;f<e.col+e.colCount&&f<this.GetColCount(a);f++){if(this.IsChild(c,this.GetColHeader(a)))i+=parseInt(this.GetElementById(this.GetColHeader(a),a.id+"col"+f).width);else i+=parseInt(this.GetElementById(this.GetFrozColHeader(a),a.id+"col"+f).width);if(g.pageX>i-3&&g.pageX<i+3){b=f;break}}}else b=-1}if(isNaN(b)||b<0)return null;var j=0,m=this.GetColCount(a),l=true,p=null,d=b+1;while(d<m){var h=this.GetColGroup(this.GetColHeader(a));if(d>=a.frzCols){var h=this.GetColGroup(this.GetColHeader(a));if(d-a.frzCols<h.childNodes.length)j=parseInt(h.childNodes[d-a.frzCols].width)}else{var h=this.GetColGroup(this.GetFrozColHeader(a));if(d<h.childNodes.length)j=parseInt(h.childNodes[d].width)}if(j>1){l=false;break}d++}if(l){d=b+1;while(d<m){if(this.GetSizable(a,d)){b=d;break}d++}}return!this.GetSizable(a,b)?null:this.IsChild(c,this.GetColHeader(a))?g.offsetX<3&&c.cellIndex==0&&this.GetFrozColHeader(a)!=null?this.GetElementById(this.GetFrozColHeader(a),a.id+"col"+(a.frzCols-1)):this.GetElementById(this.GetColHeader(a),a.id+"col"+b):this.GetElementById(this.GetFrozColHeader(a),a.id+"col"+b)}c=c.parentNode}return null};this.GetColGroup=function(d){if(d==null)return null;var a=d.getElementsByTagName("COLGROUP");if(a!=null&&a.length>0){if(d.colgroup!=null)return d.colgroup;var b={};b.childNodes=[];for(var c=0;c<a[0].childNodes.length;c++)if(a[0].childNodes[c]!=null&&a[0].childNodes[c].tagName=="COL"){var e=b.childNodes.length;b.childNodes.length++;b.childNodes[e]=a[0].childNodes[c]}d.colgroup=b;return b}else return null};this.GetSizeRow=function(b,h,f){var k=this.GetRowCount(b);if(k==0)return null;if(b.getAttribute("LayoutMode"))return null;var j=this.GetCell(h);if(j==null){if(h.getAttribute("FpSpread")=="rowpadding")if(f.clientY<3){var a=h.parentNode.rowIndex;if(a>1){var r=h.parentNode.parentNode.rows[a-1];if(this.GetSizable(b,r))return r}}var p=this.GetCorner(b);if(p!=null&&this.IsChild(h,p))if(f.clientY>h.offsetHeight-4){var c=null,a=0;c=this.GetRowHeader(b);if(c!=null){while(a<c.rows.length&&c.rows[a].offsetHeight<2&&!this.GetSizable(b,c.rows[a]))a++;if(a<c.rows.length&&this.GetSizable(b,c.rows[a])&&c.rows[a].offsetHeight<2)return c.rows[a]}}return null}var s=b.rowSpanCells,u=b.spanCells,g=this.IsChild(j,this.GetFrozRowHeader(b)),d=j;while(d!=null&&d!=document.documentElement){if(d.getAttribute("FpSpread")=="rh"){var a=-1,n=$$(d).offset().top,t=n+d.offsetHeight;if(f.pageY<n+3){if(d.rowIndex>1)a=d.rowIndex-1;else if(d.rowIndex==0&&!g&&this.GetFrozRowHeader(b)!=null){g=true;a=d.frzRows-1}}else if(f.pageY>t-4){var m=this.GetSpanCell(this.GetRowFromCell(b,j),this.GetColFromCell(b,j),s);if(m!=null)for(var c=g?this.GetFrozRowHeader(b):this.GetRowHeader(b),i=n,q=m.row-(g?0:b.frzRows),l=q;l<q+m.rowCount;l++){i+=parseInt(c.rows[l].style.height);if(f.pageY>i-3&&f.pageY<i+3){a=l;break}}else if(d.rowIndex>=0)a=d.rowIndex}else break;var i=0,k=this.GetRowHeader(b).rows.length;if(g)k=this.GetFrozRowHeader(b).rows.length;var o=true,c=g?this.GetFrozRowHeader(b):this.GetRowHeader(b),e=a+1;while(e<k){if(c.rows[e].style.height!=null)i=parseInt(c.rows[e].style.height);else i=parseInt(c.rows[e].offsetHeight);if(i>1){o=false;break}e++}if(o){e=a+1;while(e<k){if(this.GetSizable(b,this.GetRowHeader(b).rows[e])){a=e;break}e++}}if(a>=0&&this.GetSizable(b,c.rows[a]))return c.rows[a];else if(f.pageY<3){while(a>0&&c.rows[a].offsetHeight==0&&!this.GetSizable(b,c.rows[a]))a--;return a>=0&&this.GetSizable(b,c.rows[a])?c.rows[a]:null}}d=d.parentNode}return null};this.GetElementById=function(c,b){if(c==null)return null;var a=c.firstChild;while(a!=null){if(a.id==b||typeof a.getAttribute=="function"&&a.getAttribute("name")==b)return a;var d=this.GetElementById(a,b);if(d!=null)return d;a=a.nextSibling}return null};this.GetSizable=function(c,a){if(typeof a=="number"){var b=null;if(a<c.frzCols)b=this.GetElementById(this.GetFrozColHeader(c),c.id+"col"+a);else b=this.GetElementById(this.GetColHeader(c),c.id+"col"+a);return b!=null&&(b.getAttribute("Sizable")==null||b.getAttribute("Sizable")=="True")}return a!=null&&(a.getAttribute("Sizable")==null||a.getAttribute("Sizable")=="True")};this.GetSpanWidth=function(g,b,f){var e=0,d=this.GetViewport(g);if(d!=null){var c=this.GetColGroup(d);if(c!=null)for(var a=b;a<b+f;a++)e+=parseInt(c.childNodes[a].width)}return e};this.GetCellType=function(a){if(a!=null&&a.getAttribute("FpCellType")!=null)return a.getAttribute("FpCellType");if(a!=null&&a.getAttribute("FpRef")!=null){var b=document.getElementById(a.getAttribute("FpRef"));return b.getAttribute("FpCellType")}return a!=null&&a.getAttribute("FpCellType")!=null?a.getAttribute("FpCellType"):"text"};this.GetCellType2=function(a){if(a!=null&&a.getAttribute("FpRef")!=null)a=document.getElementById(a.getAttribute("FpRef"));var b=null;if(a!=null){b=a.getAttribute("FpCellType");if(b=="readonly")b=a.getAttribute("CellType");if(b==null)b=a.getAttribute("CellType2")}return b!=null?b:"text"};this.GetCellEditorID=function(b,a){if(a!=null&&a.getAttribute("FpRef")!=null){var c=document.getElementById(a.getAttribute("FpRef"));return c.getAttribute("FpEditorID")}return a.getAttribute("FpEditorID")!=null?a.getAttribute("FpEditorID"):b.getAttribute("FpDefaultEditorID")};this.EditorMap=function(a,b){this.id=a;this.editor=b};this.ValidatorMap=function(a,b){this.id=a;this.validator=b};this.GetCellEditor=function(f,b,e){for(var a=null,c=0;c<this.editorList.length;c++){var d=this.editorList[c];if(d.id==b){a=d.editor;break}}if(a==null){a=document.getElementById(b);this.editorList[this.editorList.length]=new this.EditorMap(b,a)}return e?a:a.cloneNode(true)};this.GetCellValidatorID=function(){return null};this.GetCellValidator=function(){return null};this.GetTableRow=function(d,e){var c=this.GetData(d).getElementsByTagName("root")[0],b=c.getElementsByTagName("data")[0],a=b.firstChild;while(a!=null){if(a.getAttribute("key")==""+e)return a;a=a.nextSibling}return null};this.GetTableCell=function(b,c){if(b==null)return null;var a=b.firstChild;while(a!=null){if(a.getAttribute("key")==""+c)return a;a=a.nextSibling}return null};this.AddTableRow=function(b,c){if(c==null)return null;var a=this.GetTableRow(b,c);if(a!=null)return a;var e=this.GetData(b).getElementsByTagName("root")[0],d=e.getElementsByTagName("data")[0];if(document.all!=null)a=this.GetData(b).createNode("element","row","");else{a=document.createElement("row");a.style.display="none"}a.setAttribute("key",c);d.appendChild(a);return a};this.AddTableCell=function(b,c){if(b==null)return null;var a=this.GetTableCell(b,c);if(a!=null)return a;if(document.all!=null)a=this.GetData(ss).createNode("element","cell","");else{a=document.createElement("cell");a.style.display="none"}a.setAttribute("key",c);b.appendChild(a);return a};this.GetCellValue=function(a,b){if(b==null)return null;var e=this.GetRowKeyFromCell(a,b),d=a.getAttribute("LayoutMode")?this.GetColKeyFromCell2(a,b):this.GetColKeyFromCell(a,b),c=this.AddTableCell(this.AddTableRow(a,e),d);return c.innerHTML};this.HTMLEncode=function(c){var a=new String(c),b=new RegExp("&","g");a=a.replace(b,"&amp;");b=new RegExp("<","g");a=a.replace(b,"&lt;");b=new RegExp(">","g");a=a.replace(b,"&gt;");b=new RegExp('"',"g");a=a.replace(b,"&quot;");return a};this.HTMLDecode=function(c){var a=new String(c),b=new RegExp("&amp;","g");a=a.replace(b,"&");b=new RegExp("&lt;","g");a=a.replace(b,"<");b=new RegExp("&gt;","g");a=a.replace(b,">");b=new RegExp("&nbsp;","g");a=a.replace(b," ");b=new RegExp("&quot;","g");a=a.replace(b,'"');return a};this.SetCellValue=function(b,a,c,l,m){if(a==null)return;if(c==" ")a.setAttribute("whiteSpace","1");else a.removeAttribute("whiteSpace");a.getAttribute("specialValue")!=null&&a.removeAttribute("specialValue");if(c!=null&&c==""){var i=this.GetCellEditorID(b,a);if(i!=null){var h=this.GetCellEditor(b,i,true);h!=null&&h.tagName=="SELECT"&&a.setAttribute("specialValue","1")}}var k=this.GetCellType(a);if(k=="readonly"&&a.getAttribute("locked")=="true"&&a.getAttribute("CellType2")!="MutuallyExclusiveCheckBoxCellType")return;var g=this.GetRowKeyFromCell(b,a),f=b.getAttribute("LayoutMode")?this.GetColKeyFromCell2(b,a):this.GetColKeyFromCell(b,a);if(g==null||f==null)return;var j=this.AddTableCell(this.AddTableRow(b,g),f);c=$$.utils.htmlEncode(c,true);c=$$.utils.htmlEncode(c,true);j.innerHTML=c;if(!l){var e=this.CreateEvent("DataChanged");e.cell=a;e.cellValue=c;e.row=g;e.col=f;this.FireEvent(b,e)}var d=this.GetCmdBtn(b,"Update");d!=null&&d.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(d,false);d=this.GetCmdBtn(b,"Cancel");d!=null&&d.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(d,false);b.dirty=true;m&&this.UpdateValues(b)};this.GetSelectedRanges=function(d){var f=this.GetSelection(d),b=[],a=f.firstChild;while(a!=null){var c=new this.Range;this.GetRangeFromNode(d,a,c);var e=b.length;b.length=e+1;b[e]=c;a=a.nextSibling}return b};this.GetSelectedRange=function(c){var b=new this.Range,d=this.GetSelection(c),a=d.lastChild;a!=null&&this.GetRangeFromNode(c,a,b);return b};this.GetRangeFromNode=function(b,a,h){if(a==null||b==null||h==null)return;h.anchor=a.getAttribute("anchor")!=null;this.updateSelectionViewIndexes(b,a);var c,e;if(b.getAttribute("LayoutMode")){c=parseInt(a.getAttribute("rowIndex"));e=parseInt(a.getAttribute("colIndex"))}else{c=this.GetRowByKey(b,a.getAttribute("row"));e=this.GetColByKey(b,a.getAttribute("col"))}var d=parseInt(a.getAttribute("rowcount")),g=parseInt(a.getAttribute("colcount")),k=this.GetViewport(b);if(k!=null)for(var l=this.GetDisplayIndex(b,c),i=l;i<l+d;i++)if(this.IsChildSpreadRow(b,k,i))d--;var j;if(b.getAttribute("LayoutMode")){var m=parseInt(a.getAttribute("col"));if(m!=-1&&parseInt(a.getAttribute("row"))==-1&&d==-1){c=parseInt(a.getAttribute("row"));j=parseInt(a.getAttribute("rowIndex"))}}var f=null;if(c<0&&e<0&&d!=0&&g!=0)f="Table";else if(c<0&&e>=0&&g>0)f="Column";else if(e<0&&c>=0&&d>0)f="Row";else f="Cell";this.SetRange(h,f,c,e,d,g,j)};this.GetSelection=function(d){var a=this.GetData(d),b=a.getElementsByTagName("root")[0],e=b.getElementsByTagName("state")[0],c=e.getElementsByTagName("selection")[0];return c};this.GetRowKeyFromRow=function(b,c){if(c<0)return null;var a=null;if(c<b.frzRows){a=this.GetViewport0(b);if(a==null)a=this.GetViewport1(b)}else{a=this.GetViewport2(b);if(a==null)a=this.GetViewport(b)}if(c>=b.frzRows)c-=b.frzRows;return a.rows[c]==null?-1:a.rows[c].getAttribute("FpKey")};this.GetColKeyFromCol=function(b,c){if(c<0)return null;var a=null;if(c>=b.frzCols){a=this.GetViewport1(b);if(a==null)a=this.GetViewport(b);if(a==null)a=this.GetColHeader(b)}else{a=this.GetViewport0(b);if(a==null)a=this.GetViewport2(b);if(a==null)a=this.GetFrozColHeader(b)}if(c>=b.frzCols)c=c-b.frzCols;var d=this.GetColGroup(a);return d!=null&&c>=0&&c<d.childNodes.length?d.childNodes[c].getAttribute("FpCol"):null};this.GetRowKeyFromCell=function(c,a){return a.parentNode.getAttribute("FpKey")};this.GetColKeyFromCell=function(a,d){var b=this.GetColFromCell(a,d);if(b>=a.frzCols){vp=this.GetViewport(a);if(vp==null||!this.IsChild(d,vp))vp=this.GetViewport1(a);var c=this.GetColGroup(vp);if(c!=null&&b-a.frzCols>=0&&b-a.frzCols<c.childNodes.length)return c.childNodes[b-a.frzCols].getAttribute("FpCol")}else{vp=this.GetViewport0(a);if(vp==null||!this.IsChild(d,vp))vp=this.GetViewport2(a);var c=this.GetColGroup(vp);if(c!=null&&b>=0&&b<c.childNodes.length)return c.childNodes[b].getAttribute("FpCol")}};this.GetRowTemplateRowFromGroupCell=function(f,b,l){var n=this.GetColCount(f),h=this.GetColHeader(f);if((!f.allowGroup||l)&&h!=null)for(var g=0;g<h.rows.length;g++)for(var i=0;i<n;i++){var k=h.rows[g].cells[i],m=isNaN(b)?parseInt(b.getAttribute("col")):b;if(k!=null&&b!=null&&parseInt(k.getAttribute("col"))==m)return g}var d=this.GetViewport1(f);if(d!=null)for(var a=0;a<d.rows.length;a++)for(var c=0;c<d.rows[a].cells.length;c++){var j=isNaN(b)?parseInt(b.getAttribute("col")):b;if(parseInt(d.rows[a].cells[c].getAttribute("col"))==j&&d.rows[a].cells[c].getAttribute("group")==null)return parseInt(d.rows[a].getAttribute("FpKey"))}var e=this.GetViewport(f);if(e!=null)for(var a=0;a<e.rows.length;a++)for(var c=0;c<e.rows[a].cells.length;c++){var j=isNaN(b)?parseInt(b.getAttribute("col")):b;if(parseInt(e.rows[a].cells[c].getAttribute("col"))==j&&e.rows[a].cells[c].getAttribute("group")==null)return parseInt(e.rows[a].getAttribute("FpKey"))}return-1};this.GetRowTemplateRowFromGroupCell2=function(g,c){var d=this.GetViewport1(g);if(d!=null)for(var a=0;a<d.rows.length;a++)for(var b=0;b<d.rows[a].cells.length;b++){var f=isNaN(c)?parseInt(c.getAttribute("col")):c;if(parseInt(d.rows[a].cells[b].getAttribute("col"))==f&&d.rows[a].cells[b].getAttribute("group")==null)return parseInt(d.rows[a].getAttribute("FpKey"))}var e=this.GetViewport(g);if(e!=null)for(var a=0;a<e.rows.length;a++)for(var b=0;b<e.rows[a].cells.length;b++){var f=isNaN(c)?parseInt(c.getAttribute("col")):c;if(parseInt(e.rows[a].cells[b].getAttribute("col"))==f&&e.rows[a].cells[b].getAttribute("group")==null)return parseInt(e.rows[a].getAttribute("FpKey"))}return-1};this.GetColTemplateRowFromGroupCell=function(a,f){var h=this.GetColCount(a),b=this.GetColHeader(a),i=this.GetRowTemplateRowFromGroupCell(a,f),g=null;if(b==null)return-1;for(var d=0;d<b.rows.length;d++)for(var e=0;e<h;e++){var c=b.rows[d].cells[e];if(c!=null&&parseInt(c.getAttribute("col"))==f){g=c;break}}return this.GetColFromCell(a,g)};this.GetColKeyFromCell2=function(b,a){return!a?-1:a.getAttribute("col")?a.getAttribute("col")=="-1"?0:parseInt(a.getAttribute("col")):this.GetColKeyFromCell(b,a)};this.GetColKeyFromCol2=function(c,d,b){var a=this.GetCellFromRowCol(c,d,b);return a?this.GetColKeyFromCell2(c,a):b};this.GetCellByRowCol2=function(b,d,c){if(d==null||c==null||d.length<=0||d=="-1"||c.length<=0||c=="-1")return null;var e=this.GetRowByKey(b,d,-1);if(e==-1)return null;for(var i=b.getAttribute("LayoutMode")!=null?parseInt(b.getAttribute("LayoutRowCount")):1,g=e;g<e+i;g++)for(var h=this.getTableRows(b,g),a=0;a<h.length;a++)for(var f=h[a],a=0;a<f.cells.length;a++)if(f.cells[a].getAttribute("col")==c)return f.cells[a];return null};this.getTableRows=function(a,d){var e=[],b=[this.GetViewport0(a),this.GetViewport1(a)];if(d>=a.frzRows){d-=a.frzRows;b=[this.GetViewport2(a),this.GetViewport(a)]}for(var c=0;c<b.length;c++)b[c]!=null&&b[c].rows[d]!=null&&e.push(b[c].rows[d]);return e};this.GetRowTemplateRowFromCell=function(c,a){if(!a)return-1;try{var b;if(a.getAttribute("group")!=null)b=this.GetRowTemplateRowFromGroupCell(c,a);else b=parseInt(a.parentNode.getAttribute("row"));return b}catch(d){return-1}};this.PaintMultipleRowSelection=function(a,j,i,g,e,f){for(var l=this.GetRowCountInternal(a),k=this.GetColCount(a),h=true,b=j;b<l;b++){if(this.IsChildSpreadRow(a,this.GetViewport(a),b))continue;for(var d=null,c=i;c<i+e&&c<k;c++){if(this.IsCovered(a,b,c,a.spanCells))continue;d=this.GetCellFromRowCol(a,b,c,d);if(d!=null&&parseInt(d.parentNode.getAttribute("row"))==j){this.PaintViewportSelection(a,b,c,g,e,f);this.GetColHeader(a)!=null&&this.GetOperationMode(a)=="Normal"&&h&&this.PaintHeaderSelection(a,b,c,g,e,f,true);this.GetRowHeader(a)!=null&&this.PaintHeaderSelection(a,b,c,g,e,f,false);h=false}}}this.PaintAnchorCell(a)};this.GetFirstRowFromKey=function(c,b){var a=this.GetRowByKey(c,b,-1);return a>-1?a:null};this.GetFirstMultiRowFromViewport=function(a,g,i){var b=null,d=null;if(g<a.frzRows)b=this.GetViewport1(a);else b=this.GetViewport(a);if(!i){d=this.GetRowKeyFromRow(a,g);if(d!=null)return this.GetRowByKey(a,d,-1)}for(var h=parseInt(a.getAttribute("layoutrowcount")),f,c=0;c<b.rows.length;c++){f=0;if(d!=null){if(b.rows[c].getAttribute("FpKey")==d)return a.frzRows!=null&&g<a.frzRows?c:c+a.frzRows}else for(var e=c+1;e<b.rows.length;e++){if(b.rows[c]!=null&&b.rows[e]!=null&&b.rows[c].getAttribute("FpKey")==b.rows[e].getAttribute("FpKey"))f++;if(f==h-1)return c}}};this.GetRowFromViewPort=function(d,c,e){if(c<0||e<0)return null;var a=null;if(c<d.frzRows)a=this.GetViewport1(d);else a=this.GetViewport(d);if(c>=0&&c<a.rows.length)for(var b=0;b<a.rows.length;b++)if(a.rows[b].getAttribute("row")!=null&&parseInt(a.rows[b].getAttribute("row"))==c)return b;return 0};this.GetDisplayIndex2=function(c,b){if(b==null)return-1;if(!c.allowGroup)return b!=null?this.GetDisplayIndex(c,b):0;else{var e=this.GetViewport1(c);if(e!=null)for(var a=b;a<e.rows.length;a++)if(e.rows(a).getAttribute("row")==b)return a;var d=this.GetViewport(c);if(d!=null)for(var a=b;a<d.rows.length;a++){if(IsChildSpreadRow(d,a))continue;if(d.rows(a).getAttribute("row")==b)return a}}return-1};this.SetSelection=function(a,d,c,j,i,h,e,g){if(j==-1&&e!=null)e=-1;if(i==-1&&g!=null)g=-1;var f=d,l=g==null?c:g;if(d!=null&&parseInt(d)>=0){d=this.GetRowKeyFromRow(a,d);if(d!="newRow")d=parseInt(d)}if(c!=null&&parseInt(c)>=0)if(a.getAttribute("LayoutMode")){var m=f>-1?f:e;if(m>-1){var n=this.GetCellFromRowCol(a,m,l);if(n&&n.getAttribute("col")!="-1")c=parseInt(this.GetColKeyFromCol2(a,f,c));else c=-1}}else c=parseInt(this.GetColKeyFromCol(a,c));if(a.getAttribute("LayoutMode")&&e!=null)f=e;var k=this.GetSelection(a);if(k==null)return;if(h==null)h=a.getAttribute("multiRange")=="true"&&!this.working;var b=k.lastChild;if(b==null||h){if(document.all!=null)b=this.GetData(a).createNode("element","range","");else{b=document.createElement("range");b.style.display="none"}k.appendChild(b)}b.setAttribute("row",d);b.setAttribute("col",c);b.setAttribute("rowcount",j);b.setAttribute("colcount",i);b.setAttribute("rowIndex",f);b.setAttribute("colIndex",l);(j>1||i>1)&&b.removeAttribute("anchor");a.dirty=true;this.inactiveAllChart(a);this.PaintFocusRect(a);var o=this.GetCmdBtn(a,"Update");this.UpdateCmdBtnState(o,false);var p=this.CreateEvent("SelectionChanged");this.FireEvent(a,p)};this.CreateSelectionNode=function(h,g,f,d,b,e,c){var a=document.createElement("range");a.style.display="none";a.setAttribute("row",g);a.setAttribute("col",f);a.setAttribute("rowcount",d);a.setAttribute("colcount",b);a.setAttribute("rowIndex",e);a.setAttribute("colIndex",c);return a};this.AddRowToSelection=function(b,f,a){var c=this.GetOperationMode(b);if(b.getAttribute("LayoutMode")&&(c=="ExtendedSelect"||c=="MultiSelect"))return;var d=a;if(typeof a!="undefined"&&parseInt(a)>=0){a=this.GetRowKeyFromRow(b,a);if(a!="newRow")a=parseInt(a)}if(!this.IsRowSelected(b,a)&&!isNaN(a)){var e=this.CreateSelectionNode(b,a,-1,1,-1,d,-1);f.appendChild(e)}};this.RemoveSelection=function(a,h){var e=this.GetSelection(a);if(e==null)return;var b=e.firstChild;while(b!=null){var c,f,d=this.GetOperationMode(a);if(a.getAttribute("LayoutMode")&&(d=="ExtendedSelect"||d=="MultiSelect")){var j=parseInt(b.getAttribute("row"));c=this.GetFirstRowFromKey(a,j)}else c=parseInt(b.getAttribute("rowIndex"));if(a.getAttribute("LayoutMode")&&(d=="ExtendedSelect"||d=="MultiSelect"))f=parseInt(a.getAttribute("layoutrowcount"));else f=parseInt(b.getAttribute("rowcount"));if(c<=h&&h<c+f){e.removeChild(b);for(var g=c;g<c+f;g++)g!=h&&this.AddRowToSelection(a,e,g);break}b=b.nextSibling}a.dirty=true;var i=this.GetCmdBtn(a,"Update");this.UpdateCmdBtnState(i,false);var k=this.CreateEvent("SelectionChanged");this.FireEvent(a,k)};this.updateSelectionViewIndexes=function(b,d){if(d.getAttribute("rowIndex")==null||d.getAttribute("colIndex")==null){var a=d.getAttribute("row"),g=parseInt(d.getAttribute("col")),f=a==-1?-1:null,e=g==-1?-1:null;if(b.getAttribute("LayoutMode")){var c=null;if(g>-1)if(a=="newRow"||parseInt(a)>-1){c=this.GetCellByRowCol2(b,a,g);if(c){f=this.GetRowFromCell(b,c);e=this.GetColFromCell(b,c)}}else{c=this.getFirstCellFromCol(b,d.getAttribute("col"));if(c)e=this.GetColFromCell(b,c)}else if(a=="newRow"||parseInt(a)>-1)f=this.GetFirstRowFromKey(b,a)}else{if(a=="newRow"||parseInt(a)>-1)f=this.GetRowByKey(b,a,-1);if(g>-1)e=this.GetColByKey(b,g,-1)}f!=null&&d.setAttribute("rowIndex",f);e!=null&&d.setAttribute("colIndex",e)}};this.GetColInfo=function(e,g){var b=this.GetData(e),c=b.getElementsByTagName("root")[0],f=c.getElementsByTagName("state")[0],d=f.getElementsByTagName("colinfo")[0],a=d.firstChild;while(a!=null){if(a.getAttribute("key")==""+g)return a;a=a.nextSibling}return null};this.GetColWidthFromCol=function(b,c){if(c<0)return 0;if(c<b.frzCols){var a=this.GetColGroup(b.viewport0);if(a==null||a.childNodes.length==0)a=GetColGroup(this.GetViewport2(b));if(a==null||a.childNodes.length==0)a=GetColGroup(this.GetFrozColHeader(b));return a!=null&&c<a.childNodes.length?parseInt(a.childNodes[c].width):0}else{var a=this.GetColGroup(b.viewport1);if(a==null||a.childNodes.length==0)a=this.GetColGroup(this.GetViewport(b));if(a==null||a.childNodes.length==0)a=this.GetColGroup(this.GetColHeader(b));return a!=null&&c-b.frzCols<a.childNodes.length?parseInt(a.childNodes[c-b.frzCols].width):0}};this.GetColWidth=function(a){if(a==null)return null;var b=a.getElementsByTagName("width")[0];return b!=null?b.innerHTML:0};this.AddColInfo=function(b,c){var a=this.GetColInfo(b,c);if(a!=null)return a;var d=this.GetData(b),e=d.getElementsByTagName("root")[0],g=e.getElementsByTagName("state")[0],f=g.getElementsByTagName("colinfo")[0];if(document.all!=null)a=this.GetData(b).createNode("element","col","");else{a=document.createElement("col");a.style.display="none"}a.setAttribute("key",c);f.appendChild(a);return a};this.SetColWidth=function(a,d,b,e){if(d==null)return;d=parseInt(d);if(b<10)b=10;var p=this.IsXHTML(a),f=null;if(d<a.frzCols){if(this.GetViewport0(a)!=null){var c=this.GetColGroup(this.GetViewport0(a));if(c==null||c.childNodes.length==0)c=this.GetColGroup(this.GetFrozColHeader(a));f=this.AddColInfo(a,c.childNodes[d].getAttribute("FpCol"));if(b==0)b=1;if(c!=null){if(e==null)e=c.childNodes[d].width;c.childNodes[d].width=b}this.SetWidthFix(this.GetViewport0(a),d,b)}if(this.GetFrozColFooter(a)!=null){var c=this.GetColGroup(this.GetFrozColFooter(a));if(c==null||c.childNodes.length==0)c=this.GetColGroup(this.GetFrozColHeader(a));if(b==0)b=1;if(c!=null){if(e==null)e=c.childNodes[d].width;c.childNodes[d].width=b}this.SetWidthFix(this.GetFrozColFooter(a),d,b)}if(this.GetViewport2(a)!=null){var c=this.GetColGroup(this.GetViewport2(a));if(c==null||c.childNodes.length==0)c=this.GetColGroup(this.GetFrozColHeader(a));f=this.AddColInfo(a,c.childNodes[d].getAttribute("FpCol"));if(b==0)b=1;if(c!=null){if(e==null)e=c.childNodes[d].width;c.childNodes[d].width=b}this.SetWidthFix(this.GetViewport2(a),d,b)}if(this.GetFrozColHeader(a)!=null){var h=parseInt(this.GetFrozColHeader(a).parentNode.parentNode.style.width);this.GetFrozColHeader(a).parentNode.parentNode.style.width=h+b-e+"px";if(this.GetViewport(a)!=null)if(this.GetViewport(a).cellSpacing=="0"&&this.GetColCount(a)>1&&this.GetViewport(a).rules!="rows")if(p)if(d==this.colCount-1)b-=1;if(b<=0)b=1;document.getElementById(a.id+"col"+d).width=b;this.SetWidthFix(this.GetFrozColHeader(a),d,b);if(this.GetViewport(a)!=null)if(this.GetViewport(a).cellSpacing=="0"&&this.GetColCount(a)>1&&this.GetViewport(a).rules!="rows")if(d==this.GetColCount(a)-1)b+=1}}else{if(this.GetViewport1(a)!=null){var c=this.GetColGroup(this.GetViewport1(a));if(c==null||c.childNodes.length==0)c=this.GetColGroup(this.GetColHeader(a));f=this.AddColInfo(a,c.childNodes[d-a.frzCols].getAttribute("FpCol"));if(this.GetViewport1(a).cellSpacing=="0"&&this.GetColCount(a)>1&&this.GetViewport1(a).rules!="rows")if(d==0)b-=1;if(b==0)b=1;if(c!=null)c.childNodes[d-a.frzCols].width=b;if(d==0)c.childNodes[0].width=b-1;this.SetWidthFix(this.GetViewport1(a),d-a.frzCols,b);var o=this.GetColHeader(a),j=this.GetColGroup(this.GetViewport(a)),l=this.GetColGroup(o);if(j!=null&&j.childNodes.length>0&&l!=null&&l.childNodes.length>0){c=this.GetColGroup(this.GetColHeader(a));if(c!=null){var k=b;if(d==a.frzCols&&a.frzCols>0)k=b+j.childNodes[0].offsetLeft;c.childNodes[d-a.frzCols].width=k}}this.SetWidthFix(this.GetColHeader(a),d-a.frzCols,b)}if(this.GetViewport(a)!=null){var c=this.GetColGroup(this.GetViewport(a));if(c==null||c.childNodes.length==0)c=this.GetColGroup(this.GetColHeader(a));f=this.AddColInfo(a,c.childNodes[d-a.frzCols].getAttribute("FpCol"));if(this.GetViewport(a).cellSpacing=="0"&&this.GetColCount(a)>1&&this.GetViewport(a).rules!="rows")if(d==0)b-=1;if(b==0)b=1;if(c!=null)c.childNodes[d-a.frzCols].width=b;this.SetWidthFix(this.GetViewport(a),d-a.frzCols,b)}if(this.GetColHeader(a)!=null){if(this.GetViewport(a)!=null)if(this.GetViewport(a).cellSpacing=="0"&&this.GetColCount(a)>1&&this.GetViewport(a).rules!="rows"){if(d==a.frzCols&&a.frzCols>0)b-=1;if(d==this.colCount-1)b-=1}if(b<=0)b=1;document.getElementById(a.id+"col"+d).width=b;this.SetWidthFix(this.GetColHeader(a),d-a.frzCols,b);if(this.GetViewport(a)!=null)if(this.GetViewport(a).cellSpacing=="0"&&this.GetColCount(a)>1&&this.GetViewport(a).rules!="rows")if(d==this.GetColCount(a)-1)b+=1}if(this.GetColFooter(a)!=null){var c=this.GetColGroup(this.GetColFooter(a));if(c==null||c.childNodes.length==0)c=this.GetColGroup(this.GetColHeader(a));f=this.AddColInfo(a,c.childNodes[d-a.frzCols].getAttribute("FpCol"));if(this.GetColFooter(a).cellSpacing=="0"&&this.GetColCount(a)>1&&this.GetColFooter(a).rules!="rows")if(d==0)b-=1;if(b==0)b=1;if(c!=null)c.childNodes[d-a.frzCols].width=b;this.SetWidthFix(this.GetColFooter(a),d-a.frzCols,b)}}var n=this.GetTopSpread(a);this.SizeAll(n);this.Refresh(n);if(d<a.frzCols&&this.GetFrozColHeader(a)!=null){var h=parseInt(this.GetFrozColHeader(a).parentNode.parentNode.style.width);this.GetFrozColHeader(a).parentNode.parentNode.style.width=h+b-e+"px";var i=this.GetColGroup(this.GetTopTable(a));if(i!=null){var q=this.GetFrozColHeader(a).parentNode.parentNode.cellIndex,h=parseInt(i.childNodes[1].width),r=this.GetRowHeader(a);if(r==null&&isNaN(h))h=parseInt(i.childNodes[0].width);i.childNodes[q].width=h+b-e+"px"}}if(f!=null){var g=f.getElementsByTagName("width");if(g!=null&&g.length>0)g[0].innerHTML=b;else{if(document.all!=null)g=this.GetData(a).createNode("element","width","");else{g=document.createElement("width");g.style.display="none"}f.appendChild(g);g.innerHTML=b}}var m=this.GetCmdBtn(a,"Update");m!=null&&this.UpdateCmdBtnState(m,false);a.dirty=true};this.SetWidthFix=function(a,g,f){if(a==null||a.rows.length==0)return;var e=0,d=0,c=a.rows[0].cells[0],b=c.colSpan;if(b==null)b=1;while(g>=d+b){e++;d=d+b;c=a.rows[0].cells[e];b=c.colSpan;if(b==null)b=1}c.width=f;if(a.rules=="all"&&!a.refreshingRules){a.refreshingRules=true;a.rules="";var h=Function.CreateCallback(function(){var a=arguments[arguments.length-1];a.rules="all";a.refreshingRules=false},a);setTimeout(h,10)}};this.GetRowInfo=function(e,g){var b=this.GetData(e),c=b.getElementsByTagName("root")[0],f=c.getElementsByTagName("state")[0],d=f.getElementsByTagName("rowinfo")[0],a=d.firstChild;while(a!=null){if(a.getAttribute("key")==""+g)return a;a=a.nextSibling}return null};this.GetRowHeight=function(b){if(b==null)return null;var a=b.getElementsByTagName("height");return a!=null&&a.length>0?a[0].innerHTML:0};this.AddRowInfo=function(b,c){var a=this.GetRowInfo(b,c);if(a!=null)return a;var d=this.GetData(b),e=d.getElementsByTagName("root")[0],g=e.getElementsByTagName("state")[0],f=g.getElementsByTagName("rowinfo")[0];if(document.all!=null)a=this.GetData(b).createNode("element","row","");else{a=document.createElement("row");a.style.display="none"}a.setAttribute("key",c);f.appendChild(a);return a};this.GetTopSpread=function(c){if(c==null)return null;var b=this.GetSpread(c);if(b==null)return null;var a=b.parentNode;while(a!=null&&a.tagName!="BODY"){if(a.getAttribute("FpSpread")=="Spread")if(a.getAttribute("hierView")=="true")b=a;else break;a=a.parentNode}return b};this.GetParentSpread=function(b){if(b.getAttribute("hostspread")!=null)return null;var c=b.getAttribute("parentSpread");if(c!=null)return c.length<=0?null:document.getElementById(c);else try{var a=b.parentNode;while(a!=null&&a!=document&&a.getAttribute("FpSpread")!="Spread")a=a.parentNode;if(a!=null&&a!=document&&a.getAttribute("hierView")=="true"){b.setAttribute("parentSpread",a.id);return a}else{b.setAttribute("parentSpread","");return null}}catch(d){b.setAttribute("parentSpread","");return null}};this.SetRowHeight=function(c,b,d){if(b==null)return;var a=b.getElementsByTagName("height");if(a!=null&&a.length>0)a[0].innerHTML=d;else{if(document.all!=null)a=this.GetData(c).createNode("element","height","");else{a=document.createElement("height");a.style.display="none"}b.appendChild(a);a.innerHTML=d}var e=this.GetCmdBtn(c,"Update");e!=null&&this.UpdateCmdBtnState(e,false);c.dirty=true};this.getSingleNode=function(g,f){for(var e=f.split("/"),c=g,d=0;d<e.length;d++){var b=e[d].trim().toLowerCase();if(b=="/"||b=="")continue;var a=c.firstChild;while(a!=null&&a.tagName.toLowerCase()!=b)a=a.nextSibling;if(a!=null&&a.tagName.toLowerCase()==b)c=a;else return null}return c};this.findAnchorCell=function(a){var n=this.GetData(a),h=this.getSingleNode(n,"/root/state/activerow"),g=this.getSingleNode(n,"/root/state/activecolumn"),b=h!=null?parseInt(h.innerHTML):-1,c=g!=null?parseInt(g.innerHTML):-1;if(this.GetSelection(a).childNodes.length==0||b>-1&&c>-1){var d=null;if(b==-1&&c===-1)return null;else if(a.getAttribute("LayoutMode")){if(c>-1){if(b>-1)d=this.GetCellByRowCol2(a,h.innerHTML,g.innerHTML);if(d==null)d=this.getFirstCellFromCol(a,g.innerHTML)}if(d==null){b=this.GetFirstRowFromKey(a,b);if(b==null)b=0;for(var r=parseInt(a.getAttribute("LayoutRowCount")),q=this.GetColCount(a),p=false,e=b;e<b+r;e++){for(var m=0;m<q;m++){d=this.GetCellFromRowCol(a,e,m);if(d!=null){p=true;break}}if(p)break}}}else{b=h!=null&&b!=-1?this.GetRowByKey(a,h.innerHTML,0):0;c=g!=null&&c!=-1?this.GetColByKey(a,g.innerHTML,0):0;d=this.GetCellFromRowCol(a,b,c)}if(d!=null&&d.getAttribute("canFocus")=="false"){b=this.GetRowFromCell(a,d);c=this.GetColFromCell(a,d);var k=this.moveRightInternal(a,b,c,false);if(k!=null)d=this.GetCellFromRowCol(a,k.row,k.col)}d!=null&&this.saveAnchorCell(a,d);return d}else if(b<=-1&&c>-1||b>-1&&c<=-1)if(b<=-1&&c>-1){var j=c>=a.frzCols?this.GetColHeader(a):this.GetFrozColHeader(a);if(j){b=j.rows.length+b;if(b>=0&&b<j.rows.length)for(var f=j.rows[b],e=0;e<f.cells.length;e++)if(f.cells[e].getAttribute("col")!=null&&parseInt(f.cells[e].getAttribute("col"))==c)return f.cells[e];for(var l=this.GetColGroup(j),e=0;e<l.childNodes.length;e++)if(l.childNodes[e].getAttribute("FpCol")!=null&&parseInt(l.childNodes[e].getAttribute("FpCol"))==c)return f.cells[e]}}else{var i=this.GetRowByKey(a,b,-1),o=i>=a.frzRows?this.GetRowHeader(a):this.GetFrozRowHeader(a);if(o&&i>=0){if(i>=a.frzRows)i-=a.frzRows;var f=o.rows[i];c=f.cells.length+c;return f.cells[c]}}return null};this.saveAnchorCell=function(b,a){if(a==null)return;var c=a.parentNode.getAttribute("FpSpread");if(c=="r"||c=="rh"||c=="ch"){var g=null,d=null;if(c=="r"||c=="ch")if(a.getAttribute("col")!=null&&a.getAttribute("col")!="-1")d=parseInt(a.getAttribute("col"));else if(a.getAttribute("col")==null){var e=this.GetColFromCell(b,a);if(e>=b.frzCols)e=e-b.frzCols;var h=this.GetColGroup(a.parentNode.parentNode.parentNode);if(h.childNodes.length>e&&h.childNodes[e].getAttribute("FpCol")!=null)d=parseInt(h.childNodes[e].getAttribute("FpCol"))}else d=0;else{d=-1;for(var f=a.parentNode.cells.length-1;f>=0;f--){if(f==a.cellIndex)break;d--}}if(c=="r"||c=="rh")g=this.GetRowKeyFromCell(b,a);else{g=-1;for(var i=a.parentNode.parentNode.parentNode,f=i.rows.length-1;f>=0;f--){if(f==a.parentNode.rowIndex)break;g--}}if(g!=null&&d!=null){this.SetActiveRow(b,g);this.SetActiveCol(b,d)}}else if(this.IsChild(a,this.GetCorner(b))){this.SetActiveRow(b,-1);this.SetActiveCol(b,-1)}};this.SetActiveRow=function(a,d){if(this.GetRowCount(a)<1)return;if(d==null)d=-1;var e=this.GetData(a),f=e.getElementsByTagName("root")[0],g=f.getElementsByTagName("state")[0],c=g.firstChild;while(c!=null&&c.tagName!="activerow"&&c.tagName!="ACTIVEROW")c=c.nextSibling;if(c!=null)c.innerHTML=""+d;if(d!=null&&a.getAttribute("IsNewRow")!="true"&&a.getAttribute("AllowInsert")=="true"){var b=this.GetCmdBtn(a,"Insert");this.UpdateCmdBtnState(b,false);b=this.GetCmdBtn(a,"Add");this.UpdateCmdBtnState(b,false)}else{var b=this.GetCmdBtn(a,"Insert");this.UpdateCmdBtnState(b,true);b=this.GetCmdBtn(a,"Add");this.UpdateCmdBtnState(b,true)}if(d!=null&&a.getAttribute("IsNewRow")!="true"&&(a.getAttribute("AllowDelete")==null||a.getAttribute("AllowDelete")=="true")){var b=this.GetCmdBtn(a,"Delete");this.UpdateCmdBtnState(b,d==-1)}else{var b=this.GetCmdBtn(a,"Delete");this.UpdateCmdBtnState(b,true)}a.dirty=true};this.SetActiveCol=function(b,e){var c=this.GetData(b),d=c.getElementsByTagName("root")[0],f=d.getElementsByTagName("state")[0],a=f.firstChild;while(a!=null&&a.tagName!="activecolumn"&&a.tagName!="ACTIVECOLUMN")a=a.nextSibling;if(a!=null)a.innerHTML=""+parseInt(e);b.dirty=true};this.getTextElement=function(a){if(a.tagName.toUpperCase()=="INPUT"&&a.type=="text"||a.tagName.toUpperCase()=="TEXTAREA")return a;for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(!c.tagName)continue;var d=this.getTextElement(c);if(d!=null)return d}return null};this.GetEditor=function(d){if(d==null)return null;var e=this.GetCellType(d);if(e=="readonly")return null;var a=d.getElementsByTagName("DIV");if(a!=null&&a.length>0&&!a[0].select){var c=this.getTextElement(a[0]);if(c!=null&&c.select){a[0].select=Function.CreateDelegate(c,c.select);if(!c.getValue)c.getValue=function(){return this.value};if(!c.setValue)c.setValue=function(a){this.value=a};a[0].getValue=Function.CreateDelegate(c,c.getValue);a[0].setValue=Function.CreateDelegate(c,c.setValue)}}if(e=="MultiColumnComboBoxCellType"||e=="ExtenderCellType")if(a!=null&&a.length>0){var b=a[0];b.type="div";return b}a=d.getElementsByTagName("INPUT");if(a!=null&&a.length>0){var b=a[0];while(b!=null&&b.getAttribute&&b.getAttribute("FpEditor")==null)b=b.parentNode;if(b!=null&&!b.getAttribute)b=null;return b}a=d.getElementsByTagName("SELECT");if(a!=null&&a.length>0)return a[0];a=d.getElementsByTagName("TEXTAREA");if(a!=null&&a.length>0){var b=a[0];if(e=="text")return b}return null};this.GetPageActiveSpread=function(){var a=document.documentElement.getAttribute("FpActiveSpread"),b=null;if(a!=null)b=document.getElementById(a);return b};this.GetPageActiveSheetView=function(){var a=document.documentElement.getAttribute("FpActiveSheetView"),b=null;if(a!=null)b=document.getElementById(a);return b};this.SetPageActiveSpread=function(a){var b=this.GetPageActiveSpread();if(b!=null&&b!=a)b.isactive=false;if(a==null)document.documentElement.setAttribute("FpActiveSpread",null);else{a.isactive=true;var c=this.GetTopSpread(a);c.lastActiveSpreadId=a.id;document.documentElement.setAttribute("FpActiveSpread",a.id);document.documentElement.setAttribute("FpActiveSheetView",a.id)}};this.getLastActiveSpread=function(c){var a=this.GetTopSpread(c);if(a==null)return null;var b=a.lastActiveSpreadId;return b?document.getElementById(b):null};this.DoResize=function(){if(the_fpSpread.spreads==null)return;for(var b=the_fpSpread.spreads.length,a=0;a<b;a++)the_fpSpread.spreads[a]!=null&&the_fpSpread.SizeSpread(the_fpSpread.spreads[a])};this.DblClick=function(d){var a=this.GetCell(this.GetTarget(d),true,d),b=this.GetSpread(a);if(a!=null&&!this.IsHeaderCell(a)&&this.GetOperationMode(b)=="RowMode"&&this.GetEnableRowEditTemplate(b)=="true"&&!b.getAttribute("LayoutMode")){var c=a.getElementsByTagName("DIV");if(c!=null&&c.length>0&&c[0].id==b.id+"_RowEditTemplateContainer")return;this.Edit(b,this.GetRowKeyFromCell(b,a));var e=this.GetCmdBtn(b,"Cancel");e!=null&&this.UpdateCmdBtnState(e,false);return}if(a!=null&&!this.IsHeaderCell(a)&&a==b.anchorCell)!(a.getAttribute("canFocus")=="false")&&this.StartEdit(b,a)};this.GetEvent=function(a){return a!=null?a:window.event};this.GetTarget=function(a){a=this.GetEvent(a);if(a.target==document){if(a.currentTarget==document)return a.explicitOriginalTarget;if(a.currentTarget!=null)return a.currentTarget}return a.target!=null?a.target:a.srcElement};this.StartEdit=function(b,x,k){var r=this.GetOperationMode(b);if(r=="SingleSelect"||r=="ReadOnly"||this.editing)return;if(r=="RowMode"&&this.GetEnableRowEditTemplate(b)=="true"&&!b.getAttribute("LayoutMode"))return;var a=x;if(a==null)a=b.anchorCell;if(a==null)return;var t=a.offsetHeight;if(this.IsHeaderCell(b,a))return;this.renderAsEditor=-1;var m=this.GetEditor(a);if(m!=null){this.editing=true;this.editor=m;this.renderAsEditor=1}var y=this.IsXHTML(b);if(a!=null){var z=this.GetRowFromCell(b,a),v=this.GetColFromCell(b,a),g=this.CreateEvent("EditStart");g.cell=a;g.row=this.GetSheetIndex(b,z);g.col=v;g.cancel=false;this.FireEvent(b,g);if(g.cancel)return;var w=this.GetCellType(a);if(w=="readonly")return;if(b.anchorCell!=a){b.anchorCell=a;this.SetActiveRow(b,this.GetRowKeyFromCell(b,a));this.SetActiveCol(b,b.getAttribute("LayoutMode")?this.GetColKeyFromCell2(a):this.GetColKeyFromCell(b,a))}if(m==null){var n=this.GetCellEditorID(b,a);if(n!=null&&n.length>0){this.editor=this.GetCellEditor(b,n,true);if(!this.editor.getAttribute("MccbId")&&!this.editor.getAttribute("Extenders"))this.editor.style.display="inline";else this.editor.style.display="block"}else{this.editor=document.createElement("INPUT");this.editor.type="text"}var e=this.GetRender(a),f=this.GetValueFromRender(b,e);if(this.imeStat&&this.editor.style.imeMode!="disabled"&&this.editor.style.imeMode!="inactive"){var p=document.getElementById(b.id+"_textBox");if(p!=null&&p.value!="")f+=p.value;this.imeStat=false}this.editingValue=f;this.editingFormula=this.GetFormulaFromCell(a);if(this.editingFormula!=null)f=this.editingFormula;try{if(e!=a)e.style.display="none";else e.innerHTML=""}catch(g){return}this.editor.style.fontFamily=e.style.fontFamily;this.editor.style.fontSize=e.style.fontSize;this.editor.style.fontWeight=e.style.fontWeight;this.editor.style.fontStyle=e.style.fontStyle;this.editor.style.textDecoration=e.style.textDecoration;this.editor.style.position="";if(y){var h=a.clientWidth-2,c=parseInt(a.style.paddingLeft);if(!isNaN(c))h-=c;else if(document.defaultView!=null&&document.defaultView.getComputedStyle!=null){c=parseInt(document.defaultView.getComputedStyle(a,"").getPropertyValue("padding-Left"));if(!isNaN(c))h-=c}c=parseInt(a.style.paddingRight);if(!isNaN(c))h-=c;else if(document.defaultView!=null&&document.defaultView.getComputedStyle!=null){c=parseInt(document.defaultView.getComputedStyle(a,"").getPropertyValue("padding-Right"));if(!isNaN(c))h-=c}this.editor.style.width=""+h+"px"}else this.editor.style.width=a.clientWidth-2;this.SaveMargin(a);if(this.editor.tagName=="TEXTAREA"){var o=t;if(document.defaultView!=null&&document.defaultView.getComputedStyle!=null){var c=parseInt(document.defaultView.getComputedStyle(a,"").getPropertyValue("padding-top"));if(!isNaN(c))o-=c;c=parseInt(document.defaultView.getComputedStyle(a,"").getPropertyValue("padding-bottom"));if(!isNaN(c))o-=c}this.editor.style.height=""+Math.max(o-4,1)+"px"}if(this.editor.tagName=="INPUT"&&this.editor.type=="text"||this.editor.tagName=="TEXTAREA"){if(this.editor.style.backgroundColor==""||this.editor.backColorSet!=null){var q="";if(document.defaultView!=null&&document.defaultView.getComputedStyle!=null)q=document.defaultView.getComputedStyle(a,"").getPropertyValue("background-color");if(q!="")this.editor.style.backgroundColor=q;else this.editor.style.backgroundColor=a.bgColor;this.editor.backColorSet=true}if(this.editor.style.color==""||this.editor.colorSet!=null){var u="";if(document.defaultView!=null&&document.defaultView.getComputedStyle!=null)u=document.defaultView.getComputedStyle(a,"").getPropertyValue("color");this.editor.style.color=u;this.editor.colorSet=true}if(v==0){var s=b.frzRows==0&&b.frzCols==0&&this.GetTopSpread(b).getAttribute("hierView")!="true";if(b.getAttribute("showFocusRect")=="false")s=false;this.editor.style.padding=s?"1px":"0px"}else this.editor.style.padding="";this.editor.style.borderWidth="0px";this.RestoreMargin(this.editor,false)}this.renderAsEditor=0;a.insertBefore(this.editor,a.firstChild);this.SetEditorValue(this.editor,f,b);if(this.editor.tagName=="SELECT"){this.editorSelectedIndex=this.editor.selectedIndex;if(f==null||f==""&&a.getAttribute("specialValue")==null)this.editor.selectedIndex=this.editorSelectedIndex=-1}if(this.editor.offsetHeight<a.clientHeight&&this.editor.tagName!="TEXTAREA")if(a.vAlign=="middle")this.editor.style.posTop+=(a.clientHeight-this.editor.offsetHeight)/2;else if(a.vAlign=="bottom")this.editor.style.posTop+=a.clientHeight-this.editor.offsetHeight;this.SizeAll(this.GetTopSpread(b));$$.browser.version>=4&&this.ScrollView(b,true)}if(this.GetRowHeader(b)==null&&b.frzCols==0)a.style.height=t+"px";this.editing=true;if(k!=null&&(k.keyCode==27||k.keyCode==k.DOM_VK_TAB)){var l=b.fpSpreadJS.getExtender(this.editor);if(l!=null&&(l.indexOf("Calendar")!=-1||l.indexOf("ComboBox")!=-1))b.__delaySetEditorFocus=true}!b.__delaySetEditorFocus&&this.SetEditorFocus(this.editor);if(this.isEditModeReplace(b,a))if(this.editor.select)this.editor.select();else for(var j=this.editor.getElementsByTagName("INPUT"),i=0;i<j.length;i++)if(j[i].tagName=="INPUT"&&j[i].type=="text"){j[i].select();break}var d=this.GetCmdBtn(b,"Update");d!=null&&d.disabled&&this.UpdateCmdBtnState(d,false);d=this.GetCmdBtn(b,"Copy");d!=null&&!d.disabled&&this.UpdateCmdBtnState(d,true);d=this.GetCmdBtn(b,"Paste");d!=null&&!d.disabled&&this.UpdateCmdBtnState(d,true);d=this.GetCmdBtn(b,"Clear");d!=null&&!d.disabled&&this.UpdateCmdBtnState(d,true)}this.ScrollView(b)};this.GetCurrency=function(a){var b=a.CurrencySymbol;if(b!=null)return b;var c=document.getElementById(a.id+"cs");return c!=null?c.innerHTML:""};this.GetValueFromRender=function(g,d){var b=this.GetCellType2(this.GetCell(d));if(b!=null){if(b=="text")b="TextCellType";var a=null;if(b=="ExtenderCellType"){a=this.GetFunction(b+"_getEditor");if(a!=null)if(a(d)!=null)a=this.GetFunction(b+"_getEditorValue");else a=null}else a=this.GetFunction(b+"_getValue");if(a!=null)return a(d,g)}var c=d;while(c.firstChild!=null&&c.firstChild.nodeName!="#text")c=c.firstChild;var f=this.GetCell(d);if(this.Trim(c.innerHTML)=="&nbsp;")return f.getAttribute("whiteSpace")==null?"":" ";var e=c.value;if(typeof e=="undefined")e=c.textContent.trim();return e};this.ReplaceAll=function(a,d,c){if(a==null)return a;var b=a.length;while(true){a=a.replace(d,c);if(a.length==b)break;b=a.length}return a};this.GetFormula=function(b,a,e){a=this.GetDisplayIndex(b,a);var d=this.GetCellFromRowCol(b,a,e),c=this.GetFormulaFromCell(d);return c};this.SetFormula=function(a,b,g,d,f,e){b=this.GetDisplayIndex(a,b);var c=this.GetCellFromRowCol(a,b,g);c.setAttribute("FpFormula",d);!e&&this.SetCellValue(a,c,d,null,f)};this.GetFormulaFromCell=function(b){var a=null;if(b.getAttribute("FpFormula")!=null)a=b.getAttribute("FpFormula");if(a!=null)a=this.Trim(new String(a));return a};this.IsDouble=function(b,l,h,i,g,f){if(b==null||b.length==0)return true;b=the_fpSpread.Trim(b);if(b.length==0)return true;if(h!=null)b=b.replace(h,"-");if(i!=null)b=b.replace(i,"+");if(b.charAt(b.length-1)=="-")b="-"+b.substring(0,b.length-1);var m=new RegExp("^\\s*([-\\+])?(\\d+)?(\\"+l+"(\\d+))?([eE]([-\\+])?(\\d+))?\\s*$"),a=b.match(m);if(a==null)return false;if((a[2]==null||a[2].length==0)&&(a[4]==null||a[4].length==0))return false;var c="";if(a[1]!=null&&a[1].length>0)c=a[1];if(a[2]!=null&&a[2].length>0)c+=a[2];else c+="0";if(a[4]!=null&&a[4].length>0)c+="."+a[4];if(a[6]!=null&&a[6].length>0){c+="E"+a[6];if(a[7]!=null)c+=a[7];else c+="0"}var e=parseFloat(c);if(isNaN(e))return false;var d=true;if(g!=null){var k=parseFloat(g);d=!isNaN(k)&&e>=k}if(d&&f!=null){var j=parseFloat(f);d=!isNaN(j)&&e<=j}return d};this.GetFunction=function(fn){if(fn==null||fn=="")return null;try{return eval(fn)}catch(e){return null}};this.SetValueToRender=function(a,b,f){var c=null,d=this.GetCellType2(this.GetCell(a));if(d!=null){if(d=="text")d="TextCellType";if(d=="ExtenderCellType"){c=this.GetFunction(d+"_getEditor");if(c!=null)if(c(a)!=null)c=this.GetFunction(d+"_setEditorValue");else c=null}else c=this.GetFunction(d+"_setValue")}if(c!=null){var g=this.GetSpread(a);c(a,b,g)}else if(typeof a.value!="undefined"){if(b==null)b="";if(typeof a.maxLength!="undefined"&&a.maxLength>0)b=b.substring(0,a.maxLength);a.value=b}else{var e=a;while(e.firstChild!=null&&e.firstChild.nodeName!="#text")e=e.firstChild;e.innerHTML=$$.utils.htmlEncode(b)}(f==null||!f)&&a.getAttribute("FpFormula")!=null&&a.setAttribute("FpFormula",b)};this.Trim=function(b){var a=b.match(new RegExp("^\\s*(\\S+(\\s+\\S+)*)\\s*$"));return a==null?"":a[1]};this.GetOffsetLeft=function(f,c,e){var b=e;if(b==null)b=this.GetViewportFromCell(f,c);var d=0,a=c;while(a!=null&&a!=b&&this.IsChild(a,b)){d+=a.offsetLeft;a=a.offsetParent}return d};this.GetOffsetTop=function(f,c,e){var b=e;if(b==null)b=this.GetViewportFromCell(f,c);var d=0,a=c;while(a!=null&&a!=b&&this.IsChild(a,b)){d+=a.offsetTop;a=a.offsetParent}return d};this.getOffsetTopWithPos=function(d){var c=0,a=d,b="";while(a!=null&&this.IsChild(a,document.body)&&b!="absolute"&&b!="relative"){c+=a.offsetTop;a=a.offsetParent;b=document.defaultView.getComputedStyle(a,"").getPropertyValue("position")}return c};this.SetEditorFocus=function(b){if(b==null)return;var c=true,a=this.GetCell(b,true),d=this.GetCellType(a);if(d!=null){var f=this.GetFunction(d+"_setFocus");if(f!=null){f(b);c=false}}if(c)try{a.getAttribute("RowEditTemplate")!="true"&&b.focus()}catch(h){if(a!=null){var e=this.GetTopSpread(a);if(e!=null){var g=document.getElementById(e.id+"_textBox");g.focus()}}}};this.SetEditorValue=function(b,d,e){var f=this.GetCell(b,true),a=this.GetCellType(f);if(a!=null){var c=this.GetFunction(a+"_setEditorValue");if(c!=null){c(b,d,e);return}}a=b.getAttribute("FpEditor");if(a!=null){var c=this.GetFunction(a+"_setEditorValue");if(c!=null){c(b,d,e);return}}b.value=d};this.GetEditorValue=function(a,d){var e=this.GetCell(a,true),b=this.GetCellType(e);if(b!=null){var c=this.GetFunction(b+"_getEditorValue");if(c!=null)return c(a,d)}b=a.getAttribute("FpEditor");if(b!=null){var c=this.GetFunction(b+"_getEditorValue");if(c!=null)return c(a,d)}return a.type=="checkbox"?a.checked?"True":"False":a.value};this.CreateMsg=function(){if(this.validationMsg!=null)return;var a=this.validationMsg=document.createElement("div");a.style.position="absolute";a.style.background="yellow";a.style.color="red";a.style.border="1px solid black";a.style.display="none"};this.SetMsg=function(a){this.CreateMsg();this.validationMsg.innerHTML=a;this.validationMsg.width=this.validationMsg.offsetWidth+6};this.ShowMsg=function(a){this.CreateMsg();if(a)this.validationMsg.style.display="block";else this.validationMsg.style.display="none"};this.getMaskedEditValidtor=function(b){if(typeof Page_Validators!="undefined"){var a=null;for(i=0;i<Page_Validators.length;i++){a=Page_Validators[i];if(typeof a.enabled=="undefined"||a.enabled!=false)if(a.id==b+"")return a}}};this.EndEdit=function(mousedown){if(this.editor!=null&&this.editor.parentNode!=null){var cell=this.GetCell(this.editor.parentNode),ss=this.GetSpread(cell,false);if(ss==null)return true;ss.valid=true;var val=this.GetEditorValue(this.editor,ss),tval=val;if(typeof val=="string")tval=this.Trim(val);var ignoreValidation=ss.getAttribute("AcceptFormula")=="true"&&tval!=null&&tval.charAt(0)=="=",checkbox=this.renderAsEditor!=0,canExtenderValidation=false,maskedEditExtenderDiv=cell.getElementsByTagName("div")[0],maskedEditValidtorItem;if(typeof maskedEditExtenderDiv!="undefined"&&maskedEditExtenderDiv!=null)if(maskedEditExtenderDiv.getAttribute("Extenders")!=null&&maskedEditExtenderDiv.getAttribute("Extenders").indexOf("MaskedEditExtender")!=-1){canExtenderValidation=this.getMaskedEditValidtor((maskedEditExtenderDiv.id+"validator").replace(new RegExp(",","g"),"_"))!=null;maskedEditValidtorItem=this.getMaskedEditValidtor((maskedEditExtenderDiv.id+"validator").replace(new RegExp(",","g"),"_"))}if(!ignoreValidation&&!checkbox||canExtenderValidation){var msg=null,ct=this.GetCellType(cell);if(ct!=null){var f=this.GetFunction(ct+"_isValid");if(f!=null){msg=f(cell,val);var e=this.CreateEvent("ErrorMessageShown");e.spread=ss;e.row=this.GetRowFromCell(ss,cell);e.col=this.GetColFromCell(ss,cell);e.errorMessage=msg;if(msg=="")e.isValid=true;else e.isValid=false;this.FireEvent(ss,e)}}if(canExtenderValidation){var exvalidator=this.getMaskedEditValidtor((maskedEditExtenderDiv.id+"validator").replace(new RegExp(",","g"),"_"));if(exvalidator)try{ExtenderCellType_validateValue&&ExtenderCellType_validateValue(this.editor);var crtret=true;if(typeof exvalidator.evaluationfunction=="function"){crtret=exvalidator.evaluationfunction(exvalidator);if(!crtret)if(typeof exvalidator.errormessage=="string"){if(msg!="")msg+=", ";msg=exvalidator.errormessage}}else if(typeof exvalidator.evaluationfunction=="string"){eval("crtret = "+exvalidator.evaluationfunction+"("+exvalidator.id+")");if(!crtret)if(typeof exvalidator.errormessage=="string"){if(msg!="")msg+=", ";msg=exvalidator.errormessage}}if(ExtenderCellType_setValidateEditor)if(!crtret){var inputs=this.editor.getElementsByTagName("INPUT");for(i=0;i<inputs.length;i++){var textInput=inputs[i];textInput.type=="text"&&textInput.setAttribute("isInvalid",true)}ExtenderCellType_setValidateEditor(this.editor)}else{var inputs=this.editor.getElementsByTagName("INPUT");for(i=0;i<inputs.length;i++){var textInput=inputs[i];textInput.type=="text"&&textInput.removeAttribute("isInvalid")}ExtenderCellType_setValidateEditor(null)}if(!crtret&&typeof exvalidator.focusOnError=="string"&&exvalidator.focusOnError=="t"){ctrl=this.editor.getElementsByTagName("input")[0];ctrl!=null&&ctrl.focus!="undefined"&&ctrl.focus!=null&&setTimeout(function(){ctrl.focus()},0)}}catch(e){}}if(msg!=null&&msg!=""){this.SetMsg(msg);var rowIndex=this.GetRowFromCell(ss,cell),colIndex=this.GetColFromCell(ss,cell),vp=this.GetViewPortByRowCol(ss,rowIndex,colIndex);vp.parentNode.insertBefore(this.validationMsg,vp.parentNode.lastChild);this.ShowMsg(true);this.SetValidatorPos(ss);this.editor.focus();ss.valid=false}else this.ShowMsg(false);if(msg!=null&&msg!=""||crtret!=null&&!crtret)return false}var selectedIndex=-1;if(!checkbox){if(this.editor.tagName=="SELECT")selectedIndex=this.editor.selectedIndex;var textlist=this.editor.getElementsByTagName("INPUT");textlist.length>0&&textlist[0].blur();cell.removeChild(this.editor);this.editor.style.display="none";this.GetViewport(ss).parentNode.appendChild(this.editor);this.SetEditorValue(this.editor,"",ss);if(this.editor.tagName=="SELECT")this.editor.selectedIndex=-1;var rd=this.GetRender(cell);if(rd.style.display=="none")rd.style.display="inline";if(this.editingFormula!=null&&this.editingFormula==val)this.SetValueToRender(rd,this.editingValue,true);else this.SetValueToRender(rd,val);this.RestoreMargin(cell)}else{var extenders=ss.fpSpreadJS.getExtender(this.editor);extenders!=null&&extenders.indexOf("ComboBox")!=-1&&FpExtender.Util.removeFocus(cell,true)}if(this.editingFormula!=null&&this.editingFormula!=val||this.editingFormula==null&&(this.editingValue!=val||val!=null&&val.length==1)||this.editor.tagName=="SELECT"&&this.editorSelectedIndex!=selectedIndex){this.SetCellValue(ss,cell,val);if(val!=null&&val.length>0&&this.Trim(val).indexOf("=")==0)cell.setAttribute("FpFormula",val);else cell.removeAttribute("FpFormula")}!checkbox&&this.SizeAll(this.GetTopSpread(ss));this.editor=null;this.editing=false;var e=this.CreateEvent("EditStopped");e.cell=cell;this.FireEvent(ss,e);!this.isEditModeReplace(ss,cell)&&this.GetCellType(cell)!="ExtenderCellType"&&this.Focus(ss);var autoCalc=ss.getAttribute("autoCalc");if(autoCalc!="false")if(this.editingFormula!=null&&this.editingFormula!=val||this.editingFormula==null&&this.editingValue!=val)if(mousedown===true)this.updateValuesId=setTimeout(function(){this.updateValuesId=null;the_fpSpread.UpdateValues(ss)},200);else this.UpdateValues(ss)}this.renderAsEditor=-1;return true};this.SetValidatorPos=function(a){if(this.editor==null)return;var b=this.GetCell(this.editor.parentNode);if(b==null)return;var c=this.validationMsg;if(c!=null&&c.style.display!="none"){var s=this.GetOffsetTop(a,b.offsetParent,document.body),t=this.GetOffsetTop(a,c.offsetParent,document.body),q=this.GetOffsetLeft(a,b.offsetParent,document.body),r=this.GetOffsetLeft(a,c.offsetParent,document.body),e=s+b.offsetTop+b.offsetHeight-t,f=this.GetViewportFromCell(a,b).parentNode,m=false;if(b.offsetTop+b.offsetHeight+c.offsetHeight>f.scrollTop+f.clientHeight){e=e-b.offsetHeight-c.offsetHeight;m=true}var h=q+b.offsetLeft-r;if(a.frzRows>0||a.frzCols>0){e=e-f.scrollTop;h=h-f.scrollLeft}var g=this.GetViewport(a),k=this.GetViewport1(a),l=this.GetViewport2(a),n=typeof a.style.position!="undefined"&&(a.style.position=="absolute"||a.style.position=="relative"),p=n?a.offsetTop:0,o=n?a.offsetLeft:0,d=true;if(this.IsChild(b,g)||this.IsChild(b,k)){var i=l!=null?this.GetOffsetLeft(a,l,document.body)+l.offsetWidth:this.GetOffsetLeft(a,g.parentNode,document.body);i-=o;if(!(a.frzRows>0||a.frzCols>0))i=f.scrollLeft;d=i<=h;if(d)d=i+g.parentNode.offsetWidth>=h}if(d&&(this.IsChild(b,g)||this.IsChild(b,l))){var j=k!=null?this.GetOffsetTop(a,k,document.body)+k.offsetHeight:this.GetOffsetTop(a,g.parentNode,document.body);j-=p;if(!(a.frzRows>0||a.frzCols>0))j=f.scrollTop;d=j<e||m;if(d)d=j+g.parentNode.offsetHeight>=e+b.offsetHeight}c.style.visibility=d?"visible":"hidden";c.style.top=e+"px";c.style.left=h+"px"}};this.SaveMargin=function(a){if(a.style.paddingLeft!=null&&a.style.paddingLeft!=""){this.editorMargin.left=a.style.paddingLeft;a.style.paddingLeft=0}if(a.style.paddingRight!=null&&a.style.paddingRight!=""){this.editorMargin.right=a.style.paddingRight;a.style.paddingRight=0}if(a.style.paddingTop!=null&&a.style.paddingTop!=""){this.editorMargin.top=a.style.paddingTop;a.style.paddingTop=0}if(a.style.paddingBottom!=null&&a.style.paddingBottom!=""){this.editorMargin.bottom=a.style.paddingBottom;a.style.paddingBottom=0}};this.RestoreMargin=function(b,a){if(this.editorMargin.left!=null&&this.editorMargin.left!=-1){b.style.paddingLeft=this.editorMargin.left;if(a==null||a)this.editorMargin.left=-1}if(this.editorMargin.right!=null&&this.editorMargin.right!=-1){b.style.paddingRight=this.editorMargin.right;if(a==null||a)this.editorMargin.right=-1}if(this.editorMargin.top!=null&&this.editorMargin.top!=-1){b.style.paddingTop=this.editorMargin.top;if(a==null||a)this.editorMargin.top=-1}if(this.editorMargin.bottom!=null&&this.editorMargin.bottom!=-1){b.style.paddingBottom=this.editorMargin.bottom;if(a==null||a)this.editorMargin.bottom=-1}};var colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};this.getColorValue=function(a){for(var b in colors)if(a!=null&&a.toLowerCase()==b)return"#"+colors[b];return null};this.darker=function(b,f){if(b==null)return null;var e,d,c,a;if(b.length>3&&b.substring(0,3).toUpperCase()=="RGB"){var h=b.match(new RegExp("\\d{1,3}","g"));e=h[0];d=h[1];c=h[2]}else if(b.substring(0,1)!="#"){var g=this.getColorValue(b);if(g==null)return b;b=g;e=parseInt(b.substring(1,3),16);d=parseInt(b.substring(3,5),16);c=parseInt(b.substring(5,7),16)}if(f.substring(0,1)!="#"){var g=this.getColorValue(f);if(g==null)g="#bbbbbb";f=g}var k=256-parseInt(f.substring(1,3),16),j=256-parseInt(f.substring(3,5),16),i=256-parseInt(f.substring(5,7),16);e-=k;if(e>255)e=255;if(e<0)e=0;d-=j;if(d>255)d=255;if(d<0)d=0;c-=i;if(c>255)c=255;if(c<0)c=0;a=c.toString(16);if(a.length<2)a="0"+a;a=d.toString(16)+a;if(a.length<4)a="0"+a;a=e.toString(16)+a;if(a.length<6)a="0"+a;return"#"+a.toUpperCase()};this.PaintSelectedCell=function(c,a,g,f){if(a==null)return;var e=f?c.getAttribute("anchorBackColor"):c.getAttribute("selectedBackColor");if(g){var b=document.defaultView.getComputedStyle(a,"").getPropertyValue("background-color");a.getAttribute("bgColorBak")==null&&a.setAttribute("bgColorBak",b);if(a.bgColor1==null)a.bgColor1=a.style.backgroundColor;if(a.getAttribute("paintSelected")==null||f){if(c.getAttribute("semiTransparentSelectedBackColor")==null||b==null||b.length==0||b=="transparent"||b=="rgb(0, 0, 0)"||b=="rgba(0, 0, 0, 0)")a.style.backgroundColor=e;else a.style.backgroundColor=this.darker(b,e);a.setAttribute("paintSelected",true)}if(a.getAttribute("bgSelImg"))a.style.backgroundImage=a.getAttribute("bgSelImg");else{var d=this.GetCurrentStyle2(a);if(d.backgroundImage!=null&&d.backgroundImage!="")a.style.backgroundImage="url(about:blank)"}}else{a.removeAttribute("paintSelected");if(a.bgColor1!=null)a.style.backgroundColor="";if(a.bgColor1!=null&&a.bgColor1!="")a.style.backgroundColor=a.bgColor1;a.style.backgroundImage="";if(a.getAttribute("bgImg")!=null)a.style.backgroundImage=a.getAttribute("bgImg")}};this.PaintAnchorCell=function(a,e){var b=this.GetOperationMode(a);if(a.anchorCell==null||b!="Normal"&&b!="RowMode")return;if(b=="MultiSelect"||b=="ExtendedSelect")return;if(!this.IsChild(a.anchorCell,a))return;if(typeof e=="undefined"||e){if(a.oldAnchorCell&&a.oldAnchorCell!=a.anchorCell){if(this.GetSelectionPolicy(a)!="MultiRange"){var h=this.GetRowFromCell(a,a.oldAnchorCell),f=this.GetColFromCell(a,a.oldAnchorCell);this.GetColHeader(a)!=null&&!this.IsColSelected(a,f)&&this.PaintHeaderSelection(a,h,f,1,1,false,true)}var g=a.oldAnchorCell.getAttribute("paintSelected")!=null;this.PaintSelectedCell(a,a.oldAnchorCell,false);g&&this.PaintSelectedCell(a,a.oldAnchorCell,true,false);a.oldAnchorCell=null}var d=a.frzRows==0&&a.frzCols==0&&this.GetTopSpread(a).getAttribute("hierView")!="true";if(a.getAttribute("showFocusRect")=="false")d=false;if(d){this.PaintSelectedCell(a,a.anchorCell,false);this.PaintFocusRect(a);this.PaintAnchorCellHeader(a,true);return}var c=a.anchorCell.parentNode.cells[0].firstChild;if(c!=null&&c.nodeName!="#text"&&c.getAttribute("FpSpread")=="Spread")return;if(!a.initialized||a.isactive&&this.GetPageActiveSheetView()==a){this.PaintSelectedCell(a,a.anchorCell,false);this.PaintSelectedCell(a,a.anchorCell,true,true);this.PaintAnchorCellHeader(a,true)}else{this.PaintSelectedCell(a,a.anchorCell,false,true);this.PaintAnchorCellHeader(a,false)}}else this.updateSelectedCell(a,a.anchorCell,this.GetSelectedRanges(a),false)};this.updateSelectedCell=function(d,g,k,i){var f=this.GetRowFromCell(d,g),e=this.GetColFromCell(d,g),b=false,c=false;if(i)b=c=true;else for(var j=k||this.GetSelectedRanges(d),h=0;h<j.length;h++){var a=j[h];if(a.anchor)continue;if(a.row==-1&&a.rowCount==-1&&a.col==-1&&a.colCount==-1){b=c=true;break}else{c=a.row==-1&&a.rowCount==-1||a.row<=f&&f<=a.row+a.rowCount;b=a.col==-1&&a.colCount==-1||a.col<=e&&e<=a.col+a.colCount}if(c&&b)break}!c&&this.PaintHeaderSelection(d,f,e,1,1,false,false);!b&&this.PaintHeaderSelection(d,f,e,1,1,false,true);this.PaintSelectedCell(d,g,c&&b,i)};this.ClearSelection=function(a,j,d){var f=this.GetParentSpread(a);if(j==null&&f!=null&&f.getAttribute("hierView")=="true"){this.ClearSelection(f,null,d);return}var b=this.GetViewport(a),i=this.GetRowCount(a);if(b!=null&&b.rows.length>i)for(var c=0;c<b.rows.length;c++)if(b.rows[c].cells.length>0&&b.rows[c].cells[0]!=null&&b.rows[c].cells[0].firstChild!=null&&b.rows[c].cells[0].firstChild.nodeName!="#text"){var h=b.rows[c].cells[0].firstChild;h.getAttribute("FpSpread")=="Spread"&&this.ClearSelection(h,true,d)}if(!a.initialized)return;if(d==null||a!=d){this.DoclearSelection(a);if(a.anchorCell!=null){var e=this.GetOperationMode(a);if(e=="RowMode"||e=="SingleSelect"||e=="ExtendedSelect"||e=="MultiSelect"){var g=a.fpSpreadJS.getRowRangeFromCell(a.anchorCell);this.PaintSelection(a,g.row,-1,g.rowCount,-1,false)}this.PaintSelectedCell(a,a.anchorCell,false);this.PaintAnchorCellHeader(a,false)}this.PaintFocusRect(a);a.selectedCols=[];this.SaveData(a);a.dirty=true}};this.SetSelectedRange=function(a,c,e,b,d,l){this.ClearSelection(a);var c=this.GetDisplayIndex(a,c),k=0,n=b,j=this.GetViewport(a);if(j!=null)for(i=c;i<j.rows.length&&k<n;i++)if(this.IsChildSpreadRow(a,j,i))b++;else k++;var h=null,g=null;if(a.getAttribute("LayoutMode")){if(e>=0&&b<0){if(d!=1)return;var o=this.GetDisplayIndex2(a,l),f=this.GetCellByRowCol(a,o,e);if(f!=null&&parseInt(f.getAttribute("col"))!=-1){e=parseInt(f.getAttribute("col"));h=parseInt(f.parentNode.getAttribute("row"));g=this.GetColFromCell(a,f)}else return;this.PaintMultipleRowSelection(a,h,g,1,d,true)}else if(c>=0&&d<0){if(b>parseInt(a.getAttribute("layoutrowcount")))return;var m=parseInt(this.GetRowKeyFromRow(a,c)),c=parseInt(this.GetFirstRowFromKey(a,m));this.UpdateAnchorCell(a,c,0,true);b=parseInt(a.getAttribute("layoutrowcount"));this.PaintSelection(c,e,b,d,true)}else if(c>=0&&e>=0&&(d>1||b>1))return}else this.PaintSelection(a,c,e,b,d,true);this.SetSelection(a,c,e,b,d,null,h,g)};this.AddSelection=function(a,c,e,b,d,l){var c=this.GetDisplayIndex(a,c),k=0,n=b,j=this.GetViewport(a);if(j!=null)for(i=c;i<j.rows.length&&k<n;i++)if(this.IsChildSpreadRow(a,j,i))b++;else k++;var h,g;if(a.getAttribute("LayoutMode")){if(e>=0&&b<0){if(d!=1)return;var o=this.GetDisplayIndex2(a,l),f=this.GetCellByRowCol(a,o,e);if(f!=null&&parseInt(f.getAttribute("col"))!=-1){h=parseInt(f.parentNode.getAttribute("row"));g=this.GetColFromCell(a,f);e=parseInt(f.getAttribute("col"))}else return;this.PaintMultipleRowSelection(a,h,g,1,d,true)}else if(c>=0&&d<0){if(b>parseInt(a.getAttribute("layoutrowcount")))return;var m=parseInt(this.GetRowKeyFromRow(a,c)),c=parseInt(this.GetFirstRowFromKey(a,m));if(a.allowGroup){this.ClearSelection(a);this.UpdateAnchorCell(a,c,0,true)}b=parseInt(a.getAttribute("layoutrowcount"));this.PaintSelection(a,c,e,b,d,true)}else if(c>=0&&e>=0&&(d>1||b>1))return}else this.PaintSelection(a,c,e,b,d,true);this.SetSelection(a,c,e,b,d,true,h,g)};this.SelectRow=function(a,b,f,e,i){if((a.selectionBlockOptions&SelectionBlockOptions.Rows)==0&&this.GetOperationMode(a)=="Normal")return;var l=this.GetSelectionUnit(a);if(l=="Column"){this.SelectTable(a,e);return}a.selectStartRow=b;a.selectStartCol=-1;if(!i)for(var c=null,h=this.GetViewport(a),k=this.GetColGroup(h),j=h.parentNode.scrollLeft,d=0;d<k.childNodes.length;d++){c=this.GetCellFromRowCol(a,b,d);if(c!=null&&c.offsetLeft>=j)if(!(c.getAttribute("canFocus")=="false")){this.UpdateAnchorCell(a,b,d,false);break}}a.selectType="r";var g=f;if(a.getAttribute("LayoutMode"))g=parseInt(a.getAttribute("layoutrowcount"));this.PaintSelection(a,b,-1,g,-1,e);if(e)this.SetSelection(a,b,-1,f,-1);else{this.RemoveSelection(a,b,-1,f,-1);this.PaintFocusRect(a)}};this.SelectColumn=function(a,g,i,f,l){if((a.selectionBlockOptions&SelectionBlockOptions.Columns)==0&&this.GetOperationMode(a)=="Normal")return;var m=this.GetSelectionUnit(a);if(m=="Row"){this.SelectTable(a,f);return}a.selectStartRow=-1;a.selectStartCol=g;if(!l){for(var b=0,e=this.GetViewport(a),k=e.parentNode.scrollTop-a.virtualTop,b=0;b<e.rows.length;b++){if(!e.rows[b].getAttribute("FpKey"))continue;if(e.rows[b].offsetTop>=k)break}b+=a.frzRows;var c=g;if(a.getAttribute("LayoutMode")){var j=a.anchorCell;if(parseInt(a.anchorCell.getAttribute("col"))==-1)return;if(j){b=this.GetRowFromCell(a,j);c=this.GetColFromCell(a,j)}a.copymulticol=true}var h=b;while(h<a.frzRows+e.rows.length){var d=this.GetCellFromRowCol(a,h,c);if(d!=null&&!d.getAttribute("group")&&d.getAttribute("canFocus")!="false"&&d.offsetTop>=k&&d.parentNode.getAttribute("previewrow")==null){this.UpdateAnchorCell(a,h,c,false,true);break}h+=a.getAttribute("LayoutMode")?parseInt(a.getAttribute("layoutrowcount")):1}}a.selectType="c";if(!a.getAttribute("LayoutMode"))this.PaintSelection(a,-1,c,-1,i,f);else this.PaintMultipleRowSelection(a,b,c,1,i,f);if(f){this.SetSelection(a,-1,g,-1,i,null,b,c);this.AddColSelection(a,g)}};this.AdjustAnchorCell=function(a,i){var c=this.GetViewport(a);if(c==null)return-1;for(var b=0,h=c.parentNode.scrollTop-a.virtualTop,b=0;b<c.rows.length;b++){if(!c.rows[b].getAttribute("FpKey"))continue;if(c.rows[b].offsetTop>=h)break}b+=a.frzRows;var d=i;if(a.getAttribute("LayoutMode")){var g=a.anchorCell;if(parseInt(a.anchorCell.getAttribute("col"))==-1)return;if(g){b=this.GetRowFromCell(a,g);d=this.GetColFromCell(a,g)}a.copymulticol=true}var f=b;while(f<a.frzRows+c.rows.length){var e=this.GetCellFromRowCol(a,f,d);if(e!=null&&!e.getAttribute("group")&&e.getAttribute("canFocus")!="false"&&e.offsetTop>=h){this.UpdateAnchorCell(a,f,d,false,true);break}f+=a.getAttribute("LayoutMode")?parseInt(a.getAttribute("layoutrowcount")):1}return d};this.tryToSetAnchorCell=function(a,e){var i=this.GetColCount(a),j=this.GetRowCount(a),g=e&&e.type=="keydown"&&e.keyCode==tab,d=this.GetNextCellRowIndex(a,0,0,g,true),c=this.GetNextCellColIndex(a,0,0,g,true),h=this.GetOperationMode(a);if(d<j&&c<i){var k=this.FireActiveCellChangingEvent(a,d,c,0);if(!k){var f=this.GetSelectionPolicy(a);!(h=="Normal"&&(f=="MultiRange"&&a.getAttribute("multiRange")=="true"||f=="Range"))&&this.ClearSelection(a);a.leadingCellRow=d;a.leadingCellCol=c;this.UpdateAnchorCell(a,d,c);var b=this.CreateEvent("ActiveCellChanged");b.cmdID=a.id;b.row=b.Row=d;b.col=b.Col=c;if(a.getAttribute("LayoutMode"))b.InnerRow=b.innerRow=0;this.FireEvent(a,b)}}};this.AddColSelection=function(b,c){for(var d=0,a=0;a<b.selectedCols.length;a++){if(b.selectedCols[a]==c)return;if(c>b.selectedCols[a])d=a+1}b.selectedCols.length++;for(var a=b.selectedCols.length-1;a>d;a--)b.selectedCols[a]=b.selectedCols[a-1];b.selectedCols[d]=c};this.IsColSelected=function(b,c){for(var a=0;a<b.selectedCols.length;a++)if(b.selectedCols[a]==c)return true;return false};this.SyncColSelection=function(b){b.selectedCols=[];for(var e=this.GetSelectedRanges(b),c=0;c<e.length;c++){var a=e[c];if(a.type=="Column")for(var d=a.col;d<a.col+a.colCount;d++)this.AddColSelection(b,d)}};this.InitMovingCol=function(a,e,n,m){if(a.getAttribute("LayoutMode")&&e==-1)return;if(this.GetOperationMode(a)!="Normal"){a.selectedCols=[];a.selectedCols.push(e)}if(n){this.dragCol=e;this.dragViewCol=this.GetColByKey(a,e)}else{if(a.getAttribute("LayoutMode"))this.dragCol=this.GetColTemplateRowFromGroupCell(a,e);else this.dragCol=parseInt(this.GetSheetColIndex(a,e));this.dragViewCol=e}var b=this.GetMovingCol(a);if(n){this.ClearSelection(a);b.innerHTML="";var g=document.createElement("DIV");g.innerHTML=m.innerHTML;g.style.borderTop="0px solid";g.style.borderLeft="0px solid";g.style.borderRight="#808080 1px solid";g.style.borderBottom="#808080 1px solid";g.style.width=""+Math.max(this.GetPreferredCellWidth(a,m),80)+"px";b.appendChild(g);if(a.getAttribute("DragColumnCssClass")==null){b.style.backgroundColor=m.style.backgroundColor;b.style.paddingTop="1px";b.style.paddingBottom="1px"}b.style.top="-50px";b.style.left="-100px"}else{var o=0;b.style.top="0px";b.style.left="-1000px";b.style.display="";b.innerHTML="";var r=document.createElement("TABLE");b.appendChild(r);var s=document.createElement("TR");r.appendChild(s);for(var c=0;c<a.selectedCols.length;c++){var d=document.createElement("TD");s.appendChild(d);var i,l;if(a.getAttribute("LayoutMode")){i=this.GetRowTemplateRowFromGroupCell(a,e,true);l=this.GetColTemplateRowFromGroupCell(a,e)}else{if(a.getAttribute("columnHeaderAutoTextIndex")!=null)i=parseInt(a.getAttribute("columnHeaderAutoTextIndex"));else i=a.getAttribute("ColHeaders")-1;l=a.selectedCols[c]}var h=this.GetHeaderCellFromRowCol(a,i,l,true);if(h.getAttribute("FpCellType")=="ExtenderCellType"&&h.getElementsByTagName("DIV").length>0){var t=this.GetEditor(h),u=this.GetFunction("ExtenderCellType_getEditorValue");if(t!=null&&u!=null)d.innerHTML=u(t)}else d.innerHTML=h.innerHTML;d.style.cssText=h.style.cssText;d.style.borderTop="0px solid";d.style.borderLeft="0px solid";d.style.borderRight="#808080 1px solid";d.style.borderBottom="#808080 1px solid";d.setAttribute("align","center");var v=Math.max(this.GetPreferredCellWidth(a,h),80);d.style.width=""+v+"px";o+=v}if(a.getAttribute("DragColumnCssClass")==null){b.style.backgroundColor=a.getAttribute("SelectedBackColor");b.style.tableLayout="fixed";b.style.width=""+o+"px"}}a.selectedCols.context=[];var p=a.selectedCols.context,k=0,f=this.GetColGroup(this.GetFrozColHeader(a));if(f!=null)for(var c=0;c<f.childNodes.length&&c<a.frzCols;c++){var j=f.childNodes[c].offsetWidth,q=parseInt(f.childNodes[c].getAttribute("FpCol"));p.push({left:k,width:j,colKey:q});k+=j}f=this.GetColGroup(this.GetColHeader(a));if(f!=null)for(var c=0;c<f.childNodes.length;c++){var j=f.childNodes[c].offsetWidth,q=parseInt(f.childNodes[c].getAttribute("FpCol"));p.push({left:k,width:j,colKey:q});k+=j}};this.SelectTable=function(a,f){if((a.selectionBlockOptions&SelectionBlockOptions.Sheet)==0&&this.GetOperationMode(a)=="Normal")return;if(f){this.ClearSelection(a);for(var b=null,c=this.GetViewport(a),k=this.GetColGroup(c),g=false,j=c.parentNode.scrollTop-a.virtualTop,i=c.parentNode.scrollLeft,d=0;d<c.rows.length;d++){var h=d+a.frzRows;if(!c.rows[d].getAttribute("FpKey"))continue;for(var e=0;e<k.childNodes.length;e++){b=this.GetCellFromRowCol(a,h,e);if(b!=null&&!b.getAttribute("group")&&b.offsetTop>=j&&b.offsetLeft>=i)if(!(b.getAttribute("canFocus")=="false")){this.UpdateAnchorCell(a,h,e,false);d=c.rows.length;g=true;break}}if(g)break}}a.selectType="t";this.PaintSelection(a,-1,-1,-1,-1,false);f&&this.SetSelection(a,-1,-1,-1,-1)};this.GetSpanCell=function(e,d,b){if(b==null)return null;for(var g=b.length,c=0;c<g;c++){var a=b[c],f=a.row<=e&&e<a.row+a.rowCount&&a.col<=d&&d<a.col+a.colCount;if(f)return a}return null};this.IsCovered=function(e,c,b,d){var a=this.GetSpanCell(c,b,d);return a==null?false:a.row==c&&a.col==b?false:true};this.IsSpanCell=function(f,h,g){for(var c=f.spanCells,e=c.length,b=0;b<e;b++){var a=c[b],d=a.row==h&&a.col==g;if(d)return a}return null};this.SelectRange=function(a,f,e,d,c,b){var g=this.GetSelectionUnit(a);if(g=="Row"){this.SelectRow(a,f,d,b,false);return}else if(g=="Column"){this.SelectColumn(a,e,c,b,false);return}a.selectType="";this.UpdateRangeSelection(a,f,e,d,c,b);if(b){this.SetSelection(a,f,e,d,c);this.PaintAnchorCell(a)}};this.UpdateRangeSelection=function(a,g,f,e,d,b){var c=this.GetViewport(a);this.UpdateRangeSelection(a,g,f,e,d,b,c)};this.GetSpanCells=function(a,b){return b==this.GetViewport(a)||b==this.GetViewport1(a)||b==this.GetViewport2(a)||b==this.GetViewport0(a)?a.spanCells:b==this.GetColHeader(a)||b==this.GetFrozColHeader(a)?a.colSpanCells:b==this.GetRowHeader(a)||b==this.GetFrozRowHeader(a)?a.rowSpanCells:null};this.UpdateRangeSelection=function(c,g,f,j,i,h,b){if(b==null)return;for(var a=g;a<g+j&&a<b.rows.length;a++){if(this.IsChildSpreadRow(c,b,a))continue;for(var d=this.GetCellIndex(c,a,f,this.GetSpanCells(c,b)),e=0;e<i;e++){if(this.IsCovered(c,a,f+e,this.GetSpanCells(c,b)))continue;d<b.rows[a].cells.length&&this.PaintSelectedCell(c,b.rows[a].cells[d],h);d++}}};this.GetColFromCell=function(b,a){if(a==null)return-1;var c=this.GetRowFromCell(b,a);return this.GetColIndex(b,c,a.cellIndex,this.GetSpanCells(b,a.parentNode.parentNode.parentNode),this.InFrozCols(b,a),this.IsChild(a,this.GetFrozRowHeader(b))||this.IsChild(a,this.GetRowHeader(b)))};this.GetRowFromCell=function(b,a){if(a==null||a.parentNode==null)return-1;var c=a.parentNode.rowIndex;if(b.frzRows>0&&(this.IsChild(a,this.GetViewport2(b))||this.IsChild(a,this.GetViewport(b))||this.IsChild(a,this.GetRowHeader(b))))c+=b.frzRows;return c};this.GetColIndex=function(a,k,g,j,i,h){var f=0,b=this.GetColCount(a),e=a.frzCols;if(i){b=a.frzCols;e=0}else if(h){e=0;var c=null;if(this.GetFrozRowHeader(a)!=null)c=this.GetColGroup(this.GetFrozRowHeader(a));else if(this.GetRowHeader(a)!=null)c=this.GetColGroup(this.GetRowHeader(a));if(c!=null)b=c.childNodes.length}for(var d=e;d<b;d++){if(this.IsCovered(a,k,d,j))continue;if(f==g)return d;f++}return b};this.GetCellIndex=function(a,j,b,c){var e=false,i=this.GetViewport(a);if(i!=null)e=i.parentNode.getAttribute("hiddenCells");if(e&&c==a.spanCells)return c!=a.rowSpanCells&&b>=a.frzCols?b-a.frzCols:b;else{var h=0,f=b;if(c!=a.rowSpanCells&&b>=a.frzCols){h=a.frzCols;f=b-a.frzCols}for(var g=0,d=0;d<f;d++){if(this.IsCovered(a,j,h+d,c))continue;g++}return g}};this.NextCell=function(a,c,i){if(c.altKey)return;var d=this.GetParent(this.GetViewport(a));if(a.anchorCell==null){var r=this.FireActiveCellChangingEvent(a,0,0);if(!r){a.SetActiveCell(0,0);var j=this.CreateEvent("ActiveCellChanged");j.cmdID=a.id;j.row=j.Row=0;j.col=j.Col=0;this.FireEvent(a,j);this.DoGetFocus(a)}return}if(c.shiftKey&&i!=c.DOM_VK_TAB){this.CancelDefault(c);var m=this.GetOperationMode(a);if(m=="RowMode"||m=="SingleSelect"||m=="MultiSelect"||m=="Normal"&&this.GetSelectionPolicy(a)=="Single")return;var g=this.GetSpanCell(a.leadingCellRow,a.leadingCellCol,this.GetSpanCells(a,this.GetViewportFromCell(a,a.anchorCell)));switch(i){case c.DOM_VK_RIGHT:var b=a.leadingCellRow,e=a.leadingCellCol+1;if(g!=null)e=g.col+g.colCount;if(e>this.GetColCount(a)-1)return;a.leadingCellCol=e;a.leadingCell=this.GetCellFromRowCol(a,b,e);this.Select(a,a.anchorCell,a.leadingCell);break;case c.DOM_VK_LEFT:var b=a.leadingCellRow,e=a.leadingCellCol-1;if(g!=null)e=g.col-1;g=this.GetSpanCell(b,e,this.GetSpanCells(a,this.GetViewportFromCell(a,a.anchorCell)));if(g!=null)if(this.IsSpanCell(a,b,g.col))e=g.col;if(e<0)return;a.leadingCellCol=e;a.leadingCell=this.GetCellFromRowCol(a,b,e);this.Select(a,a.anchorCell,a.leadingCell);break;case c.DOM_VK_DOWN:var b=a.leadingCellRow+1,e=a.leadingCellCol;if(g!=null)b=g.row+g.rowCount;b=this.GetNextRow(a,b);if(b>this.GetRowCountInternal(a)-1)return;a.leadingCellRow=b;a.leadingCell=this.GetCellFromRowCol(a,b,e);this.Select(a,a.anchorCell,a.leadingCell);this.PaintSelections(a,true);break;case c.DOM_VK_UP:var b=a.leadingCellRow-1,e=a.leadingCellCol;if(g!=null)b=g.row-1;b=this.GetPrevRow(a,b);g=this.GetSpanCell(b,e,this.GetSpanCells(a,this.GetViewportFromCell(a,a.anchorCell)));if(g!=null)if(this.IsSpanCell(a,g.row,e))b=g.row;if(b<0)return;a.leadingCellRow=b;a.leadingCell=this.GetCellFromRowCol(a,b,e);this.Select(a,a.anchorCell,a.leadingCell);this.PaintSelections(a,true);break;case c.DOM_VK_HOME:if(a.anchorCell.parentNode.rowIndex>=0){a.leadingCellCol=0;a.leadingCell=this.GetCellFromRowCol(a,a.leadingCellRow,a.leadingCellCol);this.Select(a,a.anchorCell,a.leadingCell)}break;case c.DOM_VK_END:if(a.anchorCell.parentNode.rowIndex>=0){a.leadingCellCol=this.GetColCount(a)-1;a.leadingCell=this.GetCellFromRowCol(a,a.leadingCellRow,a.leadingCellCol);this.Select(a,a.anchorCell,a.leadingCell)}break;case c.DOM_VK_PAGE_DOWN:if(this.GetViewport(a)!=null&&a.anchorCell.parentNode.rowIndex>=0){b=0;for(b=0;b<this.GetViewport(a).rows.length;b++)if(this.GetViewport(a).rows[b].offsetTop+this.GetViewport(a).rows[b].offsetHeight>this.GetViewport(a).parentNode.offsetHeight+this.GetViewport(a).parentNode.scrollTop)break;b=this.GetNextRow(a,b);if(b<this.GetViewport(a).rows.length){this.GetViewport(a).parentNode.scrollTop=this.GetViewport(a).rows[b].offsetTop;a.leadingCellRow=b}else{b=this.GetRowCountInternal(a)-1;a.leadingCellRow=b}a.leadingCell=this.GetCellFromRowCol(a,a.leadingCellRow,a.leadingCellCol);this.Select(a,a.anchorCell,a.leadingCell)}break;case c.DOM_VK_PAGE_UP:if(this.GetViewport(a)!=null&&a.anchorCell.parentNode.rowIndex>0){b=0;for(b=0;b<this.GetViewport(a).rows.length;b++)if(this.GetViewport(a).rows[b].offsetTop+this.GetViewport(a).rows[b].offsetHeight>this.GetViewport(a).parentNode.scrollTop)break;if(b<this.GetViewport(a).rows.length){var p=0;while(b>0){p+=this.GetViewport(a).rows[b].offsetHeight;if(p>this.GetViewport(a).parentNode.offsetHeight)break;b--}b=this.GetPrevRow(a,b);if(b>=0){this.GetViewport(a).parentNode.scrollTop=this.GetViewport(a).rows[b].offsetTop;a.leadingCellRow=b;a.leadingCell=this.GetCellFromRowCol(a,a.leadingCellRow,a.leadingCellCol);this.Select(a,a.anchorCell,a.leadingCell)}}}}this.SyncColSelection(a)}else{var q=i==c.DOM_VK_TAB;if(i==c.DOM_VK_TAB)if(c.shiftKey)i=c.DOM_VK_LEFT;else i=c.DOM_VK_RIGHT;var y=a.anchorCell,b,e;if(c.shiftKey){b=a.leadingCellRow;e=a.leadingCellCol}else if(this.GetCellFromRowCol(a,a.leadingCellRow,a.leadingCellCol)==a.anchorCell){b=a.leadingCellRow;e=a.leadingCellCol}else{b=this.GetRowFromCell(a,a.anchorCell);e=this.GetColFromCell(a,a.anchorCell)}switch(i){case c.DOM_VK_RIGHT:this.MoveRight(a,b,e,q);break;case c.DOM_VK_LEFT:this.MoveLeft(a,b,e,q);break;case c.DOM_VK_DOWN:this.MoveDown(a,b,e,false,false,true);break;case c.DOM_VK_UP:this.MoveUp(a,b,e,false,false,true);break;case c.DOM_VK_HOME:a.anchorCell.parentNode.rowIndex>=0&&this.MoveRight(a,b,-1,false);break;case c.DOM_VK_END:a.anchorCell.parentNode.rowIndex>=0&&this.MoveLeft(a,b,this.GetColCount(a),false);break;case c.DOM_VK_PAGE_DOWN:if(this.GetViewport(a)!=null&&a.anchorCell.parentNode.rowIndex>=0){var l=0;if(a.virtualPaging=="true"){var s=document.getElementById(a.id+"_VirtualPaging_Top");l=s.offsetHeight}b=0;for(b=0;b<this.GetViewport(a).rows.length;b++)if(this.GetViewport(a).rows[b].offsetTop+this.GetViewport(a).rows[b].offsetHeight>this.GetViewport(a).parentNode.offsetHeight+this.GetViewport(a).parentNode.scrollTop-l)break;b=this.GetNextRow(a,b);var k=null;if(b<this.GetViewport(a).rows.length){while(b>=0){k=this.GetCellFromRowCol(a,b,e);if(k.getAttribute("TabStop")=="false"||k.getAttribute("canFocus")=="false")b--;else break}var x=this.GetViewport(a).rows[b].offsetTop+l;this.UpdateLeadingCell(a,b,a.leadingCellCol);this.GetViewport(a).parentNode.scrollTop=x}else{b=this.GetPrevRow(a,this.GetRowCount(a)-1);while(b>=0){k=this.GetCellFromRowCol(a,b,e);if(k.getAttribute("TabStop")=="false"||k.getAttribute("canFocus")=="false")b--;else break}this.UpdateLeadingCell(a,b,a.leadingCellCol)}}break;case c.DOM_VK_PAGE_UP:if(this.GetViewport(a)!=null&&a.anchorCell.parentNode.rowIndex>=0){var l=0;if(a.virtualPaging=="true"){var s=document.getElementById(a.id+"_VirtualPaging_Top");l=s.offsetHeight}b=0;for(b=0;b<this.GetViewport(a).rows.length;b++)if(this.GetViewport(a).rows[b].offsetTop+this.GetViewport(a).rows[b].offsetHeight>this.GetViewport(a).parentNode.scrollTop-l)break;if(b<this.GetViewport(a).rows.length){var p=0;while(b>=0){p+=this.GetViewport(a).rows[b].offsetHeight;if(p>this.GetViewport(a).parentNode.offsetHeight)break;b--}b=this.GetPrevRow(a,b);if(b>=0){var k=null,B=this.GetColCount(a)-1;while(b<=B){k=this.GetCellFromRowCol(a,b,e);if(k.getAttribute("TabStop")=="false"||k.getAttribute("canFocus")=="false")b++;else break}var x=this.GetViewport(a).rows[b].offsetTop+l;this.UpdateLeadingCell(a,b,a.leadingCellCol);this.GetViewport(a).parentNode.scrollTop=x}}}}if(y!=a.anchorCell){var w=this.GetCmdBtn(a,"Update");w!=null&&this.UpdateCmdBtnState(w,false);var z=this.GetOperationMode(a);if(z=="Normal"){var A=this.CreateEvent("SelectionChanged");this.FireEvent(a,A)}a.fpSpreadJS.keepGeneratedSelectionFromAnchorCell();var j=this.CreateEvent("ActiveCellChanged");j.cmdID=a.id;j.Row=j.row=this.GetSheetIndex(a,this.GetRowFromCell(a,a.anchorCell));j.Col=j.col=this.GetColFromCell(a,a.anchorCell);if(a.getAttribute("LayoutMode"))j.InnerRow=j.innerRow=a.anchorCell.parentNode.getAttribute("row");this.FireEvent(a,j)}var m=this.GetOperationMode(a);m=="ExtendedSelect"&&this.SelectRow(a,a.leadingCellRow,1,true,true)}var f=this.GetCellFromRowCol(a,a.leadingCellRow,a.leadingCellCol);if(i==c.DOM_VK_LEFT||i==c.DOM_VK_HOME)if(f.offsetLeft<d.scrollLeft)if(f.cellIndex>0)d.scrollLeft=a.anchorCell.offsetLeft;else d.scrollLeft=0;else if(f.offsetLeft>=d.scrollLeft+d.clientWidth)d.scrollLeft=a.anchorCell.offsetLeft+a.anchorCell.offsetWidth-d.clientWidth;if(i==c.DOM_VK_RIGHT||i==c.DOM_VK_END)if(f.offsetLeft+f.offsetWidth>d.scrollLeft+d.clientWidth)d.scrollLeft=a.anchorCell.offsetLeft+a.anchorCell.offsetWidth-d.clientWidth;else if(f.offsetLeft<d.scrollLeft)if(f.cellIndex>0)d.scrollLeft=a.anchorCell.offsetLeft;else d.scrollLeft=0;if((i==c.DOM_VK_UP||i==c.DOM_VK_LEFT)&&(this.IsChild(f,d)||this.IsChild(f,this.GetViewport2(a))))if(f.parentNode.rowIndex>0){var o=f.parentNode.offsetTop-(d.scrollTop-a.virtualTop),n=o+f.parentNode.offsetHeight;if(n>d.clientHeight)d.scrollTop=d.scrollTop+n-d.clientHeight;else if(o<0)d.scrollTop=d.scrollTop-(d.scrollTop-a.virtualTop-f.parentNode.offsetTop)}else d.scrollTop=a.virtualTop;var v=this.GetViewport(a);if((i==c.DOM_VK_DOWN||i==c.DOM_VK_RIGHT)&&(this.IsChild(f,d)||this.IsChild(f,this.GetViewport2(a)))){var o=f.parentNode.offsetTop-(d.scrollTop-a.virtualTop),n=o+f.parentNode.offsetHeight;if(f.parentNode.rowIndex<f.parentNode.parentNode.rows.length-1){if(n>d.clientHeight)d.scrollTop=d.scrollTop+n-d.clientHeight;else if(o<0)d.scrollTop=d.scrollTop-(d.scrollTop-a.virtualTop-f.parentNode.offsetTop)}else d.scrollTop=a.virtualTop+(v.offsetHeight-d.clientHeight>0?v.offsetHeight-d.clientHeight:0)}this.ScrollView(a);this.EnableButtons(a);this.SaveData(a);var r=true;if(a.anchorCell!=null)if(a.editModePermanent)this.DoGetFocus(a,c);else{var h=this.GetEditor(a.anchorCell);if(h!=null){if(c.shiftKey&&!q)h.blur();else{var u=this.GetCellType(a.anchorCell);if(!h.disabled&&(u=="MultiColumnComboBoxCellType"||u=="ExtenderCellType"&&h.getElementsByTagName("INPUT").length>0||h.type==null||h.type=="checkbox"||h.type=="radio"||h.type=="text"||h.type=="textarea"||h.type=="password"||h.tagName=="SELECT")){this.editing=true;if(c!=null&&c.keyCode==c.DOM_VK_TAB){var t=a.fpSpreadJS.getExtender(h);if(t!=null&&t.indexOf("ComboBox")!=-1)a.__delaySetEditorFocus=true}!a.__delaySetEditorFocus&&this.SetEditorFocus(h);this.editor=h;this.editingValue=this.GetEditorValue(h,a)}}r=false;if(this.isEditModeReplace(a,a.anchorCell)){h.select&&h.select();this.CancelDefault(c)}}!this.IsHeaderCell(a,a.anchorCell)&&this.MoveTextBox(a,a.anchorCell)}r&&this.Focus(a,null,a.getAttribute("LayoutMode")!=null)};this.MoveTextBox=function(d,c){var h=this.GetTopSpread(d),b=document.getElementById(h.id+"_textBox");if(b!=null){var e=this.GetViewportFromCell(d,c);if(e!=null){var a=e.parentNode,g=a.offsetTop+c.offsetTop-a.scrollTop,f=a.offsetLeft+c.offsetLeft-a.scrollLeft;if(!this.IsStaticPos(d)){g+=1;f+=1}}b.style.top=""+g+"px";b.style.left=""+f+"px"}};this.MoveUp=function(a,b,c,h,d,j){if(b==0&&!h)return;var f=this.GetRowCountInternal(a),i=this.GetColCount(a),e=1,g=this.GetSpanCell(b,c,this.GetSpanCells(a,this.GetViewportFromCell(a,a.anchorCell)));if(g!=null){b=g.row-1;e=c-g.col+1}else b--;b=this.GetPrevRow2(a,b,a.leadingCellCol,d,j);if(b<0&&h)if(c==e-1||c==0){b=this.GetPrevCellRowIndex(a,f-1,i-1,d,true);c=this.GetPrevCellColIndex(a,f-1,i-1,d,true)}else{b=this.GetPrevCellRowIndex(a,f-1,c-e,d,true);c=this.GetPrevCellColIndex(a,f-1,c-e,d,true)}if(b>=0){a.leadingCellRow=b;a.leadingCellCol=c;this.UpdateLeadingCell(a,a.leadingCellRow,a.leadingCellCol)}};this.MoveDown=function(a,b,c,j,d,i){var h=this.GetRowCountInternal(a),g=this.GetColCount(a),f=1,e=this.GetSpanCell(b,c,this.GetSpanCells(a,this.GetViewportFromCell(a,a.anchorCell)));if(e!=null){b=e.row+e.rowCount;f=e.colCount}else b++;b=this.GetNextRow2(a,b,c,d,i);if(b==h&&j)if(c==g-f||c==g-1){b=this.GetNextCellRowIndex(a,0,0,d,true);c=this.GetNextCellColIndex(a,0,0,d,true)}else{b=this.GetNextCellRowIndex(a,0,c+f,d,true);c=this.GetNextCellColIndex(a,0,c+f,d,true)}if(b<h){a.leadingCellRow=b;a.leadingCellCol=c;this.UpdateLeadingCell(a,a.leadingCellRow,a.leadingCellCol)}};this.MoveLeft=function(a,b,c,d){var i=b,k=this.GetRowCountInternal(a),j=this.GetColCount(a);if(typeof d=="undefined")d=true;c=this.GetPrevCol(a,b,c,d,true);if(c<0){c=j-1;b--;if(b<0)b=k-1;b=this.GetPrevRow(a,b);var g=a.spanCells,e=this.GetSpanCell(b,c,g);if(e!=null){c=e.col;b=e.row}a.leadingCellRow=b}var f=this.GetCellFromRowCol(a,a.leadingCellRow,c);if(a.anchorCell!=f&&(d&&f.getAttribute("TabStop")=="false"||f.getAttribute("canFocus")=="false"))this.MoveLeft(a,a.leadingCellRow,c);else{var h=this.UpdateLeadingCell(a,a.leadingCellRow,c);if(h)a.leadingCellRow=i}};this.GetPrevCol=function(b,f,e,h,g){var c=null,a=e,j=this.GetColCount(b);while(a>=0){var d=this.GetSpanCell(f,e,this.GetSpanCells(b,this.GetViewportFromCell(b,b.anchorCell)));if(d!=null)a=d.col-1;else a--;c=this.GetCellFromRowCol(b,f,a);if(c==null)break;var i=h&&c.getAttribute("TabStop")=="false"||g&&c.getAttribute("canFocus")=="false";if(!i)break}return a};this.MoveRight=function(b,c,g,e){var f=c,a=this.moveRightInternal(b,c,g,e);if(a!=null){var d=this.UpdateLeadingCell(b,a.row,a.col);if(d)b.leadingCellRow=f}};this.moveRightInternal=function(c,a,b,d){var e=this.GetRowCountInternal(c),i=this.GetColCount(c);if(e==0||i==0)return null;var h=a>-1&&a<e?a:-1,g=b>-1&&b<i?b:-1,j=-1;if(typeof d=="undefined")d=true;do{if(a>=e){b=0;a=0;a=this.GetNextRow(c,a);c.leadingCellRow=a}else{b=this.GetNextCol(c,a,b,d,true);if(b>=i){b=0;a++;if(a>=e)a=0;a=this.GetNextRow(c,a);c.leadingCellRow=a}}if(h<0||g<0){h=a;g=b}var f=this.GetCellFromRowCol(c,a,b);if(f!=null&&f.getAttribute("canFocus")!="false"&&!(d&&f.getAttribute("TabStop")=="false"))return{row:a,col:b};j++}while(j==0||h!=a||g!=b);return null};this.GetPrevCellRowIndex=function(c,h,d,f,e){for(var b=h,i=this.GetColCount(c),g=this.GetRowCount(c),a=d,a=d;a>=0;a--){if(a==d)b=this.GetPrevRow2(c,h,a,f,e);else b=this.GetPrevRow2(c,g-1,a,f,e);if(b>=0)break}if(b<0)for(a=i-1;a>d;a--){b=this.GetPrevRow2(c,g-1,a,f,e);if(b>=0)break}return b};this.GetPrevCellColIndex=function(c,h,d,f,e){for(var b=h,i=this.GetColCount(c),g=this.GetRowCount(c),a=d,a=d;a>=0;a--){if(a==d)b=this.GetPrevRow2(c,h,a,f,e);else b=this.GetPrevRow2(c,g-1,a,f,e);if(b>=0)break}if(b<0)for(a=i-1;a>d;a--){b=this.GetPrevRow2(c,g-1,a,f,e);if(b>=0)break}return a};this.GetNextCellRowIndex=function(c,h,g,e,d){for(var b=h,i=this.GetColCount(c),f=this.GetRowCount(c),a=0,a=g;a<i;a++){if(a==g)b=this.GetNextRow2(c,h,a,e,d);else b=this.GetNextRow2(c,0,a,e,d);if(b<f)break}if(b==f)for(a=0;a<g;a++){b=this.GetNextRow2(c,0,a,e,d);if(b<f)break}return b};this.GetNextCellColIndex=function(c,h,g,e,d){for(var b=h,i=this.GetColCount(c),f=this.GetRowCount(c),a=0,a=g;a<i;a++){if(a==g)b=this.GetNextRow2(c,h,a,e,d);else b=this.GetNextRow2(c,0,a,e,d);if(b<f)break}if(b==f)for(a=0;a<g;a++){b=this.GetNextRow2(c,0,a,e,d);if(b<f)break}return a};this.GetNextCol=function(b,e,i,g,f){var c=null,a=i,h=this.GetColCount(b);while(a<h){var d=this.GetSpanCell(e,a,this.GetSpanCells(b,this.GetViewportFromCell(b,b.anchorCell)));if(d!=null)a=d.col+d.colCount;else a++;c=this.GetCellFromRowCol(b,e,a);if(c==null)break;var j=g&&c.getAttribute("TabStop")=="false"||f&&c.getAttribute("canFocus")=="false";if(!j)break}return a};this.UpdateLeadingCell=function(a,c,b){var d=0;if(a.getAttribute("LayoutMode")){d=this.GetRowFromViewPort(a,c,b);var e=this.GetCellFromRowCol(a,d,b);if(e)d=e.parentNode.getAttribute("row")}var f=this.FireActiveCellChangingEvent(a,c,b,d);if(!f){var g=this.GetOperationMode(a);g!="MultiSelect"&&this.ClearSelection(a);a.leadingCellCol=b;a.leadingCellRow=c;a.selectStartCol=b;a.selectStartRow=c;this.UpdateAnchorCell(a,c,b,null,false,a.getAttribute("LayoutMode")!=null)}return f};this.GetPrevRow2=function(c,h,f,e,d){var b=null,a=h;while(a>=0){a=this.GetPrevRow(c,a);b=this.GetCellFromRowCol(c,a,f);var g=e&&b.getAttribute("TabStop")=="false"||d&&b.getAttribute("canFocus")=="false";if(!g)break;a=a-1}return a};this.GetPrevRow=function(c,a){if(a<0)return 0;var b=this.GetViewport(c);if(a<c.frzRows){b=this.GetViewport0(c);if(b==null)b=this.GetViewport1(c)}while(b!=null&&a<b.rows.length)if(this.IsChildSpreadRow(c,b,a))a--;else break;var e=0;if(a>=c.frzRows){a=a-c.frzRows;e=c.frzRows}if(c.frzCols<this.GetColCount(c)){var d=this.GetViewport2(c);while((d==null||a<d.rows.length&&d.rows[a].cells.length==0)&&b!=null&&a>0&&b.rows[a].cells.length==0)a--}if(b!=null&&a>=0&&a<b.rows.length)if(b.rows[a].getAttribute("previewrow"))a--;return a+e};this.GetNextRow2=function(b,i,g,f,e){var c=null,a=i,d=this.GetRowCountInternal(b);while(a<d){a=this.GetNextRow(b,a);if(a>=d)break;c=this.GetCellFromRowCol(b,a,g);var h=f&&c.getAttribute("TabStop")=="false"||e&&c.getAttribute("canFocus")=="false";if(!h)break;a=a+1}return a};this.GetNextRow=function(c,a){var b=this.GetViewport(c);if(a<c.frzRows){b=this.GetViewport0(c);if(b==null)b=this.GetViewport1(c)}while(b!=null&&a<b.rows.length)if(this.IsChildSpreadRow(c,b,a))a++;else break;var e=0;if(a>=c.frzRows){a=a-c.frzRows;e=c.frzRows}if(c.frzCols<this.GetColCount(c)){var d=this.GetViewport2(c);while((d==null||a<d.rows.length&&d.rows[a].cells.length==0)&&b!=null&&a<b.rows.length&&b.rows[a].cells.length==0)a++}if(b!=null&&a>=0&&a<b.rows.length)if(b.rows[a].getAttribute("previewrow"))a++;return a+e};this.FireActiveCellChangedEvent=function(b,e,d,c){var a=this.CreateEvent("ActiveCellChanged");a.cmdID=b.id;a.Row=a.row=this.GetSheetIndex(b,e);a.Col=a.col=d;if(c!=null&&b.getAttribute("LayoutMode"))a.InnerRow=a.innerRow=c;this.FireEvent(b,a);b.editModePermanent&&this.DoGetFocus(b)};this.FireActiveCellChangingEvent=function(b,e,d,c){var a=this.CreateEvent("ActiveCellChanging");a.cancel=false;a.cmdID=b.id;a.row=this.GetSheetIndex(b,e);a.col=d;if(b.getAttribute("LayoutMode"))a.innerRow=c;this.FireEvent(b,a);return a.cancel};this.GetSheetRowIndex=function(a,b){b=this.GetDisplayIndex(a,b);if(b<0)return-1;var c=null;if(a.frzRows>0){if(b>=a.frzRows&&this.GetViewport(a)!=null)c=this.GetViewport(a).rows[b-a.frzRows];else if(b<a.frzRows&&this.GetViewport1(a)!=null)c=this.GetViewport1(a).rows[b]}else c=this.GetViewport(a).rows[b];return c!=null?c.getAttribute("FpKey"):-1};this.GetSheetColIndex=function(a,d,e){var b=-1;if(a.getAttribute("LayoutMode")){var f=this.GetDisplayIndex2(a,e),c=this.GetCellByRowCol(a,f,d);if(c!=null)b=parseInt(c.getAttribute("col"))}else b=a.GetColKeyFromCol(d);return b};this.GetCellByRowCol=function(b,a,c){a=this.GetDisplayIndex(b,a);return this.GetCellFromRowCol(b,a,c)};this.GetHeaderCellFromRowCol=function(a,b,d,f){if(b<0||d<0)return null;var c=null;if(f)if(d<a.frzCols)c=this.GetFrozColHeader(a);else c=this.GetColHeader(a);else if(b<a.frzRows)c=this.GetFrozRowHeader(a);else c=this.GetRowHeader(a);var e=this.GetSpanCell(b,d,this.GetSpanCells(a,c));if(e!=null){b=e.row;d=e.col}var g=this.GetCellIndex(a,b,d,this.GetSpanCells(a,c));if(!f)if(b>=a.frzRows)b-=a.frzRows;return c.rows[b].cells[g]};this.GetCellFromRowCol=function(a,b,d,e){if(b<0||d<0)return null;var c=null;if(b<a.frzRows)if(d<a.frzCols)c=this.GetViewport0(a);else c=this.GetViewport1(a);else if(d<a.frzCols)c=this.GetViewport2(a);else c=this.GetViewport(a);var i=a.spanCells,g=this.GetSpanCell(b,d,i);if(g!=null){b=g.row;d=g.col}var f=0,h=false;if(c!=null)h=c.parentNode.getAttribute("hiddenCells");if(e!=null&&!h){if(e.cellIndex<e.parentNode.cells.length-1)f=e.cellIndex+1}else f=this.GetCellIndex(a,b,d,i);if(b>=a.frzRows)b-=a.frzRows;return b>=0&&b<c.rows.length?c.rows[b].cells[f]:null};this.getFirstCellFromCol=function(b,g){for(var f=this.GetRowCountInternal(b),e=this.GetColCount(b),c=0;c<f;c++)for(var d=0;d<e;d++){var a=this.GetCellFromRowCol(b,c,d);if(a!=null&&a.getAttribute("col")==g)return a}return null};this.GetHiddenValue=function(e,a,c){if(c==null)return;a=this.GetDisplayIndex(e,a);var d=null,b=null;b=this.GetViewport(e);if(b!=null&&a>=0&&a<b.rows.length){var f=b.rows[a];d=f.getAttribute("hv"+c)}return d};this.GetValue=function(a,b,f){b=this.GetDisplayIndex(a,b);var c=this.GetCellFromRowCol(a,b,f),e=this.GetRender(c),d=this.GetValueFromRender(a,e);return d==" "&&c.getAttribute("whiteSpace")==null?"":d};this.SetValue=function(a,d,g,b,e,f){d=this.GetDisplayIndex(a,d);if(b!=null&&typeof b!="string")b=new String(b);var c=this.GetCellFromRowCol(a,d,g);if(this.ValidateCell(a,c,b)){this.SetCellValueFromView(c,b);if(b!=null)this.SetCellValue(a,c,""+b,e,f);else this.SetCellValue(a,c,"",e,f);this.SizeSpread(a);$$.browser.version>=4&&this.ScrollView(a,true)}else if(a.getAttribute("lcidMsg")!=null)alert(a.getAttribute("lcidMsg"));else alert("Can't set the data into the cell. The data type is not correct for the cell.")};this.SetActiveCell=function(a,d,e){a.ignoreFireSelectionChanged=true;var f=this.GetPageActiveSpread();a.getAttribute("mcctCellType")==null&&(f==null||f!=a)&&this.DoGetFocus(a);var h=a.anchorCell;this.ClearSelection(a,true);d=this.GetDisplayIndex(a,d);var g=this.GetCellFromRowCol(a,d,e);if(g!=null){var i=this.FireActiveCellChangingEvent(a,d,e);if(i)return}this.UpdateAnchorCell(a,d,e);this.ResetLeadingCell(a);var b=this.GetParent(this.GetViewport(a)),c=this.GetCellFromRowCol(a,d,e);if(c!=null&&b!=null){if(c.offsetLeft<b.scrollLeft||c.offsetLeft+c.offsetWidth>b.scrollLeft+b.clientWidth)b.scrollLeft=c.offsetLeft;if(c.offsetTop<b.scrollTop||c.offsetTop+c.offsetHeight>b.scrollTop+b.clientHeight)b.scrollTop=c.offsetTop}a.ignoreFireSelectionChanged=false;if(a.anchorCell!=h){var j=this.CreateEvent("SelectionChanged");this.FireEvent(a,j);this.FireActiveCellChangedEvent(a,a.leadingCellRow,a.leadingCellCol)}};this.GetOperationMode=function(b){return b.getAttribute("OperationMode")};this.SetOperationMode=function(b,a){b.setAttribute("OperationMode",a)};this.GetEnableRowEditTemplate=function(b){return b.getAttribute("EnableRowEditTemplate")};this.GetSelectionPolicy=function(b){return b.getAttribute("SelectionPolicy")};this.GetSelectionUnit=function(b){var a=b.getAttribute("SelectionUnit");return a!=null?a:"Cell"};this.UpdateAnchorCell=function(a,c,e,d,g,f){if(a.getAttribute("LayoutMode")&&a.allowGroup&&g)c=this.GetRowFromViewPort(a,c,e);a.anchorCell=this.GetCellFromRowCol(a,c,e);if(a.anchorCell==null)return;var h=this.GetRowKeyFromCell(a,a.anchorCell);this.SetActiveRow(a,h);this.SetActiveCol(a,a.getAttribute("LayoutMode")?this.GetColKeyFromCell2(a,a.anchorCell):this.GetColKeyFromCell(a,a.anchorCell));if(d==null||d){var b=this.GetOperationMode(a);if(b=="RowMode"||b=="SingleSelect")!this.IsRowSelected(a,c)&&this.SelectRow(a,c,1,true,true);this.PaintSelections(a,true,f);this.PaintFocusRect(a);if(!(b=="RowMode"||b=="SingleSelect")&&b!="MultiSelect"&&b!="ExtendedSelect")a.selectType=""}};this.ResetLeadingCell=function(a){if(a.anchorCell==null||!this.IsChild(a.anchorCell,a))return;a.leadingCellRow=this.GetRowFromCell(a,a.anchorCell);a.leadingCellCol=this.GetColFromCell(a,a.anchorCell);this.SelectRange(a,a.leadingCellRow,a.leadingCellCol,1,1,true)};this.Edit=function(a,b){var e=this.GetOperationMode(a);if(e!="RowMode")return;var c=a.getAttribute("name"),d=a.getAttribute("ajax")!="false";if(d){FarPoint&&FarPoint.System.WebControl.MultiColumnComboBoxCellTypeUtilitis&&FarPoint.System.WebControl.MultiColumnComboBoxCellTypeUtilitis.CloseAll();this.SyncData(c,"Edit,"+b,a)}else __doPostBack(c,"Edit,"+b);a.setAttribute("editingInTemplate","true")};this.Update=function(a){this.GetOperationMode(a)=="RowMode"&&this.GetEnableRowEditTemplate(a)=="true"&&a.setAttribute("editingInTemplate","false");if(this.editing)return;this.SaveData(a);var b=a.getAttribute("name"),c=a.getAttribute("ajax")!="false";if(c)this.SyncData(b,"Update",a);else __doPostBack(b,"Update")};this.Cancel=function(a){var d=document.getElementById(a.id+"_data");d.value="";this.SaveData(a);var b=a.getAttribute("name"),c=a.getAttribute("ajax")!="false";if(c)this.SyncData(b,"Cancel",a);else __doPostBack(b,"Cancel")};this.Add=function(b){if(this.editing)return;var a=null,c=this.GetPageActiveSpread();if(c!=null)a=c.getAttribute("name");else a=b.getAttribute("name");var d=b.getAttribute("ajax")!="false";if(d)this.SyncData(a,"Add",b);else __doPostBack(a,"Add")};this.Insert=function(b){if(this.editing)return;var a=null,c=this.GetPageActiveSpread();if(c!=null)a=c.getAttribute("name");else a=b.getAttribute("name");var d=b.getAttribute("ajax")!="false";if(d)this.SyncData(a,"Insert",b);else __doPostBack(a,"Insert")};this.Delete=function(b){if(this.editing)return;var a=null,c=this.GetPageActiveSpread();if(c!=null)a=c.getAttribute("name");else a=b.getAttribute("name");var d=b.getAttribute("ajax")!="false";if(d)this.SyncData(a,"Delete",b);else __doPostBack(a,"Delete")};this.Print=function(c){if(this.editing)return;this.SaveData(c);if(document.printSpread==null){var a=document.createElement("IFRAME");a.name="printSpread";a.style.position="absolute";a.style.left="-10px";a.style.width="0px";a.style.height="0px";document.printSpread=a;document.body.insertBefore(a,null);a.addEventListener("load",function(){the_fpSpread.PrintSpread()},false)}var d=this.GetForm(c);if(d==null)return;var b=d;b.__EVENTTARGET.value=c.getAttribute("name");b.__EVENTARGUMENT.value="Print";var e=b.target;b.target="printSpread";b.submit();b.target=e};this.PrintSpread=function(){document.printSpread.contentWindow.focus();document.printSpread.contentWindow.print();window.focus();var a=this.GetPageActiveSpread();a!=null&&this.Focus(a)};this.PrintPDF=function(a){if(this.editing)return;this.SaveData(a);var c=this.GetForm(a);if(c==null)return;var b=c;b.__EVENTTARGET.value=a.getAttribute("name");b.__EVENTARGUMENT.value="PrintPDF";b.submit()};this.GotoPage=function(a,c,d){if(this.editing)return;if(a.dirty){this.SaveData(a);a.dirty=false}var b=a.getAttribute("name"),e=a.getAttribute("ajax")!="false";if(e)this.SyncData(b,"Page,"+c,a,d);else __doPostBack(b,"Page,"+c)};this.ScrollToPage=function(a,c,h,f){if(this.editing)return;if(a.dirty){this.SaveData(a);a.dirty=false}var d=h?"ScrollUpToPage":"ScrollDownToPage",e=a.getAttribute("name"),b=this.GetCurrentPageIndex(a),g=a.getAttribute("ajax")!="false";if(g)this.SyncData(e,d+","+c+","+b,a,f);else __doPostBack(e,d+","+c+","+b)};this.Next=function(a){if(this.editing)return;var b=a.getAttribute("name"),c=a.getAttribute("ajax")!="false";if(c)this.SyncData(b,"Next",a);else __doPostBack(b,"Next")};this.Prev=function(a){if(this.editing)return;var b=a.getAttribute("name"),c=a.getAttribute("ajax")!="false";if(c)this.SyncData(b,"Prev",a);else __doPostBack(b,"Prev")};this.GetViewportFromCell=function(b,c){if(c!=null){var a=c;while(a!=null){if(a.tagName=="TABLE")break;a=a.parentNode}if(a==this.GetViewport(b)||a==this.GetViewport0(b)||a==this.GetViewport1(b)||a==this.GetViewport2(b))return a}return null};this.IsChild=function(c,b){if(c==null||b==null)return false;var a=c.parentNode;while(a!=null){if(a==b)return true;a=a.parentNode}return false};this.GetCorner=function(a){return a.corner};this.GetFooterCorner=function(a){return a.footerCorner};this.Select=function(b,h,g){if(this.GetSpread(h)!=b||this.GetSpread(g)!=b)return;if(this.InRowHeader(b,h)||this.InRowHeader(b,g))if((b.selectionBlockOptions&SelectionBlockOptions.Rows)==0&&this.GetOperationMode(b)=="Normal"&&b.selectType!="r")return;if(this.InColHeader(b,h)||this.InColHeader(b,g))if((b.selectionBlockOptions&SelectionBlockOptions.Columns)==0&&this.GetOperationMode(b)=="Normal"&&b.selectType!="c")return;if(!this.IsHeaderCell(b,h)&&!this.IsHeaderCell(b,g))if((b.selectionBlockOptions&SelectionBlockOptions.Cells)==0&&this.GetOperationMode(b)=="Normal"&&b.selectType=="")return;if(b.selectStartRow==null)b.selectStartRow=this.GetRowFromCell(b,h);if(b.selectStartCol==null)b.selectStartCol=this.GetColFromCell(b,h);var f=b.selectStartRow,e=b.selectStartCol,d=this.GetRowFromCell(b,g),c=0;if(b.selectType=="r"){c=-1;if(this.IsChild(g,this.GetColHeader(b)))d=0}else if(b.selectType=="c"){if(this.IsChild(g,this.GetRowHeader(b)))c=0;else c=this.GetColFromCell(b,g);d=-1}else if(this.IsChild(g,this.GetColHeader(b))){d=0;c=this.GetColFromCell(b,g)}else if(this.IsChild(g,this.GetRowHeader(b)))c=0;else c=this.GetColFromCell(b,g);if(b.selectType=="t")e=c=f=d=-1;var j=Math.max(f,d);f=Math.min(f,d);d=j;j=Math.max(e,c);e=Math.min(e,c);c=j;var a=null,k=this.GetSelection(b),i=k.lastChild;if(i!=null){var o=this.GetRowByKey(b,i.getAttribute("row")),n=this.GetColByKey(b,i.getAttribute("col")),m=parseInt(i.getAttribute("rowcount")),l=parseInt(i.getAttribute("colcount"));a=new this.Range;this.SetRange(a,"cell",o,n,m,l)}if(a!=null&&a.col==-1&&a.row==-1)return;if(a!=null&&a.col==-1&&a.row>=0)if(a.row>d||a.row+a.rowCount-1<f){this.PaintSelection(b,a.row,a.col,a.rowCount,a.colCount,false);this.PaintSelection(b,f,e,d-f+1,c-e+1,true)}else if(f>a.row){var j=f-a.row;this.PaintSelection(b,a.row,a.col,j,a.colCount,false);if(d<a.row+a.rowCount-1)this.PaintSelection(b,d,a.col,a.row+a.rowCount-d,a.colCount,false);else this.PaintSelection(b,a.row+a.rowCount,a.col,d-a.row-a.rowCount+1,a.colCount,true)}else{this.PaintSelection(b,f,a.col,a.row-f,a.colCount,true);if(d<a.row+a.rowCount-1)this.PaintSelection(b,d+1,a.col,a.row+a.rowCount-d-1,a.colCount,false);else this.PaintSelection(b,a.row+a.rowCount,a.col,d-a.row-a.rowCount+1,a.colCount,true)}else if(a!=null&&a.row==-1&&a.col>=0)if(a.col>c||a.col+a.colCount-1<e){this.PaintSelection(b,a.row,a.col,a.rowCount,a.colCount,false);this.PaintSelection(b,f,e,d-f+1,c-e+1,true)}else if(e>a.col){this.PaintSelection(b,a.row,a.col,a.rowCount,e-a.col,false);if(c<a.col+a.colCount-1)this.PaintSelection(b,a.row,c,a.rowCount,a.col+a.colCount-c,false);else this.PaintSelection(b,a.row,a.col+a.colCount,a.rowCount,c-a.col-a.colCount,true)}else{this.PaintSelection(b,a.row,e,a.rowCount,a.col-e,true);if(c<a.col+a.colCount-1)this.PaintSelection(b,a.row,c+1,a.rowCount,a.col+a.colCount-c-1,false);else this.PaintSelection(b,a.row,a.col+a.colCount,a.rowCount,c-a.col-a.colCount+1,true)}else if(a!=null&&a.row>=0&&a.col>=0)this.ExtendSelection(b,a,f,e,d-f+1,c-e+1);else this.PaintSelection(b,f,e,d-f+1,c-e+1,true);this.SetSelection(b,f,e,d-f+1,c-e+1,a==null)};this.ExtendSelection=function(d,a,c,b,h,g){var i=Math.max(a.col,b),f=Math.min(a.col+a.colCount-1,b+g-1),j=Math.max(a.row,c),e=Math.min(a.row+a.rowCount-1,c+h-1);a.row<j&&this.PaintSelection(d,a.row,a.col,j-a.row,a.colCount,false);a.col<i&&this.PaintSelection(d,a.row,a.col,a.rowCount,i-a.col,false);a.row+a.rowCount-1>e&&this.PaintSelection(d,e+1,a.col,a.row+a.rowCount-e-1,a.colCount,false);a.col+a.colCount-1>f&&this.PaintSelection(d,a.row,f+1,a.rowCount,a.col+a.colCount-f-1,false);c<j&&this.PaintSelection(d,c,b,j-c,g,true);b<i&&this.PaintSelection(d,c,b,h,i-b,true);c+h-1>e&&this.PaintSelection(d,e+1,b,c+h-e-1,g,true);b+g-1>f&&this.PaintSelection(d,c,f+1,h,b+g-f-1,true)};this.PaintAnchorCellHeader=function(a,e){var d,c;d=this.GetRowFromCell(a,a.anchorCell);c=this.GetColFromCell(a,a.anchorCell);if(e&&a.anchorCell.getAttribute("group")!=null){var f=this.GetSpanCell(d,c,a.spanCells);if(f!=null&&f.colCount>1){var b=this.GetSelectedRange(a);if(d<b.row||d>=b.row+b.rowCount||c<b.col||c>=b.col+b.colCount)return}}this.GetColHeader(a)!=null&&this.PaintHeaderSelection(a,d,c,1,1,e,true);this.GetRowHeader(a)!=null&&this.PaintHeaderSelection(a,d,c,1,1,e,false)};this.LineIntersection=function(c,e,d,f){var a,b;a=Math.max(c,d);b=Math.min(c+e,d+f);return a<b?{s:a,c:b-a}:null};this.RangeIntersection=function(i,g,e,c,j,h,f,d){var b=this.LineIntersection(i,e,j,f),a=this.LineIntersection(g,c,h,d);return b&&a?{row:b.s,col:a.s,rowCount:b.c,colCount:a.c}:null};this.paintSelection2=function(a,c,b,f,e,d){c<0&&b<0&&this.PaintCornerSelection(a,d);if(c<0){c=0;f=this.GetRowCountInternal(a)}if(b<0){b=0;e=this.GetColCount(a)}this.PaintViewportSelection(a,c,b,f,e,d);this.GetColHeader(a)!=null&&this.GetOperationMode(a)=="Normal"&&this.PaintHeaderSelection(a,c,b,f,e,d,true);this.GetRowHeader(a)!=null&&this.PaintHeaderSelection(a,c,b,f,e,d,false);this.PaintAnchorCell(a)};this.PaintSelection=function(a,b,c,e,d,f){b<0&&c<0&&this.PaintCornerSelection(a,f);var n=false,o=false,s,r,v;if(b<0){s=b;b=0;e=this.GetRowCountInternal(a)}if(c<0){r=c;c=0;d=this.GetColCount(a)}this.PaintViewportSelection(a,b,c,e,d,f);for(var p=this.GetSelection(a),j,l,k,i,h,u=0,t=0,m,g,q=p.childNodes.length-1;q>=0;q--){j=p.childNodes[q];if(j){l=parseInt(j.getAttribute("rowIndex"));k=parseInt(j.getAttribute("colIndex"));i=parseInt(j.getAttribute("rowcount"));h=parseInt(j.getAttribute("colcount"));if(l<0||i<0){l=0;i=this.GetRowCountInternal(a)}if(k<0||h<0){k=0;h=this.GetColCount(a)}if(u<i)u=i;if(t<h)t=h;if(q>=p.childNodes.length-1){if(b<=l&&e>=i||a.getAttribute("LayoutMode")&&d==1&&b<parseInt(a.getAttribute("layoutrowcount")))if(this.GetColHeader(a)!=null&&this.GetOperationMode(a)=="Normal"){this.PaintHeaderSelection(a,b,c,e,d,f,true);n=true}if(c<=k&&d>=h)if(this.GetRowHeader(a)!=null){this.PaintHeaderSelection(a,b,c,e,d,f,false);o=true}if(!n&&!o){if(this.GetColHeader(a)!=null&&this.GetOperationMode(a)=="Normal"){this.PaintHeaderSelection(a,b,c,e,d,f,true);n=true}if(this.GetRowHeader(a)!=null){this.PaintHeaderSelection(a,b,c,e,d,f,false);o=true}}}else if(!f&&this.GetOperationMode(a)=="Normal"&&!a.getAttribute("LayoutMode")){m=this.RangeIntersection(b,c,e,d,l,k,i,h);m&&this.PaintViewportSelection(a,m.row,m.col,m.rowCount,m.colCount,true);if(n){g=this.LineIntersection(c,d,k,h);g&&this.PaintHeaderSelection(a,b,g.s,e,g.c,true,true)}if(o){g=this.LineIntersection(b,e,l,i);g&&this.PaintHeaderSelection(a,g.s,c,g.c,d,true,false)}}}}if(s!=null||r!=null)if(u<e&&s<0||t<d&&r<0)v=true;if(p.childNodes.length<=0||a.getAttribute("SelectionPolicy")=="MultiRange"&&v){this.GetColHeader(a)!=null&&this.GetOperationMode(a)=="Normal"&&this.PaintHeaderSelection(a,b,c,e,d,f,true);this.GetRowHeader(a)!=null&&this.PaintHeaderSelection(a,b,c,e,d,f,false)}this.PaintAnchorCell(a)};this.PaintFocusRect=function(b){var d=document.getElementById(b.id+"_focusRectT");if(d==null)return;var a=this.GetSelectedRange(b);if(b.anchorCell==null&&(a==null||a.rowCount==0&&a.colCount==0)){this.HideFocusBorder(b);return}var n=this.GetOperationMode(b);if(n=="RowMode"||n=="SingleSelect"||n=="MultiSelect"||n=="ExtendedSelect"){var g=b.GetActiveRow();if(g<0){var q=this.findAnchorCell(b);if(q!=null)g=this.GetSheetIndex(b,this.GetRowFromCell(b,q));else return}if(b.getAttribute("layoutMode"))g=this.GetFirstMultiRowFromViewport(b,g,false);a=new this.Range;this.SetRange(a,"Row",g,-1,1,-1)}else if(a==null||a.rowCount==0&&a.colCount==0){var g=b.GetActiveRow(),h=b.GetActiveCol();a=new this.Range;this.SetRange(a,"Cell",g,h,b.anchorCell.rowSpan,b.anchorCell.colSpan)}if(a.row<0){a.row=0;a.rowCount=this.GetRowCountInternal(b)}if(a.col<0){a.col=0;a.colCount=this.GetColCount(b);if(b.getAttribute("LayoutMode")&&a.rowCount<parseInt(b.getAttribute("layoutrowcount"))&&a.type=="Row")a.rowCount=parseInt(b.getAttribute("layoutrowcount"))}var e;if(b.getAttribute("LayoutMode"))e=a.innerRow!=null?a.innerRow:a.row;else e=a.row;var c=null;if(e>-1)c=this.GetCellFromRowCol(b,e,a.col);else if(b.getAttribute("LayoutMode"))if(b.anchorCell!=null){e=parseInt(b.anchorCell.parentNode.getAttribute("row"));c=this.GetCellFromRowCol(b,e,a.col)}else{var o=this.GetSelection(b).lastChild;if(o!=null&&o.getAttribute("col")!="-1"){c=this.getFirstCellFromCol(b,o.getAttribute("col"));if(c)e=parseInt(c.parentNode.getAttribute("row"))}}if(c==null)return;if(a.rowCount==1&&a.colCount==1){a.rowCount=c.rowSpan;a.colCount=c.colSpan;if(c.colSpan>1&&!c.getAttribute("group")&&!b.getAttribute("LayoutMode")){var t=parseInt(c.getAttribute("col"));if(!isNaN(t))a.col=this.GetColByKey(b,t)}}var i=this.GetOffsetTop(b,c),f=this.GetOffsetLeft(b,c);if(this.GetViewport(b).cellSpacing>0){if(a.col==0)f=f-1;if(a.row==0)i=i-1}if(c.rowSpan>1){e=c.parentNode.rowIndex;var l=this.GetCellFromRowCol(b,e,a.col+a.colCount-1);if(l!=null&&l.parentNode.rowIndex>c.parentNode.rowIndex)i=this.GetOffsetTop(b,l);if(b.getAttribute("LayoutMode")&&a.rowCount<c.rowSpan&&(a.type=="Column"||a.type=="Row"))a.rowCount=c.rowSpan}if(c.colSpan>1){var l=this.GetCellFromRowCol(b,e+a.rowCount-1,a.col),u=this.GetOffsetLeft(b,l);if(u>f){f=u;c=l}if(b.getAttribute("LayoutMode")&&a.colCount<c.colSpan&&(a.type=="Column"||a.type=="Row"))a.colCount=c.colSpan}for(var j=0,s=this.GetViewport(b).rows,g=e;g<e+a.rowCount&&g<s.length;g++){j+=s[g].offsetHeight;if(g>e)j+=parseInt(this.GetViewport(b).cellSpacing)}var k=0,m=this.GetColGroup(this.GetViewport(b));if(m.childNodes==null||m.childNodes.length==0)return;for(var h=a.col;h<a.col+a.colCount&&h<m.childNodes.length;h++){k+=m.childNodes[h].offsetWidth;if(h>a.col)k+=parseInt(this.GetViewport(b).cellSpacing)}if(a.col>c.cellIndex&&a.type=="Column"){var p=b.getAttribute("LayoutMode")!=null?parseInt(c.getAttribute("scol")):parseInt(c.getAttribute("col"));if(c.getAttribute("group"))p=c.cellIndex;for(var h=p;h<a.col;h++){f+=m.childNodes[h].offsetWidth;if(h>p)f+=parseInt(this.GetViewport(b).cellSpacing)}}if(a.row>0)i-=2;else j-=2;if(a.col>0)f-=2;else k-=2;if(parseInt(this.GetViewport(b).cellSpacing)>0){i+=1;f+=1}else{k+=1;j+=1}if(b.virtualPaging=="true"){var r=document.getElementById(b.id+"_VirtualPaging_Top");if(r)i+=r.offsetHeight}if(k<0)k=0;if(j<0)j=0;d.style.left=""+f+"px";d.style.top=""+i+"px";d.style.width=""+k+"px";d=document.getElementById(b.id+"_focusRectB");d.style.left=""+f+"px";d.style.top=""+(i+j)+"px";d.style.width=""+k+"px";d=document.getElementById(b.id+"_focusRectL");d.style.left=""+f+"px";d.style.top=""+i+"px";d.style.height=""+j+"px";d=document.getElementById(b.id+"_focusRectR");d.style.left=""+(f+k)+"px";d.style.top=""+i+"px";d.style.height=""+j+"px"};this.PaintCornerSelection=function(d,f){var e=true;if(this.GetTopSpread(d).getAttribute("ShowHeaderSelection")=="false")e=false;if(!e)return;var a=this.GetCorner(d);if(a!=null&&a.rows.length>0)for(var b=0;b<a.rows.length;b++)for(var c=0;c<a.rows[b].cells.length;c++)a.rows[b].cells[c]!=null&&this.PaintSelectedCell(d,a.rows[b].cells[c],f)};this.PaintHeaderSelection=function(a,b,g,f,k,n,e){var l=true;if(this.GetTopSpread(a).getAttribute("ShowHeaderSelection")=="false")l=false;if(!l)return;var r=e?a.colSpanCells:a.rowSpanCells;if(a.getAttribute("LayoutMode")&&e){if(f>parseInt(a.getAttribute("layoutrowcount")))f=parseInt(a.getAttribute("layoutrowcount"));var q=this.GetCellFromRowCol(a,b,g);if(a.allowGroup&&q.getAttribute("group")!=null)b=this.GetFirstMultiRowFromViewport(a,b,true);for(var c=b;c<b+f;c++)for(var d=g;d<g+k;d++){var o=this.GetCellFromRowCol(a,c,d);if(o){var i=this.GetRowTemplateRowFromCell(a,o);if(!isNaN(i)){if(i>=parseInt(a.getAttribute("layoutrowcount")))i=parseInt(a.getAttribute("layoutrowcount"))-1;var h=this.GetHeaderCellFromRowCol(a,i,d,e);h!=null&&this.GetRowTemplateRowFromCell(a,h)==i&&this.PaintSelectedCell(a,h,n)}}}}else{var j=this.GetRowCountInternal(a),p=this.GetColCount(a);if(e){if(this.GetColHeader(a)==null)return;b=0;f=j=this.GetColHeader(a).rows.length}else{if(this.GetRowHeader(a)==null)return;g=0;var m=this.GetColGroup(this.GetRowHeader(a));if(m==null)return;k=p=m.childNodes.length}}if(a.getAttribute("LayoutMode")&&a.getAttribute("OperationMode")!="Normal"&&!e)b=this.GetFirstMultiRowFromViewport(a,b,false);if(a.getAttribute("LayoutMode")&&a.anchorCell!=null&&a.anchorCell.getAttribute("group")!=null&&!e&&f!=j)f=1;for(var c=b;c<b+f&&c<j;c++){if(!e&&this.IsChildSpreadRow(a,this.GetViewport(a),c))continue;for(var d=g;d<g+k&&d<p;d++){if(!a.getAttribute("LayoutMode")&&this.IsCovered(a,c,d,r))continue;var h=this.GetHeaderCellFromRowCol(a,c,d,e);h!=null&&this.PaintSelectedCell(a,h,n)}}};this.PaintViewportSelection=function(a,f,h,e,k,i){var g=this.GetRowCountInternal(a),j=this.GetColCount(a);if(a.getAttribute("LayoutMode")&&a.getAttribute("OperationMode")!="Normal"&&e==parseInt(a.getAttribute("layoutrowcount")))f=this.GetFirstMultiRowFromViewport(a,f,false);if(a.getAttribute("LayoutMode")&&a.anchorCell!=null&&a.anchorCell.getAttribute("group")!=null&&e!=g)e=1;for(var b=f;b<f+e&&b<g;b++){if(this.IsChildSpreadRow(a,this.GetViewport(a),b))continue;for(var c=null,d=h;d<h+k&&d<j;d++){if(this.IsCovered(a,b,d,a.spanCells))continue;c=this.GetCellFromRowCol(a,b,d,c);c!=null&&c.parentNode.getAttribute("previewRow")==null&&this.PaintSelectedCell(a,c,i)}}};this.Copy=function(a){var k=this.GetPageActiveSpread();if(k!=null&&k!=a&&this.GetTopSpread(k)==a){this.Copy(k);return}if(this.GetEnableRowEditTemplate(a)=="true"&&this.GetOperationMode(a)=="RowMode")return;var p=this.GetSelection(a),c=p.lastChild;if(c!=null){var g,e,j,i;a.copymulticol=false;if(a.getAttribute("LayoutMode")&&c.getAttribute("col")!="-1"&&c.getAttribute("row")=="-1"&&c.getAttribute("rowcount")=="-1"){var b=a.anchorCell;if(b){g=b.parentNode.getAttribute("row");e=this.GetColFromCell(a,b);j=this.GetRowCountInternal(a);i=parseInt(c.getAttribute("colcount"));a.copymulticol=true}}else if(a.getAttribute("LayoutMode")&&c.getAttribute("col")=="-1"&&c.getAttribute("colcount")=="-1"&&c.getAttribute("row")!=-1){var q=parseInt(c.getAttribute("row"));g=this.GetFirstRowFromKey(a,q);e=parseInt(c.getAttribute("colIndex"));j=parseInt(a.getAttribute("layoutrowcount"))}else{g=a.getAttribute("LayoutMode")?parseInt(c.getAttribute("rowIndex")):this.GetRowByKey(a,c.getAttribute("row"));e=a.getAttribute("LayoutMode")?parseInt(c.getAttribute("colIndex")):this.GetColByKey(a,c.getAttribute("col"));j=parseInt(c.getAttribute("rowcount"));i=parseInt(c.getAttribute("colcount"))}var m=false;if(g<0||a.copymulticol){if(!a.copymulticol){g=0;j=this.GetRowCountInternal(a)}var l=this.CreateEvent("CopyData");l.spread=a;l.includeColHeader=false;this.FireEvent(a,l);m=l.includeColHeader}if(e<0){e=0;i=this.GetColCount(a)}var d="";if(m)for(var h=g;h<this.GetColHeader(a).rows.length;h++){for(var b=null,f=e;f<e+i;f++){if(this.IsCovered(a,h,f,a.colSpanCells))d+="";else{b=this.GetHeaderCellFromRowCol(a,h,f,true);if(a.getAttribute("LayoutMode")&&a.copymulticol&&(b==null||b.parentNode.getAttribute("row")!=g))continue;var o=this.GetCellType(b);if(o=="TextCellType"&&b.getAttribute("password")!=null)d+="";else d+=this.GetCellValueFromView(a,b)}if(f+1<e+i)d+="\t"}d+="\r\n"}var n=g;if(m)n=0;for(var h=n;h<g+j;h++){if(this.IsChildSpreadRow(a,this.GetViewport(a),h))continue;for(var b=null,f=e;f<e+i;f++){if(this.IsCovered(a,h,f,a.spanCells))d+="";else{b=this.GetCellFromRowCol(a,h,f,b);if(a.getAttribute("LayoutMode")&&a.copymulticol&&(b==null||b.parentNode.getAttribute("row")!=g))continue;if(b!=null&&b.parentNode.getAttribute("previewrow")!=null)continue;var o=this.GetCellType(b);if(o=="TextCellType"&&b.getAttribute("password")!=null)d+="";else d+=this.GetCellValueFromView(a,b)}if(f+1<e+i)d+="\t"}d+="\r\n"}this.clipboardData=d}else if(a.anchorCell!=null){var d=this.GetCellValueFromView(a,a.anchorCell);this.clipboardData=d}};this.GetCellValueFromView=function(d,b){var a=null;if(b!=null){var c=this.GetRender(b);a=this.GetValueFromRender(d,c);if(a==null||a==" ")a=""}return a};this.SetCellValueFromView=function(a,f,e){if(a!=null){var b=this.GetRender(a),d=this.GetCellType(a),c=false;if(d=="readonly"&&a.getAttribute("locked")!="true"&&a.getAttribute("canFocus")=="false")c=true;if((d!="readonly"||e||c)&&b!=null&&b.getAttribute("FpEditor")!="Button"){this.SetValueToRender(b,f);return true}}return false};this.Paste=function(a){var n=this.GetPageActiveSpread();if(n!=null&&n!=a&&this.GetTopSpread(n)==a){this.Paste(n);return}if(this.GetEnableRowEditTemplate(a)=="true"&&this.GetOperationMode(a)=="RowMode")return;if(a.anchorCell==null)return;var x=this.clipboardData;if(x==null)return;var E=this.GetViewportFromCell(a,a.anchorCell),i=this.GetRowFromCell(a,a.anchorCell),h=this.GetColFromCell(a,a.anchorCell),y=this.GetColCount(a),r=this.GetRowCountInternal(a),t=this.GetSelection(a);if(t!=null){var c=t.lastChild;if(c!=null){var i=parseInt(c.getAttribute("row")),h=parseInt(c.getAttribute("col"));if(a.getAttribute("LayoutMode")&&c.getAttribute("col")!="-1"&&c.getAttribute("row")=="-1"&&c.getAttribute("rowcount")=="-1"){var b=a.anchorCell;if(b){i=b.parentNode.getAttribute("row");h=this.GetColFromCell(a,b)}}else if(a.getAttribute("LayoutMode")&&c.getAttribute("col")=="-1"&&c.getAttribute("colcount")=="-1"&&c.getAttribute("row")!=-1){var C=parseInt(c.getAttribute("row"));i=this.GetFirstRowFromKey(a,C);h=parseInt(c.getAttribute("colIndex"))}else{i=a.getAttribute("LayoutMode")?parseInt(c.getAttribute("rowIndex")):this.GetRowByKey(a,c.getAttribute("row"));h=a.getAttribute("LayoutMode")?parseInt(c.getAttribute("colIndex")):this.GetColByKey(a,c.getAttribute("col"))}if(i<0)i=0;if(h<0)h=0}}var g=i,f=h,k=new String(x);if(k.length==0)return;var s=k.lastIndexOf("\r\n");if(s>=0&&s==k.length-2)k=k.substring(0,s);for(var q=0,e=k.split("\r\n"),d=0;d<e.length&&g<r;d++){if(typeof e[d]=="string"){e[d]=e[d].split("\t");if(e[d].length>q)q=e[d].length}g++}g=this.GetSheetIndex(a,i);for(var d=0;d<e.length&&g<r;d++){var l=e[d];if(l!=null){f=h;for(var b=null,w=null,m="",z=false,p=this.GetDisplayIndex(a,g),j=0;j<l.length&&f<y;j++){if(!this.IsCovered(a,p,f,a.spanCells)){b=this.GetCellFromRowCol(a,p,f,b);if(b==null)continue;w=this.GetEditor(b);m=this.GetCellType(b);var z=w!=null&&(m=="text"||m=="TextCellType");if(b.parentNode.getAttribute("previewrow")=="true")continue;var o=l[j];if(!z&&!this.ValidateCell(a,b,o)){if(a.getAttribute("lcidMsg")!=null)alert(a.getAttribute("lcidMsg"));else alert("Can't set the data into the cell. The data type is not correct for the cell.");return}}f++}}g++}if(e.length==0)return;g=this.GetSheetIndex(a,i);for(var d=0;d<e.length&&g<r;d++){f=h;for(var l=e[d],b=null,p=this.GetDisplayIndex(a,g),j=0;j<q&&f<y;j++){if(!this.IsCovered(a,p,f,a.spanCells)){b=this.GetCellFromRowCol(a,p,f,b);if(b==null)continue;if(a.getAttribute("LayoutMode")&&a.copymulticol&&parseInt(b.parentNode.getAttribute("row"))!=parseInt(a.anchorCell.parentNode.getAttribute("row")))continue;if(b.parentNode.getAttribute("previewrow")=="true")continue;var m=this.GetCellType(b),u=this.GetRender(b);if(b.getAttribute("CellType2")=="HyperLinkCellType")continue;if(m!="readonly"&&u.getAttribute("FpEditor")!="Button"||m=="readonly"&&b.getAttribute("locked")!="true"){var o=null;if(l!=null&&j<l.length)o=l[j];var B=this.SetCellValueFromView(b,o);if(B)if(o!=null)this.SetCellValue(a,b,""+this.GetValueFromRender(a,u));else this.SetCellValue(a,b,"")}}f++}g++}var A=a.getAttribute("autoCalc");A!="false"&&this.UpdateValues(a);var D=this.GetTopSpread(a),v=document.getElementById(D.id+"_textBox");v!=null&&v.blur();this.SizeSpread(a);$$.browser.version>=4&&this.ScrollView(a,true)};this.getFrozenRowCount=function(a){if(a.frzRows==0)return 0;var b=this.GetViewport0(a);if(b==null)b=this.GetViewport1(a);for(var d=0,c=0;c<b.rows.length;c++){if(!b.rows[c].getAttribute("FpKey"))continue;d++}return Math.min(a.frzRows,d)};this.UpdateValues=function(a){if(a.dataBuff==null&&this.GetParentSpread(a)==null&&a.getAttribute("rowFilter")!="true"&&a.getAttribute("hierView")!="true"&&a.getAttribute("IsNewRow")!="true"){this.SaveData(a);this.StorePostData(a);this.SyncData(a.getAttribute("name"),"UpdateValues",a)}};this.ValidateCell=function(f,a,c){if(a==null||c==null||c=="")return true;var b=null,d=this.GetCellType(a);if(d!=null){var e=this.GetFunction(d+"_isValid");if(e!=null)b=e(a,c)}return b==null||b==""};this.UpdateSelectionsBackColor=function(a,n,m){for(var j=this.GetSelection(a),c=null,h,e,l,k,b,i=0;i<j.childNodes.length;i++){c=j.childNodes[i];h=a.getAttribute("LayoutMode")?parseInt(c.getAttribute("rowIndex")):this.GetRowByKey(a,c.getAttribute("row"));e=a.getAttribute("LayoutMode")?parseInt(c.getAttribute("colIndex")):this.GetColByKey(a,c.getAttribute("col"));l=parseInt(c.getAttribute("rowcount"));k=parseInt(c.getAttribute("colcount"));if(h!=-1&&e!=-1)for(var f=0;f<l;f++)for(var g=0;g<k;g++){if(n==h+f&&m==e+g)continue;b=this.GetCellFromRowCol(a,h+f,e+g);var d=b.style.backgroundColor;if(b!=null&&b.getAttribute("paintSelected")==null){if(a.getAttribute("semiTransparentSelectedBackColor")==null||d==null||d.length==0||d=="transparent"||d=="rgb(0, 0, 0)"||d=="rgba(0, 0, 0, 0)")b.style.backgroundColor=a.getAttribute("selectedBackColor");else b.style.backgroundColor=this.darker(d,a.getAttribute("selectedBackColor"));b.setAttribute("paintSelected",true)}}}};this.DoclearSelection=function(a){var f=this.GetSelection(a),b=f.lastChild;while(b!=null){var c=a.getAttribute("LayoutMode")?parseInt(b.getAttribute("rowIndex")):this.GetRowByKey(a,b.getAttribute("row")),e=a.getAttribute("LayoutMode")?parseInt(b.getAttribute("colIndex")):this.GetColByKey(a,b.getAttribute("col")),d=parseInt(b.getAttribute("rowcount")),h=parseInt(b.getAttribute("colcount"));if(a.getAttribute("LayoutMode")&&c!=-1&&(h==-1||a.getAttribute("OperationMode")!="Normal")){d=parseInt(a.getAttribute("layoutrowcount"));this.PaintSelection(a,c,-1,d,-1,false)}if(a.getAttribute("LayoutMode")&&e!=-1&&(d==-1||a.getAttribute("OperationMode")!="Normal")){var g=this.getFirstCellFromCol(a,b.getAttribute("col"));if(g){c=parseInt(g.parentNode.getAttribute("row"));e=this.GetColFromCell(a,g)}this.PaintMultipleRowSelection(a,c,e,1,h,false)}else this.PaintSelection(a,c,e,d,h,false);f.removeChild(b);b=f.lastChild}};this.Clear=function(ss){var activeSpread=this.GetPageActiveSpread();if(activeSpread!=null&&activeSpread!=ss&&this.GetTopSpread(activeSpread)==ss){this.Clear(activeSpread);return}if(this.GetEnableRowEditTemplate(ss)=="true"&&this.GetOperationMode(ss)=="RowMode")return;var cellType=this.GetCellType(ss.anchorCell);if(cellType=="readonly")return;var selection=this.GetSelection(ss),node=selection.lastChild;if(this.AnyReadOnlyCell(ss,node))return;this.Copy(ss);if(node!=null){var r,c,rc,cc,IsColumn=false;if(ss.getAttribute("LayoutMode")&&node.getAttribute("col")!="-1"&&node.getAttribute("row")=="-1"&&node.getAttribute("rowcount")=="-1"){var cell=ss.anchorCell;if(cell){r=cell.parentNode.getAttribute("row");c=this.GetColFromCell(ss,cell);rc=this.GetRowCountInternal(ss);cc=parseInt(node.getAttribute("colcount"));IsColumn=true}}else if(ss.getAttribute("LayoutMode")&&node.getAttribute("col")=="-1"&&node.getAttribute("row")!=-1){var rowKey=parseInt(node.getAttribute("row"));r=this.GetFirstRowFromKey(ss,rowKey);c=parseInt(node.getAttribute("colIndex"));rc=parseInt(ss.getAttribute("layoutrowcount"))}else{r=ss.getAttribute("LayoutMode")?parseInt(node.getAttribute("rowIndex")):this.GetRowByKey(ss,node.getAttribute("row"));c=ss.getAttribute("LayoutMode")?parseInt(node.getAttribute("colIndex")):this.GetColByKey(ss,node.getAttribute("col"));rc=parseInt(node.getAttribute("rowcount"));cc=parseInt(node.getAttribute("colcount"))}if(r<0){r=0;rc=this.GetRowCountInternal(ss)}if(c<0){c=0;cc=this.GetColCount(ss)}if(this.GetRowHeader(ss)==null){ss.setAttribute("ignoreSizeSpread","true");for(var j=r;j<r+rc;j++)this.SetRowHeight2(ss,j,this.GetRowHeightInternal(ss,j),false);ss.setAttribute("ignoreSizeSpread","false")}for(var i=r;i<r+rc;i++){if(this.IsChildSpreadRow(ss,this.GetViewport(ss),i))continue;for(var cell=null,j=c;j<c+cc;j++)if(!this.IsCovered(ss,i,j,ss.spanCells)){cell=this.GetCellFromRowCol(ss,i,j,cell);if(cell==null)continue;if(ss.getAttribute("LayoutMode")&&IsColumn&&cell.parentNode.getAttribute("row")!=r)continue;if(cell.parentNode.getAttribute("previewrow")!=null)continue;var cellType=this.GetCellType(cell);if(cellType!="readonly"){var edit=this.GetEditor(cell);if(edit!=null&&edit.getAttribute("FpEditor")=="Button")continue;if(edit!=null&&edit.getAttribute("FpEditor")=="MultiColumnComboBoxCellType"){var mccbId=getMccbID(cell,ss);if(mccbId!=null){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval(mccbId+"_Obj");editorObj!=null&&editorObj.SetText(null)}}else{cell.removeAttribute("FpFormula");this.SetCellValueFromView(cell,null)}this.SetCellValue(ss,cell,"")}}}var autoCalc=ss.getAttribute("autoCalc");autoCalc!="false"&&this.UpdateValues(ss);this.EnsureAllRowHeights(ss);$$.browser.version>=4&&this.ScrollView(ss,true)}};this.AnyReadOnlyCell=function(a,c){if(c!=null){var g=parseInt(c.getAttribute("rowIndex")),e=parseInt(c.getAttribute("colIndex")),j=parseInt(c.getAttribute("rowcount")),i=parseInt(c.getAttribute("colcount")),h=null;if(a.getAttribute("LayoutMode")&&c.getAttribute("col")!="-1"){var b=this.getFirstCellFromCol(a,c.getAttribute("col"));if(b)h=b.parentNode.getAttribute("row")}if(g<0){g=0;j=this.GetRowCountInternal(a)}if(e<0){e=0;i=this.GetColCount(a)}for(var d=g;d<g+j;d++){if(this.IsChildSpreadRow(a,this.GetViewport(a),d))continue;for(var b=null,f=e;f<e+i;f++)if(!this.IsCovered(a,d,f,a.spanCells)){b=this.GetCellFromRowCol(a,d,f,b);if(h!=null&&b!=null&&b.parentNode.getAttribute("row")!=h)continue;var k=this.GetCellType(b);if(k=="readonly")return true}}}return false};this.GetViewportFromPoint=function(a,h,b){var i=l2=0,g=t2=0,k=w2=0,j=h2=0,c=this.GetViewport0(a),d=this.GetViewport1(a),e=this.GetViewport2(a),f=this.GetViewport(a);if(c!=null){i=this.GetOffsetLeft(a,c,document.body);k=c.offsetWidth;g=this.GetOffsetTop(a,c,document.body);j=c.offsetHeight}if(e!=null){i=this.GetOffsetLeft(a,e,document.body);k=e.offsetWidth;t2=this.GetOffsetTop(a,e,document.body);h2=e.offsetHeight}if(d!=null){l2=this.GetOffsetLeft(a,d,document.body);w2=d.offsetWidth;g=this.GetOffsetTop(a,d,document.body);j=d.offsetHeight}if(f!=null){l2=this.GetOffsetLeft(a,f,document.body);w2=f.offsetWidth;t2=this.GetOffsetTop(a,f,document.body);h2=f.offsetHeight}if(i<h&&h<l2){if(g<b&&b<t2)return c;else if(t2<b&&b<t2+w2)return e}else if(l2<h&&h<l2+w2)if(g<b&&b<t2)return d;else if(t2<b&&b<t2+w2)return f;return null};this.GetCellFromPoint=function(h,k,l,d){var b=this.GetOffsetLeft(h,d,document.body),c=this.GetOffsetTop(h,d,document.body);if(k<b||l<c)return null;else{for(var g=d.rows,a=null,f=0;f<g.length;f++){var j=g[f];c+=j.offsetHeight;if(l<c){a=j;break}}if(a!=null)for(var e=0;e<a.cells.length;e++){var i=a.cells[e];b+=i.offsetWidth;if(k<b)return i}}return null};this.MoveSliderBar=function(a,e){var c=this.GetElementById(this.activePager,a.id+"_slideBar"),b=e.clientX-this.GetOffsetLeft(a,a,document.body)+window.scrollX-8;if(b<a.slideLeft)b=a.slideLeft;if(b>a.slideRight)b=a.slideRight;var d=parseInt(this.activePager.getAttribute("totalPage"))-1,f=parseInt((b-a.slideLeft)/(a.slideRight-a.slideLeft)*d)+1;if(a.style.position!="absolute"&&a.style.position!="relative")b+=this.GetOffsetLeft(a,a,document.body);c.style.left=b+"px";return f};this.GetOffsetParent=function(b){var a=b;while(a!=document.body&&a.style.position!="absolute"&&a.style.position!="relative"&&a.style.position!="fixed")a=a.offsetParent;if(a==null)a=document.body;return a};this.MouseMove=function(b){if(window.fpPostOn!=null)return;b=this.GetEvent(b);var f=this.GetTarget(b);if(f!=null&&f.tagName=="scrollbar")return;if(f.parentNode!=null&&f.parentNode.getAttribute("previewrow"))return;var a=this.GetSpread(f,true);if(a!=null&&this.dragSlideBar){if(this.activePager!=null){var Z=this.MoveSliderBar(a,b),t=this.GetElementById(this.activePager,a.id+"_posIndicator");t.innerHTML=this.activePager.getAttribute("pageText")+Z}return}if(this.working)a=this.GetSpread(this.activeElement);if(a==null||!this.working&&this.HitCommandBar(f))return;if(a.getAttribute("OperationMode")=="ReadOnly")return;var G=this.IsXHTML(a);if(this.working){if(this.dragCol!=null&&this.dragCol>=0){var n=this.GetMovingCol(a),j=b.clientX;if(n!=null){if(n.style.display=="none")n.style.display="";var x=document.defaultView.getComputedStyle(a,null);if(x.position!="absolute"&&x.position!="relative"){var o=this.GetOffsetParent(a);n.style.top=""+(b.clientY+window.scrollY-this.GetOffsetTop(a,o,document.body))+"px";n.style.left=""+(b.clientX+window.scrollX+5-this.GetOffsetLeft(a,o,document.body))+"px";j-=this.GetOffsetLeft(o,a,document.body)}else{n.style.top=""+(b.clientY-this.GetOffsetTop(a,a,document.body)+window.scrollY)+"px";n.style.left=""+(b.clientX-this.GetOffsetLeft(a,a,document.body)+window.scrollX+5)+"px"}}var u=this.GetViewport(a),ab=document.body,m=this.GetGroupBar(a),d=-1,r=0,e=0,x=document.defaultView.getComputedStyle(a,null);if(x.position!="absolute"&&x.position!="relative"){var o=this.GetOffsetParent(a);r=this.GetOffsetTop(a,a,o)-u.parentNode.scrollTop+a.virtualTop;e=this.GetOffsetLeft(a,a,o)-u.parentNode.scrollLeft;j+=Math.max(document.body.scrollLeft,document.documentElement.scrollLeft)}else j-=this.GetOffsetLeft(a,a,document.body)-Math.max(document.body.scrollLeft,document.documentElement.scrollLeft);var D=false,G=this.IsXHTML(a),E=G?document.body.parentNode.scrollTop:document.body.scrollTop,z=document.getElementById(a.id+"_titleBar");if(z)E-=z.parentNode.parentNode.offsetHeight;if(this.GetPager1(a)!=null)E-=this.GetPager1(a).offsetHeight;if(m!=null&&b.clientY<this.GetOffsetTop(a,a,document.body)-u.parentNode.scrollTop+m.offsetHeight-E){if(a.style.position!="absolute"&&a.style.position!="relative")e=this.GetOffsetLeft(a,a,document.body);r+=10;D=true;var F=m.getElementsByTagName("TABLE")[0];if(F!=null)for(var i=0;i<F.rows[0].cells[0].childNodes.length;i++){var L=F.rows[0].cells[0].childNodes[i].offsetWidth;if(L==null)continue;if(e<=j&&j<e+L){d=i;break}e+=L}if(d==-1&&j>=e)d=-2;a.targetCol=d}else{if(a.style.position=="absolute"||a.style.position=="relative")e=-u.parentNode.scrollLeft;if(this.GetRowHeader(a)!=null)e+=this.GetRowHeader(a).offsetWidth;if(m!=null)r+=m.offsetHeight;if(j<e)d=0;else{var k=a.selectedCols.context;if(k){for(var i=0;i<k.length;i++)if(k[i].left+e<=j&&j<k[i].left+e+k[i].width)d=i;if(this.IsColSelected(a,d))while(this.IsColSelected(a,d)&&this.IsColSelected(a,d-1))d--;else if(this.IsColSelected(a,d-1))d++;if(d<0)d=0;if(d>=k.length)d=k.length-1;e+=k[d].left}}e-=5;var y=parseInt(this.GetSheetColIndex(a,d));if(y<0)if(a.selectedCols.context){var N=a.selectedCols.context[d].colKey;y=N?N:d}else y=d;a.targetCol=y}if(z)r+=z.parentNode.parentNode.offsetHeight;if(this.GetPager1(a)!=null)r+=this.GetPager1(a).offsetHeight;var t=this.GetPosIndicator(a);t.style.left=""+e+"px";t.style.top=""+r+"px";if(m!=null&&D&&m.getElementsByTagName("TABLE").length==0)t.style.display="none";else if(D||a.allowColMove)t.style.display="";else t.style.display="none";var c=this.GetParent(this.GetViewport(a));if(c!=null){var C=this.GetOffsetLeft(a,a,document.body)+c.offsetLeft+c.offsetWidth-20,s=0,B=this.GetViewport2(a);if(B!=null){s=B.offsetWidth;C+=s}if(b.clientX>C){c.scrollLeft=c.scrollLeft+10;this.ScrollView(a);this.UpdatePostbackData(a)}else if(b.clientX<this.GetOffsetLeft(a,a,document.body)+c.offsetLeft+s+5){c.scrollLeft=c.scrollLeft-10;this.ScrollView(a);this.UpdatePostbackData(a)}}return}if(this.sizeColumn==null&&this.sizeRow==null){if(a.anchorCell!=null){var c=this.GetParent(this.GetViewport(a));if(c!=null){var S=this.IsStaticPos(a),K=-Math.max(document.body.parentNode.scrollTop,document.body.scrollTop),J=-Math.max(document.body.parentNode.scrollLeft,document.body.scrollLeft);if(!S||a.frzRows>0||a.frzCols>0){K+=this.GetOffsetTop(a,a,document.body);J+=this.GetOffsetLeft(a,a,document.body)}var R=c.offsetTop+c.offsetHeight-10+K,I=0,W=this.GetViewport1(a);if(W!=null){I=this.GetViewport1(a).offsetHeight;R+=I}a.ignoreVirtualPaging=true;if(b.clientY>R){c.scrollTop=c.scrollTop+10;this.ScrollView(a)}else if(b.clientY<c.offsetTop+I+5+K){var v=true,M=this.GetSelection(a),l=M.lastChild;if(l!=null){var Y=parseInt(l.getAttribute("rowcount")),X=parseInt(l.getAttribute("colcount"));v=(X>0||this.GetOperationMode(a)=="SingleSelect")&&(this.IsChild(a.anchorCell,this.GetViewport(a))||this.IsChild(a.anchorCell,this.GetViewport2(a)));if(parseInt(l.getAttribute("row"))<0)v=false}if(v){if(c.scrollTop-10>=a.virtualTop)c.scrollTop=c.scrollTop-10;else c.scrollTop=a.virtualTop;this.ScrollView(a)}}var C=c.offsetLeft+c.offsetWidth-20+J,s=0,B=this.GetViewport2(a);if(B!=null){s=B.offsetWidth;C+=s}if(b.clientX>C){c.scrollLeft=c.scrollLeft+10;this.ScrollView(a)}else if(b.clientX<c.offsetLeft+s+5+J){var v=true,M=this.GetSelection(a),l=M.lastChild;if(l!=null){var Y=parseInt(l.getAttribute("rowcount")),X=parseInt(l.getAttribute("colcount"));v=Y>0&&(this.IsChild(a.anchorCell,this.GetViewport(a))||this.IsChild(a.anchorCell,this.GetViewport1(a)));if(parseInt(l.getAttribute("col"))<0)v=false}if(v){c.scrollLeft=c.scrollLeft-10;this.ScrollView(a)}}}a.ignoreVirtualPaging=false;var g=this.GetCell(f,null,b);if(g==null&&f!=null){var u=this.GetViewportFromPoint(a,b.clientX,b.clientY);if(u!=null)g=this.GetCellFromPoint(a,b.clientX,b.clientY,u)}if(g!=null&&g!=a.leadingCell){var q=this.GetOperationMode(a);if(q!="MultiSelect"){if(!this.InColHeader(a,g)&&(q=="SingleSelect"||q=="RowMode")){var w=this.GetRowFromCell(a,g),h;if(this.InRowHeader(a,g)){if(a.anchorCell!=null)if(this.InRowHeader(a,a.anchorCell))h=-1;else h=this.GetColFromCell(a,a.anchorCell);else h=-1;if(h==-1){var V=fpSpreadJS.getNextColumn(w,0,false,true,true);if(V==-1)h=this.GetColFromCell(a,g)}}else h=this.GetColFromCell(a,g);var T=this.FireActiveCellChangingEvent(a,w,h);if(T)return;a.oldAnchorCell=a.anchorCell;this.ClearSelection(a);this.UpdateAnchorCell(a,w,h,false);this.SelectRow(a,w,1,true,true);if(this.GetCellFromRowCol(a,a.selectStartRow,h)==a.anchorCell)a.leadingCellRow=a.selectStartRow;this.FireActiveCellChangedEvent(a,w,h)}else if(q!="SingleSelect"&&q!="RowMode"&&!(q=="Normal"&&this.GetSelectionPolicy(a)=="Single")&&!a.getAttribute("LayoutMode")){this.Select(a,a.anchorCell,g);this.SyncColSelection(a)}a.leadingCell=g}}}}else if(this.sizeColumn!=null){var H=b.clientX-this.activeX,A=parseInt(this.sizeColumn.width)+H,P=0,O=A>P;if(O)if(a.frzRows>0||a.frzCols>0){var p=0;if(!G)p+=parseInt(a.style.borderWidth);a.sizeBar.style.cursor=this.GetResizeCursor(false);if(a.style.position=="relative"||a.style.position=="absolute")a.sizeBar.style.left=b.clientX-this.GetOffsetLeft(a,a,document.body)-p+window.scrollX+"px";else{var o=this.GetOffsetParent(a);a.sizeBar.style.left=b.clientX-this.GetOffsetLeft(a,o,document.body)-p+window.scrollX+"px"}}else{this.sizeColumn.width=A;var Q=parseInt(this.sizeColumn.getAttribute("index"));if(this.IsChild(this.sizeColumn,this.GetFrozColHeader(a)))this.SetWidthFix(this.GetFrozColHeader(a),Q,A);else this.SetWidthFix(this.GetColHeader(a),Q-a.frzCols,A);this.activeX=b.clientX}}else if(this.sizeRow!=null){var H=b.clientY-this.activeY,U=parseInt(this.sizeRow.style.height)+H,P=0,O=P<U;if(O)if(a.frzRows>0||a.frzCols>0){var p=0;if(!G)p+=parseInt(a.style.borderWidth);a.sizeBar.style.cursor=this.GetResizeCursor(true);if(a.style.position=="relative"||a.style.position=="absolute")a.sizeBar.style.top=b.clientY-this.GetOffsetTop(a,a,document.body)-p+window.scrollY+"px";else{var o=this.GetOffsetParent(a);a.sizeBar.style.top=b.clientY-this.GetOffsetTop(a,o,document.body)-p+window.scrollY+"px"}}else{this.sizeRow.style.height=""+(parseInt(this.sizeRow.style.height)+H)+"px";this.activeY=b.clientY}}}else{this.activeElement=f;if(this.activeElement==null||this.GetSpread(this.activeElement)!=a)return;var f=this.GetSizeColumn(a,this.activeElement,b);if(f!=null){this.sizeColumn=f;this.activeElement.style.cursor=this.GetResizeCursor(false)}else{var f=this.GetSizeRow(a,this.activeElement,b);if(f!=null){this.sizeRow=f;if(this.activeElement!=null&&this.activeElement.style!=null)this.activeElement.style.cursor=this.GetResizeCursor(true)}else if(this.activeElement!=null&&this.activeElement.style!=null){var g=this.GetCell(this.activeElement);if(g!=null&&this.IsHeaderCell(a,g))if(this.activeElement.getAttribute("FpSpread")=="rowpadding"||this.activeElement.getAttribute("ControlType")=="chgrayarea")this.activeElement.style.cursor=this.GetgrayAreaCursor(a);else this.activeElement.style.cursor="default";else if(this.activeElement!=null&&this.activeElement.style!=null&&(this.activeElement.getAttribute("FpSpread")=="rowpadding"||this.activeElement.getAttribute("ControlType")=="chgrayarea"))this.activeElement.style.cursor=this.GetgrayAreaCursor(a)}}}};this.MouseWheel=function(b){var a=this.GetSpread(b.target,false),c=this.GetTarget(b);if(a!=null&&a.getAttribute("mcctCellType")!="true"&&c.tagName!="OPTION"&&c.tagName!="SELECT"){var e=this.GetSpread(document.activeElement);e!=a&&this.Focus(a,b);a.EndEdit();if(a.getAttribute("ClientAutoSize")!="True"){var d=this.GetParent(this.GetViewport(a));if(d.style.overflow=="hidden"){d.scrollTop+=10*b.detail;this.ScrollView(a)}}}};this.GetgrayAreaCursor=function(a){if(a.tableView!=null&&a.tableView.style.cursor!=null){if(a.tableView.style.cursor=="auto")a.tableView.style.cursor="default";return a.tableView.style.cursor}else return"default"};this.GetResizeCursor=function(a){return a?"n-resize":"w-resize"};this.HitCommandBar=function(c){var a=c,b=this.GetTopSpread(this.GetSpread(a,true));if(b==null)return false;var d=this.GetCommandBar(b);while(a!=null&&a!=b){if(a==d)return true;a=a.parentNode}return false};this.OpenWaitMsg=function(a){var d=document.getElementById(a.id+"_waitmsgcontainer");if(d==null){var b=document.getElementById(a.id+"_waitmsg");b.style.display="block";var h=a.offsetWidth,g=a.offsetHeight,c=this.CreateTestBox(a);c.style.fontFamily=b.style.fontFamily;c.style.fontSize=b.style.fontSize;c.style.fontWeight=b.style.fontWeight;c.style.fontStyle=b.style.fontStyle;c.innerHTML=b.innerHTML;b.style.width=""+(c.offsetWidth+2)+"px";var e=Math.max(10,(h-parseInt(b.offsetWidth))/2),f=Math.max(10,(g-parseInt(b.offsetHeight))/2);if(a.style.position!="absolute"&&a.style.position!="relative"){e+=this.GetOffsetLeft(a,a,b.offsetParent);f+=this.GetOffsetTop(a,a,b.offsetParent)}b.style.top=""+f+"px";b.style.left=""+e+"px"}else{d.style.display="block";var f=Math.max(10,(a.offsetHeight-parseInt(d.offsetHeight))/2),e=a.clientLeft+8;if(a.style.position!="absolute"&&a.style.position!="relative"){e+=this.GetOffsetLeft(a,a,document.body);f+=this.GetOffsetTop(a,a,document.body)}d.style.top=""+f+"px";d.style.left=""+e+"px";d.style.width=""+(a.offsetWidth-a.offsetLeft-8)+"px"}};this.CloseWaitMsg=function(b){var a=document.getElementById(b.id+"_waitmsgcontainer");if(a==null){var c=document.getElementById(b.id+"_waitmsg");if(c!=null)c.style.display="none"}else a.style.display="none"};this.MouseDown=function(c){if(window.fpPostOn!=null)return;c=this.GetEvent(c);var b=this.GetTarget(c),a=this.GetSpread(b,true);this.sizeColumn=this.GetSizeColumn(a,b,c);this.sizeRow=this.GetSizeRow(a,b,c);if(a==null)return;a.isactive=true;a.ignoreBlur=true;a.preventPopUp=false;a.mouseY=c.clientY;var y=this.GetSpread(c.currentTarget,true);if(y!=null&&y!=a)return;var r=this.GetPageActiveSpread();if(this.GetViewport(a)==null)return;if(a!=null&&b.parentNode!=null&&b.parentNode.getAttribute("name")==a.id+"_slideBar"){if(this.IsChild(b,this.GetPager1(a)))this.activePager=this.GetPager1(a);else if(this.IsChild(b,this.GetPager2(a)))this.activePager=this.GetPager2(a);if(this.activePager!=null){var p=true;if(this.editing)p=this.EndEdit(a);if(p){this.UpdatePostbackData(a);this.dragSlideBar=true}}return this.CancelDefault(c)}this.checkOverViewportScrollbar(a,c);if(a!=null)a.working=false;if(this.GetOperationMode(a)=="ReadOnly")return;var w=false;if(a!=null)w=this.IsXHTML(a);if(this.editing&&a.getAttribute("mcctCellType")!="true"){var C=this.GetCell(b);if(C!=a.anchorCell||C==b){var p=null;if($$.browser.version>=4)p=this.EndEdit(true);else p=this.EndEdit();if(!p)return}else return}var v=FpSpreadJS.getTableRow(b);if(r!=null&&this.GetTopSpread(r)==this.GetTopSpread(a)&&this.sizeColumn==null&&this.sizeRow==null&&(this.HitCommandBar(b)||b==this.GetParent(this.GetViewport(a))||b==this.GetParent(this.GetViewport1(a))||b==this.GetParent(this.GetViewport2(a))||b.getAttribute("ControlType")=="chgrayarea"||b.getAttribute("FpSpread")=="rowpadding"||v!=null&&FpSpreadJS.getTable(v)==this.GetRowHeader(a)&&FpSpreadJS.isChildSpreadRow(this.GetViewport(a),v.rowIndex)))return;var J=r==a;this.SetActiveSpread(c);r=this.GetPageActiveSpread();if(this.HitCommandBar(b))return;if(c.button==2)return;if(this.IsChild(b,this.GetGroupBar(a))){var B=parseInt(b.id.replace(a.id+"_group",""));if(!isNaN(B)){this.InitMovingCol(a,B,true,b);this.working=true;a.dragFromGroupbar=true;this.CancelDefault(c);return}}if(this.sizeColumn!=null){this.working=true;this.activeX=this.activeY=c.clientX;if(this.sizeColumn.style!=null)this.sizeColumn.style.cursor=this.GetResizeCursor(false);this.activeElement=b;if(a.frzRows>0||a.frzCols>0){var h=this.GetViewport0(a);if(h==null)h=this.GetViewport1(a);if(h==null)h=this.GetViewport(a);h=h.parentNode;if(this.GetColHeader(a)!=null)a.sizeBar.style.top=""+(this.GetOffsetTop(a,h,a)-this.GetColHeader(a).offsetHeight)+"px";else a.sizeBar.style.top=""+this.GetOffsetTop(a,h,a)+"px";var n=0;if(!w)n+=parseInt(a.style.borderWidth);a.sizeBar.style.cursor=this.GetResizeCursor(false);if(a.style.position=="relative"||a.style.position=="absolute")a.sizeBar.style.left=c.clientX-this.GetOffsetLeft(a,a,document.body)-n+window.scrollX+"px";else{var x=this.GetOffsetParent(a);a.sizeBar.style.left=c.clientX-this.GetOffsetLeft(a,x,document.body)-n+window.scrollX+"px"}var o=0;if(this.GetViewport0(a)!=null)o=this.GetViewport0(a).parentNode.offsetHeight;if(o==0&&this.GetViewport1(a)!=null)o=this.GetViewport1(a).parentNode.offsetHeight;if(this.GetViewport(a)!=null)o+=this.GetViewport(a).parentNode.offsetHeight;if(this.GetColHeader(a)!=null)o+=this.GetColHeader(a).offsetHeight;a.sizeBar.style.height=""+o+"px";a.sizeBar.style.width="2px"}}else if(this.sizeRow!=null){this.working=true;this.activeX=this.activeY=c.clientY;this.sizeRow.style.cursor=this.GetResizeCursor(true);this.activeElement=b;a.working=true;if(a.frzRows>0||a.frzCols>0){var h=this.GetViewport0(a);if(h==null)h=this.GetViewport1(a);if(h==null)h=this.GetViewport(a);h=h.parentNode;var n=0;if(!w)n+=parseInt(a.style.borderWidth);a.sizeBar.style.cursor=this.GetResizeCursor(true);if(a.style.position=="relative"||a.style.position=="absolute"){a.sizeBar.style.left="0px";a.sizeBar.style.top=this.activeY-this.GetOffsetTop(a,a,document.body)-n+window.scrollY+"px"}else{var x=this.GetOffsetParent(a);a.sizeBar.style.left=""+this.GetOffsetLeft(a,a,x)+"px";a.sizeBar.style.top=this.activeY-this.GetOffsetTop(a,x,document.body)-n+window.scrollY+"px"}a.sizeBar.style.height="2px";a.sizeBar.style.width=""+a.offsetWidth+"px"}}else{var e=this.GetCell(b,null,c);if(e==null){var A=this.GetCorner(a);if(A!=null&&this.IsChild(b,A)){if(this.GetOperationMode(a)=="Normal"){a.anchorCell==null&&this.Focus(a);if(a.anchorCell!=null)this.saveAnchorCell(a,a.anchorCell);else{this.SetActiveRow(a,-1);this.SetActiveCol(a,-1)}a.oldAnchorCell=a.anchorCell;this.SelectTable(a,true);if(a.anchorCell){a.leadingCellRow=this.GetRowFromCell(a,a.anchorCell);a.leadingCellCol=this.GetColFromCell(a,a.anchorCell)}}else this.ClearSelection(a,null,a);this.DoGetFocus(a)}return}var k=this.GetColFromCell(a,e);if(e.parentNode.getAttribute("FpSpread")=="ch"&&k>=this.GetColCount(a))return;if(e.parentNode.getAttribute("FpSpread")=="rh"&&this.IsChildSpreadRow(a,this.GetViewport(a),e.parentNode.rowIndex)){this.ClearSelection(a,null,a);return}var F=e.getAttribute("canFocus")=="false";if(F)return;if(e.parentNode.getAttribute("FpSpread")=="ch"&&this.GetOperationMode(a)!="Normal"){this.ClearSelection(a,null,a);if(a.allowColMove||a.allowGroup){if(a.getAttribute("LayoutMode"))k=parseInt(e.getAttribute("col"));this.InitMovingCol(a,k)}this.working=true;this.activeElement=b;a.anchorCell==null&&this.tryToSetAnchorCell(a);this.PaintAnchorCell(a);this.PaintSelections(a,true);return this.CancelDefault(c)}if(e.parentNode.getAttribute("FpSpread")=="ch"&&(this.GetOperationMode(a)=="RowMode"||this.GetOperationMode(a)=="SingleSelect"||this.GetOperationMode(a)=="ExtendedSelect")){if(!a.allowColMove&&!a.allowGroup)return}else{var G=this.FireActiveCellChangingEvent(a,this.GetRowFromCell(a,e),k,e.parentNode.getAttribute("row"));if(G)return;var f=this.GetOperationMode(a),I=this.GetTopSpread(a);if(!c.ctrlKey||a.getAttribute("multiRange")!="true"){if(f!="MultiSelect"&&!(c.shiftKey&&f=="ExtendedSelect"&&a.getAttribute("LayoutMode")==null))if(!((a.allowColMove||a.allowGroup)&&e.parentNode.getAttribute("FpSpread")=="ch"&&f=="Normal"&&(a.getAttribute("SelectionPolicy")=="Range"||a.getAttribute("SelectionPolicy")=="MultiRange")&&a.selectedCols.length!=0&&this.IsColSelected(a,k))){var t=!this.InRowHeader(a,e)||(a.selectionBlockOptions&SelectionBlockOptions.Rows)!=0&&this.GetOperationMode(a)!="ReadOnly";t=t&&(!this.InColHeader(a,e)||(a.selectionBlockOptions&SelectionBlockOptions.Columns)!=0&&this.GetOperationMode(a)=="Normal");if(t)this.ClearSelection(a);else{this.CancelDefault(c);return}}}else if(f!="ExtendedSelect"&&f!="MultiSelect")if(a.anchorCell!=null){a.fpSpreadJS.updateSelectionRangeFromCell(a.anchorCell);a.fpSpreadJS.keepGeneratedSelectionFromAnchorCell();this.PaintSelectedCell(a,a.anchorCell,true);this.UpdateSelectionsBackColor(a,this.GetRowFromCell(a,e),this.GetColFromCell(a,e))}}var q=a.anchorCell;if(q)a.oldAnchorCell=q;a.anchorCell=e;var d=a.anchorCell,g=this.GetParent(this.GetViewport(a));if(g!=null&&!this.IsControl(b)&&b!=null&&b.tagName!="scrollbar"){if((this.IsChild(d,g)||this.IsChild(d,this.GetViewport1(a)))&&d.offsetLeft+d.offsetWidth>g.scrollLeft+g.clientWidth)g.scrollLeft=d.offsetLeft+d.offsetWidth-g.clientWidth;if((this.IsChild(d,g)||this.IsChild(d,this.GetViewport2(a)))&&d.offsetTop+d.offsetHeight>g.scrollTop+g.clientHeight&&d.offsetHeight<g.clientHeight)g.scrollTop=d.offsetTop+d.offsetHeight-g.clientHeight;if((this.IsChild(d,this.GetViewport(a))||this.IsChild(d,this.GetViewport2(a)))&&d.offsetTop<g.scrollTop-a.virtualTop)g.scrollTop=d.offsetTop+a.virtualTop;if((this.IsChild(d,g)||this.IsChild(d,this.GetViewport1(a)))&&d.offsetLeft<g.scrollLeft)g.scrollLeft=d.offsetLeft;a.ignoreVirtualPaging=true;this.ScrollView(a);a.ignoreVirtualPaging=false}var f=this.GetOperationMode(a),i=e.parentNode.getAttribute("FpSpread"),E=i=="rh",D=i=="ch";if(i=="r"||i=="ch"||i=="rh"){this.saveAnchorCell(a,e);if(i=="ch")a.leadingCellRow=0;else if(i=="rh")a.leadingCellCol=0}if(a.anchorCell.parentNode.getAttribute("FpSpread")=="r"){if(c.shiftKey&&f=="ExtendedSelect"&&a.getAttribute("LayoutMode")==null){var l=this.GetExtendedSelectRows(a,q,a.leadingCell,a.anchorCell);this.ClearSelection(a);l!=null&&l.length>0&&this.SelectRow(a,l[0],l[1],true,true)}else if(f=="ExtendedSelect"||f=="MultiSelect"){var H=this.IsRowSelected(a,this.GetRowFromCell(a,a.anchorCell));if(H)this.SelectRow(a,this.GetRowFromCell(a,a.anchorCell),1,false,true);else this.SelectRow(a,this.GetRowFromCell(a,a.anchorCell),1,true,true)}else if(f=="RowMode"||f=="SingleSelect")this.SelectRow(a,this.GetRowFromCell(a,a.anchorCell),1,true,true);else this.SelectRange(a,this.GetRowFromCell(a,a.anchorCell),k,1,1,true);a.selectStartRow=this.GetRowFromCell(a,a.anchorCell);a.selectStartCol=k}else if(a.anchorCell.parentNode.getAttribute("FpSpread")=="ch"){if(b.tagName=="INPUT"||b.tagName=="TEXTAREA"||b.tagName=="SELECT")return;var j=k;if(a.allowColMove||a.allowGroup)if(f=="Normal"&&(a.getAttribute("SelectionPolicy")=="Range"||a.getAttribute("SelectionPolicy")=="MultiRange"))if(this.IsColSelected(a,j)){this.AdjustAnchorCell(a,j);this.PaintAnchorCell(a);this.InitMovingCol(a,j)}else this.SelectColumn(a,j,1,true);else{if(a.getAttribute("LayoutMode"))j=parseInt(a.anchorCell.getAttribute("col"));if(f=="Normal"||f=="ReadOnly")this.SelectColumn(a,j,1,true);else a.selectedCols.push(j);this.InitMovingCol(a,j)}else if(f=="Normal"||f=="ReadOnly"){if(a.getAttribute("LayoutMode"))j=parseInt(a.anchorCell.getAttribute("col"));this.SelectColumn(a,j,1,true)}else return;if(b.tagName=="INPUT"||b.tagName=="TEXTAREA"||b.tagName=="SELECT")return}else if(a.anchorCell.parentNode.getAttribute("FpSpread")=="rh"){if(b.tagName=="INPUT"||b.tagName=="TEXTAREA"||b.tagName=="SELECT")return;if(c.shiftKey&&f=="ExtendedSelect"&&a.getAttribute("LayoutMode")==null){var l=this.GetExtendedSelectRows(a,q,a.leadingCell,a.anchorCell);this.ClearSelection(a);l!=null&&l.length>0&&this.SelectRow(a,l[0],l[1],true,true)}else if(f=="ExtendedSelect"||f=="MultiSelect")if(this.IsRowSelected(a,this.GetRowFromCell(a,a.anchorCell)))this.SelectRow(a,this.GetRowFromCell(a,a.anchorCell),1,false,true);else this.SelectRow(a,this.GetRowFromCell(a,a.anchorCell),1,true,true);else this.SelectRow(a,this.GetRowFromCell(a,a.anchorCell),1,true);if(b.tagName=="INPUT"||b.tagName=="TEXTAREA"||b.tagName=="SELECT")return}a.leadingCell=a.anchorCell;if(a.anchorCell!=null){i=a.anchorCell.parentNode.getAttribute("FpSpread");if(i=="rh"||i=="r")a.leadingCellRow=this.GetRowFromCell(a,a.anchorCell);if(i=="ch"||i=="r")a.leadingCellCol=k;if(E&&this.GetCellFromRowCol(a,a.selectStartRow,a.leadingCellCol)==a.anchorCell)a.leadingCellRow=a.selectStartRow;if(D&&this.GetCellFromRowCol(a,a.leadingCellRow,a.selectStartCol)==a.anchorCell)a.leadingCellCol=a.selectStartCol}this.activeElement=b;this.working=true;if(a.anchorCell!=null){var m=this.CreateEvent("ActiveCellChanged");m.cmdID=a.id;m.Row=m.row=this.GetSheetIndex(a,this.GetRowFromCell(a,a.anchorCell));m.Col=m.col=k;if(a.getAttribute("LayoutMode"))m.InnerRow=m.innerRow=a.anchorCell.parentNode.getAttribute("row");this.FireEvent(a,m)}}if(this.IsInRowEditTemplate(a,b))return;this.EnableButtons(a);this.dragCol!=null&&this.dragCol>=0&&!this.IsControl(b)&&!a.isactive&&this.Focus(a);if(!this.editing&&this.sizeRow==null&&this.sizeColumn==null)if(a.anchorCell!=null&&this.IsChild(a.anchorCell,a)&&!this.IsHeaderCell(a,this.GetCell(b))){var z=this.GetEditor(a.anchorCell);this.ProcessEditMode(a,true,true);if($$.browser.version>=4){var u=z!=null?a.fpSpreadJS.getExtender(z):null;if(u!=null)if(u.indexOf("TextBoxWatermarkExtender")!=-1)a.delaySetEditorFocus=true;else u.indexOf("CalendarExtender")!=-1&&this.CancelDefault(c)}}this.imeDisabled=null;if(!this.IsControl(b)){a!=null&&this.UpdatePostbackData(a);if(this.imeStat){this.imeStat=false;var I=this.GetTopSpread(a),s=document.getElementById(I.id+"_textBox");if(s!=null){s.value="";s.style.width="0px";s.style.height="0px"}}else return this.CancelDefault(c)}};this.GetMovingCol=function(b){var a=document.getElementById(b.id+"movingCol");if(a==null){a=document.createElement("DIV");a.style.display="none";a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.id=b.id+"movingCol";a.align="center";b.insertBefore(a,null);if(b.getAttribute("DragColumnCssClass")!=null)a.className=b.getAttribute("DragColumnCssClass");else a.style.border="1px solid black";a.style.MozOpacity=.5}return a};this.IsControl=function(a){return a!=null&&(a.tagName=="INPUT"||a.tagName=="TEXTAREA"||a.tagName=="SELECT"||a.tagName=="OPTION")};this.changeButtonsState=function(c,b){var a=this.GetCmdBtn(c,"Update");a!=null&&a.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(a,!b);a=this.GetCmdBtn(c,"Cancel");a!=null&&a.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(a,!b)};this.EnableButtons=function(b){var i=this.GetCellType(b.anchorCell),e=this.GetPageActiveSpread();if(e==null)return;var h=this.GetSelection(e),c=h.lastChild,g=b.getAttribute("OperationMode"),d=g=="ReadOnly"||g=="SingleSelect"||i=="readonly";if(!d)d=this.AnyReadOnlyCell(b,c);if(d){var a=this.GetCmdBtn(b,"Copy");this.UpdateCmdBtnState(a,c==null);var f=this.clipboardData;a=this.GetCmdBtn(b,"Paste");this.UpdateCmdBtnState(a,c==null||f==null);a=this.GetCmdBtn(b,"Clear");this.UpdateCmdBtnState(a,true)}else{var a=this.GetCmdBtn(b,"Copy");this.UpdateCmdBtnState(a,c==null);var f=this.clipboardData;a=this.GetCmdBtn(b,"Paste");this.UpdateCmdBtnState(a,c==null||f==null);a=this.GetCmdBtn(b,"Clear");this.UpdateCmdBtnState(a,c==null)}};this.CellClicked=function(b){var a=this.GetSpread(b);a!=null&&this.SaveData(a)};this.getCmdButtonState=function(a){return a==null||a.disabled||/true/i.test(a.getAttribute("disabled"))||a.tagName=="IMG"&&new RegExp(a.getAttribute("disabledImg")+"$","i").test(a.src)?false:true};this.UpdateCmdBtnState=function(a,b){if(a==null)return;if(a.tagName=="INPUT"){var e=a.disabled;if(e==b)return;a.disabled=b}else{var e=a.getAttribute("disabled");if(e==b)return;a.setAttribute("disabled",b)}if(a.tagName=="IMG"){var c=a.getAttribute("disabledImg");if(b&&c!=null&&c!=""){if(a.src.indexOf(c)<0)a.src=c}else{var d=a.getAttribute("enabledImg");if(a.src.indexOf(d)<0)a.src=d}}};this.SetImageButtonSrc=function(b,c){if(b==null)return;if(b.tagName!="IMG")return;var a="";switch(c){case 0:case"enable":a=b.getAttribute("enabledimg");break;case 1:case"disable":a=b.getAttribute("disabledImg");break;case 2:case"hover":a=b.getAttribute("hoverImg")}if(a!=null&&a!=""&&b.src.indexOf(a)<0)b.src=a};this.GetExtendedSelectRows=function(e,i,f,h){var a=[],d=f!=null?this.GetRowFromCell(e,f):this.GetRowFromCell(e,i),b=this.GetRowFromCell(e,h),g=this.GetSelection(e);if(g==null){a.push(newRow);a.push(1)}else{var c=this.GetSelectRowNode(g,d);if(c!=null)if(b<c.startRow){a.push(b);if(d==c.startRow)a.push(c.endRow-b+1);else a.push(c.startRow-b+1)}else if(c.startRow<=b&&b<=c.endRow)if(b>=d){a.push(b);a.push(c.endRow-b+1)}else{a.push(c.startRow);a.push(b-c.startRow+1)}else if(d==c.startRow){a.push(c.endRow);a.push(b-c.endRow+1)}else{a.push(c.startRow);a.push(b-c.startRow+1)}else if(d<b){a.push(d+1);a.push(b-d-1)}else{a.push(b);a.push(Math.max(1,d-b))}}return a};this.GetSelectRowNode=function(f,d){var b=null,a=f.firstChild;while(a!=null){var g=parseInt(a.getAttribute("colIndex"));if(g==-1){var c=parseInt(a.getAttribute("rowIndex")),e=parseInt(a.getAttribute("rowcount"));if(c<=d&&d<c+e){b={};b.startRow=c;b.endRow=c+e-1;break}}a=a.nextSibling}return b};this.MouseUp=function(b){this.__MouseUp(b);var a=this.GetPageActiveSpread();if(a!=null&&a.isOverScrollbar)a.isOverScrollbar=false};this.__MouseUp=function(b){if(this.updateValuesId!=null){clearTimeout(this.updateValuesId);var a=this.GetPageActiveSpread();this.UpdateValues(a);this.updateValuesId=null}if(window.fpPostOn!=null)return;b=this.GetEvent(b);var e=this.GetTarget(b),a=this.GetSpread(e,true);if(a==null&&!this.working&&!this.dragSlideBar)return;var B=this.GetSpread(b.currentTarget,true);if(B!=null&&B!=a)return;if(this.dragSlideBar){this.dragSlideBar=false;if(a==null)a=this.GetSpread(this.activePager,true);if(this.activePager!=null&&a!=null){var db=this.MoveSliderBar(a,b)-1;this.activePager=null;this.GotoPage(a,db)}return}if(this.editing){var z=this.GetCell(b.target),I=this.GetCellType(z);if(z!=null){var D=this.GetEditor(z);if(D!=null&&this.renderAsEditor==1)if(I==$$.CellTypes.CHECKBOX||I==$$.CellTypes.RADIO_BUTTON_LIST){var X=this.GetEditorValue(D,a);this.editingValue=X;this.changeButtonsState(a,true)}}}if(this.working&&(this.sizeColumn!=null||this.sizeRow!=null))if(this.sizeColumn!=null)a=this.GetSpread(this.sizeColumn);else a=this.GetSpread(this.sizeRow);if(this.working&&this.sizeColumn==null&&this.sizeRow==null)a=this.GetPageActiveSpread();if(a==null)return;if(this.GetViewport(a)==null)return;var bb=this.GetOperationMode(a);if(bb=="ReadOnly")return;var w=true;if(this.working){this.working=false;if(this.dragCol!=null&&this.dragCol>=0){var u=this.IsChild(e,this.GetGroupBar(a))||e==this.GetGroupBar(a);if(!u&&this.GetGroupBar(a)!=null){var T=b.clientX,U=b.clientY,P=this.GetOffsetLeft(a,a,document.body),R=this.GetOffsetTop(a,a,document.body),cb=this.GetGroupBar(a).offsetWidth,ab=this.GetGroupBar(a).offsetHeight,F=window.scrollX,t=window.scrollY,O=document.getElementById(a.id+"_titleBar");if(O)t-=O.parentNode.parentNode.offsetHeight;if(this.GetPager1(a)!=null)t-=this.GetPager1(a).offsetHeight;u=P<=F+T&&F+T<=P+cb&&R<=t+U&&t+U<=R+ab}if(a.dragFromGroupbar)if(u)if(a.targetCol>0)this.Regroup(a,this.dragCol,parseInt((a.targetCol+1)/2));else this.Regroup(a,this.dragCol,a.targetCol);else this.Ungroup(a,this.dragCol,a.targetCol);else if(u){if(a.allowGroup)if(a.targetCol>0)this.Group(a,this.dragCol,parseInt((a.targetCol+1)/2));else this.Group(a,this.dragCol,a.targetCol)}else if(a.allowColMove)if(a.targetCol!=null){var f=this.CreateEvent("ColumnDragMove");f.cancel=false;f.col=a.selectedCols;this.FireEvent(a,f);if(!f.cancel){var V=this.GetOperationMode(a)!=$$.OperationModes.NORMAL?a.fpSpreadJS.buildTargetColsMoved(a.selectedCols,this.dragCol,a.targetCol):null;this.MoveCol(a,this.dragCol,a.targetCol);var W=this.GetOperationMode(a)!=$$.OperationModes.NORMAL?V:a.selectedCols,f=this.CreateEvent("ColumnDragMoveCompleted");f.col=W;this.FireEvent(a,f)}}var Q=this.GetMovingCol(a);if(Q!=null)Q.style.display="none";this.dragCol=-1;this.dragViewCol=-1;var S=this.GetPosIndicator(a);if(S!=null)S.style.display="none";a.dragFromGroupbar=false;a.targetCol=null;this.sizeColumn=this.sizeRow=null}if(this.sizeColumn!=null){if(a.sizeBar!=null)a.sizeBar.style.left="-400px";w=false;var v=b.clientX-this.activeX,h=parseInt(this.sizeColumn.width),l=h;if(isNaN(h))h=0;h+=v;if(h<1)h=1;var q=parseInt(this.sizeColumn.getAttribute("index")),j=this.GetColGroup(this.GetViewport(a));if(this.IsChild(this.sizeColumn,this.GetFrozColHeader(a))){j=this.GetColGroup(this.GetViewport0(a));if(j==null)j=this.GetColGroup(this.GetViewport2(a))}if(j!=null&&j.childNodes.length>0)if(this.IsChild(this.sizeColumn,this.GetColHeader(a)))l=parseInt(j.childNodes[q-a.frzCols].width);else l=parseInt(j.childNodes[q].width);else l=1;if(this.GetViewport(a).rules!="rows")if(q==parseInt(this.colCount)-1)l-=1;if(h!=l&&b.clientX!=this.activeY){this.SetColWidth(a,q,h,l);var f=this.CreateEvent("ColWidthChanged");f.col=q;f.width=h;this.FireEvent(a,f)}this.ScrollView(a);var k=this.GetPageActiveSpread(),i=this.GetTopSpread(a);if(k==null||k==a||this.GetTopSpread(k)==i){(a.anchorCell==null||!this.IsChild(document.activeElement,i))&&this.Focus(i);this.PaintSelections(a,true);this.PaintAnchorCell(a);this.PaintFocusRect(a)}}else if(this.sizeRow!=null){if(a.sizeBar!=null){a.sizeBar.style.left="-400px";a.sizeBar.style.width="2px"}w=false;var v=b.clientY-this.activeY,y=this.sizeRow.offsetHeight+v;if(y<1){y=1;v=1-this.sizeRow.offsetHeight}this.sizeRow.style.height=""+y+"px";this.sizeRow.style.cursor="auto";var c=null;if(this.IsChild(this.sizeRow,this.GetFrozRowHeader(a)))c=this.GetViewport1(a);else c=this.GetViewport(a);if(c.rows.length>=2&&c.cellSpacing=="0"&&a.frzRow==0)if(this.sizeRow.rowIndex==0)c.rows[0].style.height=""+(parseInt(this.sizeRow.style.height)-1)+"px";else if(this.sizeRow.rowIndex==c.rows.length-1)c.rows[this.sizeRow.rowIndex].style.height=""+(parseInt(this.sizeRow.style.height)+1)+"px";else c.rows[this.sizeRow.rowIndex].style.height=this.sizeRow.style.height;else c.rows[this.sizeRow.rowIndex].style.height=""+(this.sizeRow.offsetHeight-c.rows[0].offsetTop)+"px";var x=this.GetViewport2(a);if(this.IsChild(this.sizeRow,this.GetFrozRowHeader(a)))x=this.GetViewport0(a);if(x!=null)x.rows[this.sizeRow.rowIndex].style.height=c.rows[this.sizeRow.rowIndex].style.height;if(this.IsChild(this.sizeRow,this.GetFrozRowHeader(a)))this.GetFrozRowHeader(a).parentNode.parentNode.parentNode.style.posHeight+=v;var L=this.AddRowInfo(a,this.sizeRow.getAttribute("FpKey"));L!=null&&this.SetRowHeight(a,L,parseInt(this.sizeRow.style.height));if(this.activeX!=b.clientY){var f=this.CreateEvent("RowHeightChanged");f.row=this.GetRowFromCell(a,this.sizeRow.cells[0]);f.height=this.sizeRow.offsetHeight;this.FireEvent(a,f)}var N=this.GetParentSpread(a);N!=null&&this.UpdateRowHeight(N,a);var i=this.GetTopSpread(a);this.SizeAll(i);this.Refresh(i);this.ScrollView(a);var k=this.GetPageActiveSpread(),i=this.GetTopSpread(a);if(k==null||k==a||this.GetTopSpread(k)==i){(a.anchorCell==null||!this.IsChild(document.activeElement,i))&&this.Focus(i);this.PaintSelections(a,true);this.PaintAnchorCell(a);this.PaintFocusRect(a)}this.SizeSpread(a)}if(this.activeElement!=null)this.activeElement=null}else{var A=this.GetPageActiveSpread();if(A!=null&&this.GetTopSpread(A)==this.GetTopSpread(a))a=this.GetPageActiveSpread()}if(this.sizeRow==null&&this.sizeColumn==null&&w&&this.HitCommandBar(e)){a.ignoreEditModePermanent=true;a.ignoreBlur=true;this.DoGetFocus(a);a.ignoreBlur=false;a.ignoreEditModePermanent=false;return}var s=false,H=this.GetSelection(a);if(H!=null){var n=H.firstChild,g=new this.Range;if(n!=null){g.row=this.GetRowByKey(a,n.getAttribute("row"));g.col=this.GetColByKey(a,n.getAttribute("col"));g.rowCount=parseInt(n.getAttribute("rowcount"));g.colCount=parseInt(n.getAttribute("colcount"))}switch(a.selectType){case"":for(var o=this.GetViewport(a).rows,d=g.row;d<g.row+g.rowCount&&d<o.length;d++)if(o[d].cells.length>0&&o[d].cells[0].firstChild!=null&&o[d].cells[0].firstChild.nodeName!="#text")if(o[d].cells[0].firstChild.getAttribute("FpSpread")=="Spread"){s=true;break}break;case"c":for(var c=this.GetViewport(a),d=0;d<c.rows.length;d++)if(this.IsChildSpreadRow(a,c,d)){s=true;break}break;case"r":for(var c=this.GetViewport(a),Z=g.rowCount,d=g.row;d<g.row+Z&&d<c.rows.length;d++)if(this.IsChildSpreadRow(a,c,d)){s=true;break}}}if(s){var p=this.GetCmdBtn(a,"Copy");this.UpdateCmdBtnState(p,true);p=this.GetCmdBtn(a,"Paste");this.UpdateCmdBtnState(p,true);p=this.GetCmdBtn(a,"Clear");this.UpdateCmdBtnState(p,true)}if(this.GetCell(e)!=null&&!this.IsHeaderCell(a,e))if(a.leadingCell!=null)this.MoveTextBox(a,a.leadingCell);else if(a.anchorCell!=null)this.MoveTextBox(a,a.anchorCell);else{m=document.getElementById(a.id+"_textBox");if(m!=null){m.style.top="0px";m.style.left="0px"}}if(this.sizeRow==null&&this.sizeColumn==null&&!this.IsInRowEditTemplate(a,e)&&b.target.nodeName!="SELECT"){a.ignorePaintSelection=true;var K=this.GetCell(e,null,b);if(K!=null){if(!(K.getAttribute("canFocus")=="false")){a.ignoreBlur=true;this.DoGetFocus(a);a.ignoreBlur=false}}else if(!a.isOverScrollbar){a.ignoreBlur=true;var M=this.GetCorner(a),Y=M!=null&&this.IsChild(e,M);a.ignoreEditModePermanent=!Y;var C=false,G=this.GetOffsetTop(a,b.target,document.body),E=this.GetOffsetLeft(a,b.target,document.body);if(!(b.clientX>=E-document.documentElement.scrollLeft&&b.clientX<=E+b.target.offsetWidth-document.documentElement.scrollLeft&&b.clientY>=G-document.documentElement.scrollTop&&b.clientY<=G+b.target.offsetHeight-document.documentElement.scrollTop))C=true;if(a.anchorCell!=null&&a.anchorCell.getAttribute("canFocus")!="false"&&a.editModePermanent)a.ignoreEditModePermanent=false;!C&&this.DoGetFocus(a);a.ignoreEditModePermanent=false;a.ignoreBlur=false}w&&e!=this.GetViewport(a).parentNode&&this.Focus(a);a.ignorePaintSelection=false}this.UpdatePostbackData(a);var J=this.GetEditor(a.anchorCell);J!=null&&this.IsChild(e,J)&&e.type=="button"&&e.focus();if(!a.isOverScrollbar){if(this.editing)if(a.delaySetEditorFocus){var c=this.GetViewport(a).parentNode,r=[c.scrollLeft,c.scrollTop];this.SetEditorFocus(this.GetEditor(a.anchorCell));a.delaySetEditorFocus=null;if(c.scrollLeft!=r[0])c.scrollLeft=r[0];if(c.scrollTop!=r[1])c.scrollTop=r[1]}}else{var i=this.GetTopSpread(a),m=document.getElementById(i.id+"_textBox");document.activeElement!=m&&m.focus();if(a.delaySetEditorFocus)a.delaySetEditorFocus=null}};this.checkOverViewportScrollbar=function(b,c){var e=c.clientX,f=c.clientY,d=this.GetTarget(c),a=this.GetViewport(b).parentNode;b.isOverScrollbar=d==a&&(a.scrollHeight>a.clientHeight&&e>=this.GetOffsetLeft(b,a,document.body)+a.clientWidth-document.documentElement.scrollLeft||a.scrollWidth>a.clientWidth&&f>=this.GetOffsetTop(b,a,document.body)+a.clientHeight-document.documentElement.scrollTop)};this.UpdateRowHeight=function(a,b){var d=b.parentNode;while(d!=null){if(d.tagName=="TR")break;d=d.parentNode}var h=this.IsXHTML(a);if(d!=null){var e=d.rowIndex;if(this.GetRowHeader(a)!=null){var c=0;if(this.GetColHeader(b)!=null)c=this.GetColHeader(b).offsetHeight;if(this.GetRowHeader(b)!=null)c+=this.GetRowHeader(b).offsetHeight;var f=document.getElementById(b.id+"_titleBar");if(f!=null)c+=f.offsetHeight;if(this.GetPager1(b)!=null)c+=this.GetPager1(b).offsetHeight;if(b.colFooter!=null)c+=b.colFooter.offsetHeight;if(!h)c-=this.GetViewport(a).cellSpacing;if(this.GetViewport(a).cellSpacing==0){this.GetRowHeader(a).rows[e].style.height=""+(c+1)+"px";if(this.GetParentSpread(a)!=null)this.GetRowHeader(a).parentNode.style.height=""+this.GetRowHeader(a).offsetHeight+"px"}else this.GetRowHeader(a).rows[e].style.height=""+(c+2)+"px";this.GetViewport(a).rows[e].style.height=""+c+"px";b.style.height=""+c+"px"}}var g=this.GetParentSpread(a);g!=null&&this.UpdateRowHeight(g,a)};this.MouseOut=function(){if(!this.working&&this.sizeColumn!=null&&this.sizeColumn.style!=null)this.sizeColumn.style.cursor="auto"};this.doIgnoreVirtualPaging=function(a){if(!a.ignoreVirtualPaging){a.ignoreVirtualPaging=true;var b=Function.CreateCallback(function(){var a=arguments[arguments.length-1];a.ignoreVirtualPaging=false},a);setTimeout(b,300)}};this.KeyDown=function(ss,event){if(window.fpPostOn!=null)return;if(!ss.ProcessKeyMap(event))return;this.doIgnoreVirtualPaging(ss);if(event.keyCode==event.DOM_VK_SPACE&&ss.anchorCell!=null){var mode=this.GetOperationMode(ss);if(mode=="MultiSelect"){if(this.IsRowSelected(ss,this.GetRowFromCell(ss,ss.anchorCell)))this.SelectRow(ss,this.GetRowFromCell(ss,ss.anchorCell),1,false,true);else this.SelectRow(ss,this.GetRowFromCell(ss,ss.anchorCell),1,true,true);return}}var checkbox=false,ctlr=null;if(this.editing&&this.editor!=null){ctlr=this.GetEditor(ss.anchorCell);checkbox=ctlr!=null}if(event.keyCode!=event.DOM_VK_LEFT&&event.keyCode!=event.DOM_VK_RIGHT&&event.keyCode!=event.DOM_VK_RETURN&&event.keyCode!=event.DOM_VK_TAB&&this.editing&&!checkbox&&this.editor.tagName=="SELECT")return;if(this.editing&&this.editor!=null&&this.editor.getAttribute("MccbId")){var editorObj=eval(this.editor.getAttribute("MccbId")+"_Obj");if(event.altKey&&event.keyCode==event.DOM_VK_DOWN)return;if(editorObj!=null&&editorObj.getIsDrop!=null&&editorObj.getIsDrop())return}switch(event.keyCode){case event.DOM_VK_LEFT:case event.DOM_VK_RIGHT:if(checkbox){var fpEditor=this.editor.getAttribute("FpEditor");if(this.editing&&fpEditor=="ExtenderEditor"){var editorEx=FpExtender.Util.getEditor(this.editor);editorEx&&editorEx.type!="text"&&this.EndEdit()}if(fpEditor!="RadioButton"&&fpEditor!="ExtenderEditor"&&fpEditor!="TextBox"){if(this.editor!=null&&this.editor.tagName=="SELECT"){this.editor.blur();this.editor.focus()}this.EndEdit()}}!this.editing&&ss.activeChartObj==null&&this.NextCell(ss,event,event.keyCode);break;case event.DOM_VK_UP:case event.DOM_VK_DOWN:case event.DOM_VK_RETURN:if(this.editor!=null&&(this.editor.tagName=="TEXTAREA"||this.editor.tagName=="SELECT"))return;if(checkbox&&this.editing&&this.editor.getAttribute("FpEditor")=="ExtenderEditor"){var extenders=this.editor.getAttribute("Extenders");if(extenders&&(extenders.indexOf("AutoCompleteExtender")!=-1||extenders.indexOf("FpComboBox")!=-1))return}event.keyCode==event.DOM_VK_RETURN&&this.CancelDefault(event);if(this.editing){if(this.editor!=null&&this.editor.getAttribute("FpEditor")=="MultiColumnComboBoxCellType"&&ss.anchorCell.getAttribute("FpEditorID")==null){var r=this.GetRowFromCell(ss,ss.anchorCell);if(r==0&&event.keyCode==event.DOM_VK_UP)return;if(event.keyCode==event.DOM_VK_DOWN){r+=ss.anchorCell.rowSpan-1;var rowCount=this.GetRowCountInternal(ss),isLastRow=r==rowCount-1;if(!isLastRow&&r==rowCount-2){var vp=this.GetViewportFromCell(ss,ss.anchorCell);if(vp.rows[vp.rows.length-1].getAttribute("previewrow")=="true")isLastRow=true}if(isLastRow)return}}var valid=this.EndEdit();if(!valid)return}event.keyCode!=event.DOM_VK_RETURN&&ss.activeChartObj==null&&this.NextCell(ss,event,event.keyCode);var ts=this.GetTopSpread(ss),textBox=document.getElementById(ts.id+"_textBox");event.DOM_VK_RETURN==event.keyCode&&textBox.focus();break;case event.DOM_VK_TAB:if(this.editing){if(this.editor!=null&&this.editor.tagName=="SELECT"){this.editor.blur();this.editor.focus()}var valid=this.EndEdit();if(!valid)return}var pt=this.GetProcessTab(ss),processTab=pt=="true"||pt=="True";if(processTab)this.NextCell(ss,event,event.keyCode);else{if(event.shiftKey)this.GetTopSpread(ss).tabIndex=-1;this.hideSelectionBlock(ss);this.SetActiveSpreadID(this.GetTopSpread(ss),"",null);this.SetPageActiveSpread(null)}break;case event.DOM_VK_SHIFT:break;case event.DOM_VK_HOME:case event.DOM_VK_END:case event.DOM_VK_PAGE_UP:case event.DOM_VK_PAGE_DOWN:!this.editing&&this.NextCell(ss,event,event.keyCode);break;default:if($$.browser.version>=2){var userBrowserHandler=event.target!=null&&(event.target.tagName=="INPUT"&&event.target.type=="text"||event.target.tagName=="TEXTAREA"&&event.target.type=="textarea"),isMccb=this.GetCellType(ss.anchorCell)=="MultiColumnComboBoxCellType";if(event.keyCode==67&&event.ctrlKey)if(!this.editing||checkbox&&(isMccb||!userBrowserHandler))this.Copy(ss);else this.clipboardData=null;else if(event.keyCode==86&&event.ctrlKey&&(!this.editing||checkbox&&!userBrowserHandler)){this.Paste(ss);this.CancelDefault(event)}else if(event.keyCode==88&&event.ctrlKey&&(!this.editing||checkbox))this.Clear(ss);else if(!this.editing&&ss.anchorCell!=null&&!this.IsHeaderCell(ss.anchorCell)&&!event.ctrlKey&&!event.altKey)!(ss.anchorCell.getAttribute("canFocus")=="false")&&this.StartEdit(ss,ss.anchorCell,event)}else if(event.charCode==99&&event.ctrlKey)if(!this.editing||checkbox)this.Copy(ss);else this.clipboardData=null;else if(event.charCode==118&&event.ctrlKey&&(!this.editing||checkbox)){var useBrowserHandler=ctlr!=null&&ctlr.getAttribute("FpEditor")!=null&&(ctlr.tagName=="INPUT"&&ctlr.type=="text"||ctlr.tagName=="TEXTAREA");!useBrowserHandler&&this.Paste(ss)}else if(event.charCode==120&&event.ctrlKey&&(!this.editing||checkbox))this.Clear(ss);else if(!this.editing&&ss.anchorCell!=null&&!this.IsHeaderCell(ss.anchorCell)&&!event.ctrlKey&&!event.altKey)!(ss.anchorCell.getAttribute("canFocus")=="false")&&this.StartEdit(ss,ss.anchorCell)}};this.GetProcessTab=function(a){var b=this.GetTopSpread(a);return b.getAttribute("ProcessTab")};this.ExpandRow=function(a,c){var b=this.GetPageActiveSpread();if(!this.IsChild(b,a))b=a;if(!b.IsValid())return;var d=a.getAttribute("name"),e=a.getAttribute("ajax")!="false";if(e)this.SyncData(d,"ExpandView, "+c,a);else __doPostBack(d,"ExpandView, "+c)};this.SortColumn=function(a,b){var c=a.getAttribute("name"),d=a.getAttribute("ajax")!="false";if(d)this.SyncData(c,"SortColumn, "+b,a);else __doPostBack(c,"SortColumn, "+b)};this.Filter=function(l,c){if(!c.IsValid())return;var e=this.GetTarget(l),b=e.value;if(e.tagName=="SELECT"){var k=new RegExp("\\s*"),j=new RegExp("\\S*"),f=e[e.selectedIndex].text,h="",d=0,i=b.length;while(i>0){var a=b.match(k);if(a!=null){h+=a[0];d=a[0].length;i-=d;b=b.substring(d);a=b.match(j);if(a!=null){d=a[0].length;i-=d;b=b.substring(d)}}else break;a=f.match(j);if(a!=null){h+=a[0];d=a[0].length;f=f.substring(d);a=f.match(k);if(a!=null){d=a[0].length;f=f.substring(d)}}else break}b=h}var g=this.CreateEvent("AutoFilteringColumn");g.cancel=false;g.col=c.selectedCols;g.spread=c;g.filterString=b;this.FireEvent(c,g);if(!g.cancel){this.SaveScrollbarState(c,0,0);this.SaveData(c);c.dirty=false;var m=c.getAttribute("ajax")!="false";if(m){this.SyncData(e.name,b,c);c.LoadState=null}else __doPostBack(e.name,b)}};this.MoveCol=function(a,e,c){var f=a.getAttribute("name");if(a.selectedCols&&a.selectedCols.length>0){for(var d=[],b=0;b<a.selectedCols.length;b++)d[b]=this.GetSheetColIndex(a,a.selectedCols[b]);var h=d.join("+");this.MoveMultiCol(a,h,c);return}var g=a.getAttribute("ajax")!="false";if(g)this.SyncData(f,"MoveCol,"+e+","+c,a);else __doPostBack(f,"MoveCol,"+e+","+c)};this.MoveMultiCol=function(a,b,d){var c=a.getAttribute("name"),e=a.getAttribute("ajax")!="false";if(e)this.SyncData(c,"MoveCol,"+b+","+d,a);else __doPostBack(c,"MoveCol,"+b+","+d)};this.Group=function(a,e,d){var f=a.getAttribute("name");if(a.selectedCols&&a.selectedCols.length>0){for(var c=[],b=0;b<a.selectedCols.length;b++)if(a.getAttribute("LayoutMode"))c[b]=parseInt(a.selectedCols[b]);else c[b]=this.GetSheetColIndex(a,a.selectedCols[b]);var h=c.join("+");this.GroupMultiCol(a,h,d);a.selectedCols=[];return}var g=a.getAttribute("ajax")!="false";if(g)this.SyncData(f,"Group,"+e+","+d,a);else __doPostBack(f,"Group,"+e+","+d)};this.GroupMultiCol=function(a,c,b){var d=a.getAttribute("name"),e=a.getAttribute("ajax")!="false";if(e)this.SyncData(d,"Group,"+c+","+b,a);else __doPostBack(d,"Group,"+c+","+b)};this.Ungroup=function(a,c,b){var d=a.getAttribute("name"),e=a.getAttribute("ajax")!="false";if(e)this.SyncData(d,"Ungroup,"+c+","+b,a);else __doPostBack(d,"Ungroup,"+c+","+b)};this.Regroup=function(a,b,c){var d=a.getAttribute("name"),e=a.getAttribute("ajax")!="false";if(e)this.SyncData(d,"Regroup,"+b+","+c,a);else __doPostBack(d,"Regroup,"+b+","+c)};this.ProcessData=function(){try{var req=this;req.removeEventListener("load",the_fpSpread.ProcessData,false);var target=window.srcfpspread;target=target.split(":").join("_");var cmd=window.fpcommand,doc=document,buff=doc.getElementById(target+"_buff");if(buff==null){buff=doc.createElement("iframe");buff.id=target+"_buff";buff.style.display="none";doc.body.appendChild(buff)}var ss=doc.getElementById(target);the_fpSpread.CloseWaitMsg(ss);if(buff==null)return;var respText=req.responseText;if(respText.indexOf("<body")>-1){var ep=ss.getAttribute("errorPage");if(ep!=null&&ep.length>0){the_fpSpread.error=true;window.location.href=ep}return}buff.contentWindow.document.body.innerHTML=respText;if(cmd.indexOf("RefreshChart")>=0){var data=eval("("+respText+")");the_fpSpread.updateChartURL(ss,data);var form=the_fpSpread.GetForm(ss);form.__EVENTTARGET.value="";form.__EVENTARGUMENT.value="";window.fpPostOn=null;return}var pt=buff.contentWindow.document.getElementById(target+"_values");if(pt!=null){var nodes=pt.getElementsByTagName("data")[0],node=nodes.firstChild;the_fpSpread.error=false;ss.SuspendLayout(true);while(node!=null){var r=the_fpSpread.GetRowByKey(ss,node.getAttribute("r"),-1),c=the_fpSpread.GetColByKey(ss,node.getAttribute("c"),-1);if(r>-1&&c>-1){var old=the_fpSpread.GetValue(ss,r,c);if(node.innerHTML!=old){var f=the_fpSpread.GetFormula(ss,r,c),cl=the_fpSpread.GetCellByRowCol(ss,r,c);the_fpSpread.SetCellValueFromView(cl,node.innerHTML,true);cl.setAttribute("FpFormula",f)}}node=node.nextSibling}the_fpSpread.ClearCellData(ss);ss.ResumeLayout(true);$$.browser.version>=4&&the_fpSpread.ScrollView(ss,true)}else{ss.preventPopUp=true;the_fpSpread.UpdateSpread(doc,buff,target,respText,cmd);the_fpSpread.FireAutoFilterColumnCompleted(ss,cmd)}var form=the_fpSpread.GetForm(ss);form.__EVENTTARGET.value="";form.__EVENTARGUMENT.value="";var old=doc.getElementsByName("__VIEWSTATE")[0],t=buff.contentWindow.document.getElementsByName("__VIEWSTATE")[0];if(old!=null&&t!=null)old.value=t.value;old=doc.getElementsByName("__EVENTVALIDATION");t=buff.contentWindow.document.getElementsByName("__EVENTVALIDATION");if(old!=null&&t!=null&&old.length>0&&t.length>0)old[0].value=t[0].value;buff.contentWindow.document.location="about:blank";window.fpPostOn=null;dataBuff=null}catch(e){window.fpPostOn=null;dataBuff=null}var ss=the_fpSpread.GetTopSpread(doc.getElementById(target)),e=the_fpSpread.CreateEvent("CallBackStopped");e.command=cmd;the_fpSpread.FireEvent(ss,e)};this.UpdateSpread=function(doc,buff,target,respText,cmd){var ss=the_fpSpread.GetTopSpread(doc.getElementById(target)),s=buff.contentWindow.document.getElementById(ss.id);if(s!=null){typeof Sys!="undefined"&&typeof $get!="undefined"&&FarPoint.System.ExtenderHelper.saveLoadedExtenderScripts(ss,cmd);the_fpSpread.error=s.getAttribute("error")=="true";ss.LoadState=null;if(cmd=="LoadOnDemand"&&!the_fpSpread.error){var ssData=this.GetElementById(ss,ss.id+"_data"),newData=this.GetElementById(s,ss.id+"_data");ssData!=null&&newData!=null&&ssData.setAttribute("data",newData.getAttribute("data"));this.CopySpreadAttr(s,ss,"AllRowsLoaded");var css=s.getElementsByTagName("style");if(css!=null)for(var i=0;i<css.length;i++)css[i]!=null&&css[i].innerHTML!=null&&css[i].innerHTML.indexOf(ss.id+"msgStyle")<0&&ss.appendChild(css[i].cloneNode(true));var ssLastRow=this.GetElementById(ss,ss.id+"_LoadInfo"),newLastRow=this.GetElementById(s,ss.id+"_LoadInfo");if(ssLastRow!=null&&newLastRow!=null)ssLastRow.value=newLastRow.value;var hasNewRows=false,rhTmp=this.GetElementById(s,ss.id+"_rowHeader");if(rhTmp!=null){rhTmp=rhTmp.firstChild;hasNewRows=rhTmp.rows.length>1;var rh=this.GetRowHeader(ss);this.LoadRows(rh,rhTmp,true)}var vpTmp=this.GetElementById(s,ss.id+"_viewport2");if(vpTmp!=null){hasNewRows=vpTmp.rows.length>0;var vp=this.GetViewport2(ss);this.LoadRows(vp,vpTmp,false)}vpTmp=this.GetElementById(s,ss.id+"_viewport");if(vpTmp!=null){hasNewRows=vpTmp.rows.length>0;var vp=this.GetViewport(ss);this.LoadRows(vp,vpTmp,false)}var st=ss.selectType;ss.preventScrollView=cmd=="LoadOnDemand";the_fpSpread.Init(ss);ss.preventScrollView=false;cmd!="LoadOnDemand"&&this.GetPageActiveSpread()===ss&&the_fpSpread.Focus(ss);if(!the_fpSpread.error&&ss.anchorCell!=null){var btn=this.GetCmdBtn(ss,"Update");btn!=null&&btn.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(btn,false)}if(hasNewRows)ss.LoadState=null;else ss.LoadState="complete";typeof Sys!="undefined"&&typeof $get!="undefined"&&FarPoint.System.ExtenderHelper.loadExtenderScripts(ss,buff.contentWindow.document.body)}else{$$(ss).copyInnerHTML(s);the_fpSpread.CopySpreadAttrs(s,ss);if(typeof Sys!="undefined"&&typeof $get!="undefined"){ss.getAttribute("ClientAutoSize")=="True"&&ss.setAttribute("ignoreSizeSpread","true");FarPoint.System.ExtenderHelper.loadExtenderScripts(ss,buff.contentWindow.document.body);ss.removeAttribute("ignoreSizeSpread")}var initText=buff.contentWindow.document.getElementById(ss.id+"_initScript");eval(initText.value)}}else{the_fpSpread.error=true;var ep=ss.getAttribute("errorPage");if(ep!=null&&ep.length>0)window.location.href=ep}};this.LoadRows=function(d,a,f){if(d==null||a==null)return;var c=d.tBodies[0],h=a.rows.length,e=null;if(f){h--;if(c.rows.length>0)e=c.rows[c.rows.length-1]}for(var b=0;b<h;b++){var g=a.rows[b].cloneNode(false);c.insertBefore(g,e);g.innerHTML=a.rows[b].innerHTML}if(!f)for(var b=0;b<a.parentNode.childNodes.length;b++){var i=a.parentNode.childNodes[b];i!=a&&d.parentNode.insertBefore(i.cloneNode(true),null)}};this.CopySpreadAttr=function(d,b,a){var c=d.getAttribute(a),e=b.getAttribute(a);if(c!=null||e!=null)if(c==null)b.removeAttribute(a);else b.setAttribute(a,c)};this.CopySpreadAttrs=function(a,b){this.CopySpreadAttr(a,b,"selectionBlockOptions");this.CopySpreadAttr(a,b,"RetainSelectionBlock");this.CopySpreadAttr(a,b,"AllRowsLoaded");this.CopySpreadAttr(a,b,"totalRowCount");this.CopySpreadAttr(a,b,"pageCount");this.CopySpreadAttr(a,b,"loadOnDemand");this.CopySpreadAttr(a,b,"allowGroup");this.CopySpreadAttr(a,b,"colMove");this.CopySpreadAttr(a,b,"showFocusRect");this.CopySpreadAttr(a,b,"FocusBorderColor");this.CopySpreadAttr(a,b,"FocusBorderStyle");this.CopySpreadAttr(a,b,"FpDefaultEditorID");this.CopySpreadAttr(a,b,"hierView");this.CopySpreadAttr(a,b,"IsNewRow");this.CopySpreadAttr(a,b,"cmdTop");this.CopySpreadAttr(a,b,"ProcessTab");this.CopySpreadAttr(a,b,"AcceptFormula");this.CopySpreadAttr(a,b,"EditMode");this.CopySpreadAttr(a,b,"AllowInsert");this.CopySpreadAttr(a,b,"AllowDelete");this.CopySpreadAttr(a,b,"error");this.CopySpreadAttr(a,b,"ajax");this.CopySpreadAttr(a,b,"autoCalc");this.CopySpreadAttr(a,b,"multiRange");this.CopySpreadAttr(a,b,"rowFilter");this.CopySpreadAttr(a,b,"OperationMode");this.CopySpreadAttr(a,b,"selectedForeColor");this.CopySpreadAttr(a,b,"selectedBackColor");this.CopySpreadAttr(a,b,"anchorBackColor");this.CopySpreadAttr(a,b,"columnHeaderAutoTextIndex");this.CopySpreadAttr(a,b,"EnableRowEditTemplate");this.CopySpreadAttr(a,b,"scrollContent");this.CopySpreadAttr(a,b,"scrollContentColumns");this.CopySpreadAttr(a,b,"scrollContentTime");this.CopySpreadAttr(a,b,"scrollContentMaxHeight");this.CopySpreadAttr(a,b,"SelectionPolicy");this.CopySpreadAttr(a,b,"selectionUnit");this.CopySpreadAttr(a,b,"isFiltering");this.CopySpreadAttr(a,b,"isFilteringCancel");this.CopySpreadAttr(a,b,"FilteringString");this.CopySpreadAttr(a,b,"FilteringCol");this.CopySpreadAttr(a,b,"ShowHeaderSelection");this.CopySpreadAttr(a,b,"layoutMode");this.CopySpreadAttr(a,b,"layoutRowCount");this.CopySpreadAttr(a,b,"currentPageIndex");this.CopySpreadAttr(a,b,"virtualPaging");b.tabIndex=a.tabIndex;if(b.style!=null&&a.style!=null){if(b.style.width!=a.style.width)b.style.width=a.style.width;if(b.style.height!=a.style.height)b.style.height=a.style.height;if(b.style.border!=a.style.border)b.style.border=a.style.border}if(a.getAttribute("expandedRowKeys")!=null&&a.getAttribute("expandedRowKeys")!="")b.setAttribute("expandedRowKeys",a.getAttribute("expandedRowKeys"));else b.removeAttribute("expandedRowKeys")};this.Clone=function(c){var b=document.createElement(c.tagName);b.id=c.id;var a=c.firstChild;while(a!=null){var d=this.Clone(a);b.appendChild(d);a=a.nextSibling}return b};this.FireEvent=function(a,b){if(a==null||b==null)return;if(b.type=="SelectionChanged"&&a.ignoreFireSelectionChanged)return;var c=a.getAttribute("mcctcelltype")=="true"?a:this.GetTopSpread(a);if(c!=null){b.spread=a;c.dispatchEvent(b)}};this.GetForm=function(b){var a=b.parentNode;while(a!=null&&a.tagName!="FORM")a=a.parentNode;return a};this.SyncData=function(i,b,a,g){if(window.fpPostOn!=null){a.LoadState=null;return}this.editing=false;var c=this.CreateEvent("CallBackStart");c.cancel=false;c.command=b;if(g==null)g=false;c.async=g;if(a==null){var l=i.split(":").join("_");a=document.getElementById(l)}if(a!=null){var n=this.GetTopSpread(a);this.FireEvent(a,c)}if(c.cancel){the_fpSpread.ClearCellData(a);return}if(b!=null&&(b.indexOf("SelectView,")==0||b=="Next"||b=="Prev"||b.indexOf("Group,")==0||b.indexOf("Page,")==0))a.LoadState=null;var k=c.async;k&&this.OpenWaitMsg(a);window.fpPostOn=true;if(this.error)b="update";try{var e=this.GetForm(a);if(e==null)return;e.__EVENTTARGET.value=i;e.__EVENTARGUMENT.value=encodeURIComponent(b);var f=e.action,j;if(f.indexOf("?")>-1)j="&";else j="?";f=f+j;var h;if(b.indexOf("RefreshChart")>=0)h=this.CollectLightData(a);else h=this.CollectData(a);var m="",d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");if(d==null)return;d.open("POST",f,k);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(a!=null)window.srcfpspread=a.id;else window.srcfpspread=i;window.fpcommand=b;this.AttachEvent(d,"load",the_fpSpread.ProcessData,false);d.send(h)}catch(c){window.fpPostOn=false;dataBuff=null}};this.CollectData=function(i){for(var h=this.GetForm(i),a,d="fpcallback=true&",f=0;f<h.elements.length;f++){a=h.elements[f];var e=a.tagName.toLowerCase();if(e=="input"){var b=a.type;if((b=="hidden"||b=="text"||b=="password"||(b=="checkbox"||b=="radio")&&a.checked)&&a.getAttribute("isInvalid")==null)d+=a.name+"="+encodeURIComponent(a.value)+"&"}else if(e=="select"){if(a.childNodes!=null)for(var g=0;g<a.childNodes.length;g++){var c=a.childNodes[g];if(c!=null&&c.tagName!=null&&c.tagName.toLowerCase()=="option"&&c.selected)d+=a.name+"="+encodeURIComponent(c.value)+"&"}}else if(e=="textarea")d+=a.name+"="+encodeURIComponent(a.value)+"&"}return d};this.CollectLightData=function(g){for(var c=this.GetForm(g),a,d="fpcallback=true&",b=0;b<c.elements.length;b++){a=c.elements[b];var e=a.tagName.toLowerCase();if(e=="input"){var f=a.type;if(f=="hidden")d+=a.name+"="+encodeURIComponent(a.value)+"&"}}return d};this.ClearCellData=function(d){var j=this.GetData(d),i=j.getElementsByTagName("root")[0],g=i.getElementsByTagName("data")[0];if(g==null)return null;if(d.dataBuff!=null){var c=d.dataBuff.firstChild;while(c!=null){var n=c.getAttribute("key"),e=c.firstChild;while(e!=null){var m=e.getAttribute("key"),a=g.firstChild;while(a!=null){var l=a.getAttribute("key");if(n==l){var f=false,b=a.firstChild;while(b!=null){var k=b.getAttribute("key");if(m==k){a.removeChild(b);f=true;break}b=b.nextSibling}if(f)break}a=a.nextSibling}e=e.nextSibling}c=c.nextSibling}}d.dataBuff=null;var h=this.GetCmdBtn(d,"Cancel");h!=null&&this.UpdateCmdBtnState(h,true)};this.StorePostData=function(b){var c=this.GetData(b),d=c.getElementsByTagName("root")[0],a=d.getElementsByTagName("data")[0];if(a!=null)b.dataBuff=a.cloneNode(true)};this.ShowMessage=function(c,e,b,a,d){var g=c.GetRowCount(),f=c.GetColCount();if(b==null||a==null||b<0||b>=g||a<0||a>=f){b=-1;a=-1}this.ShowMessageInner(c,e,b,a,d)};this.HideMessage=function(a,c,b){var f=a.GetRowCount(),e=a.GetColCount();if(c==null||b==null||c<0||c>=f||b<0||b>=e)a.msgList&&a.msgList.centerMsg&&a.msgList.centerMsg.msgBox.IsVisible&&a.msgList.centerMsg.msgBox.Hide();var d=this.GetMsgObj(a,c,b);d&&d.msgBox.IsVisible&&d.msgBox.Hide()};this.ShowMessageInner=function(b,g,f,e,c){var a=this.GetMsgObj(b,f,e);if(a)a.timer&&a.msgBox.Hide();else a=this.CreateMsgObj(b,f,e);var d=a.msgBox;d.Show(b,this,g);if(c&&c>0)a.timer=setTimeout(function(){d.Hide()},c);this.SetMsgObj(b,a)};this.GetMsgObj=function(e,c,d){var b,a=e.msgList;if(a)if(c==-1&&d==-1)b=a.centerMsg;else if(c==-2)b=a.hScrollMsg;else if(d==-2)b=a.vScrollMsg;else if(a[c])b=a[c][d];return b};this.SetMsgObj=function(c,a){var b=c.msgList;if(a.row==-1&&a.col==-1)b.centerMsg=a;else if(a.row==-2)b.hScrollMsg=a;else if(a.col==-2)b.vScrollMsg=a;else{if(!b[a.row])b[a.row]=[];b[a.row][a.col]=a}};var scStyle=null;this.CreateMsgObj=function(f,e,d){var a=document.createElement("div"),c={row:e,col:d,msgBox:a},b=null;if(e!=-2&&d!=-2){a.style.border="1px solid black";a.style.background="yellow";a.style.color="red"}else{a.style.border="1px solid #55678e";a.style.fontSize="small";a.style.background="#E6E9ED";a.style.color="#4c5b7f";this.GetScrollingContentStyle(f);b=scStyle}if(b!=null){if(b.fontFamily!=null)a.style.fontFamily=b.fontFamily;if(b.fontSize!=null)a.style.fontSize=b.fontSize;if(b.fontStyle!=null)a.style.fontStyle=b.fontStyle;if(b.fontVariant!=null)a.style.fontVariant=b.fontVariant;if(b.fontWeight!=null)a.style.fontWeight=b.fontWeight;if(b.backgroundColor!=null)a.style.backgroundColor=b.backgroundColor;if(b.color!=null)a.style.color=b.color}a.style.position="absolute";a.style.overflow="hidden";a.style.display="block";a.style.marginLeft=0;a.style.marginTop=2;a.style.marginRight=0;a.style.marginBottom=0;a.msgObj=c;a.Show=function(b,d,p){var l=d.GetMsgPos(b,this.msgObj.row,this.msgObj.col),q=d.GetCommandBar(b),v=d.GetGroupBar(b);this.style.visibility="visible";this.style.display="block";if(p){this.style.left=""+0+"px";this.style.top=""+0+"px";this.style.width="auto";this.innerHTML=p}var s=d.GetViewport0(b),t=d.GetViewport1(b),u=d.GetViewport2(b),m=s||t||u,o=b.style.position=="relative"||b.style.position=="absolute",e=l.top,g=l.left,c=f.offsetParent;while((c.tagName=="TD"||c.tagName=="TR"||c.tagName=="TBODY"||c.tagName=="TABLE")&&c.style.position!="relative"&&c.style.position!="absolute")c=c.offsetParent;if(this.msgObj.row>=0&&this.msgObj.col>=0){if(!o&&m&&c){var j=d.GetLocation(b),k=d.GetLocation(c);e+=j.y-k.y;g+=j.x-k.x;if(c.tagName!="BODY"){e-=d.GetBorderWidth(c,0);g-=d.GetBorderWidth(c,3)}}var h=d.GetViewPortByRowCol(b,this.msgObj.row,this.msgObj.col);!this.parentNode&&h&&h.parentNode&&h.parentNode.insertBefore(a,null);var n=this.offsetWidth;this.style.left=""+g+"px";if(!m&&h&&h.parentNode&&g+n>h.offsetWidth)this.style.width=""+(l.cellWidth-2)+"px";else if(parseInt(this.style.width)!=n)this.style.width=""+(n-2)+"px";if(!m&&h!=null&&e>=h.offsetHeight-2)e-=l.cellHeight+this.offsetHeight;this.style.top=""+e+"px"}else{if(!o&&c){var j=d.GetLocation(b),k=d.GetLocation(c);e+=j.y-k.y;g+=j.x-k.x;if(c.tagName!="BODY"){e-=d.GetBorderWidth(c,0);g-=d.GetBorderWidth(c,3)}}var i=20;!this.parentNode&&b.insertBefore(a,null);if(this.offsetWidth+i<b.offsetWidth)g+=(b.offsetWidth-this.offsetWidth-i)/(this.msgObj.row==-2?1:2);else this.style.width=""+(b.offsetWidth-i)+"px";if(this.offsetHeight<b.offsetHeight)e+=(b.offsetHeight-this.offsetHeight)/(this.msgObj.col==-2?1:2);if(this.msgObj.col==-2){var r=d.GetColFooter(b);if(r)e-=r.offsetHeight;var q=d.GetCommandBar(b);if(q)e-=q.offsetHeight;e-=i}this.style.top=""+e+"px";this.style.left=""+g+"px"}this.IsVisible=true};a.Hide=function(){this.style.visibility="hidden";this.style.display="none";this.IsVisible=false;if(this.msgObj.timer){clearTimeout(this.msgObj.timer);this.msgObj.timer=null}this.innerHTML=""};return c};this.GetLocation=function(d){if(d.window&&d.window===d||d.nodeType===9)return{x:0,y:0};for(var e=0,f=0,i=null,g=null,b=null,a=d;a;i=a,g=b,a=a.offsetParent){var c=a.tagName;b=this.GetCurrentStyle2(a);if((a.offsetLeft||a.offsetTop)&&!(c==="BODY"&&(!g||g.position!="absolute"))){e+=a.offsetLeft;f+=a.offsetTop}if(i!=null&&b){if(c!="TABLE"&&c!="TD"&&c!="HTML"){e+=parseInt(b.borderLeftWidth)||0;f+=parseInt(b.borderTopWidth)||0}if(c==="TABLE"&&(b.position==="relative"||b.position==="absolute")){e+=parseInt(b.marginLeft)||0;f+=parseInt(b.marginTop)||0}}}b=this.GetCurrentStyle2(d);var h=b?b.position:null;if(!h||h!="absolute")for(var a=d.parentNode;a;a=a.parentNode){c=a.tagName;if(c!="BODY"&&c!="HTML"&&(a.scrollLeft||a.scrollTop)){e-=a.scrollLeft||0;f-=a.scrollTop||0;b=this.GetCurrentStyle2(a);if(b){e+=parseInt(b.borderLeftWidth)||0;f+=parseInt(b.borderTopWidth)||0}}}return{x:e,y:f}};var _borderWidthNames=["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth"],_borderStyleNames=["borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle"],_borderThicknesses;this.GetBorderWidth=function(b,a){if(!this.GetBorderVisible(b,a))return 0;var c=this.GetCurrentStyle(b,_borderWidthNames[a]);return this.ParseBorderWidth(c)};this.GetBorderVisible=function(b,a){return this.GetCurrentStyle(b,_borderStyleNames[a])!="none"};this.GetWindow=function(a){var b=a.ownerDocument||a.document||a;return b.defaultView||b.parentWindow};this.GetCurrentStyle2=function(a){if(a.nodeType===3)return null;var b=this.GetWindow(a);if(a.documentElement)a=a.documentElement;var c=b&&a!=b?b.getComputedStyle(a,null):a.style;return c};this.GetCurrentStyle=function(b,c,d){var a=null;if(b){if(b.currentStyle)a=b.currentStyle[c];else if(document.defaultView&&document.defaultView.getComputedStyle){var e=document.defaultView.getComputedStyle(b,null);if(e)a=e[c]}if(!a&&b.style.getPropertyValue)a=b.style.getPropertyValue(c);else if(!a&&b.style.getAttribute)a=b.style.getAttribute(c)}if(!a||a==""||typeof a==="undefined")if(typeof d!="undefined")a=d;else a=null;return a};this.ParseBorderWidth=function(d){if(!_borderThicknesses){var c={},a=document.createElement("div");a.style.visibility="hidden";a.style.position="absolute";a.style.fontSize="1px";document.body.appendChild(a);var b=document.createElement("div");b.style.height="0px";b.style.overflow="hidden";a.appendChild(b);var e=a.offsetHeight;b.style.borderTop="solid black";b.style.borderTopWidth="thin";c.thin=a.offsetHeight-e;b.style.borderTopWidth="medium";c.medium=a.offsetHeight-e;b.style.borderTopWidth="thick";c.thick=a.offsetHeight-e;a.removeChild(b);document.body.removeChild(a);_borderThicknesses=c}if(d){switch(d){case"thin":case"medium":case"thick":return _borderThicknesses[d];case"inherit":return 0}var f=this.ParseUnit(d);if(f.type!="px")throw new Error;return f.size}return 0};this.ParseUnit=function(a){if(!a)throw new Error;a=this.Trim(a).toLowerCase();for(var g=a.length,c=-1,f=0;f<g;f++){var b=a.substr(f,1);if((b<"0"||b>"9")&&b!="-"&&b!="."&&b!=",")break;c=f}if(c==-1)throw new Error;var e,d;if(c<g-1)e=this.Trim(a.substring(c+1));else e="px";d=parseFloat(a.substr(0,c+1));if(e=="px")d=Math.floor(d);return{size:d,type:e}};this.GetViewPortByRowCol=function(a,h,g){var c=this.GetViewport0(a),d=this.GetViewport1(a),e=this.GetViewport2(a),f=this.GetViewport(a),b=this.GetCellByRowCol(a,h,g);return f!=null&&this.IsChild(b,f)?f:e!=null&&this.IsChild(b,e)?e:d!=null&&this.IsChild(b,d)?d:c!=null&&this.IsChild(b,c)?c:void 0};this.GetMsgPos=function(b,l,k){if(l<0||k<0)return{left:0,top:0};else{var f=this.GetViewport0(b),c=this.GetViewport1(b),d=this.GetViewport2(b),g=this.GetViewport(b),i=this.GetGroupBar(b),j=document.getElementById(b.id+"_titleBar"),a=this.GetCellByRowCol(b,l,k),e=a.offsetTop+a.clientHeight,h=a.offsetLeft;if((f!=null||c!=null)&&(this.IsChild(a,d)||this.IsChild(a,g)))if(f!=null)e+=f.offsetHeight;else e+=c.offsetHeight;if((f!=null||d!=null)&&(this.IsChild(a,c)||this.IsChild(a,g)))if(f!=null)h+=f.offsetWidth;else h+=d.offsetWidth;if(g!=null&&(f||c||d)){if(j)e+=j.offsetHeight;if(i)e+=i.offsetHeight;if(this.GetColHeader(b))e+=this.GetColHeader(b).offsetHeight;if(this.GetRowHeader(b))h+=this.GetRowHeader(b).offsetWidth}if(g!=null&&this.IsChild(a,g)){if(c||d)e-=g.parentNode.scrollTop;if(c||d)h-=g.parentNode.scrollLeft}if(d!=null&&this.IsChild(a,d))e-=d.parentNode.scrollTop;if(c!=null&&this.IsChild(a,c))h-=c.parentNode.scrollLeft;var m=a.clientHeight,n=a.clientWidth;return{left:h,top:e,cellHeight:m,cellWidth:n}}};this.SyncMsgs=function(a){if(!a.msgList)return;for(i in a.msgList)if(a.msgList[i].constructor==Array)for(j in a.msgList[i])a.msgList[i][j]&&a.msgList[i][j].msgBox&&a.msgList[i][j].msgBox.IsVisible&&a.msgList[i][j].msgBox.Show(a,this)};this.GetCellInfo=function(g,i,h,f){var c=this.GetData(g);if(c==null)return null;var d=c.getElementsByTagName("root")[0];if(d==null)return null;var e=d.getElementsByTagName("state")[0];if(e==null)return null;var b=e.getElementsByTagName("cellinfo")[0];if(b==null)return null;var a=b.firstChild;while(a!=null){if(a.getAttribute("r")==""+i&&a.getAttribute("c")==""+h&&a.getAttribute("pos")==""+f)return a;a=a.nextSibling}return null};this.AddCellInfo=function(f,i,h,e){var a=this.GetCellInfo(f,i,h,parseInt(e));if(a!=null)return a;var c=this.GetData(f),d=c.getElementsByTagName("root")[0];if(d==null)return null;var g=d.getElementsByTagName("state")[0];if(g==null)return null;var b=g.getElementsByTagName("cellinfo")[0];if(b==null)return null;if(document.all!=null)a=c.createNode("element","c","");else{a=document.createElement("c");a.style.display="none"}a.setAttribute("r",i);a.setAttribute("c",h);a.setAttribute("pos",e);b.appendChild(a);return a};this.setCellAttribute=function(a,b,j,g,k,l){if(b==null)return;var f=this.GetRowKeyFromCell(a,b),h=a.getAttribute("LayoutMode")?this.GetColKeyFromCell2(a,b):this.GetColKeyFromCell(a,b);if(typeof f=="undefined")return;var d=-1;if(this.IsChild(b,this.GetCorner(a)))d=0;else if(this.IsChild(b,this.GetRowHeader(a))||this.IsChild(b,this.GetFrozColHeader(a)))d=1;else if(this.IsChild(b,this.GetColHeader(a))||this.IsChild(b,this.GetFrozColHeader(a)))d=2;else if(this.IsChild(b,this.GetViewport(a))||this.IsChild(b,this.GetViewport0(a))||this.IsChild(b,this.GetViewport1(a))||this.IsChild(b,this.GetViewport2(a)))d=3;var i=this.AddCellInfo(a,f,h,d);i.setAttribute(j,g);if(!k){var e=this.CreateEvent("DataChanged");e.cell=b;e.cellValue=g;e.row=f;e.col=h;this.FireEvent(a,e)}var c=this.GetCmdBtn(a,"Update");c!=null&&c.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(c,false);c=this.GetCmdBtn(a,"Cancel");c!=null&&c.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(c,false);a.dirty=true;l&&this.UpdateValues(a)};this.updateCellLocked=function(b,c){if(b==null)return;var d=b.getAttribute("FpCellType")=="readonly";if(d==c)return;var a=b.firstChild;while(a!=null){if(typeof a.disabled!="undefined")a.disabled=c;a=a.nextSibling}};this.Cells=function(b,d,c){var a=this.GetCellByRowCol(b,d,c);if(a){a.GetValue=function(){return the_fpSpread.GetValue(b,d,c)};a.SetValue=function(a){if(typeof a=="undefined")return;if(this.parentNode.getAttribute("previewRow")!=null)return;the_fpSpread.SetValue(b,d,c,a);the_fpSpread.SaveClientEditedDataRealTime()};a.GetBackColor=function(){return this.getAttribute("bgColorBak")!=null?this.getAttribute("bgColorBak"):document.defaultView.getComputedStyle(this,"").getPropertyValue("background-color")};a.SetBackColor=function(a){if(typeof a=="undefined")return;this.bgColor=a;this.setAttribute("bgColorBak",a);this.style.backgroundColor=a;the_fpSpread.setCellAttribute(b,this,"bc",a);the_fpSpread.SaveClientEditedDataRealTime()};a.GetForeColor=function(){return document.defaultView.getComputedStyle(this,"").getPropertyValue("color")};a.SetForeColor=function(a){if(typeof a=="undefined")return;this.style.color=a;the_fpSpread.setCellAttribute(b,this,"fc",a);the_fpSpread.SaveClientEditedDataRealTime()};a.GetTabStop=function(){return this.getAttribute("TabStop")!="false"};a.SetTabStop=function(a){if(typeof a=="undefined")return;var c=new String(a);if(c.toLocaleLowerCase()=="false"){this.setAttribute("TabStop","false");the_fpSpread.setCellAttribute(b,this,"ts","false");the_fpSpread.SaveClientEditedDataRealTime()}else this.removeAttribute("TabStop")};a.GetCellType=function(){var a=the_fpSpread.GetCellType2(this);if(a=="text"||a=="readonly")a=this.getAttribute("CellType2");if(a==null)a="GeneralCellType";return a};a.GetHAlign=function(){var a=document.defaultView.getComputedStyle(this,"").getPropertyValue("text-Align");if(a==""||a=="undefined"||a==null)a=this.style.textAlign;if(a==""||a=="undefined"||a==null)a=this.getAttribute("align");if(a=="start")a="left";if(a!=null&&a.indexOf("-moz")!=-1)a=a.replace("-moz-","");return a};a.SetHAlign=function(a){if(typeof a=="undefined")return;this.style.textAlign=typeof a=="string"?a:a.Name;the_fpSpread.setCellAttribute(b,this,"ha",typeof a=="string"?a:a.Name);the_fpSpread.SaveClientEditedDataRealTime()};a.GetVAlign=function(){var a=document.defaultView.getComputedStyle(this,"").getPropertyValue("vertical-Align");if(a==""||a=="undefined"||a==null)a=this.style.verticalAlign;if(a==""||a=="undefined"||a==null)a=this.getAttribute("valign");return a};a.SetVAlign=function(a){if(typeof a=="undefined")return;this.style.verticalAlign=typeof a=="string"?a:a.Name;the_fpSpread.setCellAttribute(b,this,"va",typeof a=="string"?a:a.Name);the_fpSpread.SaveClientEditedDataRealTime()};a.GetLocked=function(){return a.GetCellType()=="ButtonCellType"||a.GetCellType()=="TagCloudCellType"||a.GetCellType()=="HyperLinkCellType"?a.getAttribute("Locked")=="1":the_fpSpread.GetCellType(this)=="readonly"};a.GetFont_Name=function(){return document.defaultView.getComputedStyle(this,"").getPropertyValue("font-family")};a.SetFont_Name=function(a){if(typeof a=="undefined")return;this.style.fontFamily=a;the_fpSpread.setCellAttribute(b,this,"fn",a);the_fpSpread.SaveClientEditedDataRealTime()};a.GetFont_Size=function(){return document.defaultView.getComputedStyle(this,"").getPropertyValue("font-size")};a.SetFont_Size=function(a){if(typeof a=="undefined")return;if(typeof a=="number")a+="px";this.style.fontSize=a;the_fpSpread.setCellAttribute(b,this,"fs",a);the_fpSpread.SizeSpread(b);the_fpSpread.SaveClientEditedDataRealTime()};a.GetFont_Bold=function(){return document.defaultView.getComputedStyle(this,"").getPropertyValue("font-weight")=="bold"?true:false};a.SetFont_Bold=function(a){if(typeof a=="undefined")return;this.style.fontWeight=a==true?"bold":"normal";the_fpSpread.setCellAttribute(b,this,"fb",new String(a).toLocaleLowerCase());the_fpSpread.SaveClientEditedDataRealTime()};a.GetFont_Italic=function(){return document.defaultView.getComputedStyle(this,"").getPropertyValue("font-style")=="italic"?true:false};a.SetFont_Italic=function(a){if(typeof a=="undefined")return;this.style.fontStyle=a==true?"italic":"normal";the_fpSpread.setCellAttribute(b,this,"fi",new String(a).toLocaleLowerCase());the_fpSpread.SaveClientEditedDataRealTime()};a.GetFont_Overline=function(){return document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("overline")>=0?true:false};a.SetFont_Overline=function(c){if(c){var a=new String("overline");if(document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("line-through")>=0)a+=" line-through";if(document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("underline")>=0)a+=" underline";this.style.textDecoration=a}else{var a=new String("");if(document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("line-through")>=0)a+=" line-through";if(document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("underline")>=0)a+=" underline";if(a=="")a="none";this.style.textDecoration=a}the_fpSpread.setCellAttribute(b,this,"fo",new String(c).toLocaleLowerCase());the_fpSpread.SaveClientEditedDataRealTime()};a.GetFont_Strikeout=function(){return document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("line-through")>=0?true:false};a.SetFont_Strikeout=function(c){if(c){var a=new String("line-through");if(document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("overline")>=0)a+=" overline";if(document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("underline")>=0)a+=" underline";this.style.textDecoration=a}else{var a=new String("");if(document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("overline")>=0)a+=" overline";if(document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("underline")>=0)a+=" underline";if(a=="")a="none";this.style.textDecoration=a}the_fpSpread.setCellAttribute(b,this,"fk",new String(c).toLocaleLowerCase());the_fpSpread.SaveClientEditedDataRealTime()};a.GetFont_Underline=function(){return document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("underline")>=0?true:false};a.SetFont_Underline=function(c){if(c){var a=new String("underline");if(document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("overline")>=0)a+=" overline";if(document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("line-through")>=0)a+=" line-through";this.style.textDecoration=a}else{var a=new String("");if(document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("overline")>=0)a+=" overline";if(document.defaultView.getComputedStyle(this,"").getPropertyValue("text-decoration").indexOf("line-through")>=0)a+=" line-through";if(a=="")a="none";this.style.textDecoration=a}the_fpSpread.setCellAttribute(b,this,"fu",new String(c).toLocaleLowerCase());the_fpSpread.SaveClientEditedDataRealTime()};return a}return null};this.getNoRowPanel=function(c,a){var b=c.id+"_NoRow";if(a!=-1&&typeof a!=="undefined")b=b+a.toString();return document.getElementById(b)};this.getDomRow=function(b,f){var e=this.GetRowCount(b);if(e==0)return null;var a=this.GetCellByRowCol(b,f,0);if(a){var d=a.parentNode.rowIndex;if(d>=0){var c=a.parentNode.parentNode.rows[d];if(this.GetSizable(b,c))return c}return null}};this.setRowInfo_RowAttribute=function(b,c,d,g,f){c=parseInt(c);if(c<0)return;var e=this.AddRowInfo(b,c);e.setAttribute(d,g);var a=this.GetCmdBtn(b,"Update");a!=null&&a.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(a,false);a=this.GetCmdBtn(b,"Cancel");a!=null&&a.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(a,false);b.dirty=true;f&&this.UpdateValues(b)};this.Rows=function(b,c){var a=this.getDomRow(b,c);if(a){a.GetHeight=function(){return the_fpSpread.GetRowHeightInternal(b,c)};a.SetHeight=function(a){if(typeof a=="undefined")return;the_fpSpread.SetRowHeight2(b,c,parseInt(a));the_fpSpread.SaveClientEditedDataRealTime()};return a}return null};this.setColInfo_ColumnAttribute=function(b,c,e,g,f){c=parseInt(c);if(c<0)return;var d=this.AddColInfo(b,c);d.setAttribute(e,g);var a=this.GetCmdBtn(b,"Update");a!=null&&a.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(a,false);a=this.GetCmdBtn(b,"Cancel");a!=null&&a.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(a,false);b.dirty=true;f&&this.UpdateValues(b)};this.Columns=function(b,c){var a={colindex:this.GetColByKey(b,parseInt(c))};if(a){a.GetWidth=function(){return the_fpSpread.GetColWidthFromCol(b,c)};a.SetWidth=function(a){if(typeof a=="undefined")return;the_fpSpread.SetColWidth(b,c,a);the_fpSpread.SaveClientEditedDataRealTime()};return a}return null};this.GetTitleBar=function(b){try{if(document.getElementById(b.id+"_title")==null)return null;var a=document.getElementById(b.id+"_titleBar");if(a!=null)a=document.getElementById(b.id+"_title");return a}catch(c){return null}};this.GetSubTitleBar=function(b){try{if(document.getElementById(b.id+"_subtitle")==null)return null;var a=document.getElementById(b.id+"_titleBar");if(a!=null)a=document.getElementById(b.id+"_subtitle");return a}catch(c){return null}};this.CheckTitleInfo=function(d){var b=this.GetData(d);if(b==null)return null;var c=b.getElementsByTagName("root")[0];if(c==null)return null;var a=c.getElementsByTagName("titleinfo")[0];return a==null?null:a};this.AddTitleInfo=function(d){var a=this.CheckTitleInfo(d);if(a!=null)return a;var b=this.GetData(d),c=b.getElementsByTagName("root")[0];if(c==null)return null;if(document.all!=null)a=b.createNode("element","titleinfo","");else{a=document.createElement("titleinfo");a.style.display="none"}c.appendChild(a);return a};this.setTitleInfo_Attribute=function(b,c,f,d){var e=this.AddTitleInfo(b);e.setAttribute(c,f);var a=this.GetCmdBtn(b,"Update");a!=null&&a.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(a,false);a=this.GetCmdBtn(b,"Cancel");a!=null&&a.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(a,false);b.dirty=true;d&&this.UpdateValues(b)};this.GetTitleInfo=function(b){var a=this.GetTitleBar(b);if(a){a.GetHeight=function(){return document.defaultView.getComputedStyle(this,"").getPropertyValue("height")};a.SetHeight=function(a){this.style.height=parseInt(a)+"px";the_fpSpread.setTitleInfo_Attribute(b,"ht",a);var c=the_fpSpread.GetTopSpread(b);the_fpSpread.SizeAll(c);the_fpSpread.Refresh(c);the_fpSpread.SaveClientEditedDataRealTime()};a.GetVisible=function(){return document.defaultView.getComputedStyle(this,"").getPropertyValue("display")=="none"?false:true;return document.defaultView.getComputedStyle(this,"").getPropertyValue("visibility")};a.SetVisible=function(a){this.style.display=a?"":"none";this.style.visibility=a?"visible":"hidden";the_fpSpread.setTitleInfo_Attribute(b,"vs",new String(a).toLocaleLowerCase());var c=the_fpSpread.GetTopSpread(b);the_fpSpread.SizeAll(c);the_fpSpread.Refresh(c);the_fpSpread.SaveClientEditedDataRealTime()};a.GetValue=function(){return this.textContent};a.SetValue=function(a){this.textContent=""+a;the_fpSpread.setTitleInfo_Attribute(b,"tx",a);the_fpSpread.SaveClientEditedDataRealTime()};return a}return null};this.SaveClientEditedDataRealTime=function(){var a=this.GetPageActiveSpread();if(a!=null){this.SaveData(a);a.dirty=false}a=this.GetPageActiveSheetView();if(a!=null){this.SaveData(a);a.dirty=false}};var strStyle="";this.ShowScrollingContent=function(c,v){var t="Row",m="Column",b="",d=this.GetTopSpread(c),r=d.getAttribute("scrollContentColumns"),x=d.getAttribute("scrollContentMaxHeight"),J=d.getAttribute("scrollContentTime"),n=this.GetViewport(d),z=this.GetColGroup(n),G=this.GetParent(n),p=0;if(c.getAttribute("lcidRow")!=null)t=c.getAttribute("lcidRow");if(c.getAttribute("lcidColumn")!=null)m=c.getAttribute("lcidColumn");if(v){for(var N=G.scrollLeft,k=this.GetColHeader(d),g=0;g<z.childNodes.length;g++){var j=z.childNodes[g];p+=j.offsetWidth;if(p>N)break}var o=this.GetViewport2(d);if(o)g+=this.GetColGroup(o).childNodes.length;if(k){var f=k.rows.length-1;if(c.getAttribute("LayoutMode")==null)f=k.getAttribute("ColTextIndex")?k.getAttribute("ColTextIndex"):k.rows.length-1;var e=this.GetHeaderCellFromRowCol(d,f,g,true);if(e)if(e.getAttribute("FpCellType")=="ExtenderCellType"&&e.getElementsByTagName("DIV").length>0){var C=this.GetEditor(e),D=this.GetFunction("ExtenderCellType_getEditorValue");if(C!=null&&D!=null)b="&nbsp;"+m+":&nbsp;"+D(C)+"&nbsp;"}else if(e.getElementsByTagName("SELECT").length>0){var A=e.getElementsByTagName("SELECT")[0];b="&nbsp;"+m+":&nbsp;"+A[A.selectedIndex].text+"&nbsp;"}else b="&nbsp;"+m+":&nbsp;"+e.innerHTML+"&nbsp;"}if(b.length<=0)b="&nbsp;"+m+":&nbsp;"+(g+1)+"&nbsp;"}else{for(var O=G.scrollTop-d.virtualTop,l=this.GetRowHeader(d),f=0,h=0,y=2,u=0;u<n.rows.length;u++){var i=n.rows[u];p+=i.offsetHeight;if(p>O){if(i.getAttribute("fpkey")==null&&!i.getAttribute("previewrow"))f--;else h=i.offsetHeight;break}if(i.getAttribute("fpkey")!=null||i.getAttribute("previewrow")){f++;h=i.offsetHeight}}var o=this.GetViewport1(d);if(o)f+=o.rows.length;if(c.getAttribute("LayoutMode")==null&&r!=null&&r.length>0){h=h>x?x:h;for(var B=r.split(","),s=false,w=0;w<B.length;w++){var j=parseInt(B[w]);if(j==null||j>=this.GetColCount(c))continue;var a=d.GetCellByRowCol(f,j);if(!a||a.getAttribute("col")!=null&&a.getAttribute("col")!=j)continue;var q=a.getAttribute("group")==1,F=a.parentNode.getAttribute("previewrow")!=null,E=a.getAttribute("RowEditTemplate")!=null,K=this.IsXHTML(c);if(!K&&strStyle==""){this.GetScrollingContentStyle(c);if(scStyle!=null){if(scStyle.fontFamily!=null&&scStyle.fontFamily!="")strStyle+="fontFamily:"+scStyle.fontFamily+";";if(scStyle.fontSize!=null&&scStyle.fontSize!="")strStyle+="fontSize:"+scStyle.fontSize+";";if(scStyle.fontStyle!=null&&scStyle.fontStyle!="")strStyle+="fontStyle:"+scStyle.fontStyle+";";if(scStyle.fontVariant!=null&&scStyle.fontVariant!="")strStyle+="fontVariant:"+scStyle.fontVariant+";";if(scStyle.fontWeight!=null&&scStyle.fontWeight!="")strStyle+="fontWeight:"+scStyle.fontWeight+";";if(scStyle.backgroundColor!=null&&scStyle.backgroundColor!="")strStyle+="backgroundColor:"+scStyle.backgroundColor+";";if(scStyle.color!=null&&scStyle.color!="")strStyle+="color:"+scStyle.color}}if(!s)b+="<div style='overflow:hidden; height:"+h+"px; ScrollingContentWidth'><table cellPadding='0' cellSpacing='0' style='height:"+h+"px;"+(q?"":"table-layout:auto;")+strStyle+"'><tr>";b+="<td style='width:"+(q?0:a.offsetWidth)+"px;'>";y+=a.offsetWidth;if(q)b+="&nbsp;<i>GroupBar:</i>&nbsp;"+a.textContent+"&nbsp;";else if(F)b+="&nbsp;<i>PreviewRow:</i>&nbsp;"+a.textContent+"&nbsp;";else if(E){var I=this.parseCell(c,a);b+="&nbsp;<i>RowEditTemplate:</i>&nbsp;"+I+"&nbsp;"}else{a.getAttribute("fpcelltype")&&this.UpdateCellTypeDOM(a);if(a.getAttribute("fpcelltype")=="MultiColumnComboBoxCellType"&&a.childNodes[0]&&a.childNodes[0].childNodes.length>0&&a.childNodes[0].getAttribute("MccbId"))b+=d.GetValue(f,j);else if(a.getAttribute("fpcelltype")=="RadioButtonListCellType"||a.getAttribute("fpcelltype")=="ExtenderCellType"||a.getAttribute("fpeditorid")!=null){var H=this.parseCell(c,a);b+=H}else b+=a.innerHTML}b+="</td>";s=true;if(q||F||E)break}if(s){b=b.replace("ScrollingContentWidth"," width:"+y+"px; ");b+="</tr></table></div>"}}if(b.length<=0&&l){var g=this.GetColGroup(l).childNodes.length-1;if(c.getAttribute("LayoutMode")==null)g=l.getAttribute("RowTextIndex")?parseInt(l.getAttribute("RowTextIndex")):this.GetColGroup(l).childNodes.length-1;var L=this.GetDisplayIndex(c,f),e=this.GetHeaderCellFromRowCol(c,L,g,false);if(e)b="&nbsp;"+t+":&nbsp;"+e.textContent+"&nbsp;"}if(b.length<=0){var M=c.getAttribute("layoutrowcount")!=null?parseInt(c.getAttribute("layoutrowcount")):1;b="&nbsp;"+t+":&nbsp;"+(parseInt(f/M)+1)+"&nbsp;"}}if(d.virtualPaging=="true"&&e!=null&&e.textContent=="")return;this.ShowMessageInner(d,b,v?-1:-2,v?-2:-1,J)};this.parseCell=function(e,d){var a=d.innerHTML,c=this.GetTopSpread(e),b=c.id;if(a.length>0){a=a.replace(new RegExp('="'+b,"g"),'="'+b+"src");a=a.replace(new RegExp("name="+b,"g"),"name="+b+"src")}return a};this.UpdateCellTypeDOM=function(b){for(var a=0;a<b.childNodes.length;a++){b.childNodes[a].tagName&&(b.childNodes[a].tagName=="INPUT"||b.childNodes[a].tagName=="SELECT")&&this.UpdateDOM(b.childNodes[a]);b.childNodes[a].childNodes&&b.childNodes[a].childNodes.length>0&&this.UpdateCellTypeDOM(b.childNodes[a])}};this.UpdateDOM=function(a){if(typeof a=="string")a=document.getElementById(a);if(a.type=="select-one")for(var b=0;b<a.options.length;b++)b==a.selectedIndex&&a.options[a.selectedIndex].setAttribute("selected","selected");else if(a.type=="text")a.setAttribute("value",a.value);else if(a.type=="textarea")a.setAttribute("value",a.value);else if(a.type=="checkbox"||a.type=="radio")if(a.checked)a.setAttribute("checked","checked");else a.removeAttribute("checked")};this.GetScrollingContentStyle=function(e){if(scStyle!=null)return;for(var f=document.styleSheets.length,a=0;a<f;a++){for(var c=document.styleSheets[a],b=0;b<c.cssRules.length;b++){var d=c.cssRules[b];if(d.selectorText=="."+e.id+"scrollContentStyle"){scStyle=d.style;break}}if(scStyle!=null)break}};this.inactiveAllChart=function(b){var a=b;while(a){if(a.activeChartObj!=null){a.activeChartObj.inactiveChart();a.activeChartObj=null}a=a.GetParentSpread(a)}};this.RefreshChart=function(a){if(this.editing)return;this.SaveData(a);var b=a.getAttribute("ajax")!="false";if(b){var c=a.getAttribute("name");this.SyncData(c,"RefreshChart,"+a.activeChartObj.chartID,a)}};this.GetActiveChartObj=function(a){return a.activeChartObj};this.SetActiveChartObj=function(a,b){a.activeChartObj=b;var c=this.CreateEvent("SelectionChanged");this.FireEvent(a,c)};this.SetActiveChart=function(ss,id){var chartContainerID=getChartByChartId(ss,id);if(chartContainerID==null)return;var chartObj=null;try{chartObj=eval(chartContainerID+"_Obj")}catch(e){}if(chartObj!=null)if(!chartObj.isActived){this.editing&&this.EndEdit(ss);ss.ClearSelection();chartObj.inactiveChart();chartObj.activeChart();var btn=this.GetCmdBtn(ss,"Update");btn!=null&&btn.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(btn,false);btn=this.GetCmdBtn(ss,"Copy");btn!=null&&btn.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(btn,true);btn=this.GetCmdBtn(ss,"Paste");btn!=null&&btn.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(btn,true);btn=this.GetCmdBtn(ss,"Clear");btn!=null&&btn.getAttribute("disabled")!=null&&this.UpdateCmdBtnState(btn,true);ss.dirty=true;this.RemoveSelection(ss,-1,-1,-1,-1)}};function getChartByChartId(d,e){for(var c=d.getElementsByTagName("DIV"),b=0;b<c.length;b++){var a=c[b];if(a.id.indexOf("_chartContainer")>0&&a.getAttribute("serverID")==e)return a.id}return null}this.GetActiveChart=function(a){return a.activeChartObj!=null?a.activeChartObj.container:null};this.updateChartURL=function(a,b){if(a.activeChartObj!=null)a.activeChartObj.getChart().src=b.src+"#"+Math.random()};this.updateChartAllImg=function(spread){for(var items=spread.getElementsByTagName("DIV"),i=0;i<items.length;i++){var item=items[i];if(item.id.indexOf("_chartContainer")>0)if(item.getAttribute("selectChart")!="false"){var chartObj=eval(item.id+"_Obj");chartObj.init();chartObj.updateChartImgitem()}}};this.initChartObj=function(spread){for(var items=spread.getElementsByTagName("DIV"),sufix="_chartContainer",initScripts=[],i=0;i<items.length;i++){var item=items[i];if(item.id.length>sufix.length&&item.id.indexOf(sufix)==item.id.length-sufix.length){var js=item.id+'_Obj = new FarPoint.Web.Spread.SpreadChart(document.getElementById("'+spread.id+'"),document.getElementById("'+item.id+'"));'+item.id+"_Obj.init();";initScripts.push(js)}}for(var i=0;i<initScripts.length;i++){var spreadTp=this.GetTopSpread(spread);spreadTp.resizing=true;eval(initScripts[i]);spreadTp.resizing=false}};this.chartDispose=function(spread){for(var items=spread.getElementsByTagName("DIV"),i=0;i<items.length;i++){var item=items[i];if(item.id.indexOf("_chartContainer")>0)if(item.getAttribute("selectChart")!="false"){var chartObj=eval(item.id+"_Obj");chartObj.dispose()}}spread.activeChartObj=null};this.GetCurrentPageIndex=function(b){var a=parseInt(b.getAttribute("currentPageIndex"));return a!=NaN?a:0}}function ComboBoxCellType_setValue(c,b,i){var g=the_fpSpread.GetCell(c);if(g==null)return;var e=g.getElementsByTagName("SELECT");if(e!=null&&e.length>0){if(b==null){e[0].selectedIndex=-1;e[0].value=""}else e[0].value=b;return}var f=the_fpSpread.GetCellEditorID(i,g),a=null;if(f!=null&&typeof f!="undefined"){a=the_fpSpread.GetCellEditor(i,f,true);if(a!=null){a.value=b;if(b==null){a.selectedIndex=-1;a.value=""}if(a.selectedIndex>=0&&a.selectedIndex<a.options.length)b=a.options[a.selectedIndex].innerHTML;var d=null;if(c.children)d=c.children;else d=c.childNodes;if(d.length>0&&d[0].tagName&&d[0].tagName.toUpperCase()=="NOBR"){var h=c;c=d[0];if(h.style.removeAttribute)h.style.removeAttribute("display");else h.style.removeProperty("display")}if(b!=null&&b!="")c.innerHTML=b;else c.innerHTML="&nbsp;"}}}function ComboBoxCellType_getValue(d,i){var h=the_fpSpread.FindContentTag(d);if(h!=null)d=h;var b=$$.utils.htmlDecode(d.innerHTML),c=the_fpSpread.GetCell(d);if(c!=null&&b==" "&&c.getAttribute("specialValue")!=null)b="";var g=c.getElementsByTagName("SELECT");if(g!=null&&g.length>0)return g[0].value;try{var f=the_fpSpread.GetCellEditorID(i,c),a=null;if(f!=null&&typeof f!="undefined"){a=the_fpSpread.GetCellEditor(i,f,true);if(a!=null){for(var j=a.options.length,e=0;e<j;e++)if($$.utils.htmlDecode(a.options[e].innerHTML)==b)return a.options[e].value;return null}}}catch(k){return null}return b}function CheckBoxCellType_setFocus(b){var a=b.getElementsByTagName("INPUT");a!=null&&a.length>0&&a[0].type=="checkbox"&&a[0].focus()}function CheckBoxCellType_getCheckBoxEditor(b){var a=b.getElementsByTagName("INPUT");return a!=null&&a.length>0&&a[0].type=="checkbox"?a[0]:null}function CheckBoxCellType_isValid(b,a){if(a==null)return"";a=the_fpSpread.Trim(a);return a==""?"":a.toLowerCase()=="true"||a.toLowerCase()=="false"?"":"invalid value"}function CheckBoxCellType_getValue(a,b){return CheckBoxCellType_getEditorValue(a,b)}function CheckBoxCellType_getEditorValue(c){var b=the_fpSpread.GetCell(c),a=CheckBoxCellType_getCheckBoxEditor(b);return a!=null&&a.checked?"true":"false"}function CheckBoxCellType_setValue(d,b){var c=the_fpSpread.GetCell(d),a=CheckBoxCellType_getCheckBoxEditor(c);if(a!=null){a.checked=b!=null&&b.toLowerCase()=="true";return}}function IntegerCellType_getValue(b){var c=b;while(c.firstChild!=null&&c.firstChild.nodeName!="#text")c=c.firstChild;var a=c.innerHTML,g=the_fpSpread.GetCell(b);if(the_fpSpread.Trim(a)=="&nbsp;")return g.getAttribute("whiteSpace")==null?"":" ";b=g;if(b.getAttribute("FpRef")!=null)b=document.getElementById(b.getAttribute("FpRef"));var e=b.getAttribute("groupchar");if(e==null)e=",";var f=a.length;while(true){a=a.replace(e,"");if(a.length==f)break;f=a.length}if(a.charAt(0)=="("&&a.charAt(a.length-1)==")"){var d=b.getAttribute("negsign");if(d==null)d="-";a=d+a.substring(1,a.length-1)}a=the_fpSpread.ReplaceAll(a,"&nbsp;"," ");return a}function IntegerCellType_isValid(f,a){if(a==null||a.length==0)return"";a=the_fpSpread.Trim(a);if(a.length==0)return"";var c=f,j=f.getAttribute("FpRef");if(j!=null)c=document.getElementById(j);var g=c.getAttribute("negsign"),i=c.getAttribute("possign");if(g!=null)a=a.replace(g,"-");if(i!=null)a=a.replace(i,"+");if(a.charAt(a.length-1)=="-")a="-"+a.substring(0,a.length-1);var k=new RegExp("^\\s*[-\\+]?\\d+\\s*$"),b=a.match(k)!=null;if(b)b=!isNaN(a);if(b){var e=c.getAttribute("MinimumValue"),d=c.getAttribute("MaximumValue"),h=parseInt(a,10);if(e!=null){e=parseInt(e,10);b=!isNaN(e)&&h>=e}if(b&&d!=null){d=parseInt(d,10);b=!isNaN(d)&&h<=d}}return!b?c.getAttribute("error")!=null?c.getAttribute("error"):"Integer":""}function IntegerCellType_setValue(c,b){var a=the_fpSpread.GetCell(c,true);if(a.getAttribute("negativeRed"))if(b<0){if(a.style.color!="red"){a.setAttribute("savedColor",a.style.color);a.style.color="red"}}else if(a.getAttribute("savedColor")!=a.style.color)a.style.color=a.getAttribute("savedColor")==null?"":a.getAttribute("savedColor");var d=c;while(d.firstChild!=null&&d.firstChild.nodeName!="#text")d=d.firstChild;c=d;if(b!=null&&b!=""){b=b.replace(" ","");c.innerHTML=b}else c.innerHTML=""}function DoubleCellType_isValid(g,a){if(a==null||a.length==0)return"";var b=g;if(g.getAttribute("FpRef")!=null)b=document.getElementById(g.getAttribute("FpRef"));var e=b.getAttribute("decimalchar");if(e==null)e=".";var d=b.getAttribute("groupchar");if(d==null)d=",";a=the_fpSpread.Trim(a);var c=true;c=a.length==0||a.charAt(0)!=d;if(c){var f=a.indexOf(e);if(f>=0){f=a.indexOf(d,f);c=f<0}}if(c){var h=a.length;while(true){a=a.replace(d,"");if(a.length==h)break;h=a.length}}if(a.length==0)c=false;else if(c){var k=b.getAttribute("negsign"),l=b.getAttribute("possign"),j=b.getAttribute("MinimumValue"),i=b.getAttribute("MaximumValue");c=the_fpSpread.IsDouble(a,e,k,l,j,i)}return!c?b.getAttribute("error")!=null?b.getAttribute("error"):"Double":""}function DoubleCellType_getValue(b){var c=b;while(c.firstChild!=null&&c.firstChild.nodeName!="#text")c=c.firstChild;var a=c.innerHTML,g=the_fpSpread.GetCell(b);if(the_fpSpread.Trim(a)=="&nbsp;")return g.getAttribute("whiteSpace")==null?"":" ";b=g;if(b.getAttribute("FpRef")!=null)b=document.getElementById(b.getAttribute("FpRef"));var e=b.getAttribute("groupchar");if(e==null)e=",";var f=a.length;while(true){a=a.replace(e,"");if(a.length==f)break;f=a.length}if(a.charAt(0)=="("&&a.charAt(a.length-1)==")"){var d=b.getAttribute("negsign");if(d==null)d="-";a=d+a.substring(1,a.length-1)}a=the_fpSpread.ReplaceAll(a,"&nbsp;"," ");return a}function DoubleCellType_setValue(c,b){var a=the_fpSpread.GetCell(c,true);if(a.getAttribute("negativeRed"))if(b<0){if(a.style.color!="red"){a.setAttribute("savedColor",a.style.color);a.style.color="red"}}else if(a.getAttribute("savedColor")!=a.style.color)a.style.color=a.getAttribute("savedColor")==null?"":a.getAttribute("savedColor");var d=c;while(d.firstChild!=null&&d.firstChild.nodeName!="#text")d=d.firstChild;c=d;if(b!=null&&b!=""){b=b.replace(" ","");c.innerHTML=b}else c.innerHTML=""}function CurrencyCellType_isValid(h,a){if(a!=null&&a.length>0){var b=h;if(h.getAttribute("FpRef")!=null)b=document.getElementById(h.getAttribute("FpRef"));var f=b.getAttribute("currencychar");if(f==null)f="$";a=a.replace(f,"");var e=b.getAttribute("groupchar");if(e==null)e=",";var d=b.getAttribute("decimalchar");if(d==null)d=".";a=the_fpSpread.Trim(a);var c=true;c=a.length==0||a.charAt(0)!=e;if(c){var g=a.indexOf(d);if(g>=0){g=a.indexOf(e,g);c=g<0}}if(c){var i=a.length;while(true){a=a.replace(e,"");if(a.length==i)break;i=a.length}}var c=true;if(a.length==0)c=false;else if(c){var l=b.getAttribute("negsign"),m=b.getAttribute("possign"),k=b.getAttribute("MinimumValue"),j=b.getAttribute("MaximumValue");c=the_fpSpread.IsDouble(a,d,l,m,k,j)}if(!c)return b.getAttribute("error")!=null?b.getAttribute("error"):"Currency ("+f+"100"+d+"10) "}return""}function CurrencyCellType_getValue(b){var d=b;while(d.firstChild!=null&&d.firstChild.nodeName!="#text")d=d.firstChild;var a=d.innerHTML,i=the_fpSpread.GetCell(b);if(the_fpSpread.Trim(a)=="&nbsp;")return i.getAttribute("whiteSpace")==null?"":" ";b=i;if(b.getAttribute("FpRef")!=null)b=document.getElementById(b.getAttribute("FpRef"));var c=b.getAttribute("currencychar");if(c!=null){var g=document.createElement("SPAN");g.innerHTML=c;c=g.innerHTML}if(c==null)c="$";var f=b.getAttribute("groupchar");if(f==null)f=",";a=a.replace(c,"");var h=a.length;while(true){a=a.replace(f,"");if(a.length==h)break;h=a.length}var e=b.getAttribute("negsign");if(e==null)e="-";if(a.charAt(0)=="("&&a.charAt(a.length-1)==")")a=e+a.substring(1,a.length-1);a=the_fpSpread.ReplaceAll(a,"&nbsp;"," ");return a}function CurrencyCellType_setValue(c,b){var a=the_fpSpread.GetCell(c,true);if(a.getAttribute("negativeRed"))if(b<0){if(a.style.color!="red"){a.setAttribute("savedColor",a.style.color);a.style.color="red"}}else if(a.getAttribute("savedColor")!=a.style.color)a.style.color=a.getAttribute("savedColor")==null?"":a.getAttribute("savedColor");var d=c;while(d.firstChild!=null&&d.firstChild.nodeName!="#text")d=d.firstChild;c=d;if(b!=null&&b!=""){b=b.replace(" ","");c.innerHTML=b}else c.innerHTML=""}function RegExpCellType_isValid(c,b){if(b==null||b=="")return"";var a=c;if(c.getAttribute("FpRef")!=null)a=document.getElementById(c.getAttribute("FpRef"));var e=new RegExp(a.getAttribute("fpexpression")),d=b.match(e),f=d!=null&&d.length>0&&b==d[0];return!f?a.getAttribute("error")!=null?a.getAttribute("error"):"invalid":""}function PercentCellType_getValue(f){var a=f;while(a.firstChild!=null&&a.firstChild.nodeName!="#text")a=a.firstChild;if(a.innerHTML=="&nbsp;")return"";a=a.innerHTML;var c=the_fpSpread.GetCell(f),b=c;if(c.getAttribute("FpRef")!=null)b=document.getElementById(c.getAttribute("FpRef"));var e=b.getAttribute("percentchar");if(e==null)e="%";a=a.replace(e,"");var d=b.getAttribute("groupchar");if(d==null)d=",";var g=a.length;while(true){a=a.replace(d,"");if(a.length==g)break;g=a.length}var h=b.getAttribute("negsign"),i=b.getAttribute("possign");a=the_fpSpread.ReplaceAll(a,"&nbsp;"," ");var k=a;if(h!=null)a=a.replace(h,"-");if(i!=null)a=a.replace(i,"+");var j=b.getAttribute("decimalchar");if(j!=null)a=a.replace(j,".");return!isNaN(a)?k:f.innerHTML}function PercentCellType_setValue(c,b){var a=the_fpSpread.GetCell(c,true);if(a.getAttribute("negativeRed"))if(b<0){if(a.style.color!="red"){a.setAttribute("savedColor",a.style.color);a.style.color="red"}}else if(a.getAttribute("savedColor")!=a.style.color)a.style.color=a.getAttribute("savedColor")==null?"":a.getAttribute("savedColor");var d=c;while(d.firstChild!=null&&d.firstChild.nodeName!="#text")d=d.firstChild;c=d;if(b!=null&&b!=""){var e=the_fpSpread.GetCell(c);if(e.getAttribute("FpRef")!=null)e=document.getElementById(e.getAttribute("FpRef"));var f=e.getAttribute("percentchar");if(f==null)f="%";b=b.replace(" ","");b=b.replace(f,"");c.innerHTML=b+f}else c.innerHTML=""}function PercentCellType_isValid(o,a){if(a!=null){var b=the_fpSpread.GetCell(o);if(b.getAttribute("FpRef")!=null)b=document.getElementById(b.getAttribute("FpRef"));var e=b.getAttribute("percentchar");if(e==null)e="%";a=a.replace(e,"");var h=b.getAttribute("groupchar");if(h==null)h=",";var k=a.length;while(true){a=a.replace(h,"");if(a.length==k)break;k=a.length}var n=a,f=b.getAttribute("negsign"),g=b.getAttribute("possign");if(f!=null)a=a.replace(f,"-");if(g!=null)a=a.replace(g,"+");var d=b.getAttribute("decimalchar");if(d!=null)a=a.replace(d,".");var c=!isNaN(a);if(c){var j=b.getAttribute("MinimumValue"),i=b.getAttribute("MaximumValue");if(j!=null||i!=null){var m=parseFloat(j),l=parseFloat(i);c=!isNaN(m)&&!isNaN(l);if(c){if(d==null)d=".";c=the_fpSpread.IsDouble(n,d,f,g,m*100,l*100)}}}if(!c)return b.getAttribute("error")!=null?b.getAttribute("error"):"Percent:(ex, 10"+e+")"}return""}function ListBoxCellType_getValue(g){var e=g.getElementsByTagName("TABLE");if(e.length>0)for(var d=e[0].rows,c=0;c<d.length;c++){var b=d[c].cells[0];if(b.getAttribute("selected")=="true"){if(b.attributes.value)return b.attributes.value.value;var a=b;while(a.firstChild!=null)a=a.firstChild;var f=a.nodeValue;return f}}return null}function ListBoxCellType_setValue(g,h){var b=g.getElementsByTagName("TABLE");if(b.length>0){b[0].style.width=g.clientWidth-6+"px";for(var f=b[0].rows,e=0;e<f.length;e++){var a=f[e].cells[0],c=a.attributes.value;if(!c){var d=a;while(d.firstChild!=null)d=d.firstChild;c=d.nodeValue}else c=c.value;if(c==h){a.setAttribute("selected","true");if(b[0].parentNode.getAttribute("selectedBackColor")!="undefined")a.style.backgroundColor=b[0].parentNode.getAttribute("selectedBackColor");if(b[0].parentNode.getAttribute("selectedForeColor")!="undefined")a.style.color=b[0].parentNode.getAttribute("selectedForeColor")}else{a.style.backgroundColor="";a.style.color="";a.setAttribute("selected","");a.bgColor=""}}}}function TextCellType_getValue(c){var b=the_fpSpread.GetCell(c,true);if(b!=null&&b.getAttribute("password")!=null)return b!=null&&b.getAttribute("value")!=null?b.getAttribute("value"):"";else{var a=c;if(c.nodeName!="INPUT"&&c.nodeName!="TEXTAREA")while(a.firstChild!=null&&a.firstChild.nodeName!="#text"&&a.firstChild.nodeName!="BR")a=a.firstChild;if(b==null)b=the_fpSpread.GetCell(c);if(the_fpSpread.Trim(a.innerHTML)=="&nbsp;")return b!=null&&b.getAttribute("whiteSpace")==null?"":" ";var e=false;if(a!=null)if(a.tagName=="INPUT"||c.tagName=="TEXTAREA")a=a.value;else{var f=the_fpSpread.GetCell(c,false);e=the_fpSpread.IsHeaderCell(the_fpSpread,f);if(!e){var d=the_fpSpread.FindContentTag(c);if(d!=null)a=$$.utils.htmlDecode(d.innerHTML);else{a=$$.utils.htmlDecode(a.innerHTML);if(a.length>1)a=a.replace(/\n\n$/g,"\n")}}else{c=a;a=$$.utils.getPlainHtmlText(a.innerHTML);a=a.trim();a=$$.utils.htmlDecode(a);if(a==" "||the_fpSpread.Trim(c.innerHTML)=="&nbsp;"){if(b!=null&&b.getAttribute("whiteSpace")==null)a="";return" "}}}return a}}function TextCellType_setValue(a,b){var e=the_fpSpread.GetCell(a,true);if(e==null)return;if(a.nodeName!="INPUT"&&a.nodeName!="TEXTAREA"){var d=a;while(d.firstChild!=null&&d.firstChild.nodeName!="#text"&&d.firstChild.nodeName!="BR")d=d.firstChild;a=d}var c=null;if(a.children)c=a.children;else c=a.childNodes;if(c.length>0&&c[0].tagName&&c[0].tagName.toUpperCase()=="NOBR"){var f=a;a=c[0];if(f.style.removeAttribute)f.style.removeAttribute("display");else f.style.removeProperty("display")}if(e.getAttribute("password")!=null)if(b!=null&&b!=""){b=b.replace(" ","");a.innerHTML="";for(var g=0;g<b.length;g++)a.innerHTML+="*";e.setAttribute("value",b)}else{a.innerHTML="";e.setAttribute("value","")}else if(a.tagName=="INPUT"||a.tagName=="TEXTAREA"){if(b==null)b="";if(typeof a.maxLength!="undefined"&&a.maxLength>0)b=b.substring(0,a.maxLength);a.value=b}else{b=$$.utils.htmlEncode(b);if(b!=null&&b!=""){if(b.length>3)b=b.replace(/<br>$/g,"<br><br>");a.innerHTML=b}else a.innerHTML="&nbsp;"}}function TextCellType_setEditorValue(b,a){b.value=a}function TextCellType_isValid(d,e){var a=the_fpSpread.GetSpread(d),f=the_fpSpread.GetCellEditorID(a,d);if(f==null)return;var c=document.getElementById(f),b=-1;if(c!=null&&typeof c.maxLength!="undefined")b=parseInt(c.maxLength);return b>0&&e!=null&&e.length>b?a.getAttribute("lcidError")!=null?a.getAttribute("lcidError"):"error":""}function GeneralCellType_getValue(d){var c=the_fpSpread.GetCell(d);if(c==null)return"";var a=d;while(a.firstChild!=null&&a.firstChild.nodeName!="#text"&&a.firstChild.nodeName!="BR")a=a.firstChild;if(a.innerHTML.trim()=="&nbsp;")return c.getAttribute("whiteSpace")==null?"":" ";var b=a.value;if(typeof b=="undefined")if(the_fpSpread.IsHeaderCell(null,c))b=a.textContent.trim();else b=$$.utils.htmlDecode(a.innerHTML);return b}function GeneralCellType_setValue(b,d){var a=the_fpSpread.GetCell(b,true);if(a.getAttribute("negativeRed"))if(d<0){if(a.style.color!="red"){a.setAttribute("savedColor",a.style.color);a.style.color="red"}}else if(a.getAttribute("savedColor")!=a.style.color)a.style.color=a.getAttribute("savedColor")==null?"":a.getAttribute("savedColor");var c=null;if(b.children)c=b.children;else c=b.childNodes;if(c.length>0&&c[0].tagName&&c[0].tagName.toUpperCase()=="NOBR"){var e=b;b=c[0];if(e.style.removeAttribute)e.style.removeAttribute("display");else e.style.removeProperty("display")}d=$$.utils.htmlEncode(d);if(d=="")d="&nbsp;";b.innerHTML=d}function EmptyCellType_getValue(a){return GeneralCellType_getValue(a)}function RadioButtonListCellType_getValue(d){var c=the_fpSpread.GetCell(d,true);if(c==null)return;for(var b=c.getElementsByTagName("INPUT"),a=0;a<b.length;a++)if(b[a].tagName=="INPUT"&&b[a].checked)return b[a].value;return null}function RadioButtonListCellType_getEditorValue(a){return RadioButtonListCellType_getValue(a)}function RadioButtonListCellType_setValue(e,c){var d=the_fpSpread.GetCell(e,true);if(d==null)return;if(c!=null)c=the_fpSpread.Trim(c);for(var b=d.getElementsByTagName("INPUT"),a=0;a<b.length;a++)if(b[a].tagName=="INPUT"&&c==the_fpSpread.Trim(b[a].value)){b[a].checked=true;break}else if(b[a].checked)b[a].checked=false}function RadioButtonListCellType_setFocus(d){var c=the_fpSpread.GetCell(d,true);if(c==null)return;var b=c.getElementsByTagName("INPUT");if(b==null)return;for(var a=0;a<b.length;a++)if(b[a].type=="radio"&&b[a].checked){b[a].focus();return}for(var a=0;a<b.length;a++)if(b[a].type=="radio"){b[a].focus();return}}function MultiColumnComboBoxCellType_setValue(rd,val,ss){var cell=the_fpSpread.GetCell(rd,true);if(cell==null)return;if(ss==null)ss=the_fpSpread.GetSpread(cell);var mccbId=getMccbID(cell,ss);if(mccbId!=null){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval(mccbId+"_Obj");if(editorObj!=null){if(editorObj.GetUseValue()==1)editorObj.SetValueToDataColumn(val);else editorObj.SetValueToTextColumn(val);if(editorObj.GetShowButton()!=1){var text=val;if(val!=null)text=editorObj.GetCurrentText(cell);if(text!=null&&text!="")rd.innerHTML=$$.utils.htmlEncode(text);else rd.innerHTML="&nbsp;"}}}}function getMccbID(d,e){var b=the_fpSpread.GetCellEditorID(e,d);if(b!=null&&typeof b!="undefined"){var c=the_fpSpread.GetCellEditor(e,b,true);if(c!=null&&c.getAttribute("MccbId")!=null)return c.getAttribute("MccbId")}var a=d.getElementsByTagName("DIV");if(a!=null&&a.length>0)if(a[0].getAttribute("MccbId")!=null)return a[0].getAttribute("MccbId");return null}function MultiColumnComboBoxCellType_getValue(rd,ss){var cl=the_fpSpread.GetCell(rd,true);if(cl==null)return null;var mccbId=getMccbID(cl,ss);if(mccbId!=null){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval(mccbId+"_Obj");if(editorObj!=null){editorObj.Value=null;return editorObj.GetCurrentValue(cl)}}return null}function MultiColumnComboBoxCellType_getEditorValue(d){var c=the_fpSpread.GetCell(d,true);if(c==null)return;var a=c.getElementsByTagName("INPUT");if(a!=null&&a.length>0){var b=a[0];return b.getAttribute("UseValue")==1?b.getAttribute("DataValue"):b.value}return null}function MultiColumnComboBoxCellType_setFocus(rd){var cell=the_fpSpread.GetCell(rd),ss=the_fpSpread.GetSpread(cell);if(cell==null)return;var divs=cell.getElementsByTagName("DIV");if(divs!=null&&divs.length>0){var mccbId=divs[0].getAttribute("MccbId");if(mccbId){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval(mccbId+"_Obj");editorObj!=null&&typeof editorObj.FocusForEdit!="undefined"&&editorObj.FocusForEdit()}}}function MultiColumnComboBoxCellType_setEditorValue(rd,editorValue,ss){var cell=the_fpSpread.GetCell(rd,true);if(cell==null)return;var editorID=the_fpSpread.GetCellEditorID(ss,cell),editor=null;if(editorID!=null&&typeof editorID!="undefined"){editor=the_fpSpread.GetCellEditor(ss,editorID,true);if(editor!=null){var mccbId=editor.getAttribute("MccbId");if(mccbId){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval(mccbId+"_Obj");if(editorObj!=null&&editorObj.SetValueToDataColumn!=null)if(editorObj.GetUseValue()==1)editorObj.SetValueToDataColumn(editorValue);else editorObj.SetValueToTextColumn(editorValue)}}}}function TagCloudCellType_getValue(b){var a=b.textContent;if(typeof a!="undefined"&&a!=null&&a.length>0){a=$$.utils.htmlDecode(a);a=the_fpSpread.Trim(a)}else a="";return a}function HyperLinkCellType_getValue(b){var a=b.textContent;if(typeof a!="undefined"&&a!=null&&a.length>0){a=the_fpSpread.ReplaceAll(a,"\n","");a=the_fpSpread.Trim(a)}else a="";return a}function ButtonCellType_getValue(b){var a=b.textContent;if(typeof a!="undefined"&&a!=null&&a.length>0){a=$$.utils.replaceAll(a,"\n","");a=the_fpSpread.Trim(a)}else a="";return a}typeof Sys!="undefined"&&typeof Sys.Application!="undefined"&&Sys.Application.notifyScriptLoaded();function getViewPortSize(b,e){if(!e)e=false;var d=the_fpSpread.GetViewport(b),f=document.getElementById(b.id+"_view"),a={top:b.virtualTop,left:0,right:d.offsetWidth,bottom:b.virtualTop+d.offsetHeight};if(hasChart(b)&&d!=null&&f!=null){var c=FpChartUtil.getUnionChartsBounds(b);if(c){a.right=Math.max(c.right+5,a.right);a.bottom=Math.max(c.bottom+5,a.bottom)}a.width=a.right-a.left;a.height=a.bottom-a.top}else{a.width=a.right-a.left;a.height=a.bottom-a.top}return a}function hasChart(a){return typeof FpChartUtil!=="undefined"&&FpChartUtil.getChartsIdCollection(a).length>0}